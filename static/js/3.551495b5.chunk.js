/*! For license information please see 3.551495b5.chunk.js.LICENSE.txt */
(this.webpackJsonpWeb3Drive=this.webpackJsonpWeb3Drive||[]).push([[3],Array(1948).concat([function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(2),s=r(25),o=r(26),u=r(149),c=r(32),f=r(3).Buffer,h=r(466),l=r(226),p=r(2003).default,d=r(57).Key,v=r(1974).TimeoutError,y=r(1985);t.OFFLINE_ERROR="This command must be run in online mode. Try running 'ipfs daemon' first.",t.MFS_FILE_TYPES={file:0,directory:1,"hamt-sharded-directory":1},t.MFS_ROOT_KEY=new d("/local/filesroot"),t.MFS_MAX_CHUNK_SIZE=262144,t.MFS_MAX_LINKS=174;var b=function(){var e=a(n.mark((function e(t,r,a){var s,o,f,h,l,p,d,v,b,m,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=a||{},Array.isArray(r)||(r=[r]),s=[],o=!0,f=!1,h=void 0,e.prev=6,l=r[Symbol.iterator]();case 8:if(o=(p=l.next()).done){e.next=24;break}if(d=p.value,!u.cid(d)){e.next=13;break}return s.push(new c(d)),e.abrupt("continue",21);case 13:if(v=y(d),b=v.cid,m=v.path){e.next=17;break}return s.push(b),e.abrupt("continue",21);case 17:return e.next=19,t.resolve(b,i({},a,{path:m}));case 19:g=e.sent,c.isCID(g.cid)&&s.push(g.cid);case 21:o=!0,e.next=8;break;case 24:e.next=30;break;case 26:e.prev=26,e.t0=e.catch(6),f=!0,h=e.t0;case 30:e.prev=30,e.prev=31,o||null==l.return||l.return();case 33:if(e.prev=33,!f){e.next=36;break}throw h;case 36:return e.finish(33);case 37:return e.finish(30);case 38:return e.abrupt("return",s);case 39:case"end":return e.stop()}}),e,null,[[6,26,30,38],[31,,33,37]])})));return function(t,r,n){return e.apply(this,arguments)}}();t.normalizePath=function(e){if(u.cid(e))return"/ipfs/".concat(new c(e));if(u.path(e))return e;throw Object.assign(new Error("invalid path: ".concat(e)),{code:"ERR_BAD_PATH"})},t.normalizeCidPath=function(e){return f.isBuffer(e)?new c(e).toString():c.isCID(e)?e.toString():(0===e.indexOf("/ipfs/")&&(e=e.substring("/ipfs/".length)),"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e)},t.resolvePath=b,t.mapFile=function(e,t){t=t||{};var r={cid:e.cid,path:e.path,name:e.name,depth:e.path.split("/").length,size:0,type:"file"};return e.unixfs&&(r.type="directory"===e.unixfs.type?"dir":"file","file"===e.unixfs.type&&(r.size=e.unixfs.fileSize(),t.includeContent&&(r.content=e.content())),r.mode=e.unixfs.mode,r.mtime=e.unixfs.mtime),r},t.withTimeoutOption=function(e,t){return function(){for(var r=arguments.length,i=new Array(r),u=0;u<r;u++)i[u]=arguments[u];var c=i[null==t?i.length-1:t];if(!c||!c.timeout)return e.apply(void 0,i);var f="string"===typeof c.timeout?p(c.timeout):c.timeout,d=new h(f);c.signal=l([c.signal,d.signal]);var y=e.apply(void 0,i),b=new Promise((function(e,t){d.signal.addEventListener("abort",(function(){t(new v)}))})),m=Date.now(),g=function(){if(d.signal.aborted)throw new v;if(Date.now()-m>f)throw d.abort(),new v};return y[Symbol.asyncIterator]?o(n.mark((function e(){var t,r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=y[Symbol.asyncIterator](),e.prev=1;case 2:return e.next=5,s(Promise.race([t.next(),b]));case 5:if(r=e.sent,i=r.value,!r.done){e.next=10;break}return e.abrupt("break",15);case 10:return g(),e.next=13,i;case 13:e.next=2;break;case 15:e.next=21;break;case 17:throw e.prev=17,e.t0=e.catch(1),g(),e.t0;case 21:return e.prev=21,d.clear(),t.return&&t.return(),e.finish(21);case 25:case"end":return e.stop()}}),e,null,[[1,17,21,25]])})))():a(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.race([y,b]);case 3:return t=e.sent,g(),e.abrupt("return",t);case 8:throw e.prev=8,e.t0=e.catch(0),g(),e.t0;case 12:return e.prev=12,d.clear(),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,8,12,15]])})))()}}},function(e,t){e.exports={options:{usePureJavaScript:!1}}},function(e,t){e.exports={options:{usePureJavaScript:!1}}},function(e,t,r){(function(t,n,i,a){var s=r(1949),o=r(2250),u=e.exports=s.util=s.util||{};function c(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function f(e){if(this.data="",this.read=0,"string"===typeof e)this.data=e;else if(u.isArrayBuffer(e)||u.isArrayBufferView(e))if("undefined"!==typeof a&&e instanceof a)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(n){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof f||"object"===typeof e&&"string"===typeof e.data&&"number"===typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!==typeof t&&t.nextTick&&!t.browser)return u.nextTick=t.nextTick,void(u.setImmediate="function"===typeof n?n:u.nextTick);if("function"===typeof n)return u.setImmediate=function(){return n.apply(void 0,arguments)},void(u.nextTick=function(e){return n(e)});if(u.setImmediate=function(e){setTimeout(e,0)},"undefined"!==typeof window&&"function"===typeof window.postMessage){var e="forge.setImmediate",r=[];u.setImmediate=function(t){r.push(t),1===r.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(t){if(t.source===window&&t.data===e){t.stopPropagation();var n=r.slice();r.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!==typeof MutationObserver){var i=Date.now(),a=!0,s=document.createElement("div");r=[];new MutationObserver((function(){var e=r.slice();r.length=0,e.forEach((function(e){e()}))})).observe(s,{attributes:!0});var o=u.setImmediate;u.setImmediate=function(e){Date.now()-i>15?(i=Date.now(),o(e)):(r.push(e),1===r.length&&s.setAttribute("a",a=!a))}}u.nextTick=u.setImmediate}(),u.isNodejs="undefined"!==typeof t&&t.versions&&t.versions.node,u.globalScope=u.isNodejs?i:"undefined"===typeof self?window:self,u.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u.isArrayBuffer=function(e){return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer},u.isArrayBufferView=function(e){return e&&u.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},u.ByteBuffer=f,u.ByteStringBuffer=f;u.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},u.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},u.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},u.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},u.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},u.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},u.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(u.encodeUtf8(e))},u.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},u.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},u.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},u.ByteStringBuffer.prototype.putInt=function(e,t){c(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},u.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},u.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},u.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},u.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},u.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},u.ByteStringBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},u.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},u.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.ByteStringBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},u.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},u.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},u.ByteStringBuffer.prototype.copy=function(){var e=u.createBuffer(this.data);return e.read=this.read,e},u.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},u.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},u.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},u.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.ByteStringBuffer.prototype.toString=function(){return u.decodeUtf8(this.bytes())},u.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=u.isArrayBuffer(e),n=u.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&void 0!==e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},u.DataBuffer.prototype.length=function(){return this.write-this.read},u.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},u.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},u.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},u.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},u.DataBuffer.prototype.putBytes=function(e,t){if(u.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(u.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof u.DataBuffer||"object"===typeof e&&"number"===typeof e.read&&"number"===typeof e.write&&u.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof u.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"===typeof e){var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=u.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=u.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},u.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},u.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},u.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},u.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},u.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},u.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},u.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},u.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},u.DataBuffer.prototype.putInt=function(e,t){c(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},u.DataBuffer.prototype.putSignedInt=function(e,t){return c(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},u.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},u.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},u.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},u.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},u.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},u.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},u.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},u.DataBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},u.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},u.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.DataBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},u.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},u.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},u.DataBuffer.prototype.copy=function(){return new u.DataBuffer(this)},u.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},u.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},u.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},u.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return u.binary.raw.encode(t);if("hex"===e)return u.binary.hex.encode(t);if("base64"===e)return u.binary.base64.encode(t);if("utf8"===e)return u.text.utf8.decode(t);if("utf16"===e)return u.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},u.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=u.encodeUtf8(e)),new u.ByteBuffer(e)},u.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},u.xorBytes=function(e,t,r){for(var n="",i="",a="",s=0,o=0;r>0;--r,++s)i=e.charCodeAt(s)^t.charCodeAt(s),o>=10&&(n+=a,a="",o=0),a+=String.fromCharCode(i),++o;return n+=a},u.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},u.bytesToHex=function(e){return u.createBuffer(e).toHex()},u.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],p="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";u.encode64=function(e,t){for(var r,n,i,a="",s="",o=0;o<e.length;)r=e.charCodeAt(o++),n=e.charCodeAt(o++),i=e.charCodeAt(o++),a+=h.charAt(r>>2),a+=h.charAt((3&r)<<4|n>>4),isNaN(n)?a+="==":(a+=h.charAt((15&n)<<2|i>>6),a+=isNaN(i)?"=":h.charAt(63&i)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},u.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,i,a="",s=0;s<e.length;)t=l[e.charCodeAt(s++)-43],r=l[e.charCodeAt(s++)-43],n=l[e.charCodeAt(s++)-43],i=l[e.charCodeAt(s++)-43],a+=String.fromCharCode(t<<2|r>>4),64!==n&&(a+=String.fromCharCode((15&r)<<4|n>>2),64!==i&&(a+=String.fromCharCode((3&n)<<6|i)));return a},u.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},u.decodeUtf8=function(e){return decodeURIComponent(escape(e))},u.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:o.encode,decode:o.decode}},u.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},u.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,a=0;a<e.length;++a)n[i++]=e.charCodeAt(a);return t?i-r:n},u.binary.hex.encode=u.bytesToHex,u.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var i=0,a=r=r||0;for(1&e.length&&(i=1,n[a++]=parseInt(e[0],16));i<e.length;i+=2)n[a++]=parseInt(e.substr(i,2),16);return t?a-r:n},u.binary.base64.encode=function(e,t){for(var r,n,i,a="",s="",o=0;o<e.byteLength;)r=e[o++],n=e[o++],i=e[o++],a+=h.charAt(r>>2),a+=h.charAt((3&r)<<4|n>>4),isNaN(n)?a+="==":(a+=h.charAt((15&n)<<2|i>>6),a+=isNaN(i)?"=":h.charAt(63&i)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},u.binary.base64.decode=function(e,t,r){var n,i,a,s,o=t;o||(o=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var u=0,c=r=r||0;u<e.length;)n=l[e.charCodeAt(u++)-43],i=l[e.charCodeAt(u++)-43],a=l[e.charCodeAt(u++)-43],s=l[e.charCodeAt(u++)-43],o[c++]=n<<2|i>>4,64!==a&&(o[c++]=(15&i)<<4|a>>2,64!==s&&(o[c++]=(3&a)<<6|s));return t?c-r:o.subarray(0,c)},u.binary.base58.encode=function(e,t){return u.binary.baseN.encode(e,p,t)},u.binary.base58.decode=function(e,t){return u.binary.baseN.decode(e,p,t)},u.text={utf8:{},utf16:{}},u.text.utf8.encode=function(e,t,r){e=u.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,a=0;a<e.length;++a)n[i++]=e.charCodeAt(a);return t?i-r:n},u.text.utf8.decode=function(e){return u.decodeUtf8(String.fromCharCode.apply(null,e))},u.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var i=new Uint16Array(n.buffer),a=r=r||0,s=r,o=0;o<e.length;++o)i[s++]=e.charCodeAt(o),a+=2;return t?a-r:n},u.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},u.deflate=function(e,t,r){if(t=u.decode64(e.deflate(u.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},u.inflate=function(e,t,r){var n=e.inflate(u.encode64(t)).rval;return null===n?null:u.decode64(n)};var d=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=u.encode64(JSON.stringify(r)),n=e.setItem(t,r)),"undefined"!==typeof n&&!0!==n.rval){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},v=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(u.decode64(r))),r},y=function(e,t,r,n){var i=v(e,t);null===i&&(i={}),i[r]=n,d(e,t,i)},b=function(e,t,r){var n=v(e,t);return null!==n&&(n=r in n?n[r]:null),n},m=function(e,t,r){var n=v(e,t);if(null!==n&&r in n){delete n[r];var i=!0;for(var a in n){i=!1;break}i&&(n=null),d(e,t,n)}},g=function(e,t){d(e,t,null)},k=function(e,t,r){var n,i=null;"undefined"===typeof r&&(r=["web","flash"]);var a=!1,s=null;for(var o in r){n=r[o];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),a="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,i=e.apply(this,t),a=!0)}catch(u){s=u}if(a)break}if(!a)throw s;return i};u.setItem=function(e,t,r,n,i){k(y,arguments,i)},u.getItem=function(e,t,r,n){return k(b,arguments,n)},u.removeItem=function(e,t,r,n){k(m,arguments,n)},u.clearItems=function(e,t,r){k(g,arguments,r)},u.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),n=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return n&&(n.fullHost=n.host,n.port?80!==n.port&&"http"===n.scheme?n.fullHost+=":"+n.port:443!==n.port&&"https"===n.scheme&&(n.fullHost+=":"+n.port):"http"===n.scheme?n.port=80:"https"===n.scheme&&(n.port=443),n.full=n.scheme+"://"+n.fullHost),n};var w=null;u.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var i,a,s=r[n].indexOf("=");s>0?(i=r[n].substring(0,s),a=r[n].substring(s+1)):(i=r[n],a=null),i in t||(t[i]=[]),i in Object.prototype||null===a||t[i].push(unescape(a))}return t};return"undefined"===typeof e?(null===w&&(w="undefined"!==typeof window&&window.location&&window.location.search?r(window.location.search.substring(1)):{}),t=w):t=r(e),t},u.parseFragment=function(e){var t=e,r="",n=e.indexOf("?");n>0&&(t=e.substring(0,n),r=e.substring(n+1));var i=t.split("/");return i.length>0&&""===i[0]&&i.shift(),{pathString:t,queryString:r,path:i,query:""===r?{}:u.getQueryVariables(r)}},u.makeRequest=function(e){var t=u.parseFragment(e),r={path:t.pathString,query:t.queryString,getPath:function(e){return"undefined"===typeof e?t.path:t.path[e]},getQuery:function(e,r){var n;return"undefined"===typeof e?n=t.query:(n=t.query[e])&&"undefined"!==typeof r&&(n=n[r]),n},getQueryLast:function(e,t){var n=r.getQuery(e);return n?n[n.length-1]:t}};return r},u.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var n=jQuery.param(t||{});return r=r||"",e+(n.length>0?"?"+n:"")+(r.length>0?"#"+r:"")},u.setPath=function(e,t,r){if("object"===typeof e&&null!==e)for(var n=0,i=t.length;n<i;){var a=t[n++];if(n==i)e[a]=r;else{var s=a in e;(!s||s&&"object"!==typeof e[a]||s&&null===e[a])&&(e[a]={}),e=e[a]}}},u.getPath=function(e,t,r){for(var n=0,i=t.length,a=!0;a&&n<i&&"object"===typeof e&&null!==e;){var s=t[n++];(a=s in e)&&(e=e[s])}return a?e:r},u.deletePath=function(e,t){if("object"===typeof e&&null!==e)for(var r=0,n=t.length;r<n;){var i=t[r++];if(r==n)delete e[i];else{if(!(i in e)||"object"!==typeof e[i]||null===e[i])break;e=e[i]}}},u.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},u.format=function(e){for(var t,r,n=/%./g,i=0,a=[],s=0;t=n.exec(e);){(r=e.substring(s,n.lastIndex-2)).length>0&&a.push(r),s=n.lastIndex;var o=t[0][1];switch(o){case"s":case"o":i<arguments.length?a.push(arguments[1+i++]):a.push("<?>");break;case"%":a.push("%");break;default:a.push("<%"+o+"?>")}}return a.push(e.substring(s)),a.join("")},u.formatNumber=function(e,t,r,n){var i=e,a=isNaN(t=Math.abs(t))?2:t,s=void 0===r?",":r,o=void 0===n?".":n,u=i<0?"-":"",c=parseInt(i=Math.abs(+i||0).toFixed(a),10)+"",f=c.length>3?c.length%3:0;return u+(f?c.substr(0,f)+o:"")+c.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+o)+(a?s+Math.abs(i-c).toFixed(a).slice(2):"")},u.formatSize=function(e){return e=e>=1073741824?u.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?u.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?u.formatNumber(e/1024,0)+" KiB":u.formatNumber(e,0)+" bytes"},u.bytesFromIP=function(e){return-1!==e.indexOf(".")?u.bytesFromIPv4(e):-1!==e.indexOf(":")?u.bytesFromIPv6(e):null},u.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=u.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},u.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=u.createBuffer(),i=0;i<8;++i)if(e[i]&&0!==e[i].length){var a=u.hexToBytes(e[i]);a.length<2&&n.putByte(0),n.putBytes(a)}else n.fillWithByte(0,r),r=0;return n.getBytes()},u.bytesToIP=function(e){return 4===e.length?u.bytesToIPv4(e):16===e.length?u.bytesToIPv6(e):null},u.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},u.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,i=0;i<e.length;i+=2){for(var a=u.bytesToHex(e[i]+e[i+1]);"0"===a[0]&&"0"!==a;)a=a.substr(1);if("0"===a){var s=r[r.length-1],o=t.length;s&&o===s.end+1?(s.end=o,s.end-s.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:o,end:o})}t.push(a)}if(r.length>0){var c=r[n];c.end-c.start>0&&(t.splice(c.start,c.end-c.start+1,""),0===c.start&&t.unshift(""),7===c.end&&t.push(""))}return t.join(":")},u.estimateCores=function(e,t){if("function"===typeof e&&(t=e,e={}),e=e||{},"cores"in u&&!e.update)return t(null,u.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return u.cores=navigator.hardwareConcurrency,t(null,u.cores);if("undefined"===typeof Worker)return u.cores=1,t(null,u.cores);if("undefined"===typeof Blob)return u.cores=2,t(null,u.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,i,a){if(0===i){var s=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return u.cores=Math.max(1,s),URL.revokeObjectURL(r),t(null,u.cores)}!function(e,t){for(var n=[],i=[],a=0;a<e;++a){var s=new Worker(r);s.addEventListener("message",(function(r){if(i.push(r.data),i.length===e){for(var a=0;a<e;++a)n[a].terminate();t(null,i)}})),n.push(s)}for(a=0;a<e;++a)n[a].postMessage(a)}(a,(function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var i=t[n],a=r[n]=[],s=0;s<e;++s)if(n!==s){var o=t[s];(i.st>o.st&&i.st<o.et||o.st>i.st&&o.st<i.et)&&a.push(s)}return r.reduce((function(e,t){return Math.max(e,t.length)}),0)}(a,r)),e(n,i-1,a)}))}([],5,16)}}).call(this,r(37),r(111).setImmediate,r(38),r(3).Buffer)},function(e,t,r){(function(t,n,i,a){var s=r(1950),o=r(2099),u=e.exports=s.util=s.util||{};function c(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function f(e){if(this.data="",this.read=0,"string"===typeof e)this.data=e;else if(u.isArrayBuffer(e)||u.isArrayBufferView(e))if("undefined"!==typeof a&&e instanceof a)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(n){for(var r=0;r<t.length;++r)this.putByte(t[r])}}else(e instanceof f||"object"===typeof e&&"string"===typeof e.data&&"number"===typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!==typeof t&&t.nextTick&&!t.browser)return u.nextTick=t.nextTick,void(u.setImmediate="function"===typeof n?n:u.nextTick);if("function"===typeof n)return u.setImmediate=function(){return n.apply(void 0,arguments)},void(u.nextTick=function(e){return n(e)});if(u.setImmediate=function(e){setTimeout(e,0)},"undefined"!==typeof window&&"function"===typeof window.postMessage){var e="forge.setImmediate",r=[];u.setImmediate=function(t){r.push(t),1===r.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(t){if(t.source===window&&t.data===e){t.stopPropagation();var n=r.slice();r.length=0,n.forEach((function(e){e()}))}}),!0)}if("undefined"!==typeof MutationObserver){var i=Date.now(),a=!0,s=document.createElement("div");r=[];new MutationObserver((function(){var e=r.slice();r.length=0,e.forEach((function(e){e()}))})).observe(s,{attributes:!0});var o=u.setImmediate;u.setImmediate=function(e){Date.now()-i>15?(i=Date.now(),o(e)):(r.push(e),1===r.length&&s.setAttribute("a",a=!a))}}u.nextTick=u.setImmediate}(),u.isNodejs="undefined"!==typeof t&&t.versions&&t.versions.node,u.globalScope=u.isNodejs?i:"undefined"===typeof self?window:self,u.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},u.isArrayBuffer=function(e){return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer},u.isArrayBufferView=function(e){return e&&u.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},u.ByteBuffer=f,u.ByteStringBuffer=f;u.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},u.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},u.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},u.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},u.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var r=this.data;t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return this.data=r,this._optimizeConstructedString(t),this},u.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},u.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(u.encodeUtf8(e))},u.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},u.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},u.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},u.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},u.ByteStringBuffer.prototype.putInt=function(e,t){c(t);var r="";do{t-=8,r+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(r)},u.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},u.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},u.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},u.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},u.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},u.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},u.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},u.ByteStringBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},u.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},u.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.ByteStringBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},u.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},u.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},u.ByteStringBuffer.prototype.copy=function(){var e=u.createBuffer(this.data);return e.read=this.read,e},u.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},u.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},u.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},u.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var r=this.data.charCodeAt(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.ByteStringBuffer.prototype.toString=function(){return u.decodeUtf8(this.bytes())},u.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var r=u.isArrayBuffer(e),n=u.isArrayBufferView(e);if(r||n)return this.data=r?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&void 0!==e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},u.DataBuffer.prototype.length=function(){return this.write-this.read},u.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},u.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+t);return n.set(r),this.data=new DataView(n.buffer),this},u.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},u.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var r=0;r<t;++r)this.data.setUint8(e);return this},u.DataBuffer.prototype.putBytes=function(e,t){if(u.isArrayBufferView(e)){var r=(n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-n.byteOffset;return this.accommodate(r),new Uint8Array(this.data.buffer,this.write).set(n),this.write+=r,this}if(u.isArrayBuffer(e)){var n=new Uint8Array(e);return this.accommodate(n.byteLength),new Uint8Array(this.data.buffer).set(n,this.write),this.write+=n.byteLength,this}if(e instanceof u.DataBuffer||"object"===typeof e&&"number"===typeof e.read&&"number"===typeof e.write&&u.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(n.byteLength),new Uint8Array(e.data.byteLength,this.write).set(n),this.write+=n.byteLength,this}if(e instanceof u.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"===typeof e){var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=u.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=u.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=u.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},u.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},u.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},u.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},u.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},u.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},u.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},u.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},u.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},u.DataBuffer.prototype.putInt=function(e,t){c(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},u.DataBuffer.prototype.putSignedInt=function(e,t){return c(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},u.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},u.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},u.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},u.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},u.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},u.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},u.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},u.DataBuffer.prototype.getInt=function(e){c(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},u.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),r=2<<e-2;return t>=r&&(t-=r<<1),t},u.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},u.DataBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},u.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},u.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},u.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},u.DataBuffer.prototype.copy=function(){return new u.DataBuffer(this)},u.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},u.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},u.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},u.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var r=this.data.getUint8(t);r<16&&(e+="0"),e+=r.toString(16)}return e},u.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return u.binary.raw.encode(t);if("hex"===e)return u.binary.hex.encode(t);if("base64"===e)return u.binary.base64.encode(t);if("utf8"===e)return u.text.utf8.decode(t);if("utf16"===e)return u.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},u.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=u.encodeUtf8(e)),new u.ByteBuffer(e)},u.fillString=function(e,t){for(var r="";t>0;)1&t&&(r+=e),(t>>>=1)>0&&(e+=e);return r},u.xorBytes=function(e,t,r){for(var n="",i="",a="",s=0,o=0;r>0;--r,++s)i=e.charCodeAt(s)^t.charCodeAt(s),o>=10&&(n+=a,a="",o=0),a+=String.fromCharCode(i),++o;return n+=a},u.hexToBytes=function(e){var t="",r=0;for(!0&e.length&&(r=1,t+=String.fromCharCode(parseInt(e[0],16)));r<e.length;r+=2)t+=String.fromCharCode(parseInt(e.substr(r,2),16));return t},u.bytesToHex=function(e){return u.createBuffer(e).toHex()},u.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],p="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";u.encode64=function(e,t){for(var r,n,i,a="",s="",o=0;o<e.length;)r=e.charCodeAt(o++),n=e.charCodeAt(o++),i=e.charCodeAt(o++),a+=h.charAt(r>>2),a+=h.charAt((3&r)<<4|n>>4),isNaN(n)?a+="==":(a+=h.charAt((15&n)<<2|i>>6),a+=isNaN(i)?"=":h.charAt(63&i)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},u.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,r,n,i,a="",s=0;s<e.length;)t=l[e.charCodeAt(s++)-43],r=l[e.charCodeAt(s++)-43],n=l[e.charCodeAt(s++)-43],i=l[e.charCodeAt(s++)-43],a+=String.fromCharCode(t<<2|r>>4),64!==n&&(a+=String.fromCharCode((15&r)<<4|n>>2),64!==i&&(a+=String.fromCharCode((3&n)<<6|i)));return a},u.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},u.decodeUtf8=function(e){return decodeURIComponent(escape(e))},u.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:o.encode,decode:o.decode}},u.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},u.binary.raw.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,a=0;a<e.length;++a)n[i++]=e.charCodeAt(a);return t?i-r:n},u.binary.hex.encode=u.bytesToHex,u.binary.hex.decode=function(e,t,r){var n=t;n||(n=new Uint8Array(Math.ceil(e.length/2)));var i=0,a=r=r||0;for(1&e.length&&(i=1,n[a++]=parseInt(e[0],16));i<e.length;i+=2)n[a++]=parseInt(e.substr(i,2),16);return t?a-r:n},u.binary.base64.encode=function(e,t){for(var r,n,i,a="",s="",o=0;o<e.byteLength;)r=e[o++],n=e[o++],i=e[o++],a+=h.charAt(r>>2),a+=h.charAt((3&r)<<4|n>>4),isNaN(n)?a+="==":(a+=h.charAt((15&n)<<2|i>>6),a+=isNaN(i)?"=":h.charAt(63&i)),t&&a.length>t&&(s+=a.substr(0,t)+"\r\n",a=a.substr(t));return s+=a},u.binary.base64.decode=function(e,t,r){var n,i,a,s,o=t;o||(o=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var u=0,c=r=r||0;u<e.length;)n=l[e.charCodeAt(u++)-43],i=l[e.charCodeAt(u++)-43],a=l[e.charCodeAt(u++)-43],s=l[e.charCodeAt(u++)-43],o[c++]=n<<2|i>>4,64!==a&&(o[c++]=(15&i)<<4|a>>2,64!==s&&(o[c++]=(3&a)<<6|s));return t?c-r:o.subarray(0,c)},u.binary.base58.encode=function(e,t){return u.binary.baseN.encode(e,p,t)},u.binary.base58.decode=function(e,t){return u.binary.baseN.decode(e,p,t)},u.text={utf8:{},utf16:{}},u.text.utf8.encode=function(e,t,r){e=u.encodeUtf8(e);var n=t;n||(n=new Uint8Array(e.length));for(var i=r=r||0,a=0;a<e.length;++a)n[i++]=e.charCodeAt(a);return t?i-r:n},u.text.utf8.decode=function(e){return u.decodeUtf8(String.fromCharCode.apply(null,e))},u.text.utf16.encode=function(e,t,r){var n=t;n||(n=new Uint8Array(2*e.length));for(var i=new Uint16Array(n.buffer),a=r=r||0,s=r,o=0;o<e.length;++o)i[s++]=e.charCodeAt(o),a+=2;return t?a-r:n},u.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},u.deflate=function(e,t,r){if(t=u.decode64(e.deflate(u.encode64(t)).rval),r){var n=2;32&t.charCodeAt(1)&&(n=6),t=t.substring(n,t.length-4)}return t},u.inflate=function(e,t,r){var n=e.inflate(u.encode64(t)).rval;return null===n?null:u.decode64(n)};var d=function(e,t,r){if(!e)throw new Error("WebStorage not available.");var n;if(null===r?n=e.removeItem(t):(r=u.encode64(JSON.stringify(r)),n=e.setItem(t,r)),"undefined"!==typeof n&&!0!==n.rval){var i=new Error(n.error.message);throw i.id=n.error.id,i.name=n.error.name,i}},v=function(e,t){if(!e)throw new Error("WebStorage not available.");var r=e.getItem(t);if(e.init)if(null===r.rval){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return null!==r&&(r=JSON.parse(u.decode64(r))),r},y=function(e,t,r,n){var i=v(e,t);null===i&&(i={}),i[r]=n,d(e,t,i)},b=function(e,t,r){var n=v(e,t);return null!==n&&(n=r in n?n[r]:null),n},m=function(e,t,r){var n=v(e,t);if(null!==n&&r in n){delete n[r];var i=!0;for(var a in n){i=!1;break}i&&(n=null),d(e,t,n)}},g=function(e,t){d(e,t,null)},k=function(e,t,r){var n,i=null;"undefined"===typeof r&&(r=["web","flash"]);var a=!1,s=null;for(var o in r){n=r[o];try{if("flash"===n||"both"===n){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),a="flash"===n}"web"!==n&&"both"!==n||(t[0]=localStorage,i=e.apply(this,t),a=!0)}catch(u){s=u}if(a)break}if(!a)throw s;return i};u.setItem=function(e,t,r,n,i){k(y,arguments,i)},u.getItem=function(e,t,r,n){return k(b,arguments,n)},u.removeItem=function(e,t,r,n){k(m,arguments,n)},u.clearItems=function(e,t,r){k(g,arguments,r)},u.parseUrl=function(e){var t=/^(https?):\/\/([^:&^\/]*):?(\d*)(.*)$/g;t.lastIndex=0;var r=t.exec(e),n=null===r?null:{full:e,scheme:r[1],host:r[2],port:r[3],path:r[4]};return n&&(n.fullHost=n.host,n.port?80!==n.port&&"http"===n.scheme?n.fullHost+=":"+n.port:443!==n.port&&"https"===n.scheme&&(n.fullHost+=":"+n.port):"http"===n.scheme?n.port=80:"https"===n.scheme&&(n.port=443),n.full=n.scheme+"://"+n.fullHost),n};var w=null;u.getQueryVariables=function(e){var t,r=function(e){for(var t={},r=e.split("&"),n=0;n<r.length;n++){var i,a,s=r[n].indexOf("=");s>0?(i=r[n].substring(0,s),a=r[n].substring(s+1)):(i=r[n],a=null),i in t||(t[i]=[]),i in Object.prototype||null===a||t[i].push(unescape(a))}return t};return"undefined"===typeof e?(null===w&&(w="undefined"!==typeof window&&window.location&&window.location.search?r(window.location.search.substring(1)):{}),t=w):t=r(e),t},u.parseFragment=function(e){var t=e,r="",n=e.indexOf("?");n>0&&(t=e.substring(0,n),r=e.substring(n+1));var i=t.split("/");return i.length>0&&""===i[0]&&i.shift(),{pathString:t,queryString:r,path:i,query:""===r?{}:u.getQueryVariables(r)}},u.makeRequest=function(e){var t=u.parseFragment(e),r={path:t.pathString,query:t.queryString,getPath:function(e){return"undefined"===typeof e?t.path:t.path[e]},getQuery:function(e,r){var n;return"undefined"===typeof e?n=t.query:(n=t.query[e])&&"undefined"!==typeof r&&(n=n[r]),n},getQueryLast:function(e,t){var n=r.getQuery(e);return n?n[n.length-1]:t}};return r},u.makeLink=function(e,t,r){e=jQuery.isArray(e)?e.join("/"):e;var n=jQuery.param(t||{});return r=r||"",e+(n.length>0?"?"+n:"")+(r.length>0?"#"+r:"")},u.setPath=function(e,t,r){if("object"===typeof e&&null!==e)for(var n=0,i=t.length;n<i;){var a=t[n++];if(n==i)e[a]=r;else{var s=a in e;(!s||s&&"object"!==typeof e[a]||s&&null===e[a])&&(e[a]={}),e=e[a]}}},u.getPath=function(e,t,r){for(var n=0,i=t.length,a=!0;a&&n<i&&"object"===typeof e&&null!==e;){var s=t[n++];(a=s in e)&&(e=e[s])}return a?e:r},u.deletePath=function(e,t){if("object"===typeof e&&null!==e)for(var r=0,n=t.length;r<n;){var i=t[r++];if(r==n)delete e[i];else{if(!(i in e)||"object"!==typeof e[i]||null===e[i])break;e=e[i]}}},u.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},u.format=function(e){for(var t,r,n=/%./g,i=0,a=[],s=0;t=n.exec(e);){(r=e.substring(s,n.lastIndex-2)).length>0&&a.push(r),s=n.lastIndex;var o=t[0][1];switch(o){case"s":case"o":i<arguments.length?a.push(arguments[1+i++]):a.push("<?>");break;case"%":a.push("%");break;default:a.push("<%"+o+"?>")}}return a.push(e.substring(s)),a.join("")},u.formatNumber=function(e,t,r,n){var i=e,a=isNaN(t=Math.abs(t))?2:t,s=void 0===r?",":r,o=void 0===n?".":n,u=i<0?"-":"",c=parseInt(i=Math.abs(+i||0).toFixed(a),10)+"",f=c.length>3?c.length%3:0;return u+(f?c.substr(0,f)+o:"")+c.substr(f).replace(/(\d{3})(?=\d)/g,"$1"+o)+(a?s+Math.abs(i-c).toFixed(a).slice(2):"")},u.formatSize=function(e){return e=e>=1073741824?u.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?u.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?u.formatNumber(e/1024,0)+" KiB":u.formatNumber(e,0)+" bytes"},u.bytesFromIP=function(e){return-1!==e.indexOf(".")?u.bytesFromIPv4(e):-1!==e.indexOf(":")?u.bytesFromIPv6(e):null},u.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=u.createBuffer(),r=0;r<e.length;++r){var n=parseInt(e[r],10);if(isNaN(n))return null;t.putByte(n)}return t.getBytes()},u.bytesFromIPv6=function(e){for(var t=0,r=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),n=u.createBuffer(),i=0;i<8;++i)if(e[i]&&0!==e[i].length){var a=u.hexToBytes(e[i]);a.length<2&&n.putByte(0),n.putBytes(a)}else n.fillWithByte(0,r),r=0;return n.getBytes()},u.bytesToIP=function(e){return 4===e.length?u.bytesToIPv4(e):16===e.length?u.bytesToIPv6(e):null},u.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t.join(".")},u.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],r=[],n=0,i=0;i<e.length;i+=2){for(var a=u.bytesToHex(e[i]+e[i+1]);"0"===a[0]&&"0"!==a;)a=a.substr(1);if("0"===a){var s=r[r.length-1],o=t.length;s&&o===s.end+1?(s.end=o,s.end-s.start>r[n].end-r[n].start&&(n=r.length-1)):r.push({start:o,end:o})}t.push(a)}if(r.length>0){var c=r[n];c.end-c.start>0&&(t.splice(c.start,c.end-c.start+1,""),0===c.start&&t.unshift(""),7===c.end&&t.push(""))}return t.join(":")},u.estimateCores=function(e,t){if("function"===typeof e&&(t=e,e={}),e=e||{},"cores"in u&&!e.update)return t(null,u.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return u.cores=navigator.hardwareConcurrency,t(null,u.cores);if("undefined"===typeof Worker)return u.cores=1,t(null,u.cores);if("undefined"===typeof Blob)return u.cores=2,t(null,u.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),r=t+4;Date.now()<r;);self.postMessage({st:t,et:r})}))}.toString(),")()"],{type:"application/javascript"}));!function e(n,i,a){if(0===i){var s=Math.floor(n.reduce((function(e,t){return e+t}),0)/n.length);return u.cores=Math.max(1,s),URL.revokeObjectURL(r),t(null,u.cores)}!function(e,t){for(var n=[],i=[],a=0;a<e;++a){var s=new Worker(r);s.addEventListener("message",(function(r){if(i.push(r.data),i.length===e){for(var a=0;a<e;++a)n[a].terminate();t(null,i)}})),n.push(s)}for(a=0;a<e;++a)n[a].postMessage(a)}(a,(function(t,r){n.push(function(e,t){for(var r=[],n=0;n<e;++n)for(var i=t[n],a=r[n]=[],s=0;s<e;++s)if(n!==s){var o=t[s];(i.st>o.st&&i.st<o.et||o.st>i.st&&o.st<i.et)&&a.push(s)}return r.reduce((function(e,t){return Math.max(e,t.length)}),0)}(a,r)),e(n,i-1,a)}))}([],5,16)}}).call(this,r(37),r(111).setImmediate,r(38),r(3).Buffer)},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(110),c=r(1),f=r(2),h=r(18),l=r(19),p=r(88),d=p.multihash,v=r(57).Key,y=r(821),b=r(336),m=r(2090),g=r(191).Record,k=r(55),w=r(15),x=r(3).Buffer;t.convertBuffer=function(e){return p.digest(e,"sha2-256")},t.convertPeerId=function(e){return p.digest(e.id,"sha2-256")},t.bufferToKey=function(e){return new v("/"+t.encodeBase32(e),!1)},t.keyForPublicKey=function(e){return x.concat([x.from("/pk/"),e.id])},t.isPublicKeyKey=function(e){return"/pk/"===e.slice(0,4).toString()},t.fromPublicKeyKey=function(e){return new k(e.slice(4))},t.now=function(){return Date.now()},t.encodeBase32=function(e){return(new y.Encoder).write(e).finalize()},t.decodeBase32=function(e){var t=new y.Decoder;return x.from(t.write(e).finalize())},t.sortClosestPeers=function(){var e=f(c.mark((function e(r,n){var i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(r,function(){var e=f(c.mark((function e(r){var i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.convertPeerId(r);case 2:return i=e.sent,e.abrupt("return",{peer:r,distance:b(i,n)});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:return i=e.sent,e.abrupt("return",i.sort(t.xorCompare).map((function(e){return e.peer})));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.xorCompare=function(e,t){return b.compare(e.distance,t.distance)},t.pathSize=function(e,t){return Math.ceil(e/t)},t.createPutRecord=function(e,t){var r=new Date;return new g(e,t,r).serialize()},t.logger=function(e,t){var r=["libp2p","dht"];t&&r.push(t),e&&r.push("".concat(e.toB58String().slice(0,8))),l.formatters.b=function(e){return d.toB58String(e)};var n=l(r.join(":"));return n.error=l(r.concat(["error"]).join(":")),n},t.TimeoutError=function(e){function t(){return n(this,t),a(this,s(t).apply(this,arguments))}return o(t,e),i(t,[{key:"code",get:function(){return"ETIMEDOUT"}}]),t}(u(Error)),t.withTimeout=function(e,t){return function(){var r=f(c.mark((function r(){var n=arguments;return c.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",Promise.race([e.apply(void 0,n),new Promise((function(e,r){setTimeout((function(){r(w(new Error("Async function did not complete before timeout"),"ETIMEDOUT"))}),t)}))]));case 1:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}()},t.mapParallel=function(){var e=f(c.mark((function e(t,r){var n,i,a,s,o,u,f,l;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=!0,a=!1,e.prev=3,o=h(t);case 5:return e.next=7,o.next();case 7:return u=e.sent,i=u.done,e.next=11,u.value;case 11:if(f=e.sent,i){e.next=18;break}l=f,n.push(r(l));case 15:i=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),a=!0,s=e.t0;case 24:if(e.prev=24,e.prev=25,i||null==o.return){e.next=29;break}return e.next=29,o.return();case 29:if(e.prev=29,!a){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(24);case 34:return e.abrupt("return",Promise.all(n));case 35:case"end":return e.stop()}}),e,null,[[3,20,24,34],[25,,29,33]])})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";t.messages={NOT_STARTED_YET:"The libp2p node is not started yet",DHT_DISABLED:"DHT is not available"},t.codes={DHT_DISABLED:"ERR_DHT_DISABLED",PUBSUB_NOT_STARTED:"ERR_PUBSUB_NOT_STARTED",DHT_NOT_STARTED:"ERR_DHT_NOT_STARTED",ERR_CONNECTION_ENDED:"ERR_CONNECTION_ENDED",ERR_CONNECTION_FAILED:"ERR_CONNECTION_FAILED",ERR_NODE_NOT_STARTED:"ERR_NODE_NOT_STARTED",ERR_ALREADY_ABORTED:"ERR_ALREADY_ABORTED",ERR_NO_VALID_ADDRESSES:"ERR_NO_VALID_ADDRESSES",ERR_DISCOVERED_SELF:"ERR_DISCOVERED_SELF",ERR_DUPLICATE_TRANSPORT:"ERR_DUPLICATE_TRANSPORT",ERR_ENCRYPTION_FAILED:"ERR_ENCRYPTION_FAILED",ERR_HOP_REQUEST_FAILED:"ERR_HOP_REQUEST_FAILED",ERR_INVALID_KEY:"ERR_INVALID_KEY",ERR_INVALID_MESSAGE:"ERR_INVALID_MESSAGE",ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_INVALID_PEER:"ERR_INVALID_PEER",ERR_MUXER_UNAVAILABLE:"ERR_MUXER_UNAVAILABLE",ERR_TIMEOUT:"ERR_TIMEOUT",ERR_TRANSPORT_UNAVAILABLE:"ERR_TRANSPORT_UNAVAILABLE",ERR_TRANSPORT_DIAL_FAILED:"ERR_TRANSPORT_DIAL_FAILED",ERR_UNSUPPORTED_PROTOCOL:"ERR_UNSUPPORTED_PROTOCOL",ERR_INVALID_MULTIADDR:"ERR_INVALID_MULTIADDR"}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(15),o=r(128),u=r(2131);function c(e,t,r){return f.apply(this,arguments)}function f(){return(f=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.digest(t,r,i);case 2:return a=e.sent,e.abrupt("return",o.encode(a,r,i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.Buffer=a,c.multihash=o,c.digest=function(){var e=i(n.mark((function e(t,r,i){var a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.createHash(r),e.next=3,a(t);case 3:return s=e.sent,e.abrupt("return",i?s.slice(0,i):s);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),c.createHash=function(e){if(!e)throw s(new Error("hash algorithm must be specified"),"ERR_HASH_ALGORITHM_NOT_SPECIFIED");if(e=o.coerceCode(e),!c.functions[e])throw s(new Error("multihash function '".concat(e,"' not yet supported")),"ERR_HASH_ALGORITHM_NOT_SUPPORTED");return c.functions[e]},c.functions={0:u.identity,17:u.sha1,18:u.sha2256,19:u.sha2512,20:u.sha3512,21:u.sha3384,22:u.sha3256,23:u.sha3224,24:u.shake128,25:u.shake256,26:u.keccak224,27:u.keccak256,28:u.keccak384,29:u.keccak512,34:u.murmur3128,35:u.murmur332,86:u.dblSha2256},u.addBlake(c.functions),c.validate=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t,o.decode(r).name);case 2:return i=e.sent,e.abrupt("return",0===a.compare(r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2050),s=r(2007),o=r(126),u=r(15),c=r(32),f=function(){var e=i(n.mark((function e(t,r,f){var h,l,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=Array.isArray(r),l=Array.isArray(r)?r:[r],e.next=4,a(t,f);case 4:return p=e.sent,l=l.map((function(e){if(c.isCID(e)&&(e="/ipfs/".concat(e)),(e=(e=(e||"").trim()).replace(/(\/\/+)/g,"/")).endsWith("/")&&e.length>1&&(e=e.substring(0,e.length-1)),!e)throw u(new Error("paths must not be empty"),"ERR_NO_PATH");if("/"!==e.substring(0,1))throw u(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");"/"===e.substring(e.length-1)&&(e=e.substring(0,e.length-1));var t,r=s(e);if("ipfs"===r[0])return t=2===r.length?"/".concat(r.join("/")):"/".concat(r.slice(0,r.length-1).join("/")),{type:"ipfs",depth:r.length-2,mfsPath:"/".concat(r.join("/")),mfsDirectory:t,parts:r,path:"/".concat(r.join("/")),name:r[r.length-1]};var n="/".concat("ipfs","/").concat(p).concat(r.length?"/"+r.join("/"):""),i="/".concat("ipfs","/").concat(p,"/").concat(r.slice(0,r.length-1).join("/"));return{type:"mfs",depth:r.length,mfsDirectory:i,mfsPath:n,parts:r,path:"/".concat(r.join("/")),name:r[r.length-1]}})),e.next=8,Promise.all(l.map(function(){var e=i(n.mark((function e(r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="mfs"===r.type?r.mfsPath:r.path,e.prev=1,e.next=4,o(i,t.ipld);case 4:a=e.sent,r.cid=a.cid,r.mfsPath="/ipfs/".concat(a.path),r.unixfs=a.unixfs,r.content=a.content,e.next=15;break;case 11:if(e.prev=11,e.t0=e.catch(1),"ERR_NOT_FOUND"===e.t0.code){e.next=15;break}throw e.t0;case 15:r.exists=Boolean(r.cid);case 16:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}()));case 8:if(!h){e.next=10;break}return e.abrupt("return",l);case 10:return e.abrupt("return",l[0]);case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports=f},function(e,t,r){"use strict";e.exports=function e(t,r){if(!t){var n=new Error(r||"Assertion failed");throw Error.captureStackTrace&&Error.captureStackTrace(n,e),n}}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(55),s=r(72),o=r(73),u=r(191).Record,c=r(3).Buffer,f=o(r(2356)),h=f.Message.MessageType,l=f.Message.ConnectionType,p=function(){function e(t,r,i){if(n(this,e),r&&!c.isBuffer(r))throw new Error("Key must be a buffer");this.type=t,this.key=r,this._clusterLevelRaw=i,this.closerPeers=[],this.providerPeers=[],this.record=null}return i(e,[{key:"serialize",value:function(){var e={key:this.key,type:this.type,clusterLevelRaw:this._clusterLevelRaw,closerPeers:this.closerPeers.map(d),providerPeers:this.providerPeers.map(d)};return this.record&&(c.isBuffer(this.record)?e.record=this.record:e.record=this.record.serialize()),f.Message.encode(e)}},{key:"clusterLevel",get:function(){var e=this._clusterLevelRaw-1;return e<0?0:e},set:function(e){this._clusterLevelRaw=e}}],[{key:"deserialize",value:function(t){var r=f.Message.decode(t),n=new e(r.type,r.key,r.clusterLevelRaw);return n.closerPeers=r.closerPeers.map(v),n.providerPeers=r.providerPeers.map(v),r.record&&(n.record=u.deserialize(r.record)),n}}]),e}();function d(e){return{id:e.id.id,addrs:(e.multiaddrs||[]).map((function(e){return e.buffer})),connection:l.CONNECTED}}function v(e){return{id:new a(e.id),multiaddrs:e.addrs.map((function(e){return s(e)}))}}p.TYPES=h,p.CONNECTION_TYPES=l,e.exports=p},function(e,t,r){"use strict";var n=r(15);e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;Array.isArray(e)&&(e=e.filter((function(e){return"object"===typeof e})).pop()||{});var r={};for(var i in t)null!==e[i]&&void 0!==e[i]?r[i]=e[i]:r[i]=t[i];if(void 0!==e.count&&(r.length=e.count),void 0!==e.p&&(r.parents=e.p),void 0!==e.l&&(r.long=e.l),r.length||0===r.length||(r.length=1/0),r.offset<0)throw n(new Error("cannot have negative write offset"),"ERR_INVALID_PARAMS");if(r.length<0)throw n(new Error("cannot have negative byte count"),"ERR_INVALID_PARAMS");return r}},function(e,t,r){var n=r(1949);r(1951),r(1978);var i=e.exports=n.asn1=n.asn1||{};function a(e,t,r){if(r>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=r,n}}i.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},i.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},i.create=function(e,t,r,a,s){if(n.util.isArray(a)){for(var o=[],u=0;u<a.length;++u)void 0!==a[u]&&o.push(a[u]);a=o}var c={tagClass:e,type:t,constructed:r,composed:r||n.util.isArray(a),value:a};return s&&"bitStringContents"in s&&(c.bitStringContents=s.bitStringContents,c.original=i.copy(c)),c},i.copy=function(e,t){var r;if(n.util.isArray(e)){r=[];for(var a=0;a<e.length;++a)r.push(i.copy(e[a],t));return r}return"string"===typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:i.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},i.equals=function(e,t,r){if(n.util.isArray(e)){if(!n.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!i.equals(e[a],t[a]))return!1;return!0}if(typeof e!==typeof t)return!1;if("string"===typeof e)return e===t;var s=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&i.equals(e.value,t.value);return r&&r.includeBitStringContents&&(s=s&&e.bitStringContents===t.bitStringContents),s},i.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};i.fromDer=function(e,t){return void 0===t&&(t={strict:!0,decodeBitStrings:!0}),"boolean"===typeof t&&(t={strict:t,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"===typeof e&&(e=n.util.createBuffer(e)),function e(t,r,n,s){var o;a(t,r,2);var u=t.getByte();r--;var c=192&u,f=31&u;o=t.length();var h,l,p=function(e,t){var r=e.getByte();if(t--,128!==r){var n;if(128&r){var i=127&r;a(e,t,i),n=e.getInt(i<<3)}else n=r;if(n<0)throw new Error("Negative length: "+n);return n}}(t,r);if(r-=o-t.length(),void 0!==p&&p>r){if(s.strict){var d=new Error("Too few bytes to read ASN.1 value.");throw d.available=t.length(),d.remaining=r,d.requested=p,d}p=r}var v=32===(32&u);if(v)if(h=[],void 0===p)for(;;){if(a(t,r,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),r-=2;break}o=t.length(),h.push(e(t,r,n+1,s)),r-=o-t.length()}else for(;p>0;)o=t.length(),h.push(e(t,p,n+1,s)),r-=o-t.length(),p-=o-t.length();void 0===h&&c===i.Class.UNIVERSAL&&f===i.Type.BITSTRING&&(l=t.bytes(p));if(void 0===h&&s.decodeBitStrings&&c===i.Class.UNIVERSAL&&f===i.Type.BITSTRING&&p>1){var y=t.read,b=r,m=0;if(f===i.Type.BITSTRING&&(a(t,r,1),m=t.getByte(),r--),0===m)try{o=t.length();var g={verbose:s.verbose,strict:!0,decodeBitStrings:!0},k=e(t,r,n+1,g),w=o-t.length();r-=w,f==i.Type.BITSTRING&&w++;var x=k.tagClass;w!==p||x!==i.Class.UNIVERSAL&&x!==i.Class.CONTEXT_SPECIFIC||(h=[k])}catch(E){}void 0===h&&(t.read=y,r=b)}if(void 0===h){if(void 0===p){if(s.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");p=r}if(f===i.Type.BMPSTRING)for(h="";p>0;p-=2)a(t,r,2),h+=String.fromCharCode(t.getInt16()),r-=2;else h=t.getBytes(p)}var S=void 0===l?null:{bitStringContents:l};return i.create(c,f,v,h,S)}(e,e.length(),0,t)},i.toDer=function(e){var t=n.util.createBuffer(),r=e.tagClass|e.type,a=n.util.createBuffer(),s=!1;if("bitStringContents"in e&&(s=!0,e.original&&(s=i.equals(e,e.original))),s)a.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:a.putByte(0);for(var o=0;o<e.value.length;++o)void 0!==e.value[o]&&a.putBuffer(i.toDer(e.value[o]))}else if(e.type===i.Type.BMPSTRING)for(o=0;o<e.value.length;++o)a.putInt16(e.value.charCodeAt(o));else e.type===i.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0===(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128===(128&e.value.charCodeAt(1)))?a.putBytes(e.value.substr(1)):a.putBytes(e.value);if(t.putByte(r),a.length()<=127)t.putByte(127&a.length());else{var u=a.length(),c="";do{c+=String.fromCharCode(255&u),u>>>=8}while(u>0);t.putByte(128|c.length);for(o=c.length-1;o>=0;--o)t.putByte(c.charCodeAt(o))}return t.putBuffer(a),t},i.oidToDer=function(e){var t,r,i,a,s=e.split("."),o=n.util.createBuffer();o.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var u=2;u<s.length;++u){t=!0,r=[],i=parseInt(s[u],10);do{a=127&i,i>>>=7,t||(a|=128),r.push(a),t=!1}while(i>0);for(var c=r.length-1;c>=0;--c)o.putByte(r[c])}return o},i.derToOid=function(e){var t;"string"===typeof e&&(e=n.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var i=0;e.length()>0;)i<<=7,128&(r=e.getByte())?i+=127&r:(t+="."+(i+r),i=0);return t},i.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),a=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=0;if(e.length>11){var u=e.charAt(10),c=10;"+"!==u&&"-"!==u&&(o=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(r,n,i),t.setUTCHours(a,s,o,0),c&&("+"===(u=e.charAt(c))||"-"===u)){var f=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);f*=6e4,"+"===u?t.setTime(+t-f):t.setTime(+t+f)}return t},i.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),a=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),u=0,c=0,f=!1;"Z"===e.charAt(e.length-1)&&(f=!0);var h=e.length-5,l=e.charAt(h);"+"!==l&&"-"!==l||(c=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),c*=6e4,"+"===l&&(c*=-1),f=!0);return"."===e.charAt(14)&&(u=1e3*parseFloat(e.substr(14),10)),f?(t.setUTCFullYear(r,n,i),t.setUTCHours(a,s,o,u),t.setTime(+t+c)):(t.setFullYear(r,n,i),t.setHours(a,s,o,u)),t},i.dateToUtcTime=function(e){if("string"===typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},i.dateToGeneralizedTime=function(e){if("string"===typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},i.integerToDer=function(e){var t=n.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},i.derToInteger=function(e){"string"===typeof e&&(e=n.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},i.validate=function(e,t,r,a){var s=!1;if(e.tagClass!==t.tagClass&&"undefined"!==typeof t.tagClass||e.type!==t.type&&"undefined"!==typeof t.type)a&&(e.tagClass!==t.tagClass&&a.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&a.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||"undefined"===typeof t.constructed){if(s=!0,t.value&&n.util.isArray(t.value))for(var o=0,u=0;s&&u<t.value.length;++u)s=t.value[u].optional||!1,e.value[o]&&((s=i.validate(e.value[o],t.value[u],r,a))?++o:t.value[u].optional&&(s=!0)),!s&&a&&a.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(s&&r)if(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else a&&a.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return s};var s=/[^\\u0000-\\u00ff]/;i.prettyPrint=function(e,t,r){var a="";r=r||2,(t=t||0)>0&&(a+="\n");for(var o="",u=0;u<t*r;++u)o+=" ";switch(a+=o+"Tag: ",e.tagClass){case i.Class.UNIVERSAL:a+="Universal:";break;case i.Class.APPLICATION:a+="Application:";break;case i.Class.CONTEXT_SPECIFIC:a+="Context-Specific:";break;case i.Class.PRIVATE:a+="Private:"}if(e.tagClass===i.Class.UNIVERSAL)switch(a+=e.type,e.type){case i.Type.NONE:a+=" (None)";break;case i.Type.BOOLEAN:a+=" (Boolean)";break;case i.Type.INTEGER:a+=" (Integer)";break;case i.Type.BITSTRING:a+=" (Bit string)";break;case i.Type.OCTETSTRING:a+=" (Octet string)";break;case i.Type.NULL:a+=" (Null)";break;case i.Type.OID:a+=" (Object Identifier)";break;case i.Type.ODESC:a+=" (Object Descriptor)";break;case i.Type.EXTERNAL:a+=" (External or Instance of)";break;case i.Type.REAL:a+=" (Real)";break;case i.Type.ENUMERATED:a+=" (Enumerated)";break;case i.Type.EMBEDDED:a+=" (Embedded PDV)";break;case i.Type.UTF8:a+=" (UTF8)";break;case i.Type.ROID:a+=" (Relative Object Identifier)";break;case i.Type.SEQUENCE:a+=" (Sequence)";break;case i.Type.SET:a+=" (Set)";break;case i.Type.PRINTABLESTRING:a+=" (Printable String)";break;case i.Type.IA5String:a+=" (IA5String (ASCII))";break;case i.Type.UTCTIME:a+=" (UTC time)";break;case i.Type.GENERALIZEDTIME:a+=" (Generalized time)";break;case i.Type.BMPSTRING:a+=" (BMP String)"}else a+=e.type;if(a+="\n",a+=o+"Constructed: "+e.constructed+"\n",e.composed){var c=0,f="";for(u=0;u<e.value.length;++u)void 0!==e.value[u]&&(c+=1,f+=i.prettyPrint(e.value[u],t+1,r),u+1<e.value.length&&(f+=","));a+=o+"Sub values: "+c+f}else{if(a+=o+"Value: ",e.type===i.Type.OID){var h=i.derToOid(e.value);a+=h,n.pki&&n.pki.oids&&h in n.pki.oids&&(a+=" ("+n.pki.oids[h]+") ")}if(e.type===i.Type.INTEGER)try{a+=i.derToInteger(e.value)}catch(p){a+="0x"+n.util.bytesToHex(e.value)}else if(e.type===i.Type.BITSTRING){if(e.value.length>1?a+="0x"+n.util.bytesToHex(e.value.slice(1)):a+="(none)",e.value.length>0){var l=e.value.charCodeAt(0);1==l?a+=" (1 unused bit shown)":l>1&&(a+=" ("+l+" unused bits shown)")}}else e.type===i.Type.OCTETSTRING?(s.test(e.value)||(a+="("+e.value+") "),a+="0x"+n.util.bytesToHex(e.value)):e.type===i.Type.UTF8?a+=n.util.decodeUtf8(e.value):e.type===i.Type.PRINTABLESTRING||e.type===i.Type.IA5String?a+=e.value:s.test(e.value)?a+="0x"+n.util.bytesToHex(e.value):0===e.value.length?a+="[null]":a+=e.value}return a}},function(e,t,r){"use strict";var n=r(48),i=r(19),a=function(e,t,r){for(var n=0,i=r.length;n<i;){if(e(t,r[n]))return!0;n+=1}return!1};e.exports={logger:function(e,t){var r=["bitswap"];t&&r.push(t),e&&r.push("".concat(e.toB58String().slice(0,8)));var n=i(r.join(":"));return n.error=i(r.concat(["error"]).join(":")),n},includesWith:a,uniqWith:function(e,t){for(var r,n=0,i=t.length,s=[];n<i;)r=t[n],a(e,r,s)||(s[s.length]=r),n+=1;return s},groupBy:function(e,t){return t.reduce((function(t,r){var n=e(r);return t[n]?t[n].push(r):t[n]=[r],t}),{})},pullAllWith:function(e,t,r){return t.filter((function(t){return!a(e,t,r)}))},sortBy:function(e,t){return Array.prototype.slice.call(t,0).sort((function(t,r){var n=e(t),i=e(r);return n<i?-1:n>i?1:0}))},isMapEqual:function(e,t){if(e.size!==t.size)return!1;var r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=n(s.value,2),c=u[0],f=u[1];if(!t.has(c))return!1;var h=t.get(c);if("function"===typeof f.equals&&!f.equals(h))return!1;if(f._data&&!f._data.equals(h._data))return!1}}catch(l){i=!0,a=l}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return!0}}},function(e,t,r){var n=r(1949);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},function(e,t,r){var n=r(1949);r(1977),r(2254),r(2255),r(1951),n.random&&n.random.getBytes?e.exports=n.random:function(t){var r={},i=new Array(4),a=n.util.createBuffer();function s(){var e=n.prng.create(r);return e.getBytes=function(t,r){return e.generate(t,r)},e.getBytesSync=function(t){return e.generate(t)},e}r.formatKey=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),n.aes._expandKey(e,!1)},r.formatSeed=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},r.cipher=function(e,t){return n.aes._updateBlock(e,t,i,!1),a.putInt32(i[0]),a.putInt32(i[1]),a.putInt32(i[2]),a.putInt32(i[3]),a.getBytes()},r.increment=function(e){return++e[3],e},r.md=n.md.sha256;var o=s(),u=null,c=n.util.globalScope,f=c.crypto||c.msCrypto;if(f&&f.getRandomValues&&(u=function(e){return f.getRandomValues(e)}),n.options.usePureJavaScript||!n.util.isNodejs&&!u){if("undefined"===typeof window||window.document,o.collectInt(+new Date,32),"undefined"!==typeof navigator){var h="";for(var l in navigator)try{"string"==typeof navigator[l]&&(h+=navigator[l])}catch(p){}o.collect(h),h=null}t&&(t().mousemove((function(e){o.collectInt(e.clientX,16),o.collectInt(e.clientY,16)})),t().keypress((function(e){o.collectInt(e.charCode,8)})))}if(n.random)for(var l in o)n.random[l]=o[l];else n.random=o;n.random.createInstance=s,e.exports=n.random}("undefined"!==typeof jQuery?jQuery:null)},function(e,t,r){"use strict";(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function a(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(2335),n.base64=r(2336),n.EventEmitter=r(2337),n.float=r(2338),n.inquire=r(2339),n.utf8=r(2340),n.pool=r(2341),n.LongBits=r(2342),n.global="undefined"!==typeof window&&window||"undefined"!==typeof e&&e||"undefined"!==typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"===typeof e||e instanceof String},n.isObject=function(e){return e&&"object"===typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!==typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"===typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=a,n.ProtocolError=a("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(38))},function(e,t,r){"use strict";var n=t.second=1e3,i=t.minute=60*n,a=t.hour=60*i;t.MAX_RECORD_AGE=36*a,t.PROTOCOL_DHT="/ipfs/kad/1.0.0",t.PROVIDERS_KEY_PREFIX="/providers/",t.PROVIDERS_LRU_CACHE_SIZE=256,t.PROVIDERS_VALIDITY=24*a,t.PROVIDERS_CLEANUP_INTERVAL=a,t.READ_MESSAGE_TIMEOUT=10*n,t.GET_MANY_RECORD_COUNT=16,t.K=20,t.ALPHA=3,t.defaultRandomWalk={enabled:!0,queriesPerPeriod:1,interval:5*i,timeout:10*n,delay:10*n}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(32),s=r(15),o=r(3).Buffer,u=r(1948).withTimeoutOption;function c(e,t){if("string"===typeof e)return"base58"!==t&&t?o.from(e,t):e;if(o.isBuffer(e))return e;if(a.isCID(e))return e.buffer;throw new Error("unsupported multihash")}e.exports=function(e){var t=e.ipld,r=e.preload;return u(function(){var e=i(n.mark((function e(i,o){var u,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=o||{},e.prev=1,u=c(i,o.enc),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),s(e.t0,"ERR_INVALID_MULTIHASH");case 8:e.prev=8,f=new a(u),e.next=15;break;case 12:throw e.prev=12,e.t1=e.catch(8),s(e.t1,"ERR_INVALID_CID");case 15:return 1===o.cidVersion&&(f=f.toV1()),!1!==o.preload&&r(f),e.abrupt("return",t.get(f,{signal:o.signal}));case 18:case"end":return e.stop()}}),e,null,[[1,5],[8,12]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){var n=r(1950);e.exports=n.md=n.md||{},n.md.algorithms=n.md.algorithms||{}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(2),s=r(61),o=s.DAGLink,u=s.DAGNode,c=r(32),f=r(19)("ipfs:mfs:core:utils:add-link"),h=r(90),l=r(339),p=r(2051),d=p.updateHamtDirectory,v=p.recreateHamtLevel,y=p.createShard,b=p.toPrefix,m=p.addLinksToHamtBucket,g=r(15),k=r(49),w=r(1955).multihash,x=r(223),S=function(){var e=a(n.mark((function e(t,r){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.parentCid||r.parent){e.next=2;break}throw g(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");case 2:if(!r.parentCid||c.isCID(r.parentCid)){e.next=4;break}throw g(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");case 4:if(r.parent){e.next=9;break}return f("Loading parent node ".concat(r.parentCid)),e.next=8,t.ipld.get(r.parentCid);case 8:r.parent=e.sent;case 9:if(r.cid){e.next=11;break}throw g(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");case 11:if(r.name){e.next=13;break}throw g(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");case 13:if(c.isCID(r.cid)||(r.cid=new c(r.cid)),r.size||0===r.size){e.next=16;break}throw g(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");case 16:if("hamt-sharded-directory"!==(a=h.unmarshal(r.parent.Data)).type){e.next=20;break}return f("Adding link to sharded directory"),e.abrupt("return",I(t,r));case 20:if(!(r.parent.Links.length>=r.shardSplitThreshold)){e.next=23;break}return f("Converting directory to sharded directory"),e.abrupt("return",E(t,i({},r,{mtime:a.mtime,mode:a.mode})));case 23:return f("Adding ".concat(r.name," (").concat(r.cid,") to regular directory")),e.abrupt("return",_(t,r));case 25:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),E=function(){var e=a(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t,r.parent.Links.map((function(e){return{name:e.Name,size:e.Tsize,cid:e.Hash}})).concat({name:r.name,size:r.size,cid:r.cid}),r);case 2:return i=e.sent,f("Converted directory to sharded directory ".concat(i.cid)),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),_=function(){var e=a(n.mark((function e(t,r){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.parent.rmLink(r.name),r.parent.addLink(new o(r.name,r.size,r.cid)),(i=h.unmarshal(r.parent.Data)).mtime&&(i.mtime=new Date,r.parent=new u(i.marshal(),r.parent.Links)),a=w.names[r.hashAlg],e.next=7,t.ipld.put(r.parent,k.DAG_PB,{cidVersion:r.cidVersion,hashAlg:a,onlyHash:!r.flush});case 7:return s=e.sent,e.abrupt("return",{node:r.parent,cid:s,size:r.parent.size});case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),I=function(){var e=a(n.mark((function e(t,r){var i,a,s,o,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(t,r);case 2:return i=e.sent,a=i.shard,s=i.path,e.next=7,x(a.flush("",t.block));case 7:return o=e.sent,e.next=10,t.ipld.get(o.cid);case 10:return u=e.sent,c=r.parent.Links.find((function(e){return e.Name.substring(0,2)===s[0].prefix})),f=u.Links.find((function(e){return e.Name.substring(0,2)===s[0].prefix})),c&&r.parent.rmLink(c.Name),r.parent.addLink(f),e.abrupt("return",d(t,r.parent.Links,s[0].bucket,r));case 16:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),A=function(){var e=a(n.mark((function e(t,r){var i,a,s,o,u,c,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={name:r.name,cid:r.cid,size:r.size},e.next=3,v(r.parent.Links);case 3:return a=e.sent,s=h.unmarshal(r.parent.Data),(o=new l({root:!0,dir:!0,parent:null,parentKey:null,path:"",dirty:!0,flat:!1,mode:s.mode},r))._bucket=a,s.mtime&&(o.mtime=new Date),e.next=10,a._findNewBucketAndPos(i.name);case 10:u=e.sent,(c=T(u))[0].node=r.parent,p=0,d=n.mark((function e(){var r,s,o,u,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c[p],p++,s=r.node,o=s.Links.find((function(e){return e.Name.substring(0,2)===r.prefix}))){e.next=8;break}return f("Link ".concat(r.prefix).concat(i.name," will be added")),p=c.length,e.abrupt("return","break");case 8:if(o.Name!=="".concat(r.prefix).concat(i.name)){e.next=12;break}return f("Link ".concat(r.prefix).concat(i.name," will be replaced")),p=c.length,e.abrupt("return","break");case 12:if(!(o.Name.length>2)){e.next=16;break}return f("Link ".concat(o.Name," ").concat(o.Hash," will be replaced with a subshard")),p=c.length,e.abrupt("return","break");case 16:return f("Found subshard ".concat(r.prefix)),e.next=19,t.ipld.get(o.Hash);case 19:if(u=e.sent,c[p]){e.next=29;break}return f("Loaded new subshard ".concat(r.prefix)),e.next=24,v(u.Links,a,r.bucket,parseInt(r.prefix,16));case 24:return e.next=26,a._findNewBucketAndPos(i.name);case 26:return h=e.sent,c.push({bucket:h.bucket,prefix:b(h.pos),node:u}),e.abrupt("return","break");case 29:return l=c[p],e.next=32,m(u.Links,l.bucket,a);case 32:l.node=u;case 33:case"end":return e.stop()}}),e)}));case 15:if(!(p<c.length)){e.next=22;break}return e.delegateYield(d(),"t0",17);case 17:if("break"!==e.t0){e.next=20;break}return e.abrupt("break",22);case 20:e.next=15;break;case 22:return e.next=24,o._bucket.put(i.name,{size:i.size,cid:i.cid});case 24:return e.abrupt("return",{shard:o,path:c});case 25:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),T=function(e){var t=e.bucket,r=e.pos,n=[{bucket:t,prefix:b(r)}];for(t=e.bucket._parent,r=e.bucket._posAtParent;t;)n.push({bucket:t,prefix:b(r)}),r=t._posAtParent,t=t._parent;return n.reverse(),n};e.exports=S},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(18),s=r(19)("ipfs:mfs:utils:update-tree"),o=r(1968),u={shardSplitThreshold:1e3},c=function(){var e=i(n.mark((function e(t,r,i){var c,f,h,l,p,d,v,y,b,m,g,k;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object.assign({},u,i),s("Trail",r),r=r.slice().reverse(),c=0,h=!0,l=!1,e.prev=6,d=a(t.ipld.getMany(r.map((function(e){return e.cid}))));case 8:return e.next=10,d.next();case 10:return v=e.sent,h=v.done,e.next=14,v.value;case 14:if(y=e.sent,h){e.next=30;break}if(b=y,m=r[c].cid,g=r[c].name,c++,f){e.next=23;break}return f={cid:m,name:g,size:b.size},e.abrupt("continue",27);case 23:return e.next=25,o(t,{parent:b,name:f.name,cid:f.cid,size:f.size,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:i.cidVersion});case 25:k=e.sent,f={cid:k.cid,name:g,size:k.size};case 27:h=!0,e.next=8;break;case 30:e.next=36;break;case 32:e.prev=32,e.t0=e.catch(6),l=!0,p=e.t0;case 36:if(e.prev=36,e.prev=37,h||null==d.return){e.next=41;break}return e.next=41,d.return();case 41:if(e.prev=41,!l){e.next=44;break}throw p;case 44:return e.finish(41);case 45:return e.finish(36);case 46:return s("Final CID ".concat(f.cid)),e.abrupt("return",f.cid);case 48:case"end":return e.stop()}}),e,null,[[6,32,36,46],[37,,41,45]])})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19)("ipfs:mfs:utils:update-mfs-root"),s=r(1948).MFS_ROOT_KEY,o=r(15),u=function(){var e=i(n.mark((function e(t,r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i&&i.signal&&i.signal.aborted)){e.next=2;break}throw o(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});case 2:return a("New MFS root will be ".concat(r)),e.next=5,t.repo.datastore.put(s,r.buffer);case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports=u},function(e,t,r){var n,i=r(2316),a=r(472),s=r(810),o=r(811),u=r(2317);"undefined"!==typeof ArrayBuffer&&(n=r(812));var c="undefined"!==typeof navigator&&/Android/i.test(navigator.userAgent),f="undefined"!==typeof navigator&&/PhantomJS/i.test(navigator.userAgent),h=c||f;t.protocol=3;var l=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},p=i(l),d={type:"error",data:"parser error"},v=r(813);function y(e,t,r){for(var n=new Array(e.length),i=o(e.length,r),a=function(e,r,i){t(r,(function(t,r){n[e]=r,i(t,n)}))},s=0;s<e.length;s++)a(s,e[s],i)}t.encodePacket=function(e,r,n,i){"function"===typeof r&&(i=r,r=!1),"function"===typeof n&&(i=n,n=null);var a=void 0===e.data?void 0:e.data.buffer||e.data;if("undefined"!==typeof ArrayBuffer&&a instanceof ArrayBuffer)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=e.data,a=new Uint8Array(i),s=new Uint8Array(1+i.byteLength);s[0]=l[e.type];for(var o=0;o<a.length;o++)s[o+1]=a[o];return n(s.buffer)}(e,r,i);if("undefined"!==typeof v&&a instanceof v)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);if(h)return function(e,r,n){if(!r)return t.encodeBase64Packet(e,n);var i=new FileReader;return i.onload=function(){t.encodePacket({type:e.type,data:i.result},r,!0,n)},i.readAsArrayBuffer(e.data)}(e,r,n);var i=new Uint8Array(1);i[0]=l[e.type];var a=new v([i.buffer,e.data]);return n(a)}(e,r,i);if(a&&a.base64)return function(e,r){var n="b"+t.packets[e.type]+e.data.data;return r(n)}(e,i);var s=l[e.type];return void 0!==e.data&&(s+=n?u.encode(String(e.data),{strict:!1}):String(e.data)),i(""+s)},t.encodeBase64Packet=function(e,r){var n,i="b"+t.packets[e.type];if("undefined"!==typeof v&&e.data instanceof v){var a=new FileReader;return a.onload=function(){var e=a.result.split(",")[1];r(i+e)},a.readAsDataURL(e.data)}try{n=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(c){for(var s=new Uint8Array(e.data),o=new Array(s.length),u=0;u<s.length;u++)o[u]=s[u];n=String.fromCharCode.apply(null,o)}return i+=btoa(n),r(i)},t.decodePacket=function(e,r,n){if(void 0===e)return d;if("string"===typeof e){if("b"===e.charAt(0))return t.decodeBase64Packet(e.substr(1),r);if(n&&!1===(e=function(e){try{e=u.decode(e,{strict:!1})}catch(t){return!1}return e}(e)))return d;var i=e.charAt(0);return Number(i)==i&&p[i]?e.length>1?{type:p[i],data:e.substring(1)}:{type:p[i]}:d}i=new Uint8Array(e)[0];var a=s(e,1);return v&&"blob"===r&&(a=new v([a])),{type:p[i],data:a}},t.decodeBase64Packet=function(e,t){var r=p[e.charAt(0)];if(!n)return{type:r,data:{base64:!0,data:e.substr(1)}};var i=n.decode(e.substr(1));return"blob"===t&&v&&(i=new v([i])),{type:r,data:i}},t.encodePayload=function(e,r,n){"function"===typeof r&&(n=r,r=null);var i=a(e);if(r&&i)return v&&!h?t.encodePayloadAsBlob(e,n):t.encodePayloadAsArrayBuffer(e,n);if(!e.length)return n("0:");y(e,(function(e,n){t.encodePacket(e,!!i&&r,!1,(function(e){n(null,function(e){return e.length+":"+e}(e))}))}),(function(e,t){return n(t.join(""))}))},t.decodePayload=function(e,r,n){if("string"!==typeof e)return t.decodePayloadAsBinary(e,r,n);var i;if("function"===typeof r&&(n=r,r=null),""===e)return n(d,0,1);for(var a,s,o="",u=0,c=e.length;u<c;u++){var f=e.charAt(u);if(":"===f){if(""===o||o!=(a=Number(o)))return n(d,0,1);if(o!=(s=e.substr(u+1,a)).length)return n(d,0,1);if(s.length){if(i=t.decodePacket(s,r,!1),d.type===i.type&&d.data===i.data)return n(d,0,1);if(!1===n(i,u+a,c))return}u+=a,o=""}else o+=f}return""!==o?n(d,0,1):void 0},t.encodePayloadAsArrayBuffer=function(e,r){if(!e.length)return r(new ArrayBuffer(0));y(e,(function(e,r){t.encodePacket(e,!0,!0,(function(e){return r(null,e)}))}),(function(e,t){var n=t.reduce((function(e,t){var r;return e+(r="string"===typeof t?t.length:t.byteLength).toString().length+r+2}),0),i=new Uint8Array(n),a=0;return t.forEach((function(e){var t="string"===typeof e,r=e;if(t){for(var n=new Uint8Array(e.length),s=0;s<e.length;s++)n[s]=e.charCodeAt(s);r=n.buffer}i[a++]=t?0:1;var o=r.byteLength.toString();for(s=0;s<o.length;s++)i[a++]=parseInt(o[s]);i[a++]=255;for(n=new Uint8Array(r),s=0;s<n.length;s++)i[a++]=n[s]})),r(i.buffer)}))},t.encodePayloadAsBlob=function(e,r){y(e,(function(e,r){t.encodePacket(e,!0,!0,(function(e){var t=new Uint8Array(1);if(t[0]=1,"string"===typeof e){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);e=n.buffer,t[0]=0}var a=(e instanceof ArrayBuffer?e.byteLength:e.size).toString(),s=new Uint8Array(a.length+1);for(i=0;i<a.length;i++)s[i]=parseInt(a[i]);if(s[a.length]=255,v){var o=new v([t.buffer,s.buffer,e]);r(null,o)}}))}),(function(e,t){return r(new v(t))}))},t.decodePayloadAsBinary=function(e,r,n){"function"===typeof r&&(n=r,r=null);for(var i=e,a=[];i.byteLength>0;){for(var o=new Uint8Array(i),u=0===o[0],c="",f=1;255!==o[f];f++){if(c.length>310)return n(d,0,1);c+=o[f]}i=s(i,2+c.length),c=parseInt(c);var h=s(i,0,c);if(u)try{h=String.fromCharCode.apply(null,new Uint8Array(h))}catch(v){var l=new Uint8Array(h);h="";for(f=0;f<l.length;f++)h+=String.fromCharCode(l[f])}a.push(h),i=s(i,c)}var p=a.length;a.forEach((function(e,i){n(t.decodePacket(e,r,!0),i,p)}))}},function(e,t,r){var n=r(1950);r(1952),r(1997);var i=e.exports=n.asn1=n.asn1||{};function a(e,t,r){if(r>t){var n=new Error("Too few bytes to parse DER.");throw n.available=e.length(),n.remaining=t,n.requested=r,n}}i.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},i.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},i.create=function(e,t,r,a,s){if(n.util.isArray(a)){for(var o=[],u=0;u<a.length;++u)void 0!==a[u]&&o.push(a[u]);a=o}var c={tagClass:e,type:t,constructed:r,composed:r||n.util.isArray(a),value:a};return s&&"bitStringContents"in s&&(c.bitStringContents=s.bitStringContents,c.original=i.copy(c)),c},i.copy=function(e,t){var r;if(n.util.isArray(e)){r=[];for(var a=0;a<e.length;++a)r.push(i.copy(e[a],t));return r}return"string"===typeof e?e:(r={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:i.copy(e.value,t)},t&&!t.excludeBitStringContents&&(r.bitStringContents=e.bitStringContents),r)},i.equals=function(e,t,r){if(n.util.isArray(e)){if(!n.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var a=0;a<e.length;++a)if(!i.equals(e[a],t[a]))return!1;return!0}if(typeof e!==typeof t)return!1;if("string"===typeof e)return e===t;var s=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&i.equals(e.value,t.value);return r&&r.includeBitStringContents&&(s=s&&e.bitStringContents===t.bitStringContents),s},i.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};i.fromDer=function(e,t){return void 0===t&&(t={strict:!0,decodeBitStrings:!0}),"boolean"===typeof t&&(t={strict:t,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"===typeof e&&(e=n.util.createBuffer(e)),function e(t,r,n,s){var o;a(t,r,2);var u=t.getByte();r--;var c=192&u,f=31&u;o=t.length();var h,l,p=function(e,t){var r=e.getByte();if(t--,128!==r){var n;if(128&r){var i=127&r;a(e,t,i),n=e.getInt(i<<3)}else n=r;if(n<0)throw new Error("Negative length: "+n);return n}}(t,r);if(r-=o-t.length(),void 0!==p&&p>r){if(s.strict){var d=new Error("Too few bytes to read ASN.1 value.");throw d.available=t.length(),d.remaining=r,d.requested=p,d}p=r}var v=32===(32&u);if(v)if(h=[],void 0===p)for(;;){if(a(t,r,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),r-=2;break}o=t.length(),h.push(e(t,r,n+1,s)),r-=o-t.length()}else for(;p>0;)o=t.length(),h.push(e(t,p,n+1,s)),r-=o-t.length(),p-=o-t.length();void 0===h&&c===i.Class.UNIVERSAL&&f===i.Type.BITSTRING&&(l=t.bytes(p));if(void 0===h&&s.decodeBitStrings&&c===i.Class.UNIVERSAL&&f===i.Type.BITSTRING&&p>1){var y=t.read,b=r,m=0;if(f===i.Type.BITSTRING&&(a(t,r,1),m=t.getByte(),r--),0===m)try{o=t.length();var g={verbose:s.verbose,strict:!0,decodeBitStrings:!0},k=e(t,r,n+1,g),w=o-t.length();r-=w,f==i.Type.BITSTRING&&w++;var x=k.tagClass;w!==p||x!==i.Class.UNIVERSAL&&x!==i.Class.CONTEXT_SPECIFIC||(h=[k])}catch(E){}void 0===h&&(t.read=y,r=b)}if(void 0===h){if(void 0===p){if(s.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");p=r}if(f===i.Type.BMPSTRING)for(h="";p>0;p-=2)a(t,r,2),h+=String.fromCharCode(t.getInt16()),r-=2;else h=t.getBytes(p)}var S=void 0===l?null:{bitStringContents:l};return i.create(c,f,v,h,S)}(e,e.length(),0,t)},i.toDer=function(e){var t=n.util.createBuffer(),r=e.tagClass|e.type,a=n.util.createBuffer(),s=!1;if("bitStringContents"in e&&(s=!0,e.original&&(s=i.equals(e,e.original))),s)a.putBytes(e.bitStringContents);else if(e.composed){e.constructed?r|=32:a.putByte(0);for(var o=0;o<e.value.length;++o)void 0!==e.value[o]&&a.putBuffer(i.toDer(e.value[o]))}else if(e.type===i.Type.BMPSTRING)for(o=0;o<e.value.length;++o)a.putInt16(e.value.charCodeAt(o));else e.type===i.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0===(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128===(128&e.value.charCodeAt(1)))?a.putBytes(e.value.substr(1)):a.putBytes(e.value);if(t.putByte(r),a.length()<=127)t.putByte(127&a.length());else{var u=a.length(),c="";do{c+=String.fromCharCode(255&u),u>>>=8}while(u>0);t.putByte(128|c.length);for(o=c.length-1;o>=0;--o)t.putByte(c.charCodeAt(o))}return t.putBuffer(a),t},i.oidToDer=function(e){var t,r,i,a,s=e.split("."),o=n.util.createBuffer();o.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var u=2;u<s.length;++u){t=!0,r=[],i=parseInt(s[u],10);do{a=127&i,i>>>=7,t||(a|=128),r.push(a),t=!1}while(i>0);for(var c=r.length-1;c>=0;--c)o.putByte(r[c])}return o},i.derToOid=function(e){var t;"string"===typeof e&&(e=n.util.createBuffer(e));var r=e.getByte();t=Math.floor(r/40)+"."+r%40;for(var i=0;e.length()>0;)i<<=7,128&(r=e.getByte())?i+=127&r:(t+="."+(i+r),i=0);return t},i.utcTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),a=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),o=0;if(e.length>11){var u=e.charAt(10),c=10;"+"!==u&&"-"!==u&&(o=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(r,n,i),t.setUTCHours(a,s,o,0),c&&("+"===(u=e.charAt(c))||"-"===u)){var f=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);f*=6e4,"+"===u?t.setTime(+t-f):t.setTime(+t+f)}return t},i.generalizedTimeToDate=function(e){var t=new Date,r=parseInt(e.substr(0,4),10),n=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),a=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),o=parseInt(e.substr(12,2),10),u=0,c=0,f=!1;"Z"===e.charAt(e.length-1)&&(f=!0);var h=e.length-5,l=e.charAt(h);"+"!==l&&"-"!==l||(c=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),c*=6e4,"+"===l&&(c*=-1),f=!0);return"."===e.charAt(14)&&(u=1e3*parseFloat(e.substr(14),10)),f?(t.setUTCFullYear(r,n,i),t.setUTCHours(a,s,o,u),t.setTime(+t+c)):(t.setFullYear(r,n,i),t.setHours(a,s,o,u)),t},i.dateToUtcTime=function(e){if("string"===typeof e)return e;var t="",r=[];r.push((""+e.getUTCFullYear()).substr(2)),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},i.dateToGeneralizedTime=function(e){if("string"===typeof e)return e;var t="",r=[];r.push(""+e.getUTCFullYear()),r.push(""+(e.getUTCMonth()+1)),r.push(""+e.getUTCDate()),r.push(""+e.getUTCHours()),r.push(""+e.getUTCMinutes()),r.push(""+e.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(t+="0"),t+=r[n];return t+="Z"},i.integerToDer=function(e){var t=n.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=e,r},i.derToInteger=function(e){"string"===typeof e&&(e=n.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},i.validate=function(e,t,r,a){var s=!1;if(e.tagClass!==t.tagClass&&"undefined"!==typeof t.tagClass||e.type!==t.type&&"undefined"!==typeof t.type)a&&(e.tagClass!==t.tagClass&&a.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&a.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||"undefined"===typeof t.constructed){if(s=!0,t.value&&n.util.isArray(t.value))for(var o=0,u=0;s&&u<t.value.length;++u)s=t.value[u].optional||!1,e.value[o]&&((s=i.validate(e.value[o],t.value[u],r,a))?++o:t.value[u].optional&&(s=!0)),!s&&a&&a.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(s&&r)if(t.capture&&(r[t.capture]=e.value),t.captureAsn1&&(r[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(r[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)r[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");r[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else a&&a.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return s};var s=/[^\\u0000-\\u00ff]/;i.prettyPrint=function(e,t,r){var a="";r=r||2,(t=t||0)>0&&(a+="\n");for(var o="",u=0;u<t*r;++u)o+=" ";switch(a+=o+"Tag: ",e.tagClass){case i.Class.UNIVERSAL:a+="Universal:";break;case i.Class.APPLICATION:a+="Application:";break;case i.Class.CONTEXT_SPECIFIC:a+="Context-Specific:";break;case i.Class.PRIVATE:a+="Private:"}if(e.tagClass===i.Class.UNIVERSAL)switch(a+=e.type,e.type){case i.Type.NONE:a+=" (None)";break;case i.Type.BOOLEAN:a+=" (Boolean)";break;case i.Type.INTEGER:a+=" (Integer)";break;case i.Type.BITSTRING:a+=" (Bit string)";break;case i.Type.OCTETSTRING:a+=" (Octet string)";break;case i.Type.NULL:a+=" (Null)";break;case i.Type.OID:a+=" (Object Identifier)";break;case i.Type.ODESC:a+=" (Object Descriptor)";break;case i.Type.EXTERNAL:a+=" (External or Instance of)";break;case i.Type.REAL:a+=" (Real)";break;case i.Type.ENUMERATED:a+=" (Enumerated)";break;case i.Type.EMBEDDED:a+=" (Embedded PDV)";break;case i.Type.UTF8:a+=" (UTF8)";break;case i.Type.ROID:a+=" (Relative Object Identifier)";break;case i.Type.SEQUENCE:a+=" (Sequence)";break;case i.Type.SET:a+=" (Set)";break;case i.Type.PRINTABLESTRING:a+=" (Printable String)";break;case i.Type.IA5String:a+=" (IA5String (ASCII))";break;case i.Type.UTCTIME:a+=" (UTC time)";break;case i.Type.GENERALIZEDTIME:a+=" (Generalized time)";break;case i.Type.BMPSTRING:a+=" (BMP String)"}else a+=e.type;if(a+="\n",a+=o+"Constructed: "+e.constructed+"\n",e.composed){var c=0,f="";for(u=0;u<e.value.length;++u)void 0!==e.value[u]&&(c+=1,f+=i.prettyPrint(e.value[u],t+1,r),u+1<e.value.length&&(f+=","));a+=o+"Sub values: "+c+f}else{if(a+=o+"Value: ",e.type===i.Type.OID){var h=i.derToOid(e.value);a+=h,n.pki&&n.pki.oids&&h in n.pki.oids&&(a+=" ("+n.pki.oids[h]+") ")}if(e.type===i.Type.INTEGER)try{a+=i.derToInteger(e.value)}catch(p){a+="0x"+n.util.bytesToHex(e.value)}else if(e.type===i.Type.BITSTRING){if(e.value.length>1?a+="0x"+n.util.bytesToHex(e.value.slice(1)):a+="(none)",e.value.length>0){var l=e.value.charCodeAt(0);1==l?a+=" (1 unused bit shown)":l>1&&(a+=" ("+l+" unused bits shown)")}}else e.type===i.Type.OCTETSTRING?(s.test(e.value)||(a+="("+e.value+") "),a+="0x"+n.util.bytesToHex(e.value)):e.type===i.Type.UTF8?a+=n.util.decodeUtf8(e.value):e.type===i.Type.PRINTABLESTRING||e.type===i.Type.IA5String?a+=e.value:s.test(e.value)?a+="0x"+n.util.bytesToHex(e.value):0===e.value.length?a+="[null]":a+=e.value}return a}},function(e,t,r){var n=r(1950);r(1995),r(2106),r(2107),r(1952),n.random&&n.random.getBytes?e.exports=n.random:function(t){var r={},i=new Array(4),a=n.util.createBuffer();function s(){var e=n.prng.create(r);return e.getBytes=function(t,r){return e.generate(t,r)},e.getBytesSync=function(t){return e.generate(t)},e}r.formatKey=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),n.aes._expandKey(e,!1)},r.formatSeed=function(e){var t=n.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},r.cipher=function(e,t){return n.aes._updateBlock(e,t,i,!1),a.putInt32(i[0]),a.putInt32(i[1]),a.putInt32(i[2]),a.putInt32(i[3]),a.getBytes()},r.increment=function(e){return++e[3],e},r.md=n.md.sha256;var o=s(),u=null,c=n.util.globalScope,f=c.crypto||c.msCrypto;if(f&&f.getRandomValues&&(u=function(e){return f.getRandomValues(e)}),n.options.usePureJavaScript||!n.util.isNodejs&&!u){if("undefined"===typeof window||window.document,o.collectInt(+new Date,32),"undefined"!==typeof navigator){var h="";for(var l in navigator)try{"string"==typeof navigator[l]&&(h+=navigator[l])}catch(p){}o.collect(h),h=null}t&&(t().mousemove((function(e){o.collectInt(e.clientX,16),o.collectInt(e.clientY,16)})),t().keypress((function(e){o.collectInt(e.charCode,8)})))}if(n.random)for(var l in o)n.random[l]=o[l];else n.random=o;n.random.createInstance=s,e.exports=n.random}("undefined"!==typeof jQuery?jQuery:null)},function(e,t,r){"use strict";var n=r(5),i=r(28),a=r(27),s=r(29),o=r(110),u=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not initialized";return n(this,t),(e=i(this,a(t).call(this,r))).name="NotInitializedError",e.code=t.code,e}return s(t,e),t}(o(Error));u.code="ERR_NOT_INITIALIZED",t.NotInitializedError=u;var c=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cannot initialize an initializing node";return n(this,t),(e=i(this,a(t).call(this,r))).name="AlreadyInitializingError",e.code=f.code,e}return s(t,e),t}(o(Error));c.code="ERR_ALREADY_INITIALIZING",t.AlreadyInitializingError=c;var f=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"cannot re-initialize an initialized node";return n(this,t),(e=i(this,a(t).call(this,r))).name="AlreadyInitializedError",e.code=t.code,e}return s(t,e),t}(o(Error));f.code="ERR_ALREADY_INITIALIZED",t.AlreadyInitializedError=f;var h=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not started";return n(this,t),(e=i(this,a(t).call(this,r))).name="NotStartedError",e.code=t.code,e}return s(t,e),t}(o(Error));h.code="ERR_NOT_STARTED",t.NotStartedError=h;var l=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not enabled";return n(this,t),(e=i(this,a(t).call(this,r))).name="NotEnabledError",e.code=t.code,e}return s(t,e),t}(o(Error));l.code="ERR_NOT_ENABLED",t.NotEnabledError=l;var p=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"request timed out";return n(this,t),(e=i(this,a(t).call(this,r))).name="TimeoutError",e.code=t.code,e}return s(t,e),t}(o(Error));p.code="ERR_TIMEOUT",t.TimeoutError=p},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(18),s=r(126),o=r(19)("ipfs:mfs:utils:to-trail"),u=function(){var e=i(n.mark((function e(t,r){var i,u,c,f,h,l,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o("Creating trail for path ".concat(r)),i=[],u=!0,c=!1,e.prev=4,h=a(s.path(r,t.ipld));case 6:return e.next=8,h.next();case 8:return l=e.sent,u=l.done,e.next=12,l.value;case 12:if(p=e.sent,u){e.next=19;break}d=p,i.push({name:d.name,cid:d.cid,size:d.node.size,type:d.unixfs?d.unixfs.type:void 0});case 16:u=!0,e.next=6;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(4),c=!0,f=e.t0;case 25:if(e.prev=25,e.prev=26,u||null==h.return){e.next=30;break}return e.next=30,h.return();case 30:if(e.prev=30,!c){e.next=33;break}throw f;case 33:return e.finish(30);case 34:return e.finish(25);case 35:return e.abrupt("return",i);case 36:case"end":return e.stop()}}),e,null,[[4,21,25,35],[26,,30,34]])})));return function(t,r){return e.apply(this,arguments)}}();e.exports=u},function(e,t,r){"use strict";var n=r(73);e.exports=n("\nmessage CircuitRelay {\n\n  enum Status {\n    SUCCESS                    = 100;\n    HOP_SRC_ADDR_TOO_LONG      = 220;\n    HOP_DST_ADDR_TOO_LONG      = 221;\n    HOP_SRC_MULTIADDR_INVALID  = 250;\n    HOP_DST_MULTIADDR_INVALID  = 251;\n    HOP_NO_CONN_TO_DST         = 260;\n    HOP_CANT_DIAL_DST          = 261;\n    HOP_CANT_OPEN_DST_STREAM   = 262;\n    HOP_CANT_SPEAK_RELAY       = 270;\n    HOP_CANT_RELAY_TO_SELF     = 280;\n    STOP_SRC_ADDR_TOO_LONG     = 320;\n    STOP_DST_ADDR_TOO_LONG     = 321;\n    STOP_SRC_MULTIADDR_INVALID = 350;\n    STOP_DST_MULTIADDR_INVALID = 351;\n    STOP_RELAY_REFUSED         = 390;\n    MALFORMED_MESSAGE          = 400;\n  }\n\n  enum Type { // RPC identifier, either HOP, STOP or STATUS\n    HOP = 1;\n    STOP = 2;\n    STATUS = 3;\n    CAN_HOP = 4;\n  }\n\n  message Peer {\n    required bytes id = 1;    // peer id\n    repeated bytes addrs = 2; // peer's known addresses\n  }\n\n  optional Type type = 1;     // Type of the message\n\n  optional Peer srcPeer = 2;  // srcPeer and dstPeer are used when Type is HOP or STATUS\n  optional Peer dstPeer = 3;\n\n  optional Status code = 4;   // Status code, used when Type is STATUS\n}\n")},function(e,t,r){var n=r(1949);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.aes.Algorithm(e,t)}))}r(2069),r(2070),r(1951),e.exports=n.aes=n.aes||{},n.aes.startEncrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!1,mode:n});return i.start(t),i},n.aes.createEncryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!1,mode:t})},n.aes.startDecrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!0,mode:n});return i.start(t),i},n.aes.createDecryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!0,mode:t})},n.aes.Algorithm=function(e,t){f||h();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return p(r._w,e,t,!1)},decrypt:function(e,t){return p(r._w,e,t,!0)}}}),r._init=!1},n.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!==typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(n.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=n.util.createBuffer();for(var i=0;i<t.length;++i)r.putByte(t[i])}}else r=n.util.createBuffer(r);if(!n.util.isArray(r)){t=r,r=[];var a=t.length();if(16===a||24===a||32===a){a>>>=2;for(i=0;i<a;++i)r.push(t.getInt32())}}if(!n.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var s=this.mode.name,o=-1!==["CFB","OFB","CTR","GCM"].indexOf(s);this._w=l(r,e.decrypt&&!o),this._init=!0}},n.aes._expandKey=function(e,t){return f||h(),l(e,t)},n.aes._updateBlock=p,i("AES-ECB",n.cipher.modes.ecb),i("AES-CBC",n.cipher.modes.cbc),i("AES-CFB",n.cipher.modes.cfb),i("AES-OFB",n.cipher.modes.ofb),i("AES-CTR",n.cipher.modes.ctr),i("AES-GCM",n.cipher.modes.gcm);var a,s,o,u,c,f=!1;function h(){f=!0,o=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;a=new Array(256),s=new Array(256),u=new Array(4),c=new Array(4);for(t=0;t<4;++t)u[t]=new Array(256),c[t]=new Array(256);var r,n,i,h,l,p,d,v=0,y=0;for(t=0;t<256;++t){h=(h=y^y<<1^y<<2^y<<3^y<<4)>>8^255&h^99,a[v]=h,s[h]=v,p=(l=e[h])<<24^h<<16^h<<8^h^l,d=((r=e[v])^(n=e[r])^(i=e[n]))<<24^(v^i)<<16^(v^n^i)<<8^v^r^i;for(var b=0;b<4;++b)u[b][v]=p,c[b][h]=d,p=p<<24|p>>>8,d=d<<24|d>>>8;0===v?v=y=1:(v=r^e[e[e[r^i]]],y^=e[e[y]])}}function l(e,t){for(var r,n=e.slice(0),i=1,s=n.length,u=4*(s+6+1),f=s;f<u;++f)r=n[f-1],f%s===0?(r=a[r>>>16&255]<<24^a[r>>>8&255]<<16^a[255&r]<<8^a[r>>>24]^o[i]<<24,i++):s>6&&f%s===4&&(r=a[r>>>24]<<24^a[r>>>16&255]<<16^a[r>>>8&255]<<8^a[255&r]),n[f]=n[f-s]^r;if(t){for(var h,l=c[0],p=c[1],d=c[2],v=c[3],y=n.slice(0),b=(f=0,(u=n.length)-4);f<u;f+=4,b-=4)if(0===f||f===u-4)y[f]=n[b],y[f+1]=n[b+3],y[f+2]=n[b+2],y[f+3]=n[b+1];else for(var m=0;m<4;++m)h=n[b+m],y[f+(3&-m)]=l[a[h>>>24]]^p[a[h>>>16&255]]^d[a[h>>>8&255]]^v[a[255&h]];n=y}return n}function p(e,t,r,n){var i,o,f,h,l,p,d,v,y,b,m,g,k=e.length/4-1;n?(i=c[0],o=c[1],f=c[2],h=c[3],l=s):(i=u[0],o=u[1],f=u[2],h=u[3],l=a),p=t[0]^e[0],d=t[n?3:1]^e[1],v=t[2]^e[2],y=t[n?1:3]^e[3];for(var w=3,x=1;x<k;++x)b=i[p>>>24]^o[d>>>16&255]^f[v>>>8&255]^h[255&y]^e[++w],m=i[d>>>24]^o[v>>>16&255]^f[y>>>8&255]^h[255&p]^e[++w],g=i[v>>>24]^o[y>>>16&255]^f[p>>>8&255]^h[255&d]^e[++w],y=i[y>>>24]^o[p>>>16&255]^f[d>>>8&255]^h[255&v]^e[++w],p=b,d=m,v=g;r[0]=l[p>>>24]<<24^l[d>>>16&255]<<16^l[v>>>8&255]<<8^l[255&y]^e[++w],r[n?3:1]=l[d>>>24]<<24^l[v>>>16&255]<<16^l[y>>>8&255]<<8^l[255&p]^e[++w],r[2]=l[v>>>24]<<24^l[y>>>16&255]<<16^l[p>>>8&255]<<8^l[255&d]^e[++w],r[n?1:3]=l[y>>>24]<<24^l[p>>>16&255]<<16^l[d>>>8&255]<<8^l[255&v]^e[++w]}function d(e){var t,r="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var a=null;r instanceof n.util.ByteBuffer&&(a=r,r={}),(r=r||{}).output=a,r.iv=e,i.call(t,r)},t}},function(e,t,r){var n=r(1949);n.pki=n.pki||{};var i=e.exports=n.pki.oids=n.oids=n.oids||{};function a(e,t){i[e]=t,i[t]=e}function s(e,t){i[e]=t}a("1.2.840.113549.1.1.1","rsaEncryption"),a("1.2.840.113549.1.1.4","md5WithRSAEncryption"),a("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),a("1.2.840.113549.1.1.7","RSAES-OAEP"),a("1.2.840.113549.1.1.8","mgf1"),a("1.2.840.113549.1.1.9","pSpecified"),a("1.2.840.113549.1.1.10","RSASSA-PSS"),a("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),a("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),a("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),a("1.3.101.112","EdDSA25519"),a("1.2.840.10040.4.3","dsa-with-sha1"),a("1.3.14.3.2.7","desCBC"),a("1.3.14.3.2.26","sha1"),a("2.16.840.1.101.3.4.2.1","sha256"),a("2.16.840.1.101.3.4.2.2","sha384"),a("2.16.840.1.101.3.4.2.3","sha512"),a("1.2.840.113549.2.5","md5"),a("1.2.840.113549.1.7.1","data"),a("1.2.840.113549.1.7.2","signedData"),a("1.2.840.113549.1.7.3","envelopedData"),a("1.2.840.113549.1.7.4","signedAndEnvelopedData"),a("1.2.840.113549.1.7.5","digestedData"),a("1.2.840.113549.1.7.6","encryptedData"),a("1.2.840.113549.1.9.1","emailAddress"),a("1.2.840.113549.1.9.2","unstructuredName"),a("1.2.840.113549.1.9.3","contentType"),a("1.2.840.113549.1.9.4","messageDigest"),a("1.2.840.113549.1.9.5","signingTime"),a("1.2.840.113549.1.9.6","counterSignature"),a("1.2.840.113549.1.9.7","challengePassword"),a("1.2.840.113549.1.9.8","unstructuredAddress"),a("1.2.840.113549.1.9.14","extensionRequest"),a("1.2.840.113549.1.9.20","friendlyName"),a("1.2.840.113549.1.9.21","localKeyId"),a("1.2.840.113549.1.9.22.1","x509Certificate"),a("1.2.840.113549.1.12.10.1.1","keyBag"),a("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),a("1.2.840.113549.1.12.10.1.3","certBag"),a("1.2.840.113549.1.12.10.1.4","crlBag"),a("1.2.840.113549.1.12.10.1.5","secretBag"),a("1.2.840.113549.1.12.10.1.6","safeContentsBag"),a("1.2.840.113549.1.5.13","pkcs5PBES2"),a("1.2.840.113549.1.5.12","pkcs5PBKDF2"),a("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),a("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),a("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),a("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),a("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),a("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),a("1.2.840.113549.2.7","hmacWithSHA1"),a("1.2.840.113549.2.8","hmacWithSHA224"),a("1.2.840.113549.2.9","hmacWithSHA256"),a("1.2.840.113549.2.10","hmacWithSHA384"),a("1.2.840.113549.2.11","hmacWithSHA512"),a("1.2.840.113549.3.7","des-EDE3-CBC"),a("2.16.840.1.101.3.4.1.2","aes128-CBC"),a("2.16.840.1.101.3.4.1.22","aes192-CBC"),a("2.16.840.1.101.3.4.1.42","aes256-CBC"),a("2.5.4.3","commonName"),a("2.5.4.5","serialName"),a("2.5.4.6","countryName"),a("2.5.4.7","localityName"),a("2.5.4.8","stateOrProvinceName"),a("2.5.4.9","streetAddress"),a("2.5.4.10","organizationName"),a("2.5.4.11","organizationalUnitName"),a("2.5.4.13","description"),a("2.5.4.15","businessCategory"),a("2.5.4.17","postalCode"),a("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),a("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),a("2.16.840.1.113730.1.1","nsCertType"),a("2.16.840.1.113730.1.13","nsComment"),s("2.5.29.1","authorityKeyIdentifier"),s("2.5.29.2","keyAttributes"),s("2.5.29.3","certificatePolicies"),s("2.5.29.4","keyUsageRestriction"),s("2.5.29.5","policyMapping"),s("2.5.29.6","subtreesConstraint"),s("2.5.29.7","subjectAltName"),s("2.5.29.8","issuerAltName"),s("2.5.29.9","subjectDirectoryAttributes"),s("2.5.29.10","basicConstraints"),s("2.5.29.11","nameConstraints"),s("2.5.29.12","policyConstraints"),s("2.5.29.13","basicConstraints"),a("2.5.29.14","subjectKeyIdentifier"),a("2.5.29.15","keyUsage"),s("2.5.29.16","privateKeyUsagePeriod"),a("2.5.29.17","subjectAltName"),a("2.5.29.18","issuerAltName"),a("2.5.29.19","basicConstraints"),s("2.5.29.20","cRLNumber"),s("2.5.29.21","cRLReason"),s("2.5.29.22","expirationDate"),s("2.5.29.23","instructionCode"),s("2.5.29.24","invalidityDate"),s("2.5.29.25","cRLDistributionPoints"),s("2.5.29.26","issuingDistributionPoint"),s("2.5.29.27","deltaCRLIndicator"),s("2.5.29.28","issuingDistributionPoint"),s("2.5.29.29","certificateIssuer"),s("2.5.29.30","nameConstraints"),a("2.5.29.31","cRLDistributionPoints"),a("2.5.29.32","certificatePolicies"),s("2.5.29.33","policyMappings"),s("2.5.29.34","policyConstraints"),a("2.5.29.35","authorityKeyIdentifier"),s("2.5.29.36","policyConstraints"),a("2.5.29.37","extKeyUsage"),s("2.5.29.46","freshestCRL"),s("2.5.29.54","inhibitAnyPolicy"),a("1.3.6.1.4.1.11129.2.4.2","timestampList"),a("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),a("1.3.6.1.5.5.7.3.1","serverAuth"),a("1.3.6.1.5.5.7.3.2","clientAuth"),a("1.3.6.1.5.5.7.3.3","codeSigning"),a("1.3.6.1.5.5.7.3.4","emailProtection"),a("1.3.6.1.5.5.7.3.8","timeStamping")},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61),s=a.DAGNode,o=a.DAGLink,u=r(1955).multihash,c=r(49),f=r(1948).withTimeoutOption,h=r(3).Buffer;function l(e,t){switch(t){case"json":return function(e){var t,r;try{var n=JSON.parse(e.toString());r=(n.Links||[]).map((function(e){return new o(e.Name||e.name,e.Size||e.size,u.fromB58String(e.Hash||e.hash||e.multihash))})),t=h.from(n.Data)}catch(i){throw new Error("failed to parse JSON: "+i)}return new s(t,r)}(e);case"protobuf":return function(e){return a.util.deserialize(e)}(e);default:throw new Error("unkown encoding: ".concat(t))}}e.exports=function(e){var t=e.ipld,r=e.gcLock,a=e.preload;return f(function(){var e=i(n.mark((function e(i,o){var u,f,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=(o=o||{}).enc,!h.isBuffer(i)){e.next=12;break}if(!u){e.next=9;break}return e.next=6,l(i,u);case 6:f=e.sent,e.next=10;break;case 9:f=new s(i);case 10:e.next=21;break;case 12:if(!s.isDAGNode(i)){e.next=16;break}f=i,e.next=21;break;case 16:if("object"!==typeof i){e.next=20;break}f=new s(i.Data,i.Links),e.next=21;break;case 20:throw new Error("obj not recognized");case 21:return e.next=23,r.readLock();case 23:return p=e.sent,e.prev=24,e.next=27,t.put(f,c.DAG_PB,{cidVersion:0,hashAlg:c.SHA2_256});case 27:return d=e.sent,!1!==o.preload&&a(d),e.abrupt("return",d);case 30:return e.prev=30,p(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[24,,30,33]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(48),s=r(5),o=r(7),u=r(227),c=r(32),f=r(49).getName,h=r(827),l=r(2409),p=r(1961).isMapEqual,d=r(2414).Message,v=r(2415),y=function(){function e(t){s(this,e),this.full=t,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}return o(e,[{key:"addEntry",value:function(t,r,n,i,a){null==n&&(n=e.WantType.Block);var s=t.toString("base58btc"),o=this.wantlist.get(s);o?(o.wantType===n&&(o.priority=r),i&&(o.cancel=Boolean(i)),a&&(o.sendDontHave=Boolean(a)),n===e.WantType.Block&&o.wantType===e.WantType.Have&&(o.wantType=n)):this.wantlist.set(s,new v(t,r,n,i,a))}},{key:"addBlock",value:function(e){var t=e.cid.toString("base58btc");this.blocks.set(t,e)}},{key:"addHave",value:function(t){var r=t.toString("base58btc");this.blockPresences.has(r)||this.blockPresences.set(r,e.BlockPresenceType.Have)}},{key:"addDontHave",value:function(t){var r=t.toString("base58btc");this.blockPresences.has(r)||this.blockPresences.set(r,e.BlockPresenceType.DontHave)}},{key:"cancel",value:function(t){var r=t.toString("base58btc");this.wantlist.delete(r),this.addEntry(t,0,e.WantType.Block,!0,!1)}},{key:"setPendingBytes",value:function(e){this.pendingBytes=e}},{key:"serializeToBitswap100",value:function(){var e={wantlist:{entries:Array.from(this.wantlist.values()).map((function(e){return{block:e.cid.buffer,priority:Number(e.priority),cancel:Boolean(e.cancel)}}))},blocks:Array.from(this.blocks.values()).map((function(e){return e.data}))};return this.full&&(e.wantlist.full=!0),d.encode(e)}},{key:"serializeToBitswap110",value:function(){var e={wantlist:{entries:Array.from(this.wantlist.values()).map((function(e){return{block:e.cid.buffer,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}}))},blockPresences:[],payload:[]};this.full&&(e.wantlist.full=!0),this.blocks.forEach((function(t){e.payload.push({prefix:t.cid.prefix,data:t.data})}));var t=!0,r=!1,n=void 0;try{for(var i,s=this.blockPresences[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){var o=a(i.value,2),u=o[0],f=o[1];e.blockPresences.push({cid:new c(u).buffer,type:f})}}catch(h){r=!0,n=h}finally{try{t||null==s.return||s.return()}finally{if(r)throw n}}return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),d.encode(e)}},{key:"equals",value:function(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&p(this.wantlist,e.wantlist)&&p(this.blocks,e.blocks)&&p(this.blockPresences,e.blockPresences))}},{key:"empty",get:function(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}},{key:Symbol.toStringTag,get:function(){var e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return"BitswapMessage <full: ".concat(this.full,", list: ").concat(e,", blocks: ").concat(t,">")}}]),e}();y.deserialize=function(){var e=i(n.mark((function e(t){var r,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=d.decode(t),a=r.wantlist&&r.wantlist.full||!1,s=new y(a),r.wantlist&&r.wantlist.entries.forEach((function(e){var t=new c(e.block);s.addEntry(t,e.priority,e.wantType,e.cancel,e.sendDontHave)})),r.blockPresences&&r.blockPresences.forEach((function(e){var t=new c(e.cid);e.type===y.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),!(r.blocks.length>0)){e.next=9;break}return e.next=8,Promise.all(r.blocks.map(function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(t,"sha2-256");case 2:r=e.sent,i=new c(r),s.addBlock(new u(t,i));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",s);case 9:if(!(r.payload.length>0)){e.next=14;break}return e.next=12,Promise.all(r.payload.map(function(){var e=i(n.mark((function e(t){var r,i,a,o,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.prefix&&t.data){e.next=2;break}return e.abrupt("return");case 2:return r=h(t.prefix),i=r[0],a=r[1],o=r[2],e.next=8,l(t.data,o);case 8:p=e.sent,d=new c(i,f(a),p),s.addBlock(new u(t.data,d));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 12:return s.setPendingBytes(r.pendingBytes),e.abrupt("return",s);case 14:return e.abrupt("return",s);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y.blockPresenceSize=function(e){return e.buffer.length+1},y.Entry=v,y.WantType={Block:d.Wantlist.WantType.Block,Have:d.Wantlist.WantType.Have},y.BlockPresenceType={Have:d.BlockPresenceType.Have,DontHave:d.BlockPresenceType.DontHave},e.exports=y},function(e,t,r){"use strict";var n=r(2040),i=r(2097),a=r(2101);t.aes=i,t.hmac=n,t.keys=a,t.randomBytes=r(2001),t.pbkdf2=r(2130)},function(e,t,r){var n,i=r(1950);e.exports=i.jsbn=i.jsbn||{};function a(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new a(null)}function o(e,t,r,n,i,a){for(var s=16383&t,o=t>>14;--a>=0;){var u=16383&this.data[e],c=this.data[e++]>>14,f=o*u+c*s;i=((u=s*u+((16383&f)<<14)+r.data[n]+i)>>28)+(f>>14)+o*c,r.data[n++]=268435455&u}return i}i.jsbn.BigInteger=a,"undefined"===typeof navigator?(a.prototype.am=o,n=28):"Microsoft Internet Explorer"==navigator.appName?(a.prototype.am=function(e,t,r,n,i,a){for(var s=32767&t,o=t>>15;--a>=0;){var u=32767&this.data[e],c=this.data[e++]>>15,f=o*u+c*s;i=((u=s*u+((32767&f)<<15)+r.data[n]+(1073741823&i))>>>30)+(f>>>15)+o*c+(i>>>30),r.data[n++]=1073741823&u}return i},n=30):"Netscape"!=navigator.appName?(a.prototype.am=function(e,t,r,n,i,a){for(;--a>=0;){var s=t*this.data[e++]+r.data[n]+i;i=Math.floor(s/67108864),r.data[n++]=67108863&s}return i},n=26):(a.prototype.am=o,n=28),a.prototype.DB=n,a.prototype.DM=(1<<n)-1,a.prototype.DV=1<<n;a.prototype.FV=Math.pow(2,52),a.prototype.F1=52-n,a.prototype.F2=2*n-52;var u,c,f=new Array;for(u="0".charCodeAt(0),c=0;c<=9;++c)f[u++]=c;for(u="a".charCodeAt(0),c=10;c<36;++c)f[u++]=c;for(u="A".charCodeAt(0),c=10;c<36;++c)f[u++]=c;function h(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function l(e,t){var r=f[e.charCodeAt(t)];return null==r?-1:r}function p(e){var t=s();return t.fromInt(e),t}function d(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function v(e){this.m=e}function y(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function b(e,t){return e&t}function m(e,t){return e|t}function g(e,t){return e^t}function k(e,t){return e&~t}function w(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function x(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function S(){}function E(e){return e}function _(e){this.r2=s(),this.q3=s(),a.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}v.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},y.prototype.convert=function(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(a.ZERO)>0&&this.m.subTo(t,t),t},y.prototype.revert=function(e){var t=s();return e.copyTo(t),this.reduce(t),t},y.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},y.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},a.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},a.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},a.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,i=!1,s=0;--n>=0;){var o=8==r?255&e[n]:l(e,n);o<0?"-"==e.charAt(n)&&(i=!0):(i=!1,0==s?this.data[this.t++]=o:s+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,(s+=r)>=this.DB&&(s-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&a.ZERO.subTo(this,this)},a.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},a.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},a.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},a.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,a=(1<<i)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+s+1]=this.data[r]>>i|o,o=(this.data[r]&a)<<n;for(r=s-1;r>=0;--r)t.data[r]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()},a.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,a=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var s=r+1;s<this.t;++s)t.data[s-r-1]|=(this.data[s]&a)<<i,t.data[s-r]=this.data[s]>>n;n>0&&(t.data[this.t-r-1]|=(this.s&a)<<i),t.t=this.t-r,t.clamp()}},a.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:n>0&&(t.data[r++]=n),t.t=r,t.clamp()},a.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),i=r.t;for(t.t=i+n.t;--i>=0;)t.data[i]=0;for(i=0;i<n.t;++i)t.data[i+r.t]=r.am(0,n.data[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&a.ZERO.subTo(t,t)},a.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},a.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=s());var o=s(),u=this.s,c=e.s,f=this.DB-d(n.data[n.t-1]);f>0?(n.lShiftTo(f,o),i.lShiftTo(f,r)):(n.copyTo(o),i.copyTo(r));var h=o.t,l=o.data[h-1];if(0!=l){var p=l*(1<<this.F1)+(h>1?o.data[h-2]>>this.F2:0),v=this.FV/p,y=(1<<this.F1)/p,b=1<<this.F2,m=r.t,g=m-h,k=null==t?s():t;for(o.dlShiftTo(g,k),r.compareTo(k)>=0&&(r.data[r.t++]=1,r.subTo(k,r)),a.ONE.dlShiftTo(h,k),k.subTo(o,o);o.t<h;)o.data[o.t++]=0;for(;--g>=0;){var w=r.data[--m]==l?this.DM:Math.floor(r.data[m]*v+(r.data[m-1]+b)*y);if((r.data[m]+=o.am(0,w,r,g,0,h))<w)for(o.dlShiftTo(g,k),r.subTo(k,r);r.data[m]<--w;)r.subTo(k,r)}null!=t&&(r.drShiftTo(h,t),u!=c&&a.ZERO.subTo(t,t)),r.t=h,r.clamp(),f>0&&r.rShiftTo(f,r),u<0&&a.ZERO.subTo(r,r)}}},a.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},a.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},a.prototype.exp=function(e,t){if(e>4294967295||e<1)return a.ONE;var r=s(),n=s(),i=t.convert(this),o=d(e)-1;for(i.copyTo(r);--o>=0;)if(t.sqrTo(r,n),(e&1<<o)>0)t.mulTo(n,i,r);else{var u=r;r=n,n=u}return t.revert(r)},a.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,a="",s=this.t,o=this.DB-s*this.DB%t;if(s-- >0)for(o<this.DB&&(r=this.data[s]>>o)>0&&(i=!0,a=h(r));s>=0;)o<t?(r=(this.data[s]&(1<<o)-1)<<t-o,r|=this.data[--s]>>(o+=this.DB-t)):(r=this.data[s]>>(o-=t)&n,o<=0&&(o+=this.DB,--s)),r>0&&(i=!0),i&&(a+=h(r));return i?a:"0"},a.prototype.negate=function(){var e=s();return a.ZERO.subTo(this,e),e},a.prototype.abs=function(){return this.s<0?this.negate():this},a.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},a.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+d(this.data[this.t-1]^this.s&this.DM)},a.prototype.mod=function(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(a.ZERO)>0&&e.subTo(t,t),t},a.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new v(t):new y(t),this.exp(e,r)},a.ZERO=p(0),a.ONE=p(1),S.prototype.convert=E,S.prototype.revert=E,S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},S.prototype.sqrTo=function(e,t){e.squareTo(t)},_.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t},_.prototype.revert=function(e){return e},_.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},_.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},_.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var I=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],A=(1<<26)/I[I.length-1];a.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},a.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=p(r),i=s(),a=s(),o="";for(this.divRemTo(n,i,a);i.signum()>0;)o=(r+a.intValue()).toString(e).substr(1)+o,i.divRemTo(n,i,a);return a.intValue().toString(e)+o},a.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),i=!1,s=0,o=0,u=0;u<e.length;++u){var c=l(e,u);c<0?"-"==e.charAt(u)&&0==this.signum()&&(i=!0):(o=t*o+c,++s>=r&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&a.ZERO.subTo(this,this)},a.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(a.ONE.shiftLeft(e-1),m,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(a.ONE.shiftLeft(e-1),this);else{var n=new Array,i=7&e;n.length=1+(e>>3),t.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},a.prototype.bitwiseTo=function(e,t,r){var n,i,a=Math.min(e.t,this.t);for(n=0;n<a;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(i=e.s&this.DM,n=a;n<this.t;++n)r.data[n]=t(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=a;n<e.t;++n)r.data[n]=t(i,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},a.prototype.changeBit=function(e,t){var r=a.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},a.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()},a.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},a.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},a.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r.data[--i]=0;for(n=r.t-this.t;i<n;++i)r.data[i+this.t]=this.am(0,e.data[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e.data[i],r,i,0,t-i);r.clamp()},a.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},a.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this.data[n])%e;return r},a.prototype.millerRabin=function(e){var t=this.subtract(a.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,i=t.shiftRight(r),s={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},o=0;o<e;++o){do{n=new a(this.bitLength(),s)}while(n.compareTo(a.ONE)<=0||n.compareTo(t)>=0);var u=n.modPow(i,this);if(0!=u.compareTo(a.ONE)&&0!=u.compareTo(t)){for(var c=1;c++<r&&0!=u.compareTo(t);)if(0==(u=u.modPowInt(2,this)).compareTo(a.ONE))return!1;if(0!=u.compareTo(t))return!1}}return!0},a.prototype.clone=function(){var e=s();return this.copyTo(e),e},a.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},a.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},a.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},a.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},a.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},a.prototype.equals=function(e){return 0==this.compareTo(e)},a.prototype.min=function(e){return this.compareTo(e)<0?this:e},a.prototype.max=function(e){return this.compareTo(e)>0?this:e},a.prototype.and=function(e){var t=s();return this.bitwiseTo(e,b,t),t},a.prototype.or=function(e){var t=s();return this.bitwiseTo(e,m,t),t},a.prototype.xor=function(e){var t=s();return this.bitwiseTo(e,g,t),t},a.prototype.andNot=function(e){var t=s();return this.bitwiseTo(e,k,t),t},a.prototype.not=function(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},a.prototype.shiftLeft=function(e){var t=s();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},a.prototype.shiftRight=function(e){var t=s();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},a.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+w(this.data[e]);return this.s<0?this.t*this.DB:-1},a.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=x(this.data[r]^t);return e},a.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},a.prototype.setBit=function(e){return this.changeBit(e,m)},a.prototype.clearBit=function(e){return this.changeBit(e,k)},a.prototype.flipBit=function(e){return this.changeBit(e,g)},a.prototype.add=function(e){var t=s();return this.addTo(e,t),t},a.prototype.subtract=function(e){var t=s();return this.subTo(e,t),t},a.prototype.multiply=function(e){var t=s();return this.multiplyTo(e,t),t},a.prototype.divide=function(e){var t=s();return this.divRemTo(e,t,null),t},a.prototype.remainder=function(e){var t=s();return this.divRemTo(e,null,t),t},a.prototype.divideAndRemainder=function(e){var t=s(),r=s();return this.divRemTo(e,t,r),new Array(t,r)},a.prototype.modPow=function(e,t){var r,n,i=e.bitLength(),a=p(1);if(i<=0)return a;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new v(t):t.isEven()?new _(t):new y(t);var o=new Array,u=3,c=r-1,f=(1<<r)-1;if(o[1]=n.convert(this),r>1){var h=s();for(n.sqrTo(o[1],h);u<=f;)o[u]=s(),n.mulTo(h,o[u-2],o[u]),u+=2}var l,b,m=e.t-1,g=!0,k=s();for(i=d(e.data[m])-1;m>=0;){for(i>=c?l=e.data[m]>>i-c&f:(l=(e.data[m]&(1<<i+1)-1)<<c-i,m>0&&(l|=e.data[m-1]>>this.DB+i-c)),u=r;0==(1&l);)l>>=1,--u;if((i-=u)<0&&(i+=this.DB,--m),g)o[l].copyTo(a),g=!1;else{for(;u>1;)n.sqrTo(a,k),n.sqrTo(k,a),u-=2;u>0?n.sqrTo(a,k):(b=a,a=k,k=b),n.mulTo(k,o[l],a)}for(;m>=0&&0==(e.data[m]&1<<i);)n.sqrTo(a,k),b=a,a=k,k=b,--i<0&&(i=this.DB-1,--m)}return n.revert(a)},a.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return a.ZERO;for(var r=e.clone(),n=this.clone(),i=p(1),s=p(0),o=p(0),u=p(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&u.isEven()||(o.addTo(this,o),u.subTo(e,u)),o.rShiftTo(1,o)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);r.compareTo(n)>=0?(r.subTo(n,r),t&&i.subTo(o,i),s.subTo(u,s)):(n.subTo(r,n),t&&o.subTo(i,o),u.subTo(s,u))}return 0!=n.compareTo(a.ONE)?a.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},a.prototype.pow=function(e){return this.exp(e,new S)},a.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)return t;for(i<a&&(a=i),a>0&&(t.rShiftTo(a,t),r.rShiftTo(a,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return a>0&&r.lShiftTo(a,r),r},a.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=I[I.length-1]){for(t=0;t<I.length;++t)if(r.data[0]==I[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<I.length;){for(var n=I[t],i=t+1;i<I.length&&n<A;)n*=I[i++];for(n=r.modInt(n);t<i;)if(n%I[t++]==0)return!1}return r.millerRabin(e)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(128),o=self.crypto||self.msCrypto,u=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof self&&(self.crypto||self.msCrypto)){e.next=2;break}throw new Error("Please use a browser with webcrypto support and ensure the code has been delivered securely via HTTPS/TLS and run within a Secure Context");case 2:e.t0=r,e.next="sha1"===e.t0?5:"sha2-256"===e.t0?10:"sha2-512"===e.t0?15:"dbl-sha2-256"===e.t0?20:28;break;case 5:return e.t1=a,e.next=8,o.subtle.digest({name:"SHA-1"},t);case 8:return e.t2=e.sent,e.abrupt("return",e.t1.from.call(e.t1,e.t2));case 10:return e.t3=a,e.next=13,o.subtle.digest({name:"SHA-256"},t);case 13:return e.t4=e.sent,e.abrupt("return",e.t3.from.call(e.t3,e.t4));case 15:return e.t5=a,e.next=18,o.subtle.digest({name:"SHA-512"},t);case 18:return e.t6=e.sent,e.abrupt("return",e.t5.from.call(e.t5,e.t6));case 20:return e.next=22,o.subtle.digest({name:"SHA-256"},t);case 22:return i=e.sent,e.t7=a,e.next=26,o.subtle.digest({name:"SHA-256"},i);case 26:return e.t8=e.sent,e.abrupt("return",e.t7.from.call(e.t7,e.t8));case 28:throw new Error("".concat(r," is not a supported algorithm"));case 29:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();e.exports={factory:function(e){return function(){var t=i(n.mark((function t(r){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u(r,e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},digest:u,multihashing:function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t,r,i);case 2:return a=e.sent,e.abrupt("return",s.encode(a,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}},function(e,t,r){"use strict";t.add=r(2135),t.addAll=r(2136),t.block={get:r(2139),put:r(2140),rm:r(2141),stat:r(2144)},t.bitswap={stat:r(2145),unwant:r(2146),wantlist:r(2147),wantlistForPeer:r(2148)},t.bootstrap={add:r(2149),clear:r(2150),list:r(2151),reset:r(2152),rm:r(2153)},t.cat=r(2154),t.config=r(2047),t.dag={get:r(2155),put:r(2156),resolve:r(2157),tree:r(2158)},t.dht=r(2159),t.dns=r(2160),t.files=r(2162),t.get=r(2174),t.id=r(2175),t.init=r(2176),t.isOnline=r(2204),t.key={export:r(2205),gen:r(2206),import:r(2207),info:r(2208),list:r(2209),rename:r(2210),rm:r(2211)},t.libp2p=r(2212),t.ls=r(2380),t.name={publish:r(2381),pubsub:{cancel:r(2383),state:r(2384),subs:r(2385)},resolve:r(2386)},t.object={data:r(2387),get:r(1966),links:r(2388),new:r(2389),patch:{addLink:r(2390),appendData:r(2391),rmLink:r(2392),setData:r(2393)},put:r(1979),stat:r(2394)},t.pin={add:r(2395),ls:r(2396),rm:r(2397)},t.ping=r(2398),t.pubsub=r(2399),t.refs=r(2400),t.refs.local=r(2401),t.repo={gc:r(2402),stat:r(2403),version:r(2404)},t.resolve=r(2405),t.start=r(2406),t.stats={bw:r(2429)},t.stop=r(2430),t.swarm={addrs:r(2431),connect:r(2432),disconnect:r(2433),localAddrs:r(2434),peers:r(2435)},t.version=r(2436)},function(e,t,r){"use strict";(function(t){var n=r(32),i=r(15);e.exports=function(e){if(t.isBuffer(e))try{e=new n(e)}catch(o){throw i(o,"ERR_INVALID_CID")}if(n.isCID(e))return{cid:e,path:void 0};e.startsWith("/ipfs/")&&(e=e.substring("/ipfs/".length));var r,a,s=e.split("/");try{r=new n(s.shift())}catch(o){throw i(o,"ERR_INVALID_CID")}return s.length&&(a="/".concat(s.join("/"))),{cid:r,path:a}}}).call(this,r(3).Buffer)},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(5),o=r(7),u=r(61),c=u.DAGNode,f=u.DAGLink,h=r(32),l=r(151).default,p=r(57).Key,d=r(15),v=r(49),y=r(467),b=r(19),m=r(3).Buffer,g=r(2005).cidToString,k=r(2142),w=r(57).Errors.notFoundError().code,x=new p("/local/pins");var S={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"},E=function(){function e(t,r){s(this,e),this.repo=t,this.dag=r,this.log=b("ipfs:pin"),this.pinset=k(r),this.directPins=new Set,this.recursivePins=new Set}return o(e,[{key:"_walkDag",value:function(){var e=a(n.mark((function e(t){var r,s,o,u,c,f,p,d=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.cid,s=t.preload,o=void 0!==s&&s,u=t.onCid,c=void 0===u?function(){}:u,h.isCID(r)||(r=new h(r)),f=function e(t){return a(n.mark((function r(){var a,s,u,f,h,l,v,b,m;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.dag.get(t,{preload:o});case 2:if(a=r.sent,s=a.value,c(t),"dag-pb"!==t.codec){r.next=9;break}p.addAll(s.Links.map((function(t){return e(t.Hash)}))),r.next=29;break;case 9:if("dag-cbor"!==t.codec){r.next=29;break}for(u=!0,f=!1,h=void 0,r.prev=13,l=y(s)[Symbol.iterator]();!(u=(v=l.next()).done);u=!0)b=i(v.value,2),b[0],m=b[1],p.add(e(m));r.next=21;break;case 17:r.prev=17,r.t0=r.catch(13),f=!0,h=r.t0;case 21:r.prev=21,r.prev=22,u||null==l.return||l.return();case 24:if(r.prev=24,!f){r.next=27;break}throw h;case 27:return r.finish(24);case 28:return r.finish(21);case 29:case"end":return r.stop()}}),r,null,[[13,17,21,29],[22,,24,28]])})))},(p=new l({concurrency:300})).add(f(r)),e.next=7,p.onIdle();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"directKeys",value:function(){return Array.from(this.directPins,(function(e){return new h(e).buffer}))}},{key:"recursiveKeys",value:function(){return Array.from(this.recursivePins,(function(e){return new h(e).buffer}))}},{key:"getIndirectKeys",value:function(){var e=a(n.mark((function e(t){var r,i,a,s,o,u,c,f,l=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.preload,i=new Set,a=!0,s=!1,o=void 0,e.prev=5,u=this.recursiveKeys()[Symbol.iterator]();case 7:if(a=(c=u.next()).done){e.next=14;break}return f=c.value,e.next=11,this._walkDag({cid:new h(f),preload:r||!1,onCid:function(e){e=e.toString(),l.recursivePins.has(e)||i.add(e)}});case 11:a=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),s=!0,o=e.t0;case 20:e.prev=20,e.prev=21,a||null==u.return||u.return();case 23:if(e.prev=23,!s){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return e.abrupt("return",Array.from(i));case 29:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"flushPins",value:function(){var e=a(n.mark((function e(){var t,r,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.pinset.storeSet(this.directKeys()).then((function(e){return new f(S.direct,e.node.size,e.cid)})),this.pinset.storeSet(this.recursiveKeys()).then((function(e){return new f(S.recursive,e.node.size,e.cid)})),this.dag.put(new c(m.alloc(0)),{version:0,format:v.DAG_PB,hashAlg:v.SHA2_256,preload:!1})]);case 2:return t=e.sent,r=i(t,2),a=r[0],s=r[1],o=new c(m.alloc(0),[a,s]),e.next=9,this.dag.put(o,{version:0,format:v.DAG_PB,hashAlg:v.SHA2_256,preload:!1});case 9:return u=e.sent,e.next=12,this.repo.datastore.put(x,u.buffer);case 12:this.log("Flushed pins with root: ".concat(u));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=a(n.mark((function e(){var t,r,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.repo.datastore.has(x);case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.repo.datastore.get(x);case 7:return t=e.sent,e.next=10,this.dag.get(new h(t),{preload:!1});case 10:return r=e.sent,e.next=13,Promise.all([this.pinset.loadSet(r.value,S.recursive),this.pinset.loadSet(r.value,S.direct)]);case 13:a=e.sent,s=i(a,2),o=s[0],u=s[1],this.directPins=new Set(u.map((function(e){return g(e)}))),this.recursivePins=new Set(o.map((function(e){return g(e)}))),this.log("Loaded pins from the datastore");case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isPinnedWithType",value:function(){var e=a(n.mark((function e(t,r){var i,s,o,u,c,f,p=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=g(t),o=S.direct,u=S.all,r!==(s=S.recursive)&&r!==u||!this.recursivePins.has(i)){e.next=4;break}return e.abrupt("return",{key:i,pinned:!0,reason:s});case 4:if(r!==s){e.next=6;break}return e.abrupt("return",{key:i,pinned:!1});case 6:if(r!==o&&r!==u||!this.directPins.has(i)){e.next=8;break}return e.abrupt("return",{key:i,pinned:!0,reason:o});case 8:if(r!==o){e.next=10;break}return e.abrupt("return",{key:i,pinned:!1});case 10:return(c=new l({concurrency:300})).addAll(this.recursiveKeys().map((function(e){return e=new h(e),a(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p.pinset.hasDescendant(e,i);case 2:t.sent&&(f=e,c.clear());case 4:case"end":return t.stop()}}),t)})))}))),e.next=14,c.onIdle();case 14:return e.abrupt("return",{key:i,pinned:Boolean(f),reason:f});case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getInternalBlocks",value:function(){var e=a(n.mark((function e(){var t,r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.repo.datastore.get(x);case 3:t=e.sent,e.next=12;break;case 6:if(e.prev=6,e.t0=e.catch(0),e.t0.code!==w){e.next=11;break}return this.log("No pinned blocks"),e.abrupt("return",[]);case 11:throw new Error("Could not get pin sets root from datastore: ".concat(e.t0.message));case 12:return r=new h(t),e.next=15,this.dag.get(r,"",{preload:!1});case 15:return i=e.sent,e.next=18,this.pinset.getInternalCids(i.value);case 18:return a=e.sent,e.abrupt("return",a.concat(r));case 20:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"fetchCompleteDag",value:function(){var e=a(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._walkDag({cid:t,preload:r.preload});case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"checkPinType",value:function(e){if("string"!==typeof e||!Object.keys(S).includes(e))return function(e){var t="Invalid type '".concat(e,"', must be one of {direct, indirect, recursive, all}");return d(new Error(t),"ERR_INVALID_PIN_TYPE")}(e)}}]),e}();E.PinTypes=S,e.exports=E},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1959),s=r(1956),o=r(126),u=r(19)("ipfs:mfs:stat"),c=r(15),f=r(1948).withTimeoutOption,h={withLocal:!1,signal:void 0};e.exports=function(e){return f(function(){var t=i(n.mark((function t(r,i){var f,p,d,v,y,b;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a(i,h),u("Fetching stats for ".concat(r)),t.next=4,s(e,r,i);case 4:return f=t.sent,p=f.type,d=f.cid,v=f.mfsPath,y="ipfs"===p&&d?d:v,t.prev=9,t.next=12,o(y,e.ipld);case 12:b=t.sent,t.next=20;break;case 15:if(t.prev=15,t.t0=t.catch(9),"ERR_NOT_FOUND"!==t.t0.code){t.next=19;break}throw c(new Error("".concat(r," does not exist")),"ERR_NOT_FOUND");case 19:throw t.t0;case 20:if(l[b.cid.codec]){t.next=22;break}throw new Error("Cannot stat codec ".concat(b.cid.codec));case 22:return t.abrupt("return",l[b.cid.codec](b,i));case 23:case"end":return t.stop()}}),t,null,[[9,15]])})));return function(e,r){return t.apply(this,arguments)}}())};var l={raw:function(e){return{cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}},"dag-pb":function(e){var t=e.node.Links.length,r=e.node.size,n=e.node.size,i={cid:e.cid,size:r,cumulativeSize:n,blocks:t,local:void 0,sizeLocal:void 0,withLocality:!1};return e.unixfs&&(i.size=e.unixfs.fileSize(),"hamt-sharded-directory"===e.unixfs.type?i.type="directory":i.type=e.unixfs.type,i.mode=e.unixfs.mode,e.unixfs.isDirectory()&&(i.size=0,i.cumulativeSize=e.node.size),"file"===i.type&&(i.blocks=e.unixfs.blockSizes.length),e.unixfs.mtime&&(i.mtime=e.unixfs.mtime)),i},"dag-cbor":function(e){return{cid:e.cid,local:void 0,sizeLocal:void 0,withLocality:!1}},identity:function(e){return{cid:e.cid,size:e.node.digest.length,cumulativeSize:e.node.digest.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}}}},function(e,t,r){var n=r(1949);if(r(1960),r(1989),r(1978),r(2257),r(2259),r(1963),r(1951),"undefined"===typeof i)var i=n.jsbn.BigInteger;var a=n.util.isNodejs?r(2025):null,s=n.asn1,o=n.util;n.pki=n.pki||{},e.exports=n.pki.rsa=n.rsa=n.rsa||{};var u=n.pki,c=[6,4,2,4,2,4,6,2],f={name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},l={name:"RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},p=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},d=function(e){var t;if(!(e.algorithm in u.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=u.oids[e.algorithm];var n=s.oidToDer(t).getBytes(),i=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),a=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);a.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,n)),a.value.push(s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,""));var o=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.digest().getBytes());return i.value.push(a),i.value.push(o),s.toDer(i).getBytes()},v=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var a;t.dP||(t.dP=t.d.mod(t.p.subtract(i.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(i.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{a=new i(n.util.bytesToHex(n.random.getBytes(t.n.bitLength()/8)),16)}while(a.compareTo(t.n)>=0||!a.gcd(t.n).equals(i.ONE));for(var s=(e=e.multiply(a.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),o=e.mod(t.q).modPow(t.dQ,t.q);s.compareTo(o)<0;)s=s.add(t.p);var u=s.subtract(o).multiply(t.qInv).mod(t.p).multiply(t.q).add(o);return u=u.multiply(a.modInverse(t.n)).mod(t.n)};function y(e,t,r){var i=n.util.createBuffer(),a=Math.ceil(t.n.bitLength()/8);if(e.length>a-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=e.length,s.max=a-11,s}i.putByte(0),i.putByte(r);var o,u=a-3-e.length;if(0===r||1===r){o=0===r?0:255;for(var c=0;c<u;++c)i.putByte(o)}else for(;u>0;){var f=0,h=n.random.getBytes(u);for(c=0;c<u;++c)0===(o=h.charCodeAt(c))?++f:i.putByte(o);u=f}return i.putByte(0),i.putBytes(e),i}function b(e,t,r,i){var a=Math.ceil(t.n.bitLength()/8),s=n.util.createBuffer(e),o=s.getByte(),u=s.getByte();if(0!==o||r&&0!==u&&1!==u||!r&&2!=u||r&&0===u&&"undefined"===typeof i)throw new Error("Encryption block is invalid.");var c=0;if(0===u){c=a-3-i;for(var f=0;f<c;++f)if(0!==s.getByte())throw new Error("Encryption block is invalid.")}else if(1===u)for(c=0;s.length()>1;){if(255!==s.getByte()){--s.read;break}++c}else if(2===u)for(c=0;s.length()>1;){if(0===s.getByte()){--s.read;break}++c}if(0!==s.getByte()||c!==a-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function m(e,t,r){"function"===typeof t&&(r=t,t={});var a={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function s(){o(e.pBits,(function(t,n){return t?r(t):(e.p=n,null!==e.q?c(t,e.q):void o(e.qBits,c))}))}function o(e,t){n.prime.generateProbablePrime(e,a,t)}function c(t,n){if(t)return r(t);if(e.q=n,e.p.compareTo(e.q)<0){var a=e.p;e.p=e.q,e.q=a}if(0!==e.p.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.p=null,void s();if(0!==e.q.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.q=null,void o(e.qBits,c);if(e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(i.ONE))return e.p=e.q=null,void s();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void o(e.qBits,c);var f=e.e.modInverse(e.phi);e.keys={privateKey:u.rsa.setPrivateKey(e.n,e.e,f,e.p,e.q,f.mod(e.p1),f.mod(e.q1),e.q.modInverse(e.p)),publicKey:u.rsa.setPublicKey(e.n,e.e)},r(null,e.keys)}"prng"in t&&(a.prng=t.prng),s()}function g(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=n.util.hexToBytes(t);return r.length>1&&(0===r.charCodeAt(0)&&0===(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128===(128&r.charCodeAt(1)))?r.substr(1):r}function k(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function w(e){return n.util.isNodejs&&"function"===typeof a[e]}function x(e){return"undefined"!==typeof o.globalScope&&"object"===typeof o.globalScope.crypto&&"object"===typeof o.globalScope.crypto.subtle&&"function"===typeof o.globalScope.crypto.subtle[e]}function S(e){return"undefined"!==typeof o.globalScope&&"object"===typeof o.globalScope.msCrypto&&"object"===typeof o.globalScope.msCrypto.subtle&&"function"===typeof o.globalScope.msCrypto.subtle[e]}function E(e){for(var t=n.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}u.rsa.encrypt=function(e,t,r){var a,s=r,o=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(s=2===r,a=y(e,t,r)):(a=n.util.createBuffer()).putBytes(e);for(var u=new i(a.toHex(),16),c=v(u,t,s).toString(16),f=n.util.createBuffer(),h=o-Math.ceil(c.length/2);h>0;)f.putByte(0),--h;return f.putBytes(n.util.hexToBytes(c)),f.getBytes()},u.rsa.decrypt=function(e,t,r,a){var s=Math.ceil(t.n.bitLength()/8);if(e.length!==s){var o=new Error("Encrypted message length is invalid.");throw o.length=e.length,o.expected=s,o}var u=new i(n.util.createBuffer(e).toHex(),16);if(u.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var c=v(u,t,r).toString(16),f=n.util.createBuffer(),h=s-Math.ceil(c.length/2);h>0;)f.putByte(0),--h;return f.putBytes(n.util.hexToBytes(c)),!1!==a?b(f.getBytes(),t,r):f.getBytes()},u.rsa.createKeyPairGenerationState=function(e,t,r){"string"===typeof e&&(e=parseInt(e,10)),e=e||2048;var a,s=(r=r||{}).prng||n.random,o={nextBytes:function(e){for(var t=s.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},u=r.algorithm||"PRIMEINC";if("PRIMEINC"!==u)throw new Error("Invalid key generation algorithm: "+u);return(a={algorithm:u,state:0,bits:e,rng:o,eInt:t||65537,e:new i(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(a.eInt),a},u.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new i(null);r.fromInt(30);for(var n,a=0,s=function(e,t){return e|t},o=+new Date,f=0;null===e.keys&&(t<=0||f<t);){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,l=h-1;0===e.pqState?(e.num=new i(h,e.rng),e.num.testBit(l)||e.num.bitwiseTo(i.ONE.shiftLeft(l),s,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),a=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(k(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(c[a++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(i.ONE).gcd(e.e).compareTo(i.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(i.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:u.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:u.rsa.setPublicKey(e.n,e.e)}}f+=(n=+new Date)-o,o=n}return null!==e.keys},u.rsa.generateKeyPair=function(e,t,r,i){if(1===arguments.length?"object"===typeof e?(r=e,e=void 0):"function"===typeof e&&(i=e,e=void 0):2===arguments.length?"number"===typeof e?"function"===typeof t?(i=t,t=void 0):"number"!==typeof t&&(r=t,t=void 0):(r=e,i=t,e=void 0,t=void 0):3===arguments.length&&("number"===typeof t?"function"===typeof r&&(i=r,r=void 0):(i=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537),!n.options.usePureJavaScript&&!r.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(i){if(w("generateKeyPair"))return a.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,r){if(e)return i(e);i(null,{privateKey:u.privateKeyFromPem(r),publicKey:u.publicKeyFromPem(t)})}));if(x("generateKey")&&x("exportKey"))return o.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:E(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return o.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){i(e)})).then((function(e){if(e){var t=u.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(e)));i(null,{privateKey:t,publicKey:u.setRsaPublicKey(t.n,t.e)})}}));if(S("generateKey")&&S("exportKey")){var c=o.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:E(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return c.oncomplete=function(e){var t=e.target.result,r=o.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=u.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(t)));i(null,{privateKey:r,publicKey:u.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){i(e)}},void(c.onerror=function(e){i(e)})}}else if(w("generateKeyPairSync")){var f=a.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:u.privateKeyFromPem(f.privateKey),publicKey:u.publicKeyFromPem(f.publicKey)}}var h=u.rsa.createKeyPairGenerationState(e,t,r);if(!i)return u.rsa.stepKeyPairGenerationState(h,0),h.keys;m(h,r,i)},u.setRsaPublicKey=u.rsa.setPublicKey=function(e,t){var r={n:e,e:t,encrypt:function(e,t,i){if("string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return y(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return n.pkcs1.encode_rsa_oaep(t,e,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"===typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var a=t.encode(e,r,!0);return u.rsa.encrypt(a,r,!0)},verify:function(e,t,n){"string"===typeof n?n=n.toUpperCase():void 0===n&&(n="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===n?n={verify:function(e,t){return t=b(t,r,!0),e===s.fromDer(t).value[1].value}}:"NONE"!==n&&"NULL"!==n&&null!==n||(n={verify:function(e,t){return e===(t=b(t,r,!0))}});var i=u.rsa.decrypt(t,r,!0,!1);return n.verify(e,i,r.n.bitLength())}};return r},u.setRsaPrivateKey=u.rsa.setPrivateKey=function(e,t,r,i,a,s,o,c){var f={n:e,e:t,d:r,p:i,q:a,dP:s,dQ:o,qInv:c,decrypt:function(e,t,r){"string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var i=u.rsa.decrypt(e,f,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:b};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return n.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(i,f,!1)},sign:function(e,t){var r=!1;"string"===typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:d},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,f.n.bitLength());return u.rsa.encrypt(n,f,r)}};return f},u.wrapRsaPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(u.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(e).getBytes())])},u.privateKeyFromAsn1=function(e){var t,r,a,o,c,l,p,d,v={},y=[];if(s.validate(e,f,v,y)&&(e=s.fromDer(n.util.createBuffer(v.privateKey))),v={},y=[],!s.validate(e,h,v,y)){var b=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw b.errors=y,b}return t=n.util.createBuffer(v.privateKeyModulus).toHex(),r=n.util.createBuffer(v.privateKeyPublicExponent).toHex(),a=n.util.createBuffer(v.privateKeyPrivateExponent).toHex(),o=n.util.createBuffer(v.privateKeyPrime1).toHex(),c=n.util.createBuffer(v.privateKeyPrime2).toHex(),l=n.util.createBuffer(v.privateKeyExponent1).toHex(),p=n.util.createBuffer(v.privateKeyExponent2).toHex(),d=n.util.createBuffer(v.privateKeyCoefficient).toHex(),u.setRsaPrivateKey(new i(t,16),new i(r,16),new i(a,16),new i(o,16),new i(c,16),new i(l,16),new i(p,16),new i(d,16))},u.privateKeyToAsn1=u.privateKeyToRSAPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.e)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.d)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.p)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.q)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.dP)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.dQ)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.qInv))])},u.publicKeyFromAsn1=function(e){var t={},r=[];if(s.validate(e,p,t,r)){var a,o=s.derToOid(t.publicKeyOid);if(o!==u.oids.rsaEncryption)throw(a=new Error("Cannot read public key. Unknown OID.")).oid=o,a;e=t.rsaPublicKey}if(r=[],!s.validate(e,l,t,r))throw(a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,a;var c=n.util.createBuffer(t.publicKeyModulus).toHex(),f=n.util.createBuffer(t.publicKeyExponent).toHex();return u.setRsaPublicKey(new i(c,16),new i(f,16))},u.publicKeyToAsn1=u.publicKeyToSubjectPublicKeyInfo=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(u.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,[u.publicKeyToRSAPublicKey(e)])])},u.publicKeyToRSAPublicKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.e))])}},function(e,t,r){var n,i=r(1949);e.exports=i.jsbn=i.jsbn||{};function a(e,t,r){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,r):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new a(null)}function o(e,t,r,n,i,a){for(var s=16383&t,o=t>>14;--a>=0;){var u=16383&this.data[e],c=this.data[e++]>>14,f=o*u+c*s;i=((u=s*u+((16383&f)<<14)+r.data[n]+i)>>28)+(f>>14)+o*c,r.data[n++]=268435455&u}return i}i.jsbn.BigInteger=a,"undefined"===typeof navigator?(a.prototype.am=o,n=28):"Microsoft Internet Explorer"==navigator.appName?(a.prototype.am=function(e,t,r,n,i,a){for(var s=32767&t,o=t>>15;--a>=0;){var u=32767&this.data[e],c=this.data[e++]>>15,f=o*u+c*s;i=((u=s*u+((32767&f)<<15)+r.data[n]+(1073741823&i))>>>30)+(f>>>15)+o*c+(i>>>30),r.data[n++]=1073741823&u}return i},n=30):"Netscape"!=navigator.appName?(a.prototype.am=function(e,t,r,n,i,a){for(;--a>=0;){var s=t*this.data[e++]+r.data[n]+i;i=Math.floor(s/67108864),r.data[n++]=67108863&s}return i},n=26):(a.prototype.am=o,n=28),a.prototype.DB=n,a.prototype.DM=(1<<n)-1,a.prototype.DV=1<<n;a.prototype.FV=Math.pow(2,52),a.prototype.F1=52-n,a.prototype.F2=2*n-52;var u,c,f=new Array;for(u="0".charCodeAt(0),c=0;c<=9;++c)f[u++]=c;for(u="a".charCodeAt(0),c=10;c<36;++c)f[u++]=c;for(u="A".charCodeAt(0),c=10;c<36;++c)f[u++]=c;function h(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function l(e,t){var r=f[e.charCodeAt(t)];return null==r?-1:r}function p(e){var t=s();return t.fromInt(e),t}function d(e){var t,r=1;return 0!=(t=e>>>16)&&(e=t,r+=16),0!=(t=e>>8)&&(e=t,r+=8),0!=(t=e>>4)&&(e=t,r+=4),0!=(t=e>>2)&&(e=t,r+=2),0!=(t=e>>1)&&(e=t,r+=1),r}function v(e){this.m=e}function y(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function b(e,t){return e&t}function m(e,t){return e|t}function g(e,t){return e^t}function k(e,t){return e&~t}function w(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function x(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function S(){}function E(e){return e}function _(e){this.r2=s(),this.q3=s(),a.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}v.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},v.prototype.revert=function(e){return e},v.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},v.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},y.prototype.convert=function(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(a.ZERO)>0&&this.m.subTo(t,t),t},y.prototype.revert=function(e){var t=s();return e.copyTo(t),this.reduce(t),t},y.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var r=32767&e.data[t],n=r*this.mpl+((r*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(r=t+this.m.t,e.data[r]+=this.m.am(0,n,e,t,0,this.m.t);e.data[r]>=e.DV;)e.data[r]-=e.DV,e.data[++r]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},y.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},a.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},a.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},a.prototype.fromString=function(e,t){var r;if(16==t)r=4;else if(8==t)r=3;else if(256==t)r=8;else if(2==t)r=1;else if(32==t)r=5;else{if(4!=t)return void this.fromRadix(e,t);r=2}this.t=0,this.s=0;for(var n=e.length,i=!1,s=0;--n>=0;){var o=8==r?255&e[n]:l(e,n);o<0?"-"==e.charAt(n)&&(i=!0):(i=!1,0==s?this.data[this.t++]=o:s+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,(s+=r)>=this.DB&&(s-=this.DB))}8==r&&0!=(128&e[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&a.ZERO.subTo(this,this)},a.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},a.prototype.dlShiftTo=function(e,t){var r;for(r=this.t-1;r>=0;--r)t.data[r+e]=this.data[r];for(r=e-1;r>=0;--r)t.data[r]=0;t.t=this.t+e,t.s=this.s},a.prototype.drShiftTo=function(e,t){for(var r=e;r<this.t;++r)t.data[r-e]=this.data[r];t.t=Math.max(this.t-e,0),t.s=this.s},a.prototype.lShiftTo=function(e,t){var r,n=e%this.DB,i=this.DB-n,a=(1<<i)-1,s=Math.floor(e/this.DB),o=this.s<<n&this.DM;for(r=this.t-1;r>=0;--r)t.data[r+s+1]=this.data[r]>>i|o,o=(this.data[r]&a)<<n;for(r=s-1;r>=0;--r)t.data[r]=0;t.data[s]=o,t.t=this.t+s+1,t.s=this.s,t.clamp()},a.prototype.rShiftTo=function(e,t){t.s=this.s;var r=Math.floor(e/this.DB);if(r>=this.t)t.t=0;else{var n=e%this.DB,i=this.DB-n,a=(1<<n)-1;t.data[0]=this.data[r]>>n;for(var s=r+1;s<this.t;++s)t.data[s-r-1]|=(this.data[s]&a)<<i,t.data[s-r]=this.data[s]>>n;n>0&&(t.data[this.t-r-1]|=(this.s&a)<<i),t.t=this.t-r,t.clamp()}},a.prototype.subTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]-e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n-=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n-=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n-=e.s}t.s=n<0?-1:0,n<-1?t.data[r++]=this.DV+n:n>0&&(t.data[r++]=n),t.t=r,t.clamp()},a.prototype.multiplyTo=function(e,t){var r=this.abs(),n=e.abs(),i=r.t;for(t.t=i+n.t;--i>=0;)t.data[i]=0;for(i=0;i<n.t;++i)t.data[i+r.t]=r.am(0,n.data[i],t,i,0,r.t);t.s=0,t.clamp(),this.s!=e.s&&a.ZERO.subTo(t,t)},a.prototype.squareTo=function(e){for(var t=this.abs(),r=e.t=2*t.t;--r>=0;)e.data[r]=0;for(r=0;r<t.t-1;++r){var n=t.am(r,t.data[r],e,2*r,0,1);(e.data[r+t.t]+=t.am(r+1,2*t.data[r],e,2*r+1,n,t.t-r-1))>=t.DV&&(e.data[r+t.t]-=t.DV,e.data[r+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(r,t.data[r],e,2*r,0,1)),e.s=0,e.clamp()},a.prototype.divRemTo=function(e,t,r){var n=e.abs();if(!(n.t<=0)){var i=this.abs();if(i.t<n.t)return null!=t&&t.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=s());var o=s(),u=this.s,c=e.s,f=this.DB-d(n.data[n.t-1]);f>0?(n.lShiftTo(f,o),i.lShiftTo(f,r)):(n.copyTo(o),i.copyTo(r));var h=o.t,l=o.data[h-1];if(0!=l){var p=l*(1<<this.F1)+(h>1?o.data[h-2]>>this.F2:0),v=this.FV/p,y=(1<<this.F1)/p,b=1<<this.F2,m=r.t,g=m-h,k=null==t?s():t;for(o.dlShiftTo(g,k),r.compareTo(k)>=0&&(r.data[r.t++]=1,r.subTo(k,r)),a.ONE.dlShiftTo(h,k),k.subTo(o,o);o.t<h;)o.data[o.t++]=0;for(;--g>=0;){var w=r.data[--m]==l?this.DM:Math.floor(r.data[m]*v+(r.data[m-1]+b)*y);if((r.data[m]+=o.am(0,w,r,g,0,h))<w)for(o.dlShiftTo(g,k),r.subTo(k,r);r.data[m]<--w;)r.subTo(k,r)}null!=t&&(r.drShiftTo(h,t),u!=c&&a.ZERO.subTo(t,t)),r.t=h,r.clamp(),f>0&&r.rShiftTo(f,r),u<0&&a.ZERO.subTo(r,r)}}},a.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},a.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},a.prototype.exp=function(e,t){if(e>4294967295||e<1)return a.ONE;var r=s(),n=s(),i=t.convert(this),o=d(e)-1;for(i.copyTo(r);--o>=0;)if(t.sqrTo(r,n),(e&1<<o)>0)t.mulTo(n,i,r);else{var u=r;r=n,n=u}return t.revert(r)},a.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var r,n=(1<<t)-1,i=!1,a="",s=this.t,o=this.DB-s*this.DB%t;if(s-- >0)for(o<this.DB&&(r=this.data[s]>>o)>0&&(i=!0,a=h(r));s>=0;)o<t?(r=(this.data[s]&(1<<o)-1)<<t-o,r|=this.data[--s]>>(o+=this.DB-t)):(r=this.data[s]>>(o-=t)&n,o<=0&&(o+=this.DB,--s)),r>0&&(i=!0),i&&(a+=h(r));return i?a:"0"},a.prototype.negate=function(){var e=s();return a.ZERO.subTo(this,e),e},a.prototype.abs=function(){return this.s<0?this.negate():this},a.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var r=this.t;if(0!=(t=r-e.t))return this.s<0?-t:t;for(;--r>=0;)if(0!=(t=this.data[r]-e.data[r]))return t;return 0},a.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+d(this.data[this.t-1]^this.s&this.DM)},a.prototype.mod=function(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(a.ZERO)>0&&e.subTo(t,t),t},a.prototype.modPowInt=function(e,t){var r;return r=e<256||t.isEven()?new v(t):new y(t),this.exp(e,r)},a.ZERO=p(0),a.ONE=p(1),S.prototype.convert=E,S.prototype.revert=E,S.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r)},S.prototype.sqrTo=function(e,t){e.squareTo(t)},_.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t},_.prototype.revert=function(e){return e},_.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},_.prototype.mulTo=function(e,t,r){e.multiplyTo(t,r),this.reduce(r)},_.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var I=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],A=(1<<26)/I[I.length-1];a.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},a.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),r=Math.pow(e,t),n=p(r),i=s(),a=s(),o="";for(this.divRemTo(n,i,a);i.signum()>0;)o=(r+a.intValue()).toString(e).substr(1)+o,i.divRemTo(n,i,a);return a.intValue().toString(e)+o},a.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var r=this.chunkSize(t),n=Math.pow(t,r),i=!1,s=0,o=0,u=0;u<e.length;++u){var c=l(e,u);c<0?"-"==e.charAt(u)&&0==this.signum()&&(i=!0):(o=t*o+c,++s>=r&&(this.dMultiply(n),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(o,0)),i&&a.ZERO.subTo(this,this)},a.prototype.fromNumber=function(e,t,r){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(a.ONE.shiftLeft(e-1),m,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(a.ONE.shiftLeft(e-1),this);else{var n=new Array,i=7&e;n.length=1+(e>>3),t.nextBytes(n),i>0?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},a.prototype.bitwiseTo=function(e,t,r){var n,i,a=Math.min(e.t,this.t);for(n=0;n<a;++n)r.data[n]=t(this.data[n],e.data[n]);if(e.t<this.t){for(i=e.s&this.DM,n=a;n<this.t;++n)r.data[n]=t(this.data[n],i);r.t=this.t}else{for(i=this.s&this.DM,n=a;n<e.t;++n)r.data[n]=t(i,e.data[n]);r.t=e.t}r.s=t(this.s,e.s),r.clamp()},a.prototype.changeBit=function(e,t){var r=a.ONE.shiftLeft(e);return this.bitwiseTo(r,t,r),r},a.prototype.addTo=function(e,t){for(var r=0,n=0,i=Math.min(e.t,this.t);r<i;)n+=this.data[r]+e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;if(e.t<this.t){for(n+=e.s;r<this.t;)n+=this.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<e.t;)n+=e.data[r],t.data[r++]=n&this.DM,n>>=this.DB;n+=e.s}t.s=n<0?-1:0,n>0?t.data[r++]=n:n<-1&&(t.data[r++]=this.DV+n),t.t=r,t.clamp()},a.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},a.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},a.prototype.multiplyLowerTo=function(e,t,r){var n,i=Math.min(this.t+e.t,t);for(r.s=0,r.t=i;i>0;)r.data[--i]=0;for(n=r.t-this.t;i<n;++i)r.data[i+this.t]=this.am(0,e.data[i],r,i,0,this.t);for(n=Math.min(e.t,t);i<n;++i)this.am(0,e.data[i],r,i,0,t-i);r.clamp()},a.prototype.multiplyUpperTo=function(e,t,r){--t;var n=r.t=this.t+e.t-t;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(t-this.t,0);n<e.t;++n)r.data[this.t+n-t]=this.am(t-n,e.data[n],r,0,0,this.t+n-t);r.clamp(),r.drShiftTo(1,r)},a.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,r=this.s<0?e-1:0;if(this.t>0)if(0==t)r=this.data[0]%e;else for(var n=this.t-1;n>=0;--n)r=(t*r+this.data[n])%e;return r},a.prototype.millerRabin=function(e){var t=this.subtract(a.ONE),r=t.getLowestSetBit();if(r<=0)return!1;for(var n,i=t.shiftRight(r),s={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},o=0;o<e;++o){do{n=new a(this.bitLength(),s)}while(n.compareTo(a.ONE)<=0||n.compareTo(t)>=0);var u=n.modPow(i,this);if(0!=u.compareTo(a.ONE)&&0!=u.compareTo(t)){for(var c=1;c++<r&&0!=u.compareTo(t);)if(0==(u=u.modPowInt(2,this)).compareTo(a.ONE))return!1;if(0!=u.compareTo(t))return!1}}return!0},a.prototype.clone=function(){var e=s();return this.copyTo(e),e},a.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},a.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},a.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},a.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},a.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var r,n=this.DB-e*this.DB%8,i=0;if(e-- >0)for(n<this.DB&&(r=this.data[e]>>n)!=(this.s&this.DM)>>n&&(t[i++]=r|this.s<<this.DB-n);e>=0;)n<8?(r=(this.data[e]&(1<<n)-1)<<8-n,r|=this.data[--e]>>(n+=this.DB-8)):(r=this.data[e]>>(n-=8)&255,n<=0&&(n+=this.DB,--e)),0!=(128&r)&&(r|=-256),0==i&&(128&this.s)!=(128&r)&&++i,(i>0||r!=this.s)&&(t[i++]=r);return t},a.prototype.equals=function(e){return 0==this.compareTo(e)},a.prototype.min=function(e){return this.compareTo(e)<0?this:e},a.prototype.max=function(e){return this.compareTo(e)>0?this:e},a.prototype.and=function(e){var t=s();return this.bitwiseTo(e,b,t),t},a.prototype.or=function(e){var t=s();return this.bitwiseTo(e,m,t),t},a.prototype.xor=function(e){var t=s();return this.bitwiseTo(e,g,t),t},a.prototype.andNot=function(e){var t=s();return this.bitwiseTo(e,k,t),t},a.prototype.not=function(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},a.prototype.shiftLeft=function(e){var t=s();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},a.prototype.shiftRight=function(e){var t=s();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},a.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+w(this.data[e]);return this.s<0?this.t*this.DB:-1},a.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,r=0;r<this.t;++r)e+=x(this.data[r]^t);return e},a.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},a.prototype.setBit=function(e){return this.changeBit(e,m)},a.prototype.clearBit=function(e){return this.changeBit(e,k)},a.prototype.flipBit=function(e){return this.changeBit(e,g)},a.prototype.add=function(e){var t=s();return this.addTo(e,t),t},a.prototype.subtract=function(e){var t=s();return this.subTo(e,t),t},a.prototype.multiply=function(e){var t=s();return this.multiplyTo(e,t),t},a.prototype.divide=function(e){var t=s();return this.divRemTo(e,t,null),t},a.prototype.remainder=function(e){var t=s();return this.divRemTo(e,null,t),t},a.prototype.divideAndRemainder=function(e){var t=s(),r=s();return this.divRemTo(e,t,r),new Array(t,r)},a.prototype.modPow=function(e,t){var r,n,i=e.bitLength(),a=p(1);if(i<=0)return a;r=i<18?1:i<48?3:i<144?4:i<768?5:6,n=i<8?new v(t):t.isEven()?new _(t):new y(t);var o=new Array,u=3,c=r-1,f=(1<<r)-1;if(o[1]=n.convert(this),r>1){var h=s();for(n.sqrTo(o[1],h);u<=f;)o[u]=s(),n.mulTo(h,o[u-2],o[u]),u+=2}var l,b,m=e.t-1,g=!0,k=s();for(i=d(e.data[m])-1;m>=0;){for(i>=c?l=e.data[m]>>i-c&f:(l=(e.data[m]&(1<<i+1)-1)<<c-i,m>0&&(l|=e.data[m-1]>>this.DB+i-c)),u=r;0==(1&l);)l>>=1,--u;if((i-=u)<0&&(i+=this.DB,--m),g)o[l].copyTo(a),g=!1;else{for(;u>1;)n.sqrTo(a,k),n.sqrTo(k,a),u-=2;u>0?n.sqrTo(a,k):(b=a,a=k,k=b),n.mulTo(k,o[l],a)}for(;m>=0&&0==(e.data[m]&1<<i);)n.sqrTo(a,k),b=a,a=k,k=b,--i<0&&(i=this.DB-1,--m)}return n.revert(a)},a.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return a.ZERO;for(var r=e.clone(),n=this.clone(),i=p(1),s=p(0),o=p(0),u=p(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),t?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;n.isEven();)n.rShiftTo(1,n),t?(o.isEven()&&u.isEven()||(o.addTo(this,o),u.subTo(e,u)),o.rShiftTo(1,o)):u.isEven()||u.subTo(e,u),u.rShiftTo(1,u);r.compareTo(n)>=0?(r.subTo(n,r),t&&i.subTo(o,i),s.subTo(u,s)):(n.subTo(r,n),t&&o.subTo(i,o),u.subTo(s,u))}return 0!=n.compareTo(a.ONE)?a.ZERO:u.compareTo(e)>=0?u.subtract(e):u.signum()<0?(u.addTo(e,u),u.signum()<0?u.add(e):u):u},a.prototype.pow=function(e){return this.exp(e,new S)},a.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),r=e.s<0?e.negate():e.clone();if(t.compareTo(r)<0){var n=t;t=r,r=n}var i=t.getLowestSetBit(),a=r.getLowestSetBit();if(a<0)return t;for(i<a&&(a=i),a>0&&(t.rShiftTo(a,t),r.rShiftTo(a,r));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=r.getLowestSetBit())>0&&r.rShiftTo(i,r),t.compareTo(r)>=0?(t.subTo(r,t),t.rShiftTo(1,t)):(r.subTo(t,r),r.rShiftTo(1,r));return a>0&&r.lShiftTo(a,r),r},a.prototype.isProbablePrime=function(e){var t,r=this.abs();if(1==r.t&&r.data[0]<=I[I.length-1]){for(t=0;t<I.length;++t)if(r.data[0]==I[t])return!0;return!1}if(r.isEven())return!1;for(t=1;t<I.length;){for(var n=I[t],i=t+1;i<I.length&&n<A;)n*=I[i++];for(n=r.modInt(n);t<i;)if(n%I[t++]==0)return!1}return r.millerRabin(e)}},function(e,t,r){"use strict";var n=r(68),i=r(50),a=r(5),s=r(7),o=r(15),u=r(55),c=r(1954).codes.ERR_INVALID_PARAMETERS,f=function(e){return e},h=function(){function e(t){var r=t.peerStore,n=t.eventName,i=t.eventProperty,s=t.eventTransformer,o=void 0===s?f:s;a(this,e),this._ps=r,this.eventName=n,this.eventProperty=i,this.eventTransformer=o,this.data=new Map}return s(e,[{key:"set",value:function(e,t){throw o(new Error("set must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}},{key:"_setData",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.emit,i=void 0===n||n,a=e.toB58String();this.data.set(a,t),i&&this._emit(e,t)}},{key:"_emit",value:function(e,t){this._ps.emit(this.eventName,i({peerId:e},this.eventProperty,this.eventTransformer(t)))}},{key:"get",value:function(e){if(!u.isPeerId(e))throw o(new Error("peerId must be an instance of peer-id"),c);var t=this.data.get(e.toB58String());return t?n(t):void 0}},{key:"delete",value:function(e){if(!u.isPeerId(e))throw o(new Error("peerId must be an instance of peer-id"),c);return!!this.data.delete(e.toB58String())&&(this._emit(e,[]),!0)}}]),e}();e.exports=h},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(1961).sortBy,s=r(2416),o=function(){function e(t){n(this,e),this.set=new Map,this._stats=t}return i(e,[{key:"add",value:function(e,t,n){var i=r(1980),a=e.toString("base58btc"),o=this.set.get(a);o?(o.inc(),o.priority=t,o.wantType===i.WantType.Have&&n===i.WantType.Block&&(o.wantType=n)):(this.set.set(a,new s(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}},{key:"remove",value:function(e){var t=e.toString("base58btc"),r=this.set.get(t);r&&(r.dec(),r.hasRefs()||(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}},{key:"removeForce",value:function(e){this.set.has(e)&&this.set.delete(e)}},{key:"forEach",value:function(e){return this.set.forEach(e)}},{key:"entries",value:function(){return this.set.entries()}},{key:"sortedEntries",value:function(){return new Map(a((function(e){return e[1].key}),Array.from(this.set.entries())))}},{key:"contains",value:function(e){var t=e.toString("base58btc");return this.set.get(t)}},{key:"length",get:function(){return this.set.size}}]),e}();o.Entry=s,e.exports=o},function(e,t,r){"use strict";e.exports={maxProvidersPerRequest:3,providerRequestTimeout:1e4,hasBlockTimeout:15e3,provideTimeout:15e3,kMaxPriority:Math.pow(2,31)-1,maxListeners:1e3,wantlistSendDebounceMs:1}},function(e,t,r){"use strict";r.r(t);var n=r(83),i=r(59),a=r(23),s=r(1);function o(e,t){var r={},n=!1;function i(r,i){return n=!0,i=new Promise((function(t){t(e[r](i))})),{done:!1,value:t(i)}}return"function"===typeof Symbol&&Symbol.iterator&&(r[Symbol.iterator]=function(){return this}),r.next=function(e){return n?(n=!1,e):i("next",e)},"function"===typeof e.throw&&(r.throw=function(e){if(n)throw n=!1,e;return i("throw",e)}),"function"===typeof e.return&&(r.return=function(e){return n?(n=!1,e):i("return",e)}),r}function u(e){this.wrapped=e}function c(e){return new u(e)}function f(e){var t,r;function n(t,r){try{var a=e[t](r),s=a.value,o=s instanceof u;Promise.resolve(o?s.wrapped:s).then((function(e){o?n("return"===t?"return":"next",e):i(a.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(c){i("throw",c)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise((function(a,s){var o={key:e,arg:i,resolve:a,reject:s,next:null};r?r=r.next=o:(t=r=o,n(e,i))}))},"function"!==typeof e.return&&(this.return=void 0)}function h(e){return function(){return new f(e.apply(this,arguments))}}"function"===typeof Symbol&&Symbol.asyncIterator&&(f.prototype[Symbol.asyncIterator]=function(){return this}),f.prototype.next=function(e){return this._invoke("next",e)},f.prototype.throw=function(e){return this._invoke("throw",e)},f.prototype.return=function(e){return this._invoke("return",e)};var l=r(164);r.d(t,"batch",(function(){return k})),r.d(t,"buffer",(function(){return E})),r.d(t,"collect",(function(){return I})),r.d(t,"concat",(function(){return B})),r.d(t,"consume",(function(){return N})),r.d(t,"filter",(function(){return D})),r.d(t,"flatMap",(function(){return z})),r.d(t,"flatTransform",(function(){return j})),r.d(t,"flatten",(function(){return O})),r.d(t,"fromStream",(function(){return G})),r.d(t,"getIterator",(function(){return w})),r.d(t,"map",(function(){return q})),r.d(t,"merge",(function(){return Y})),r.d(t,"parallelFlatMap",(function(){return Z})),r.d(t,"parallelMap",(function(){return X})),r.d(t,"parallelMerge",(function(){return $})),r.d(t,"pipeline",(function(){return J})),r.d(t,"reduce",(function(){return ne})),r.d(t,"take",(function(){return se})),r.d(t,"tap",(function(){return ce})),r.d(t,"time",(function(){return de})),r.d(t,"transform",(function(){return ve})),r.d(t,"writeToStream",(function(){return me}));var p=s.mark(g),d=s.mark(S),v=s.mark(C),y=s.mark(ae),b=s.mark(pe);function m(){return(m=h(s.mark((function e(t,r){var n,i,a,o,u,f,h,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],i=!0,a=!1,e.prev=3,u=Object(l.a)(r);case 5:return e.next=7,c(u.next());case 7:return f=e.sent,i=f.done,e.next=11,c(f.value);case 11:if(h=e.sent,i){e.next=22;break}if(p=h,n.push(p),n.length!==t){e.next=19;break}return e.next=18,n;case 18:n=[];case 19:i=!0,e.next=5;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(3),a=!0,o=e.t0;case 28:if(e.prev=28,e.prev=29,i||null==u.return){e.next=33;break}return e.next=33,c(u.return());case 33:if(e.prev=33,!a){e.next=36;break}throw o;case 36:return e.finish(33);case 37:return e.finish(28);case 38:if(!(n.length>0)){e.next=41;break}return e.next=41,n;case 41:case"end":return e.stop()}}),e,null,[[3,24,28,38],[29,,33,37]])})))).apply(this,arguments)}function g(e,t){var r,n,i,a,o,u,c;return s.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=[],n=!0,i=!1,a=void 0,s.prev=4,o=t[Symbol.iterator]();case 6:if(n=(u=o.next()).done){s.next=16;break}if(c=u.value,r.push(c),r.length!==e){s.next=13;break}return s.next=12,r;case 12:r=[];case 13:n=!0,s.next=6;break;case 16:s.next=22;break;case 18:s.prev=18,s.t0=s.catch(4),i=!0,a=s.t0;case 22:s.prev=22,s.prev=23,n||null==o.return||o.return();case 25:if(s.prev=25,!i){s.next=28;break}throw a;case 28:return s.finish(25);case 29:return s.finish(22);case 30:if(!(r.length>0)){s.next=33;break}return s.next=33,r;case 33:case"end":return s.stop()}}),p,null,[[4,18,22,30],[23,,25,29]])}function k(e,t){return void 0===t?function(t){return k(e,t)}:t[Symbol.asyncIterator]?function(e,t){return m.apply(this,arguments)}(e,t):g(e,t)}function w(e){if("function"===typeof e.next)return e;if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function x(){var e,t;return{promise:new Promise((function(r,n){t=r,e=n})),reject:e,resolve:t}}function S(e,t){var r,n,i,a,o,u,c,f,h,l,p;return s.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=[],s.prev=1,i=!0,a=!1,o=void 0,s.prev=5,u=t[Symbol.iterator]();case 7:if(i=(c=u.next()).done){s.next=17;break}if(f=c.value,r.push(f),!(r.length<=e)){s.next=12;break}return s.abrupt("continue",14);case 12:return s.next=14,r.shift();case 14:i=!0,s.next=7;break;case 17:s.next=23;break;case 19:s.prev=19,s.t0=s.catch(5),a=!0,o=s.t0;case 23:s.prev=23,s.prev=24,i||null==u.return||u.return();case 26:if(s.prev=26,!a){s.next=29;break}throw o;case 29:return s.finish(26);case 30:return s.finish(23);case 31:s.next=36;break;case 33:s.prev=33,s.t1=s.catch(1),n=s.t1;case 36:h=0,l=r;case 37:if(!(h<l.length)){s.next=44;break}return p=l[h],s.next=41,p;case 41:h++,s.next=37;break;case 44:if(!n){s.next=46;break}throw n;case 46:case"end":return s.stop()}}),d,null,[[1,33],[5,19,23,31],[24,,26,30]])}function E(e,t){return void 0===t?function(t){return E(e,t)}:t[Symbol.asyncIterator]?function(e,t){var r=w(t),n=[],o=[],u=!1,c=!1;function f(){for(;o.length>0&&n.length>0;){var e=o.shift(),t=n.shift(),r=t.error,i=t.value;r?e.reject(r):e.resolve({done:!1,value:i})}for(;o.length>0&&c;){(0,o.shift().resolve)({done:!0,value:void 0})}}function h(){return l.apply(this,arguments)}function l(){return(l=Object(a.a)(s.mark((function t(){var i,a,o;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=2;break}return t.abrupt("return");case 2:if(!u){t.next=4;break}return t.abrupt("return");case 4:if(!(n.length>=e)){t.next=6;break}return t.abrupt("return");case 6:return u=!0,t.prev=7,t.next=10,r.next();case 10:i=t.sent,a=i.done,o=i.value,a?c=!0:n.push({value:o}),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),c=!0,n.push({error:t.t0});case 20:f(),u=!1,h();case 23:case"end":return t.stop()}}),t,null,[[7,16]])})))).apply(this,arguments)}function p(){return(p=Object(a.a)(s.mark((function e(){var t,r,i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=6;break}if(t=n.shift(),r=t.error,i=t.value,!r){e.next=4;break}throw r;case 4:return h(),e.abrupt("return",{done:!1,value:i});case 6:if(!c){e.next=8;break}return e.abrupt("return",{done:!0,value:void 0});case 8:return a=x(),o.push(a),h(),e.abrupt("return",a.promise);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=Object(i.a)({next:function(){return p.apply(this,arguments)}},Symbol.asyncIterator,(function(){return d}));return d}(e,t):S(e,t)}function _(){return(_=Object(a.a)(s.mark((function e(t){var r,n,i,a,o,u,c,f;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=!0,i=!1,e.prev=3,o=Object(l.a)(t);case 5:return e.next=7,o.next();case 7:return u=e.sent,n=u.done,e.next=11,u.value;case 11:if(c=e.sent,n){e.next=18;break}f=c,r.push(f);case 15:n=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),i=!0,a=e.t0;case 24:if(e.prev=24,e.prev=25,n||null==o.return){e.next=29;break}return e.next=29,o.return();case 29:if(e.prev=29,!i){e.next=32;break}throw a;case 32:return e.finish(29);case 33:return e.finish(24);case 34:return e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,null,[[3,20,24,34],[25,,29,33]])})))).apply(this,arguments)}function I(e){return e[Symbol.asyncIterator]?function(e){return _.apply(this,arguments)}(e):Array.from(e)}function A(e){return T.apply(this,arguments)}function T(){return(T=h(s.mark((function e(t){var r,n,i,a,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,e.prev=2,a=Object(l.a)(t);case 4:return e.next=6,c(a.next());case 6:return u=e.sent,r=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,r){e.next=17;break}return h=f,e.delegateYield(o(Object(l.a)(h),c),"t0",14);case 14:r=!0,e.next=4;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(2),n=!0,i=e.t1;case 23:if(e.prev=23,e.prev=24,r||null==a.return){e.next=28;break}return e.next=28,c(a.return());case 28:if(e.prev=28,!n){e.next=31;break}throw i;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])})))).apply(this,arguments)}function C(e){var t,r,n,i,a,o;return s.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=!0,r=!1,n=void 0,s.prev=3,i=e[Symbol.iterator]();case 5:if(t=(a=i.next()).done){s.next=11;break}return o=a.value,s.delegateYield(o,"t0",8);case 8:t=!0,s.next=5;break;case 11:s.next=17;break;case 13:s.prev=13,s.t1=s.catch(3),r=!0,n=s.t1;case 17:s.prev=17,s.prev=18,t||null==i.return||i.return();case 20:if(s.prev=20,!r){s.next=23;break}throw n;case 23:return s.finish(20);case 24:return s.finish(17);case 25:case"end":return s.stop()}}),v,null,[[3,13,17,25],[18,,20,24]])}function B(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.find((function(e){return void 0!==e[Symbol.asyncIterator]}));return n?A(t):C(t)}function R(){return(R=Object(a.a)(s.mark((function e(t){var r,n,i,a,o,u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,e.prev=2,a=Object(l.a)(t);case 4:return e.next=6,a.next();case 6:return o=e.sent,r=o.done,e.next=10,o.value;case 10:if(u=e.sent,r){e.next=16;break}u;case 13:r=!0,e.next=4;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(2),n=!0,i=e.t0;case 22:if(e.prev=22,e.prev=23,r||null==a.return){e.next=27;break}return e.next=27,a.return();case 27:if(e.prev=27,!n){e.next=30;break}throw i;case 30:return e.finish(27);case 31:return e.finish(22);case 32:case"end":return e.stop()}}),e,null,[[2,18,22,32],[23,,27,31]])})))).apply(this,arguments)}function N(e){if(e[Symbol.asyncIterator])return function(e){return R.apply(this,arguments)}(e);var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)i.value}catch(s){r=!0,n=s}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}function P(e,t){return M.apply(this,arguments)}function M(){return(M=h(s.mark((function e(t,r){var n,i,a,o,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i=!1,e.prev=2,o=Object(l.a)(r);case 4:return e.next=6,c(o.next());case 6:return u=e.sent,n=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,n){e.next=21;break}return h=f,e.next=15,c(t(h));case 15:if(!e.sent){e.next=18;break}return e.next=18,h;case 18:n=!0,e.next=4;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(2),i=!0,a=e.t0;case 27:if(e.prev=27,e.prev=28,n||null==o.return){e.next=32;break}return e.next=32,c(o.return());case 32:if(e.prev=32,!i){e.next=35;break}throw a;case 35:return e.finish(32);case 36:return e.finish(27);case 37:case"end":return e.stop()}}),e,null,[[2,23,27,37],[28,,32,36]])})))).apply(this,arguments)}function D(e,t){return void 0===t?function(t){return P(e,t)}:P(e,t)}function O(e){return L.apply(this,arguments)}function L(){return(L=h(s.mark((function e(t){var r,n,i,a,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,e.prev=2,a=Object(l.a)(t);case 4:return e.next=6,c(a.next());case 6:return u=e.sent,r=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,r){e.next=22;break}if(!(h=f)||"string"===typeof h||!h[Symbol.iterator]&&!h[Symbol.asyncIterator]){e.next=17;break}return e.delegateYield(o(Object(l.a)(O(h)),c),"t0",15);case 15:e.next=19;break;case 17:return e.next=19,h;case 19:r=!0,e.next=4;break;case 22:e.next=28;break;case 24:e.prev=24,e.t1=e.catch(2),n=!0,i=e.t1;case 28:if(e.prev=28,e.prev=29,r||null==a.return){e.next=33;break}return e.next=33,c(a.return());case 33:if(e.prev=33,!n){e.next=36;break}throw i;case 36:return e.finish(33);case 37:return e.finish(28);case 38:case"end":return e.stop()}}),e,null,[[2,24,28,38],[29,,33,37]])})))).apply(this,arguments)}function K(e,t){return U.apply(this,arguments)}function U(){return(U=h(s.mark((function e(t,r){var n,i,a,o,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i=!1,e.prev=2,o=Object(l.a)(r);case 4:return e.next=6,c(o.next());case 6:return u=e.sent,n=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,n){e.next=18;break}return h=f,e.next=15,t(h);case 15:n=!0,e.next=4;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),i=!0,a=e.t0;case 24:if(e.prev=24,e.prev=25,n||null==o.return){e.next=29;break}return e.next=29,c(o.return());case 29:if(e.prev=29,!i){e.next=32;break}throw a;case 32:return e.finish(29);case 33:return e.finish(24);case 34:case"end":return e.stop()}}),e,null,[[2,20,24,34],[25,,29,33]])})))).apply(this,arguments)}function q(e,t){return void 0===t?function(t){return K(e,t)}:K(e,t)}function z(e,t){return void 0===t?function(t){return z(e,t)}:D((function(e){return void 0!==e&&null!==e}),O(q(e,t)))}function j(e,t,r){return void 0===t?function(t,r){return r?j(e,t,r):j(e,t)}:void 0===r?function(r){return j(e,t,r)}:D((function(e){return void 0!==e&&null!==e}),O(function(e,t,r){var n=w(r),o=[],u=[],c=!1,f=!1,h=0,p=null;function d(){for(;u.length>0&&o.length>0;){(0,u.shift().resolve)({done:!1,value:o.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;p?(r(p),p=null):t({done:!0,value:void 0})}}function v(){return y.apply(this,arguments)}function y(){return(y=Object(a.a)(s.mark((function t(){var r,i,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return d(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+o.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,d()):b(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,p=t.t0,d();case 24:f=!1,v();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function b(e){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(s.mark((function e(r){var n,i,a,u,f,y,b,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:if(!(n=e.sent)||!n[Symbol.asyncIterator]){e.next=40;break}i=!0,a=!1,e.prev=7,f=Object(l.a)(n);case 9:return e.next=11,f.next();case 11:return y=e.sent,i=y.done,e.next=15,y.value;case 15:if(b=e.sent,i){e.next=22;break}m=b,o.push(m);case 19:i=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(7),a=!0,u=e.t0;case 28:if(e.prev=28,e.prev=29,i||null==f.return){e.next=33;break}return e.next=33,f.return();case 33:if(e.prev=33,!a){e.next=36;break}throw u;case 36:return e.finish(33);case 37:return e.finish(28);case 38:e.next=41;break;case 40:o.push(n);case 41:e.next=47;break;case 43:e.prev=43,e.t1=e.catch(0),c=!0,p=e.t1;case 47:h--,d(),v();case 50:case"end":return e.stop()}}),e,null,[[0,43],[7,24,28,38],[29,,33,37]])})))).apply(this,arguments)}function g(){return(g=Object(a.a)(s.mark((function e(){var t,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==o.length){e.next=5;break}return t=x(),u.push(t),v(),e.abrupt("return",t.promise);case 5:return r=o.shift(),v(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=Object(i.a)({next:function(){return g.apply(this,arguments)}},Symbol.asyncIterator,(function(){return k}));return k}(e,t,r)))}function V(e){return F.apply(this,arguments)}function F(){return(F=Object(a.a)(s.mark((function e(t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.once("readable",(function(){e()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(){return(H=h(s.mark((function e(t){var r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=t.read())){e.next=6;break}return e.next=5,r;case 5:return e.abrupt("continue",0);case 6:if(!t._readableState.ended){e.next=8;break}return e.abrupt("break",12);case 8:return e.next=10,c(V(t));case 10:e.next=0;break;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e){return"function"===typeof e[Symbol.asyncIterator]?e:function(e){return H.apply(this,arguments)}(e)}function Y(){return W.apply(this,arguments)}function W(){return(W=h(s.mark((function e(){var t,r,n,i,a,o,u,f,h,l,p,d=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=d.length,r=new Array(t),n=0;n<t;n++)r[n]=d[n];i=new Set(r.map(w));case 2:if(!(i.size>0)){e.next=38;break}a=!0,o=!1,u=void 0,e.prev=6,f=i[Symbol.iterator]();case 8:if(a=(h=f.next()).done){e.next=22;break}return l=h.value,e.next=12,c(l.next());case 12:if(!(p=e.sent).done){e.next=17;break}i.delete(l),e.next=19;break;case 17:return e.next=19,p.value;case 19:a=!0,e.next=8;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(6),o=!0,u=e.t0;case 28:e.prev=28,e.prev=29,a||null==f.return||f.return();case 31:if(e.prev=31,!o){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(28);case 36:e.next=2;break;case 38:case"end":return e.stop()}}),e,null,[[6,24,28,36],[29,,31,35]])})))).apply(this,arguments)}function J(e){for(var t=e(),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,s=n;a<s.length;a++){var o=s[a];t=o(t)}return t}function Q(){return(Q=h(s.mark((function e(t,r,n){var i,a,o,u,f,p,d,v;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=null,a=function(e){return{value:r(e)}},o=function(){var e=h(s.mark((function e(t){var r,n,a,o,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,n=!1,e.prev=2,o=Object(l.a)(t);case 4:return e.next=6,c(o.next());case 6:return u=e.sent,r=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,r){e.next=20;break}if(h=f,!i){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,h;case 17:r=!0,e.next=4;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),n=!0,a=e.t0;case 26:if(e.prev=26,e.prev=27,r||null==o.return){e.next=31;break}return e.next=31,c(o.return());case 31:if(e.prev=31,!n){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(26);case 36:case"end":return e.stop()}}),e,null,[[2,22,26,36],[27,,31,35]])})));return function(t){return e.apply(this,arguments)}}(),u=J((function(){return n}),E(1),o,q(a),E(t)),f=w(u);case 5:return e.next=8,c(f.next());case 8:if(p=e.sent,d=p.value,!p.done){e.next=13;break}return e.abrupt("break",27);case 13:return e.prev=13,e.next=16,c(d.value);case 16:if(v=e.sent,i){e.next=20;break}return e.next=20,v;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(13),i=e.t0;case 25:e.next=5;break;case 27:if(!i){e.next=29;break}throw i;case 29:case"end":return e.stop()}}),e,null,[[13,22]])})))).apply(this,arguments)}function X(e,t,r){return void 0===t?function(t,r){return X(e,t,r)}:void 0===r?function(r){return X(e,t,r)}:function(e,t,r){return Q.apply(this,arguments)}(e,t,r)}function Z(e,t,r){return void 0===t?function(t,r){return r?Z(e,t,r):Z(e,t)}:void 0===r?function(r){return Z(e,t,r)}:D((function(e){return void 0!==e&&null!==e}),O(X(e,t,r)))}function $(){return ee.apply(this,arguments)}function ee(){return(ee=h(s.mark((function e(){var t,r,i,o,u,f,h,l,p,d,v,y,b,m,g,k,x,S,E,_,I,A,T,C,B,R,N,P=arguments;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=P.length,r=new Array(t),i=0;i<t;i++)r[i]=P[i];for(o=r.map(w),u=new Set,f=new Map,h=null,l=null,p=null,d=function(e){h=e,l&&l(e)},v=function(e){p&&p(e)},y=function(){return new Promise((function(e,t){if(h&&t(h),f.size>0)return e();p=e,l=t}))},b=function(e){var t=Promise.resolve(e.next()).then(function(){var r=Object(a.a)(s.mark((function r(n){var i,a;return s.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=n.done,a=n.value,i||f.set(e,a),u.delete(t);case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());u.add(t),t.then(v,d)},m=!0,g=!1,k=void 0,e.prev=14,x=o[Symbol.iterator]();!(m=(S=x.next()).done);m=!0)E=S.value,b(E);e.next=22;break;case 18:e.prev=18,e.t0=e.catch(14),g=!0,k=e.t0;case 22:e.prev=22,e.prev=23,m||null==x.return||x.return();case 25:if(e.prev=25,!g){e.next=28;break}throw k;case 28:return e.finish(25);case 29:return e.finish(22);case 30:if(0!==u.size||0!==f.size){e.next=33;break}return e.abrupt("return");case 33:return e.next=35,c(y());case 35:_=!0,I=!1,A=void 0,e.prev=38,T=f[Symbol.iterator]();case 40:if(_=(C=T.next()).done){e.next=49;break}return B=Object(n.a)(C.value,2),R=B[0],N=B[1],f.delete(R),e.next=45,N;case 45:b(R);case 46:_=!0,e.next=40;break;case 49:e.next=55;break;case 51:e.prev=51,e.t1=e.catch(38),I=!0,A=e.t1;case 55:e.prev=55,e.prev=56,_||null==T.return||T.return();case 58:if(e.prev=58,!I){e.next=61;break}throw A;case 61:return e.finish(58);case 62:return e.finish(55);case 63:e.next=30;break;case 65:case"end":return e.stop()}}),e,null,[[14,18,22,30],[23,,25,29],[38,51,55,63],[56,,58,62]])})))).apply(this,arguments)}function te(e,t,r){return re.apply(this,arguments)}function re(){return(re=Object(a.a)(s.mark((function e(t,r,n){var i,a,o,u,c,f,h,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=r,a=!0,o=!1,e.prev=3,c=Object(l.a)(n);case 5:return e.next=7,c.next();case 7:return f=e.sent,a=f.done,e.next=11,f.value;case 11:if(h=e.sent,a){e.next=20;break}return p=h,e.next=16,t(i,p);case 16:i=e.sent;case 17:a=!0,e.next=5;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(3),o=!0,u=e.t0;case 26:if(e.prev=26,e.prev=27,a||null==c.return){e.next=31;break}return e.next=31,c.return();case 31:if(e.prev=31,!o){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",i);case 37:case"end":return e.stop()}}),e,null,[[3,22,26,36],[27,,31,35]])})))).apply(this,arguments)}function ne(e,t,r){return void 0===t?function(t,r){return r?te(e,t,r):ne(e,t)}:void 0===r?function(r){return ne(e,t,r)}:te(e,t,r)}function ie(){return(ie=h(s.mark((function e(t,r){var n,i,a,o,u,f,h,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,i=!0,a=!1,e.prev=3,u=Object(l.a)(r);case 5:return e.next=7,c(u.next());case 7:return f=e.sent,i=f.done,e.next=11,c(f.value);case 11:if(h=e.sent,i){e.next=22;break}return p=h,e.next=16,p;case 16:if(!(++n>=t)){e.next=19;break}return e.abrupt("break",22);case 19:i=!0,e.next=5;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(3),a=!0,o=e.t0;case 28:if(e.prev=28,e.prev=29,i||null==u.return){e.next=33;break}return e.next=33,c(u.return());case 33:if(e.prev=33,!a){e.next=36;break}throw o;case 36:return e.finish(33);case 37:return e.finish(28);case 38:case"end":return e.stop()}}),e,null,[[3,24,28,38],[29,,33,37]])})))).apply(this,arguments)}function ae(e,t){var r,n,i,a,o,u,c;return s.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=0,n=!0,i=!1,a=void 0,s.prev=4,o=t[Symbol.iterator]();case 6:if(n=(u=o.next()).done){s.next=16;break}return c=u.value,s.next=10,c;case 10:if(!(++r>=e)){s.next=13;break}return s.abrupt("break",16);case 13:n=!0,s.next=6;break;case 16:s.next=22;break;case 18:s.prev=18,s.t0=s.catch(4),i=!0,a=s.t0;case 22:s.prev=22,s.prev=23,n||null==o.return||o.return();case 25:if(s.prev=25,!i){s.next=28;break}throw a;case 28:return s.finish(25);case 29:return s.finish(22);case 30:case"end":return s.stop()}}),y,null,[[4,18,22,30],[23,,25,29]])}function se(e,t){return void 0===t?function(t){return se(e,t)}:t[Symbol.asyncIterator]?function(e,t){return ie.apply(this,arguments)}(e,t):ae(e,t)}function oe(e,t){return ue.apply(this,arguments)}function ue(){return(ue=h(s.mark((function e(t,r){var n,i,a,o,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=!0,i=!1,e.prev=2,o=Object(l.a)(r);case 4:return e.next=6,c(o.next());case 6:return u=e.sent,n=u.done,e.next=10,c(u.value);case 10:if(f=e.sent,n){e.next=20;break}return h=f,e.next=15,c(t(h));case 15:return e.next=17,h;case 17:n=!0,e.next=4;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(2),i=!0,a=e.t0;case 26:if(e.prev=26,e.prev=27,n||null==o.return){e.next=31;break}return e.next=31,c(o.return());case 31:if(e.prev=31,!i){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(26);case 36:case"end":return e.stop()}}),e,null,[[2,22,26,36],[27,,31,35]])})))).apply(this,arguments)}function ce(e,t){return void 0===t?function(t){return oe(e,t)}:oe(e,t)}function fe(e,t){var r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){var i=n%1e9;r+=(n-i)/1e9,n=i}return[r,n]}function he(e,t){return le.apply(this,arguments)}function le(){return(le=h(s.mark((function e(t,r){var n,i,a,o,u,f,h;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=r[Symbol.asyncIterator](),i=[0,0];case 2:return a=process.hrtime(),e.next=6,c(n.next());case 6:if(o=e.sent,u=o.value,f=o.done,h=process.hrtime(a),i=fe(i,h),t.progress&&t.progress(h,i),!f){e.next=15;break}return t.total&&t.total(i),e.abrupt("return",u);case 15:return e.next=17,u;case 17:e.next=2;break;case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pe(e,t){var r,n,i,a,o,u,c;return s.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:r=t[Symbol.iterator](),n=[0,0];case 2:if(i=process.hrtime(),a=r.next(),o=a.value,u=a.done,c=process.hrtime(i),n=fe(n,c),e.progress&&e.progress(c,n),!u){s.next=11;break}return e.total&&e.total(n),s.abrupt("return",o);case 11:return s.next=13,o;case 13:s.next=2;break;case 15:case"end":return s.stop()}}),b)}function de(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return void 0===t?function(t){return de(e,t)}:void 0!==t[Symbol.asyncIterator]?he(e,t):pe(e,t)}function ve(e,t,r){return void 0===t?function(t,r){return r?ve(e,t,r):ve(e,t)}:void 0===r?function(r){return ve(e,t,r)}:function(e,t,r){var n=w(r),o=[],u=[],c=!1,f=!1,h=0,l=null;function p(){for(;u.length>0&&o.length>0;){(0,u.shift().resolve)({done:!1,value:o.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;l?(r(l),l=null):t({done:!0,value:void 0})}}function d(){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(s.mark((function t(){var r,i,a;return s.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return p(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+o.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,p()):y(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,l=t.t0,p();case 24:f=!1,d();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(s.mark((function e(r){var n;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:n=e.sent,o.push(n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),c=!0,l=e.t0;case 11:h--,p(),d();case 14:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function m(){return(m=Object(a.a)(s.mark((function e(){var t,r;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==o.length){e.next=5;break}return t=x(),u.push(t),d(),e.abrupt("return",t.promise);case 5:return r=o.shift(),d(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=Object(i.a)({next:function(){return m.apply(this,arguments)}},Symbol.asyncIterator,(function(){return g}));return g}(e,t,r)}function ye(e,t){return be.apply(this,arguments)}function be(){return(be=Object(a.a)(s.mark((function e(t,r){var n,i,a,o,u,c,f,h,p,d,v,y,b,m;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=null,i=null,a=null,o=function(e){n=e,i&&i(e)},u=function(){a&&a()},c=function(){t.removeListener("error",o),t.removeListener("drain",u)},t.once("error",o),f=function(){return new Promise((function(e,r){if(n)return r(n);t.once("drain",u),a=e,i=r}))},h=!0,p=!1,e.prev=10,v=Object(l.a)(r);case 12:return e.next=14,v.next();case 14:return y=e.sent,h=y.done,e.next=18,y.value;case 18:if(b=e.sent,h){e.next=29;break}if(m=b,!1!==t.write(m)){e.next=24;break}return e.next=24,f();case 24:if(!n){e.next=26;break}return e.abrupt("break",29);case 26:h=!0,e.next=12;break;case 29:e.next=35;break;case 31:e.prev=31,e.t0=e.catch(10),p=!0,d=e.t0;case 35:if(e.prev=35,e.prev=36,h||null==v.return){e.next=40;break}return e.next=40,v.return();case 40:if(e.prev=40,!p){e.next=43;break}throw d;case 43:return e.finish(40);case 44:return e.finish(35);case 45:if(c(),!n){e.next=48;break}throw n;case 48:case"end":return e.stop()}}),e,null,[[10,31,35,45],[36,,40,44]])})))).apply(this,arguments)}function me(e,t){return void 0===t?function(t){return ye(e,t)}:ye(e,t)}},function(e,t,r){"use strict";t.get=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self,t=e.crypto||e.msCrypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}},function(e,t,r){var n=r(1950);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.aes.Algorithm(e,t)}))}r(2041),r(2042),r(1952),e.exports=n.aes=n.aes||{},n.aes.startEncrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!1,mode:n});return i.start(t),i},n.aes.createEncryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!1,mode:t})},n.aes.startDecrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!0,mode:n});return i.start(t),i},n.aes.createDecryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!0,mode:t})},n.aes.Algorithm=function(e,t){f||h();var r=this;r.name=e,r.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return p(r._w,e,t,!1)},decrypt:function(e,t){return p(r._w,e,t,!0)}}}),r._init=!1},n.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,r=e.key;if("string"!==typeof r||16!==r.length&&24!==r.length&&32!==r.length){if(n.util.isArray(r)&&(16===r.length||24===r.length||32===r.length)){t=r,r=n.util.createBuffer();for(var i=0;i<t.length;++i)r.putByte(t[i])}}else r=n.util.createBuffer(r);if(!n.util.isArray(r)){t=r,r=[];var a=t.length();if(16===a||24===a||32===a){a>>>=2;for(i=0;i<a;++i)r.push(t.getInt32())}}if(!n.util.isArray(r)||4!==r.length&&6!==r.length&&8!==r.length)throw new Error("Invalid key parameter.");var s=this.mode.name,o=-1!==["CFB","OFB","CTR","GCM"].indexOf(s);this._w=l(r,e.decrypt&&!o),this._init=!0}},n.aes._expandKey=function(e,t){return f||h(),l(e,t)},n.aes._updateBlock=p,i("AES-ECB",n.cipher.modes.ecb),i("AES-CBC",n.cipher.modes.cbc),i("AES-CFB",n.cipher.modes.cfb),i("AES-OFB",n.cipher.modes.ofb),i("AES-CTR",n.cipher.modes.ctr),i("AES-GCM",n.cipher.modes.gcm);var a,s,o,u,c,f=!1;function h(){f=!0,o=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;a=new Array(256),s=new Array(256),u=new Array(4),c=new Array(4);for(t=0;t<4;++t)u[t]=new Array(256),c[t]=new Array(256);var r,n,i,h,l,p,d,v=0,y=0;for(t=0;t<256;++t){h=(h=y^y<<1^y<<2^y<<3^y<<4)>>8^255&h^99,a[v]=h,s[h]=v,p=(l=e[h])<<24^h<<16^h<<8^h^l,d=((r=e[v])^(n=e[r])^(i=e[n]))<<24^(v^i)<<16^(v^n^i)<<8^v^r^i;for(var b=0;b<4;++b)u[b][v]=p,c[b][h]=d,p=p<<24|p>>>8,d=d<<24|d>>>8;0===v?v=y=1:(v=r^e[e[e[r^i]]],y^=e[e[y]])}}function l(e,t){for(var r,n=e.slice(0),i=1,s=n.length,u=4*(s+6+1),f=s;f<u;++f)r=n[f-1],f%s===0?(r=a[r>>>16&255]<<24^a[r>>>8&255]<<16^a[255&r]<<8^a[r>>>24]^o[i]<<24,i++):s>6&&f%s===4&&(r=a[r>>>24]<<24^a[r>>>16&255]<<16^a[r>>>8&255]<<8^a[255&r]),n[f]=n[f-s]^r;if(t){for(var h,l=c[0],p=c[1],d=c[2],v=c[3],y=n.slice(0),b=(f=0,(u=n.length)-4);f<u;f+=4,b-=4)if(0===f||f===u-4)y[f]=n[b],y[f+1]=n[b+3],y[f+2]=n[b+2],y[f+3]=n[b+1];else for(var m=0;m<4;++m)h=n[b+m],y[f+(3&-m)]=l[a[h>>>24]]^p[a[h>>>16&255]]^d[a[h>>>8&255]]^v[a[255&h]];n=y}return n}function p(e,t,r,n){var i,o,f,h,l,p,d,v,y,b,m,g,k=e.length/4-1;n?(i=c[0],o=c[1],f=c[2],h=c[3],l=s):(i=u[0],o=u[1],f=u[2],h=u[3],l=a),p=t[0]^e[0],d=t[n?3:1]^e[1],v=t[2]^e[2],y=t[n?1:3]^e[3];for(var w=3,x=1;x<k;++x)b=i[p>>>24]^o[d>>>16&255]^f[v>>>8&255]^h[255&y]^e[++w],m=i[d>>>24]^o[v>>>16&255]^f[y>>>8&255]^h[255&p]^e[++w],g=i[v>>>24]^o[y>>>16&255]^f[p>>>8&255]^h[255&d]^e[++w],y=i[y>>>24]^o[p>>>16&255]^f[d>>>8&255]^h[255&v]^e[++w],p=b,d=m,v=g;r[0]=l[p>>>24]<<24^l[d>>>16&255]<<16^l[v>>>8&255]<<8^l[255&y]^e[++w],r[n?3:1]=l[d>>>24]<<24^l[v>>>16&255]<<16^l[y>>>8&255]<<8^l[255&p]^e[++w],r[2]=l[v>>>24]<<24^l[y>>>16&255]<<16^l[p>>>8&255]<<8^l[255&d]^e[++w],r[n?1:3]=l[y>>>24]<<24^l[p>>>16&255]<<16^l[d>>>8&255]<<8^l[255&v]^e[++w]}function d(e){var t,r="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var a=null;r instanceof n.util.ByteBuffer&&(a=r,r={}),(r=r||{}).output=a,r.iv=e,i.call(t,r)},t}},function(e,t,r){"use strict";e.exports="enum KeyType {\n  RSA = 0;\n  Ed25519 = 1;\n  Secp256k1 = 2;\n}\nmessage PublicKey {\n  required KeyType Type = 1;\n  required bytes Data = 2;\n}\nmessage PrivateKey {\n  required KeyType Type = 1;\n  required bytes Data = 2;\n}"},function(e,t,r){var n=r(1950);n.pki=n.pki||{};var i=e.exports=n.pki.oids=n.oids=n.oids||{};function a(e,t){i[e]=t,i[t]=e}function s(e,t){i[e]=t}a("1.2.840.113549.1.1.1","rsaEncryption"),a("1.2.840.113549.1.1.4","md5WithRSAEncryption"),a("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),a("1.2.840.113549.1.1.7","RSAES-OAEP"),a("1.2.840.113549.1.1.8","mgf1"),a("1.2.840.113549.1.1.9","pSpecified"),a("1.2.840.113549.1.1.10","RSASSA-PSS"),a("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),a("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),a("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),a("1.3.101.112","EdDSA25519"),a("1.2.840.10040.4.3","dsa-with-sha1"),a("1.3.14.3.2.7","desCBC"),a("1.3.14.3.2.26","sha1"),a("2.16.840.1.101.3.4.2.1","sha256"),a("2.16.840.1.101.3.4.2.2","sha384"),a("2.16.840.1.101.3.4.2.3","sha512"),a("1.2.840.113549.2.5","md5"),a("1.2.840.113549.1.7.1","data"),a("1.2.840.113549.1.7.2","signedData"),a("1.2.840.113549.1.7.3","envelopedData"),a("1.2.840.113549.1.7.4","signedAndEnvelopedData"),a("1.2.840.113549.1.7.5","digestedData"),a("1.2.840.113549.1.7.6","encryptedData"),a("1.2.840.113549.1.9.1","emailAddress"),a("1.2.840.113549.1.9.2","unstructuredName"),a("1.2.840.113549.1.9.3","contentType"),a("1.2.840.113549.1.9.4","messageDigest"),a("1.2.840.113549.1.9.5","signingTime"),a("1.2.840.113549.1.9.6","counterSignature"),a("1.2.840.113549.1.9.7","challengePassword"),a("1.2.840.113549.1.9.8","unstructuredAddress"),a("1.2.840.113549.1.9.14","extensionRequest"),a("1.2.840.113549.1.9.20","friendlyName"),a("1.2.840.113549.1.9.21","localKeyId"),a("1.2.840.113549.1.9.22.1","x509Certificate"),a("1.2.840.113549.1.12.10.1.1","keyBag"),a("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),a("1.2.840.113549.1.12.10.1.3","certBag"),a("1.2.840.113549.1.12.10.1.4","crlBag"),a("1.2.840.113549.1.12.10.1.5","secretBag"),a("1.2.840.113549.1.12.10.1.6","safeContentsBag"),a("1.2.840.113549.1.5.13","pkcs5PBES2"),a("1.2.840.113549.1.5.12","pkcs5PBKDF2"),a("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),a("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),a("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),a("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),a("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),a("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),a("1.2.840.113549.2.7","hmacWithSHA1"),a("1.2.840.113549.2.8","hmacWithSHA224"),a("1.2.840.113549.2.9","hmacWithSHA256"),a("1.2.840.113549.2.10","hmacWithSHA384"),a("1.2.840.113549.2.11","hmacWithSHA512"),a("1.2.840.113549.3.7","des-EDE3-CBC"),a("2.16.840.1.101.3.4.1.2","aes128-CBC"),a("2.16.840.1.101.3.4.1.22","aes192-CBC"),a("2.16.840.1.101.3.4.1.42","aes256-CBC"),a("2.5.4.3","commonName"),a("2.5.4.5","serialName"),a("2.5.4.6","countryName"),a("2.5.4.7","localityName"),a("2.5.4.8","stateOrProvinceName"),a("2.5.4.9","streetAddress"),a("2.5.4.10","organizationName"),a("2.5.4.11","organizationalUnitName"),a("2.5.4.13","description"),a("2.5.4.15","businessCategory"),a("2.5.4.17","postalCode"),a("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),a("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),a("2.16.840.1.113730.1.1","nsCertType"),a("2.16.840.1.113730.1.13","nsComment"),s("2.5.29.1","authorityKeyIdentifier"),s("2.5.29.2","keyAttributes"),s("2.5.29.3","certificatePolicies"),s("2.5.29.4","keyUsageRestriction"),s("2.5.29.5","policyMapping"),s("2.5.29.6","subtreesConstraint"),s("2.5.29.7","subjectAltName"),s("2.5.29.8","issuerAltName"),s("2.5.29.9","subjectDirectoryAttributes"),s("2.5.29.10","basicConstraints"),s("2.5.29.11","nameConstraints"),s("2.5.29.12","policyConstraints"),s("2.5.29.13","basicConstraints"),a("2.5.29.14","subjectKeyIdentifier"),a("2.5.29.15","keyUsage"),s("2.5.29.16","privateKeyUsagePeriod"),a("2.5.29.17","subjectAltName"),a("2.5.29.18","issuerAltName"),a("2.5.29.19","basicConstraints"),s("2.5.29.20","cRLNumber"),s("2.5.29.21","cRLReason"),s("2.5.29.22","expirationDate"),s("2.5.29.23","instructionCode"),s("2.5.29.24","invalidityDate"),s("2.5.29.25","cRLDistributionPoints"),s("2.5.29.26","issuingDistributionPoint"),s("2.5.29.27","deltaCRLIndicator"),s("2.5.29.28","issuingDistributionPoint"),s("2.5.29.29","certificateIssuer"),s("2.5.29.30","nameConstraints"),a("2.5.29.31","cRLDistributionPoints"),a("2.5.29.32","certificatePolicies"),s("2.5.29.33","policyMappings"),s("2.5.29.34","policyConstraints"),a("2.5.29.35","authorityKeyIdentifier"),s("2.5.29.36","policyConstraints"),a("2.5.29.37","extKeyUsage"),s("2.5.29.46","freshestCRL"),s("2.5.29.54","inhibitAnyPolicy"),a("1.3.6.1.4.1.11129.2.4.2","timestampList"),a("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),a("1.3.6.1.5.5.7.3.1","serverAuth"),a("1.3.6.1.5.5.7.3.2","clientAuth"),a("1.3.6.1.5.5.7.3.3","codeSigning"),a("1.3.6.1.5.5.7.3.4","emailProtection"),a("1.3.6.1.5.5.7.3.8","timeStamping")},,function(e,t,r){var n=r(1950);if(r(1972),r(1982),r(1997),r(2109),r(2111),r(1973),r(1952),"undefined"===typeof i)var i=n.jsbn.BigInteger;var a=n.util.isNodejs?r(1998):null,s=n.asn1,o=n.util;n.pki=n.pki||{},e.exports=n.pki.rsa=n.rsa=n.rsa||{};var u=n.pki,c=[6,4,2,4,2,4,6,2],f={name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},l={name:"RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},p=n.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},d=function(e){var t;if(!(e.algorithm in u.oids)){var r=new Error("Unknown message digest algorithm.");throw r.algorithm=e.algorithm,r}t=u.oids[e.algorithm];var n=s.oidToDer(t).getBytes(),i=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),a=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);a.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,n)),a.value.push(s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,""));var o=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.digest().getBytes());return i.value.push(a),i.value.push(o),s.toDer(i).getBytes()},v=function(e,t,r){if(r)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var a;t.dP||(t.dP=t.d.mod(t.p.subtract(i.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(i.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{a=new i(n.util.bytesToHex(n.random.getBytes(t.n.bitLength()/8)),16)}while(a.compareTo(t.n)>=0||!a.gcd(t.n).equals(i.ONE));for(var s=(e=e.multiply(a.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),o=e.mod(t.q).modPow(t.dQ,t.q);s.compareTo(o)<0;)s=s.add(t.p);var u=s.subtract(o).multiply(t.qInv).mod(t.p).multiply(t.q).add(o);return u=u.multiply(a.modInverse(t.n)).mod(t.n)};function y(e,t,r){var i=n.util.createBuffer(),a=Math.ceil(t.n.bitLength()/8);if(e.length>a-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=e.length,s.max=a-11,s}i.putByte(0),i.putByte(r);var o,u=a-3-e.length;if(0===r||1===r){o=0===r?0:255;for(var c=0;c<u;++c)i.putByte(o)}else for(;u>0;){var f=0,h=n.random.getBytes(u);for(c=0;c<u;++c)0===(o=h.charCodeAt(c))?++f:i.putByte(o);u=f}return i.putByte(0),i.putBytes(e),i}function b(e,t,r,i){var a=Math.ceil(t.n.bitLength()/8),s=n.util.createBuffer(e),o=s.getByte(),u=s.getByte();if(0!==o||r&&0!==u&&1!==u||!r&&2!=u||r&&0===u&&"undefined"===typeof i)throw new Error("Encryption block is invalid.");var c=0;if(0===u){c=a-3-i;for(var f=0;f<c;++f)if(0!==s.getByte())throw new Error("Encryption block is invalid.")}else if(1===u)for(c=0;s.length()>1;){if(255!==s.getByte()){--s.read;break}++c}else if(2===u)for(c=0;s.length()>1;){if(0===s.getByte()){--s.read;break}++c}if(0!==s.getByte()||c!==a-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function m(e,t,r){"function"===typeof t&&(r=t,t={});var a={algorithm:{name:(t=t||{}).algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function s(){o(e.pBits,(function(t,n){return t?r(t):(e.p=n,null!==e.q?c(t,e.q):void o(e.qBits,c))}))}function o(e,t){n.prime.generateProbablePrime(e,a,t)}function c(t,n){if(t)return r(t);if(e.q=n,e.p.compareTo(e.q)<0){var a=e.p;e.p=e.q,e.q=a}if(0!==e.p.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.p=null,void s();if(0!==e.q.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.q=null,void o(e.qBits,c);if(e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(i.ONE))return e.p=e.q=null,void s();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void o(e.qBits,c);var f=e.e.modInverse(e.phi);e.keys={privateKey:u.rsa.setPrivateKey(e.n,e.e,f,e.p,e.q,f.mod(e.p1),f.mod(e.q1),e.q.modInverse(e.p)),publicKey:u.rsa.setPublicKey(e.n,e.e)},r(null,e.keys)}"prng"in t&&(a.prng=t.prng),s()}function g(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var r=n.util.hexToBytes(t);return r.length>1&&(0===r.charCodeAt(0)&&0===(128&r.charCodeAt(1))||255===r.charCodeAt(0)&&128===(128&r.charCodeAt(1)))?r.substr(1):r}function k(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function w(e){return n.util.isNodejs&&"function"===typeof a[e]}function x(e){return"undefined"!==typeof o.globalScope&&"object"===typeof o.globalScope.crypto&&"object"===typeof o.globalScope.crypto.subtle&&"function"===typeof o.globalScope.crypto.subtle[e]}function S(e){return"undefined"!==typeof o.globalScope&&"object"===typeof o.globalScope.msCrypto&&"object"===typeof o.globalScope.msCrypto.subtle&&"function"===typeof o.globalScope.msCrypto.subtle[e]}function E(e){for(var t=n.util.hexToBytes(e.toString(16)),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t.charCodeAt(i);return r}u.rsa.encrypt=function(e,t,r){var a,s=r,o=Math.ceil(t.n.bitLength()/8);!1!==r&&!0!==r?(s=2===r,a=y(e,t,r)):(a=n.util.createBuffer()).putBytes(e);for(var u=new i(a.toHex(),16),c=v(u,t,s).toString(16),f=n.util.createBuffer(),h=o-Math.ceil(c.length/2);h>0;)f.putByte(0),--h;return f.putBytes(n.util.hexToBytes(c)),f.getBytes()},u.rsa.decrypt=function(e,t,r,a){var s=Math.ceil(t.n.bitLength()/8);if(e.length!==s){var o=new Error("Encrypted message length is invalid.");throw o.length=e.length,o.expected=s,o}var u=new i(n.util.createBuffer(e).toHex(),16);if(u.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var c=v(u,t,r).toString(16),f=n.util.createBuffer(),h=s-Math.ceil(c.length/2);h>0;)f.putByte(0),--h;return f.putBytes(n.util.hexToBytes(c)),!1!==a?b(f.getBytes(),t,r):f.getBytes()},u.rsa.createKeyPairGenerationState=function(e,t,r){"string"===typeof e&&(e=parseInt(e,10)),e=e||2048;var a,s=(r=r||{}).prng||n.random,o={nextBytes:function(e){for(var t=s.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}},u=r.algorithm||"PRIMEINC";if("PRIMEINC"!==u)throw new Error("Invalid key generation algorithm: "+u);return(a={algorithm:u,state:0,bits:e,rng:o,eInt:t||65537,e:new i(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(a.eInt),a},u.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var r=new i(null);r.fromInt(30);for(var n,a=0,s=function(e,t){return e|t},o=+new Date,f=0;null===e.keys&&(t<=0||f<t);){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,l=h-1;0===e.pqState?(e.num=new i(h,e.rng),e.num.testBit(l)||e.num.bitwiseTo(i.ONE.shiftLeft(l),s,e.num),e.num.dAddOffset(31-e.num.mod(r).byteValue(),0),a=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(k(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(c[a++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(i.ONE).gcd(e.e).compareTo(i.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(i.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:u.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:u.rsa.setPublicKey(e.n,e.e)}}f+=(n=+new Date)-o,o=n}return null!==e.keys},u.rsa.generateKeyPair=function(e,t,r,i){if(1===arguments.length?"object"===typeof e?(r=e,e=void 0):"function"===typeof e&&(i=e,e=void 0):2===arguments.length?"number"===typeof e?"function"===typeof t?(i=t,t=void 0):"number"!==typeof t&&(r=t,t=void 0):(r=e,i=t,e=void 0,t=void 0):3===arguments.length&&("number"===typeof t?"function"===typeof r&&(i=r,r=void 0):(i=r,r=t,t=void 0)),r=r||{},void 0===e&&(e=r.bits||2048),void 0===t&&(t=r.e||65537),!n.options.usePureJavaScript&&!r.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(i){if(w("generateKeyPair"))return a.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,r){if(e)return i(e);i(null,{privateKey:u.privateKeyFromPem(r),publicKey:u.publicKeyFromPem(t)})}));if(x("generateKey")&&x("exportKey"))return o.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:E(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return o.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){i(e)})).then((function(e){if(e){var t=u.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(e)));i(null,{privateKey:t,publicKey:u.setRsaPublicKey(t.n,t.e)})}}));if(S("generateKey")&&S("exportKey")){var c=o.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:E(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return c.oncomplete=function(e){var t=e.target.result,r=o.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);r.oncomplete=function(e){var t=e.target.result,r=u.privateKeyFromAsn1(s.fromDer(n.util.createBuffer(t)));i(null,{privateKey:r,publicKey:u.setRsaPublicKey(r.n,r.e)})},r.onerror=function(e){i(e)}},void(c.onerror=function(e){i(e)})}}else if(w("generateKeyPairSync")){var f=a.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:u.privateKeyFromPem(f.privateKey),publicKey:u.publicKeyFromPem(f.publicKey)}}var h=u.rsa.createKeyPairGenerationState(e,t,r);if(!i)return u.rsa.stepKeyPairGenerationState(h,0),h.keys;m(h,r,i)},u.setRsaPublicKey=u.rsa.setPublicKey=function(e,t){var r={n:e,e:t,encrypt:function(e,t,i){if("string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,r){return y(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return n.pkcs1.encode_rsa_oaep(t,e,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"===typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var a=t.encode(e,r,!0);return u.rsa.encrypt(a,r,!0)},verify:function(e,t,n){"string"===typeof n?n=n.toUpperCase():void 0===n&&(n="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===n?n={verify:function(e,t){return t=b(t,r,!0),e===s.fromDer(t).value[1].value}}:"NONE"!==n&&"NULL"!==n&&null!==n||(n={verify:function(e,t){return e===(t=b(t,r,!0))}});var i=u.rsa.decrypt(t,r,!0,!1);return n.verify(e,i,r.n.bitLength())}};return r},u.setRsaPrivateKey=u.rsa.setPrivateKey=function(e,t,r,i,a,s,o,c){var f={n:e,e:t,d:r,p:i,q:a,dP:s,dQ:o,qInv:c,decrypt:function(e,t,r){"string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var i=u.rsa.decrypt(e,f,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:b};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return n.pkcs1.decode_rsa_oaep(t,e,r)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(i,f,!1)},sign:function(e,t){var r=!1;"string"===typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:d},r=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},r=1);var n=t.encode(e,f.n.bitLength());return u.rsa.encrypt(n,f,r)}};return f},u.wrapRsaPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(u.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(e).getBytes())])},u.privateKeyFromAsn1=function(e){var t,r,a,o,c,l,p,d,v={},y=[];if(s.validate(e,f,v,y)&&(e=s.fromDer(n.util.createBuffer(v.privateKey))),v={},y=[],!s.validate(e,h,v,y)){var b=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw b.errors=y,b}return t=n.util.createBuffer(v.privateKeyModulus).toHex(),r=n.util.createBuffer(v.privateKeyPublicExponent).toHex(),a=n.util.createBuffer(v.privateKeyPrivateExponent).toHex(),o=n.util.createBuffer(v.privateKeyPrime1).toHex(),c=n.util.createBuffer(v.privateKeyPrime2).toHex(),l=n.util.createBuffer(v.privateKeyExponent1).toHex(),p=n.util.createBuffer(v.privateKeyExponent2).toHex(),d=n.util.createBuffer(v.privateKeyCoefficient).toHex(),u.setRsaPrivateKey(new i(t,16),new i(r,16),new i(a,16),new i(o,16),new i(c,16),new i(l,16),new i(p,16),new i(d,16))},u.privateKeyToAsn1=u.privateKeyToRSAPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.e)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.d)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.p)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.q)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.dP)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.dQ)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.qInv))])},u.publicKeyFromAsn1=function(e){var t={},r=[];if(s.validate(e,p,t,r)){var a,o=s.derToOid(t.publicKeyOid);if(o!==u.oids.rsaEncryption)throw(a=new Error("Cannot read public key. Unknown OID.")).oid=o,a;e=t.rsaPublicKey}if(r=[],!s.validate(e,l,t,r))throw(a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=r,a;var c=n.util.createBuffer(t.publicKeyModulus).toHex(),f=n.util.createBuffer(t.publicKeyExponent).toHex();return u.setRsaPublicKey(new i(c,16),new i(f,16))},u.publicKeyToAsn1=u.publicKeyToSubjectPublicKeyInfo=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(u.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,[u.publicKeyToRSAPublicKey(e)])])},u.publicKeyToRSAPublicKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,g(e.e))])}},function(e,t,r){"use strict";var n=r(3).Buffer,i=r(2113);function a(e,t){if(!t)throw new Error("requires an encoded buffer");var r=s(e),i=n.from(r.code);return function(e,t){s(e).decode(t.toString())}(r.name,t),n.concat([i,t])}function s(e){var t;if(i.names[e])t=i.names[e];else{if(!i.codes[e])throw new Error("Unsupported encoding");t=i.codes[e]}if(!t.isImplemented())throw new Error("Base "+e+" is not implemented yet");return t}(t=e.exports=a).encode=function(e,t){var r=s(e);return a(r.name,n.from(r.encode(t)))},t.decode=function(e){n.isBuffer(e)&&(e=e.toString());var t=e.substring(0,1);"string"===typeof(e=e.substring(1,e.length))&&(e=n.from(e));var r=s(t);return n.from(r.decode(e.toString()))},t.isEncoded=function(e){n.isBuffer(e)&&(e=e.toString());if("[object String]"!==Object.prototype.toString.call(e))return!1;var t=e.substring(0,1);try{return s(t).name}catch(r){return!1}},t.names=Object.freeze(Object.keys(i.names)),t.codes=Object.freeze(Object.keys(i.codes))},function(e,t,r){"use strict";var n=r(463),i=r(15);e.exports=function(e){if(isNaN(e)||e<=0)throw i(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return n(e)}},function(e,t,r){"use strict";var n=r(3).Buffer;r(1952),r(1982);var i=r(1950);t.bigIntegerToUintBase64url=function(e,r){var i=n.from(e.abs().toByteArray());if(i=0===i[0]?i.slice(1):i,null!=r){if(i.length>r)throw new Error("byte array longer than desired length");i=n.concat([n.alloc(r-i.length),i])}return t.bufferToBase64url(i)},t.bufferToBase64url=function(e){return e.toString("base64").split("=")[0].replace(/\+/g,"-").replace(/\//g,"_")},t.base64urlToBigInteger=function(e){var r=t.base64urlToBuffer(e);return new i.jsbn.BigInteger(r.toString("hex"),16)},t.base64urlToBuffer=function(e,t){e=(e+"===".slice((e.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/");var r=n.from(e,"base64");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=n.concat([n.alloc(t-r.length),r])}return r}},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return i}));var n=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([a-z\xb5\u03bc]*)/gi;function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ms",r=null;return(e=e.replace(/(\d),(\d)/g,"$1$2")).replace(n,(function(e,t,n){(n=i[n]||i[n.toLowerCase().replace(/s$/,"")])&&(r=(r||0)+parseFloat(t,10)*n)})),r&&r/i[t]}i.nanosecond=i.ns=1e-6,i["\xb5s"]=i["\u03bcs"]=i.us=i.microsecond=.001,i.millisecond=i.ms=1,i.second=i.sec=i.s=1e3*i.ms,i.minute=i.min=i.m=60*i.s,i.hour=i.hr=i.h=60*i.m,i.day=i.d=24*i.h,i.week=i.wk=i.w=7*i.d,i.month=i.b=30.4375*i.d,i.year=i.yr=i.y=365.25*i.d},function(e,t,r){"use strict";var n=r(32),i=r(15);t.cleanCid=function(e){if(n.isCID(e))return e;try{return new n(e)}catch(t){throw i(t,"ERR_INVALID_CID")}}},function(e,t,r){"use strict";var n=r(32);t.cidToString=function(e,t){if((t=t||{}).upgrade=!1!==t.upgrade,n.isCID(e)||(e=new n(e)),0===e.version&&t.base&&"base58btc"!==t.base){if(!t.upgrade)return e.toString();e=e.toV1()}return e.toBaseEncodedString(t.base)}},function(e,t,r){"use strict";e.exports=function(){return{Addresses:{Swarm:[],API:"",Gateway:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dns4/ams-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLer265NRgSp2LA3dPaeykiS1J6DifTC88f5uVQKNAd","/dns4/lon-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLMeWqB7YGVLJN3pNLQpmmEk35v6wYtsMGLzSr5QBU3","/dns4/sfo-3.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLPppuBtQSGwKDZT2M73ULpjvfd3aZ6ha4oFGL1KrGM","/dns4/sgp-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLSafTMBsPKadTEgaXctDQVcqN88CNLHXMkTNwMKPnu","/dns4/nyc-1.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLueR4xBeUbY9WZ9xGUUxunbKWcrNFTDAadQJmocnWm","/dns4/nyc-2.bootstrap.libp2p.io/tcp/443/wss/p2p/QmSoLV4Bbm51jM9C4gDYZQ9Cy3U6aXMJDAbzgu2fzaDs64","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:200,HighWater:500}},Routing:{Type:"none"}}}},function(e,t,r){"use strict";e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2009),s=r(1987),o=r(19)("ipfs:mfs:cp"),u=r(15),c=r(1969),f=r(1970),h=r(1968),l=r(1956),p=r(2165),d=r(1975),v=r(1948).withTimeoutOption,y={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,signal:void 0};e.exports=function(e){return v(function(){var t=i(n.mark((function t(){var r,i,c,f,h,v,k,w,x,S,E,_,I,A,T=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=T.length,i=new Array(r),c=0;c<r;c++)i[c]=T[c];return t.next=3,p(e,i,y);case 3:if(f=t.sent,h=f.sources,v=f.destination,k=f.options,h.length){t.next=9;break}throw u(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");case 9:if(k.parents=k.p||k.parents,!(w=h.find((function(e){return!e.exists})))){t.next=13;break}throw u(new Error("".concat(w.path," does not exist")),"ERR_INVALID_PARAMS");case 13:if(x=b(v),!v.exists){t.next=20;break}if(o("Destination exists"),1!==h.length||x){t.next=18;break}throw u(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS");case 18:t.next=49;break;case 20:if(o("Destination does not exist"),!(h.length>1)){t.next=31;break}if(k.parents){t.next=24;break}throw u(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");case 24:return t.next=26,a(e)(v.path,k);case 26:return t.next=28,l(e,v.path,k);case 28:v=t.sent,t.next=49;break;case 31:if(!(v.parts.length>1)){t.next=49;break}return S="/".concat(v.parts.slice(0,-1).join("/")),t.prev=33,t.next=36,s(e)(S,k);case 36:t.next=49;break;case 38:if(t.prev=38,t.t0=t.catch(33),"ERR_NOT_FOUND"===t.t0.code){t.next=42;break}throw t.t0;case 42:if(k.parents){t.next=44;break}throw u(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");case 44:return t.next=46,a(e)(S,k);case 46:return t.next=48,l(e,v.path,k);case 48:v=t.sent;case 49:return E=b(v)?v.mfsPath:v.mfsDirectory,t.next=52,d(e,E,k);case 52:if(_=t.sent,1!==h.length){t.next=58;break}return I=h.pop(),A=x?I.name:v.name,o("Only one source, copying to destination ".concat(x?"directory":"file"," ").concat(A)),t.abrupt("return",m(e,I,A,_,k));case 58:return o("Multiple sources, wrapping in a directory"),t.abrupt("return",g(e,h,v,_,k));case 60:case"end":return t.stop()}}),t,null,[[33,38]])})));return function(){return t.apply(this,arguments)}}())};var b=function(e){return e.unixfs&&e.unixfs.type&&e.unixfs.type.includes("directory")},m=function(){var e=i(n.mark((function e(t,r,i,a,s){var o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.pop(),e.next=3,k(t,r,i,o,s);case 3:return o=e.sent,a.push(o),e.next=7,c(t,a,s);case 7:return u=e.sent,e.next=10,f(t,u,s);case 10:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),g=function(){var e=i(n.mark((function e(t,r,i,a,s){var o,u,h;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<r.length)){e.next=9;break}return u=r[o],e.next=5,k(t,u,u.name,i,s);case 5:i=e.sent;case 6:o++,e.next=1;break;case 9:return a[a.length-1]=i,e.next=12,c(t,a,s);case 12:return h=e.sent,e.next=15,f(t,h,s);case 15:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),k=function(){var e=i(n.mark((function e(t,r,i,a,s){var o,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.repo.blocks.get(r.cid);case 2:return o=e.sent,e.next=5,h(t,{parentCid:a.cid,size:o.data.length,cid:r.cid,name:i,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush});case 5:return u=e.sent,c=u.node,f=u.cid,a.node=c,a.cid=f,a.size=c.size,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(15),s=r(19)("ipfs:mfs:mkdir"),o=r(126),u=r(2164),c=r(2007),f=r(1970),h=r(1969),l=r(1968),p=r(2050),d=r(1959),v=r(1948).withTimeoutOption,y={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0,mode:null,mtime:null,signal:void 0};e.exports=function(e){return v(function(){var t=i(n.mark((function t(r,i){var l,v,m,g,k,w,x,S,E;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=d(i,y),r){t.next=3;break}throw new Error("no path given to Mkdir");case 3:if("/"!==(r=r.trim())){t.next=8;break}if(!i.parents){t.next=7;break}return t.abrupt("return");case 7:throw a(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH");case 8:if("/"===r.substring(0,1)){t.next=10;break}throw a(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");case 10:if(s("Creating ".concat(r)),"ipfs"!==(l=c(r))[0]){t.next=14;break}throw a(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");case 14:return t.next=16,p(e,i);case 16:return v=t.sent,g=[],t.next=20,u(e,"directory",i);case 20:k=t.sent,w=0;case 22:if(!(w<=l.length)){t.next=51;break}return x=l.slice(0,w),S="/ipfs/".concat(v,"/").concat(x.join("/")),t.prev=25,t.next=28,o(S,e.ipld);case 28:if(m=t.sent,s("".concat(S," existed")),s("".concat(S," had children ").concat(m.node.Links.map((function(e){return e.Name})))),w!==l.length){t.next=35;break}if(!i.parents){t.next=34;break}return t.abrupt("return");case 34:throw a(new Error("file already exists"),"ERR_ALREADY_EXISTS");case 35:g.push({name:m.name,cid:m.cid}),t.next=48;break;case 38:if(t.prev=38,t.t0=t.catch(25),"ERR_NOT_FOUND"!==t.t0.code){t.next=47;break}if(!(w<l.length)||i.parents){t.next=43;break}throw a(new Error("Intermediate directory path ".concat(S," does not exist, use the -p flag to create it")),"ERR_NOT_FOUND");case 43:return t.next=45,b(e,x[x.length-1],k,g[g.length-1],g,i);case 45:t.next=48;break;case 47:throw t.t0;case 48:w++,t.next=22;break;case 51:return t.next=53,h(e,g,i);case 53:return E=t.sent,t.next=56,f(e,E,i);case 56:case"end":return t.stop()}}),t,null,[[25,38]])})));return function(e,r){return t.apply(this,arguments)}}())};var b=function(){var e=i(n.mark((function e(t,r,i,a,o,u){var c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("Adding empty dir called ".concat(r," to ").concat(a.cid)),e.next=3,l(t,{parent:a.node,parentCid:a.cid,size:i.node.size,cid:i.cid,name:r,hashAlg:u.hashAlg,cidVersion:u.cidVersion,flush:u.flush});case 3:c=e.sent,o[o.length-1].cid=c.cid,o.push({name:r,cid:i.cid});case 6:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1956),s=r(1959);function o(){return(o=i(n.mark((function e(t,r,i){var o,u,c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=[],c=0;c<r.length;c++)"string"===typeof r[c]||r[c]instanceof String?o.push(r[c].trim()):c===r.length-1&&(u=r[c]);return u=s(u,i),e.next=5,a(t,o,u);case 5:return e.t0=e.sent,e.t1=u,e.abrupt("return",{sources:e.t0,options:e.t1});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(e,t,r){return o.apply(this,arguments)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(15),s=r(1969),o=r(1970),u=r(2010),c=r(2166),f=r(1956),h=r(1975),l=r(1948).withTimeoutOption,p={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,signal:void 0};e.exports=function(e){return l(function(){var t=i(n.mark((function t(){var r,i,s,o,c,f,h,l,v,y,b,m,g=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=g.length,i=new Array(r),s=0;s<r;s++)i[s]=g[s];return t.next=3,u(e,i,p);case 3:if(o=t.sent,c=o.sources,f=o.options,c.length){t.next=8;break}throw a(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");case 8:c.forEach((function(e){if("/"===e.path)throw a(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")})),h=!0,l=!1,v=void 0,t.prev=12,y=c[Symbol.iterator]();case 14:if(h=(b=y.next()).done){t.next=21;break}return m=b.value,t.next=18,d(e,m.path,f);case 18:h=!0,t.next=14;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(12),l=!0,v=t.t0;case 27:t.prev=27,t.prev=28,h||null==y.return||y.return();case 30:if(t.prev=30,!l){t.next=33;break}throw v;case 33:return t.finish(30);case 34:return t.finish(27);case 35:case"end":return t.stop()}}),t,null,[[12,23,27,35],[28,,30,34]])})));return function(){return t.apply(this,arguments)}}())};var d=function(){var e=i(n.mark((function e(t,r,i){var u,l,p,d,v,y,b;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r,i);case 2:return u=e.sent,e.next=5,h(t,u.mfsPath,i);case 5:if(l=e.sent,p=l.pop(),d=l[l.length-1]){e.next=10;break}throw a(new Error("".concat(r," does not exist")),"ERR_NOT_FOUND");case 10:if("directory"!==p.type||i.recursive){e.next=12;break}throw a(new Error("".concat(r," is a directory, use -r to remove directories")),"ERR_WAS_DIR");case 12:return e.next=14,c(t,{parentCid:d.cid,name:p.name,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush});case 14:return v=e.sent,y=v.cid,d.cid=y,e.next=19,s(t,l,i);case 19:return b=e.sent,e.next=22,o(t,b,i);case 22:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(48),i=r(1),a=r(2),s=r(5),o=r(7),u=r(18),c=r(469),f=r(19),h=r(139),l=r(15),p=r(2178),d=r(2185),v=r(792),y=r(2186),b=r(2187),m=r(2188),g=r(2189),k=r(2190),w=r(2193),x=r(2194),S=r(2195),E=r(2196),_=r(2013),I=f("ipfs:repo"),A=Number.MAX_SAFE_INTEGER,T={memory:r(2055),fs:r(2055)},C=function(){function e(t,r){if(s(this,e),"string"!==typeof t)throw new Error("missing repoPath");this.options=function(e){var t=Object.assign({},S,e);return t.storageBackends=Object.assign({},S.storageBackends,t.storageBackends),t.storageBackendOptions=Object.assign({},S.storageBackendOptions,t.storageBackendOptions),t}(r),this.closed=!0,this.path=t,this._locker=this._getLocker(),this.root=b.create("root",this.path,this.options),this.version=m(this.root),this.config=g(this.root),this.spec=k(this.root),this.apiAddr=w(this.root)}return o(e,[{key:"init",value:function(){var e=a(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I("initializing at: %s",this.path),e.next=3,this._openRoot();case 3:return e.next=5,this.config.set(N(t));case 5:return e.next=7,this.spec.set(P(t));case 7:return e.next=9,this.version.set(y.repoVersion);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){var e=a(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.closed){e.next=2;break}return e.abrupt("return",!0);case 2:return e.prev=2,e.next=5,this._openRoot();case 5:return e.next=7,this._checkInitialized();case 7:return e.next=9,this.root.close();case 9:return e.abrupt("return",!0);case 12:return e.prev=12,e.t0=e.catch(2),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"open",value:function(){var e=a(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.closed){e.next=2;break}throw l(new Error("repo is already open"),_.ERR_REPO_ALREADY_OPEN);case 2:return I("opening at: %s",this.path),e.prev=3,e.next=6,this._openRoot();case 6:return e.next=8,this._checkInitialized();case 8:return e.next=10,this._openLock(this.path);case 10:return this.lockfile=e.sent,I("acquired repo.lock"),I("creating datastore"),this.datastore=b.create("datastore",v(this.path,"datastore"),this.options),e.next=16,this.datastore.open();case 16:return I("creating blocks"),t=b.create("blocks",v(this.path,"blocks"),this.options),e.next=20,t.open();case 20:return e.next=22,x(t,this.options.storageBackendOptions.blocks);case 22:return this.blocks=e.sent,I("creating keystore"),this.keys=b.create("keys",v(this.path,"keys"),this.options),e.next=27,this.keys.open();case 27:return e.next=29,this.version.check(y.repoVersion);case 29:if(e.sent){e.next=39;break}return e.next=33,this._isAutoMigrationEnabled();case 33:if(!e.sent){e.next=38;break}return e.next=36,this._migrate(y.repoVersion);case 36:e.next=39;break;case 38:throw new _.InvalidRepoVersionError("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");case 39:this.closed=!1,I("all opened"),e.next=56;break;case 43:if(e.prev=43,e.t0=e.catch(3),!this.lockfile){e.next=55;break}return e.prev=46,e.next=49,this._closeLock();case 49:this.lockfile=null,e.next=55;break;case 52:e.prev=52,e.t1=e.catch(46),I("error removing lock",e.t1);case 55:throw e.t0;case 56:case"end":return e.stop()}}),e,this,[[3,43],[46,52]])})));return function(){return e.apply(this,arguments)}}()},{key:"_getLocker",value:function(){if("string"===typeof this.options.lock){if(!T[this.options.lock])throw new Error("Unknown lock type: "+this.options.lock);return T[this.options.lock]}if(!this.options.lock)throw new Error("No lock provided");return this.options.lock}},{key:"_openRoot",value:function(){var e=a(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.root.open();case 3:e.next=9;break;case 5:if(e.prev=5,e.t0=e.catch(0),"Already open"===e.t0.message){e.next=9;break}throw e.t0;case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"_openLock",value:function(){var e=a(i.mark((function e(t){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._locker.lock(t);case 2:if("function"===typeof(r=e.sent).close){e.next=5;break}throw l(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");case 5:return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_closeLock",value:function(){return this.lockfile.close()}},{key:"_checkInitialized",value:function(){var e=a(i.mark((function e(){var t,r,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return I("init check"),e.prev=1,e.next=4,Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()]);case 4:r=e.sent,a=n(r,1),t=a[0],e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(1),"ERR_NOT_FOUND"!==e.t0.code){e.next=13;break}throw l(new Error("repo is not initialized yet"),_.ERR_REPO_NOT_INITIALIZED,{path:this.path});case 13:throw e.t0;case 14:if(t){e.next=16;break}throw l(new Error("repo is not initialized yet"),_.ERR_REPO_NOT_INITIALIZED,{path:this.path});case 16:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"close",value:function(){var e=a(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.closed){e.next=2;break}throw l(new Error("repo is already closed"),_.ERR_REPO_ALREADY_CLOSED);case 2:return I("closing at: %s",this.path),e.prev=3,e.next=6,this.apiAddr.delete();case 6:e.next=12;break;case 8:if(e.prev=8,e.t0=e.catch(3),e.t0.code===_.ERR_REPO_NOT_INITIALIZED||e.t0.message.startsWith("ENOENT")){e.next=12;break}throw e.t0;case 12:return e.next=14,Promise.all([this.root,this.blocks,this.keys,this.datastore].map((function(e){return e.close()})));case 14:return I("unlocking"),this.closed=!0,e.next=18,this._closeLock();case 18:this.lockfile=null;case 19:case"end":return e.stop()}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"exists",value:function(){var e=a(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.version.exists());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stat",value:function(){var e=a(i.mark((function e(){var t,r,a,s,o,u,c,f;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),B(this.datastore),B(this.keys)]);case 2:return t=e.sent,r=n(t,5),a=r[0],s=r[1],o=r[2],u=r[3],c=r[4],f=s.size.plus(u).plus(c),e.abrupt("return",{repoPath:this.path,storageMax:a,version:o,numObjects:s.count,repoSize:f});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_isAutoMigrationEnabled",value:function(){var e=a(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.options.autoMigrate){e.next=2;break}return e.abrupt("return",this.options.autoMigrate);case 2:return e.prev=2,e.next=5,this.config.get("repoAutoMigrate");case 5:t=e.sent,e.next=15;break;case 8:if(e.prev=8,e.t0=e.catch(2),e.t0.code!==_.NotFoundError.code){e.next=14;break}t=!0,e.next=15;break;case 14:throw e.t0;case 15:return e.abrupt("return",t);case 16:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"_migrate",value:function(){var e=a(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.version.get();case 2:if(!(e.sent>t)){e.next=8;break}return I("reverting to version "+t),e.abrupt("return",p.revert(this.path,t,{ignoreLock:!0,repoOptions:this.options}));case 8:return I("migrating to version "+t),e.abrupt("return",p.migrate(this.path,t,{ignoreLock:!0,repoOptions:this.options}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_storageMaxStat",value:function(){var e=a(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.config.get("Datastore.StorageMax");case 3:return t=e.sent,e.abrupt("return",new h(d(t)));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",new h(A));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"_blockStat",value:function(){var e=a(i.mark((function e(){var t,r,n,a,s,o,c,f,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new h(0),r=new h(0),n=!0,a=!1,e.prev=4,o=u(this.blocks.query({}));case 6:return e.next=8,o.next();case 8:return c=e.sent,n=c.done,e.next=12,c.value;case 12:if(f=e.sent,n){e.next=20;break}l=f,t=t.plus(1),r=r.plus(l.data.byteLength).plus(l.cid.buffer.byteLength);case 17:n=!0,e.next=6;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),a=!0,s=e.t0;case 26:if(e.prev=26,e.prev=27,n||null==o.return){e.next=31;break}return e.next=31,o.return();case 31:if(e.prev=31,!a){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",{count:t,size:r});case 37:case"end":return e.stop()}}),e,this,[[4,22,26,36],[27,,31,35]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function B(e){return R.apply(this,arguments)}function R(){return(R=a(i.mark((function e(t){var r,n,a,s,o,c,f,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new h(0),n=!0,a=!1,e.prev=3,o=u(t.query({}));case 5:return e.next=7,o.next();case 7:return c=e.sent,n=c.done,e.next=11,c.value;case 11:if(f=e.sent,n){e.next=18;break}l=f,r.plus(l.value.byteLength).plus(l.key.toBuffer().byteLength);case 15:n=!0,e.next=5;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(3),a=!0,s=e.t0;case 24:if(e.prev=24,e.prev=25,n||null==o.return){e.next=29;break}return e.next=29,o.return();case 29:if(e.prev=29,!a){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(24);case 34:return e.abrupt("return",r);case 35:case"end":return e.stop()}}),e,null,[[3,20,24,34],[25,,29,33]])})))).apply(this,arguments)}function N(e){return e.datastore=Object.assign({},E,c(e,"datastore",{})),e}function P(e){var t=Object.assign({},E.Spec,c(e,"datastore.Spec",{}));return{type:t.type,mounts:t.mounts.map((function(e){return{mountpoint:e.mountpoint,type:e.child.type,path:e.child.path,shardFunc:e.child.shardFunc}}))}}e.exports=C,e.exports.utils={blockstore:r(2054)},e.exports.repoVersion=y.repoVersion,e.exports.errors=_},function(e,t,r){"use strict";var n=r(5),i=r(28),a=r(27),s=r(29),o=r(110),u=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="LockExistsError",r.code=t.code,r}return s(t,e),t}(o(Error));u.code="ERR_LOCK_EXISTS",t.LockExistsError=u;var c=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="NotFoundError",r.code=t.code,r}return s(t,e),t}(o(Error));c.code="ERR_NOT_FOUND",t.NotFoundError=c;var f=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="InvalidRepoVersionError",r.code=t.code,r}return s(t,e),t}(o(Error));f.code="ERR_INVALID_REPO_VERSION",t.InvalidRepoVersionError=f,t.ERR_REPO_NOT_INITIALIZED="ERR_REPO_NOT_INITIALIZED",t.ERR_REPO_ALREADY_OPEN="ERR_REPO_ALREADY_OPEN",t.ERR_REPO_ALREADY_CLOSED="ERR_REPO_ALREADY_CLOSED"},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(28),u=r(27),c=r(87),f=r(29),h=r(19),l=r(41),p=r(15),d=r(55),v=r(2015),y=r(2016),b=r(2216),m=r(2217),g=r(2224),k=g.signMessage,w=g.verifySignature;var x=function(e){function t(e){var r,n=e.debugName,i=e.multicodecs,s=e.peerId,f=e.registrar,l=e.signMessages,p=void 0===l||l,v=e.strictSigning,y=void 0===v||v;if(a(this,t),"string"!==typeof n)throw new Error("a debugname `string` is required");if(!i)throw new Error("multicodecs are required");if(!d.isPeerId(s))throw new Error("peerId must be an instance of `peer-id`");return function(e){if("object"!==typeof e)throw new Error("a registrar object is required");if("function"!==typeof e.handle)throw new Error("a handle function must be provided in registrar");if("function"!==typeof e.register)throw new Error("a register function must be provided in registrar");if("function"!==typeof e.unregister)throw new Error("a unregister function must be provided in registrar")}(f),(r=o(this,u(t).call(this))).log=h(n),r.log.err=h("".concat(n,":error")),r.multicodecs=m.ensureArray(i),r.registrar=f,r.started=!1,r.peerId=s,r.topics=new Map,r.peers=new Map,r.signMessages=p,r.strictSigning=y,r._registrarId=void 0,r._onIncomingStream=r._onIncomingStream.bind(c(r)),r._onPeerConnected=r._onPeerConnected.bind(c(r)),r._onPeerDisconnected=r._onPeerDisconnected.bind(c(r)),r}return f(t,e),s(t,[{key:"start",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.started){e.next=2;break}return e.abrupt("return");case 2:return this.log("starting"),this.registrar.handle(this.multicodecs,this._onIncomingStream),t=new v({multicodecs:this.multicodecs,handlers:{onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected}}),e.next=7,this.registrar.register(t);case 7:this._registrarId=e.sent,this.log("started"),this.started=!0;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.started){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.registrar.unregister(this._registrarId);case 4:this.log("stopping"),this.peers.forEach((function(e){return e.close()})),this.peers=new Map,this.started=!1,this.log("stopped");case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onIncomingStream",value:function(e){var t=e.protocol,r=e.stream,n=e.connection.remotePeer,i=n.toB58String(),a=this._addPeer(n,[t]);this._processMessages(i,r,a)}},{key:"_onPeerConnected",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.toB58String(),this.log("connected",i),a=this._addPeer(t,this.multicodecs),e.prev=3,e.next=6,r.newStream(this.multicodecs);case 6:s=e.sent,o=s.stream,a.attachConnection(o),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),this.log.err(e.t0);case 14:case"end":return e.stop()}}),e,this,[[3,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_onPeerDisconnected",value:function(e,t){var r=e.toB58String(),n=this.peers.get(r);this.log("connection ended",r,t?t.message:""),this._removePeer(n)}},{key:"_addPeer",value:function(e,t){var r=this,n=e.toB58String(),i=this.peers.get(n);if(!i){this.log("new peer",n);var a=new b({id:e,protocols:t});this.peers.set(n,a),i=a,a.once("close",(function(){return r._removePeer(a)}))}return i}},{key:"_removePeer",value:function(e){if(e){var t=e.id.toB58String();return this.log("delete peer",t),this.peers.delete(t),e}}},{key:"validate",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.strictSigning||t.signature){e.next=3;break}return this.log("Signing required and no signature was present, dropping message:",t),e.abrupt("return",!1);case 3:if(!t.signature){e.next=7;break}return e.abrupt("return",w(t));case 7:return e.abrupt("return",!0);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_buildMessage",value:function(e){var t=m.normalizeOutRpcMessage(e);return this.signMessages?k(this.peerId,t):e}},{key:"getSubscribers",value:function(e){if(!this.started)throw p(new Error("not started yet"),"ERR_NOT_STARTED_YET");if(!e||"string"!==typeof e)throw p(new Error("a string topic must be provided"),"ERR_NOT_VALID_TOPIC");return Array.from(this.peers.values()).filter((function(t){return t.topics.has(e)})).map((function(e){return e.id.toB58String()}))}},{key:"publish",value:function(e,t){throw p(new Error("publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}},{key:"subscribe",value:function(e){throw p(new Error("subscribe must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}},{key:"unsubscribe",value:function(e){throw p(new Error("unsubscribe must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}},{key:"getTopics",value:function(){throw p(new Error("getTopics must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}},{key:"_processMessages",value:function(e,t,r){throw p(new Error("_processMessages must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}]),t}(l);e.exports=x,e.exports.message=y,e.exports.utils=m},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(87),u=r(29),c=r(63),f=function(e){function t(e){var r,i=e.min,u=e.max,c=e.multicodecs,f=e.handlers;if(n(this,t),r=a(this,s(t).call(this,{min:i,max:u,handlers:f})),!c)throw new Error("one or more multicodec should be provided");if(!f)throw new Error("the handlers should be provided");if("function"!==typeof f.onConnect)throw new Error("the 'onConnect' handler must be provided");if("function"!==typeof f.onDisconnect)throw new Error("the 'onDisconnect' handler must be provided");return r.multicodecs=Array.isArray(c)?c:[c],r._registrar=void 0,r._onProtocolChange=r._onProtocolChange.bind(o(r)),r._onPeerConnect=r._onPeerConnect.bind(o(r)),r}return u(t,e),i(t,[{key:"_updatePeers",value:function(e){var t=this,r=!0,n=!1,i=void 0;try{for(var a,s=function(){var e=a.value,r=e.id,n=e.protocols;if(t.multicodecs.filter((function(e){return n.includes(e)})).length){t.peers.add(r.toB58String());var i=t._registrar.getConnection(r);i&&t._onConnect(r,i)}else t.peers.delete(r.toB58String())},o=e[Symbol.iterator]();!(r=(a=o.next()).done);r=!0)s()}catch(u){n=!0,i=u}finally{try{r||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"_onProtocolChange",value:function(e){var t=this,r=e.peerId,n=e.protocols,i=this.peers.has(r.toB58String()),a=n.filter((function(e){return t.multicodecs.includes(e)}));i&&0===a.length&&this._onDisconnect(r);var s=!0,o=!1,u=void 0;try{for(var c,f=n[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;if(this.multicodecs.includes(h)){var l=this._registrar.peerStore.get(r);return void this._updatePeers([l])}}}catch(p){o=!0,u=p}finally{try{s||null==f.return||f.return()}finally{if(o)throw u}}}},{key:"_onPeerConnect",value:function(e){var t=e.remotePeer,r=this._registrar.peerStore.protoBook.get(t);r&&this.multicodecs.find((function(e){return r.includes(e)}))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}},{key:"registrar",set:function(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),this._updatePeers(this._registrar.peerStore.peers.values())}}]),t}(r(2060));e.exports=c(f,{className:"MulticodecTopology",symbolName:"@libp2p/js-interfaces/topology/multicodec-topology"})},function(e,t,r){"use strict";var n=r(73),i=n(r(2214)),a=i.RPC,s=n(r(2215));(t=e.exports).rpc=i,t.td=s,t.RPC=a,t.Message=a.Message,t.SubOpts=a.SubOpts},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GossipsubFanoutTTL=t.GossipsubHeartbeatInterval=t.GossipsubHeartbeatInitialDelay=t.GossipsubHistoryGossip=t.GossipsubHistoryLength=t.GossipsubDhi=t.GossipsubDlo=t.GossipsubD=t.GossipsubID=t.FloodSubID=void 0;var n=t.second=1e3,i=t.minute=60*n;t.FloodSubID="/floodsub/1.0.0",t.GossipsubID="/meshsub/1.0.0",t.GossipsubD=6,t.GossipsubDlo=4,t.GossipsubDhi=12,t.GossipsubHistoryLength=5,t.GossipsubHistoryGossip=3,t.GossipsubHeartbeatInitialDelay=100/n,t.GossipsubHeartbeatInterval=n,t.GossipsubFanoutTTL=i},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(2228),t),i(r(2229),t)},function(e,t,r){"use strict";e.exports={DIAL_TIMEOUT:3e4,MAX_PARALLEL_DIALS:100,MAX_PER_PEER_DIALS:4,METRICS:{computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50}}},function(e,t,r){"use strict";e.exports={relay:"/libp2p/circuit/relay/0.1.0"}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(100),u=r(229),c=r(1976).CircuitRelay,f=r(19),h=f("libp2p:circuit:stream-handler");h.error=f("libp2p:circuit:stream-handler:error");var l=function(){function e(t){var r=t.stream,n=t.maxLength,i=void 0===n?4096:n;a(this,e),this.stream=r,this.shake=u(this.stream),this.decoder=o.decode.fromReader(this.shake.reader,{maxDataLength:i})}return s(e,[{key:"read",value:function(){var e=i(n.mark((function e(){var t,r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decoder.next();case 2:if(!(t=e.sent).value){e.next=7;break}return r=c.decode(t.value.slice()),h("read message type",r.type),e.abrupt("return",r);case 7:h("read received no value, closing stream"),this.close();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"write",value:function(e){h("write message type %s",e.type),this.shake.write(o.encode.single(c.encode(e)))}},{key:"rest",value:function(){return this.shake.rest(),this.shake.stream}},{key:"end",value:function(e){this.write(e),this.close()}},{key:"close",value:function(){h("closing the stream"),this.rest().sink([])}}]),e}();e.exports=l},function(e,t,r){"use strict";t.get=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:self,t=e.crypto||e.msCrypto;if(!t||!t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}},function(e,t,r){"use strict";e.exports="enum KeyType {\n  RSA = 0;\n  Ed25519 = 1;\n  Secp256k1 = 2;\n}\nmessage PublicKey {\n  required KeyType Type = 1;\n  required bytes Data = 2;\n}\nmessage PrivateKey {\n  required KeyType Type = 1;\n  required bytes Data = 2;\n}"},function(e,t,r){var n=r(1949);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.des.Algorithm(e,t)}))}r(2069),r(2070),r(1951),e.exports=n.des=n.des||{},n.des.startEncrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createEncryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createDecryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return p(r._keys,e,t,!1)},decrypt:function(e,t){return p(r._keys,e,t,!0)}}}),r._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],a=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],f=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],l=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],v=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],y=e.length()>8?3:1,b=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],g=0,k=0;k<y;k++){var w=e.getInt32(),x=e.getInt32();w^=(t=252645135&(w>>>4^x))<<4,w^=t=65535&((x^=t)>>>-16^w),w^=(t=858993459&(w>>>2^(x^=t<<-16)))<<2,w^=t=65535&((x^=t)>>>-16^w),w^=(t=1431655765&(w>>>1^(x^=t<<-16)))<<1,w^=t=16711935&((x^=t)>>>8^w),t=(w^=(t=1431655765&(w>>>1^(x^=t<<8)))<<1)<<8|(x^=t)>>>20&240,w=x<<24|x<<8&16711680|x>>>8&65280|x>>>24&240,x=t;for(var S=0;S<m.length;++S){m[S]?(w=w<<2|w>>>26,x=x<<2|x>>>26):(w=w<<1|w>>>27,x=x<<1|x>>>27);var E=r[(w&=-15)>>>28]|n[w>>>24&15]|i[w>>>20&15]|a[w>>>16&15]|s[w>>>12&15]|o[w>>>8&15]|u[w>>>4&15],_=c[(x&=-15)>>>28]|f[x>>>24&15]|h[x>>>20&15]|l[x>>>16&15]|p[x>>>12&15]|d[x>>>8&15]|v[x>>>4&15];t=65535&(_>>>16^E),b[g++]=E^t,b[g++]=_^t<<16}}return b}(t),this._init=!0}},i("DES-ECB",n.cipher.modes.ecb),i("DES-CBC",n.cipher.modes.cbc),i("DES-CFB",n.cipher.modes.cfb),i("DES-OFB",n.cipher.modes.ofb),i("DES-CTR",n.cipher.modes.ctr),i("3DES-ECB",n.cipher.modes.ecb),i("3DES-CBC",n.cipher.modes.cbc),i("3DES-CFB",n.cipher.modes.cfb),i("3DES-OFB",n.cipher.modes.ofb),i("3DES-CTR",n.cipher.modes.ctr);var a=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],s=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],o=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],u=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],c=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],f=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],l=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function p(e,t,r,n){var i,p,d=32===e.length?3:9;i=3===d?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var v=t[0],y=t[1];v^=(p=252645135&(v>>>4^y))<<4,v^=(p=65535&(v>>>16^(y^=p)))<<16,v^=p=858993459&((y^=p)>>>2^v),v^=p=16711935&((y^=p<<2)>>>8^v),v=(v^=(p=1431655765&(v>>>1^(y^=p<<8)))<<1)<<1|v>>>31,y=(y^=p)<<1|y>>>31;for(var b=0;b<d;b+=3){for(var m=i[b+1],g=i[b+2],k=i[b];k!=m;k+=g){var w=y^e[k],x=(y>>>4|y<<28)^e[k+1];p=v,v=y,y=p^(s[w>>>24&63]|u[w>>>16&63]|f[w>>>8&63]|l[63&w]|a[x>>>24&63]|o[x>>>16&63]|c[x>>>8&63]|h[63&x])}p=v,v=y,y=p}y=y>>>1|y<<31,y^=p=1431655765&((v=v>>>1|v<<31)>>>1^y),y^=(p=16711935&(y>>>8^(v^=p<<1)))<<8,y^=(p=858993459&(y>>>2^(v^=p)))<<2,y^=p=65535&((v^=p)>>>16^y),y^=p=252645135&((v^=p<<16)>>>4^y),v^=p<<4,r[0]=v,r[1]=y}function d(e){var t,r="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var a=null;r instanceof n.util.ByteBuffer&&(a=r,r={}),(r=r||{}).output=a,r.iv=e,i.call(t,r)},t}},,function(e,t,r){var n=r(1949);r(1951);var i=e.exports=n.pem=n.pem||{};function a(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},i=0;i<e.values.length;++i)r.push(e.values[i].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var a=0,s=-1;for(i=0;i<t.length;++i,++a)if(a>65&&-1!==s){var o=t[s];","===o?(++s,t=t.substr(0,s)+"\r\n "+t.substr(s)):t=t.substr(0,s)+"\r\n"+o+t.substr(s+1),a=i-s-1,s=-1,++i}else" "!==t[i]&&"\t"!==t[i]&&","!==t[i]||(s=i);return t}function s(e){return e.replace(/^\s+/,"")}i.encode=function(e,t){t=t||{};var r,i="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(i+=a(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(i+=a(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),i+=a(r)),e.headers)for(var s=0;s<e.headers.length;++s)i+=a(e.headers[s]);return e.procType&&(i+="\r\n"),i+=n.util.encode64(e.body,t.maxline||64)+"\r\n",i+="-----END "+e.type+"-----\r\n"},i.decode=function(e){for(var t,r=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,a=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,o=/\r?\n/;t=i.exec(e);){var u={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(t[3])};if(r.push(u),t[2]){for(var c=t[2].split(o),f=0;t&&f<c.length;){for(var h=c[f].replace(/\s+$/,""),l=f+1;l<c.length;++l){var p=c[l];if(!/\s/.test(p[0]))break;h+=p,f=l}if(t=h.match(a)){for(var d={name:t[1],values:[]},v=t[2].split(","),y=0;y<v.length;++y)d.values.push(s(v[y]));if(u.procType)if(u.contentDomain||"Content-Domain"!==d.name)if(u.dekInfo||"DEK-Info"!==d.name)u.headers.push(d);else{if(0===d.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');u.dekInfo={algorithm:v[0],parameters:v[1]||null}}else u.contentDomain=v[0]||"";else{if("Proc-Type"!==d.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==d.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');u.procType={version:v[0],type:v[1]}}}++f}if("ENCRYPTED"===u.procType&&!u.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}},function(e,t,r){"use strict";var n=r(3).Buffer,i=r(2261);function a(e,t){if(!t)throw new Error("requires an encoded buffer");var r=s(e),i=n.from(r.code);return function(e,t){s(e).decode(t.toString())}(r.name,t),n.concat([i,t])}function s(e){var t;if(i.names[e])t=i.names[e];else{if(!i.codes[e])throw new Error("Unsupported encoding");t=i.codes[e]}if(!t.isImplemented())throw new Error("Base "+e+" is not implemented yet");return t}(t=e.exports=a).encode=function(e,t){var r=s(e);return a(r.name,n.from(r.encode(t)))},t.decode=function(e){n.isBuffer(e)&&(e=e.toString());var t=e.substring(0,1);"string"===typeof(e=e.substring(1,e.length))&&(e=n.from(e));var r=s(t);return n.from(r.decode(e.toString()))},t.isEncoded=function(e){n.isBuffer(e)&&(e=e.toString());if("[object String]"!==Object.prototype.toString.call(e))return!1;var t=e.substring(0,1);try{return s(t).name}catch(r){return!1}},t.names=Object.freeze(Object.keys(i.names)),t.codes=Object.freeze(Object.keys(i.codes))},function(e,t,r){"use strict";var n=r(463),i=r(15);e.exports=function(e){if(isNaN(e)||e<=0)throw i(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return n(e)}},function(e,t,r){"use strict";var n=r(3).Buffer;r(1951),r(1989);var i=r(1949);t.bigIntegerToUintBase64url=function(e,r){var i=n.from(e.abs().toByteArray());if(i=0===i[0]?i.slice(1):i,null!=r){if(i.length>r)throw new Error("byte array longer than desired length");i=n.concat([n.alloc(r-i.length),i])}return t.bufferToBase64url(i)},t.bufferToBase64url=function(e){return e.toString("base64").split("=")[0].replace(/\+/g,"-").replace(/\//g,"_")},t.base64urlToBigInteger=function(e){var r=t.base64urlToBuffer(e);return new i.jsbn.BigInteger(r.toString("hex"),16)},t.base64urlToBuffer=function(e,t){e=(e+"===".slice((e.length+3)%4)).replace(/-/g,"+").replace(/_/g,"/");var r=n.from(e,"base64");if(null!=t){if(r.length>t)throw new Error("byte array longer than desired length");r=n.concat([n.alloc(t-r.length),r])}return r}},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"batch",(function(){return g})),r.d(t,"buffer",(function(){return S})),r.d(t,"collect",(function(){return _})),r.d(t,"concat",(function(){return T})),r.d(t,"consume",(function(){return B})),r.d(t,"filter",(function(){return N})),r.d(t,"flatMap",(function(){return O})),r.d(t,"flatten",(function(){return P})),r.d(t,"flatTransform",(function(){return L})),r.d(t,"fromStream",(function(){return q})),r.d(t,"getIterator",(function(){return k})),r.d(t,"map",(function(){return D})),r.d(t,"merge",(function(){return z})),r.d(t,"parallelFlatMap",(function(){return F})),r.d(t,"parallelMap",(function(){return V})),r.d(t,"parallelMerge",(function(){return H})),r.d(t,"pipeline",(function(){return j})),r.d(t,"reduce",(function(){return Y})),r.d(t,"take",(function(){return J})),r.d(t,"tap",(function(){return X})),r.d(t,"time",(function(){return te})),r.d(t,"transform",(function(){return re})),r.d(t,"writeToStream",(function(){return ae}));var n=r(83),i=r(59),a=r(23),s=r(1),o=r.n(s),u=o.a.mark(m),c=o.a.mark(x),f=o.a.mark(A),h=o.a.mark(W),l=o.a.mark(ee);function p(e){var t="function"===typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function d(e){return this instanceof d?(this.v=e,this):new d(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof d?Promise.resolve(r.value.v).then(u,c):f(a[0][2],r)}catch(n){f(a[0][3],n)}var r}function u(e){o("next",e)}function c(e){o("throw",e)}function f(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}function y(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:d(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function b(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=p(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}function m(e,t){var r,n,i,a,s,c,f;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=[],n=!0,i=!1,a=void 0,o.prev=4,s=t[Symbol.iterator]();case 6:if(n=(c=s.next()).done){o.next=16;break}if(f=c.value,r.push(f),r.length!==e){o.next=13;break}return o.next=12,r;case 12:r=[];case 13:n=!0,o.next=6;break;case 16:o.next=22;break;case 18:o.prev=18,o.t0=o.catch(4),i=!0,a=o.t0;case 22:o.prev=22,o.prev=23,n||null==s.return||s.return();case 25:if(o.prev=25,!i){o.next=28;break}throw a;case 28:return o.finish(25);case 29:return o.finish(22);case 30:if(!(r.length>0)){o.next=33;break}return o.next=33,r;case 33:case"end":return o.stop()}}),u,null,[[4,18,22,30],[23,,25,29]])}function g(e,t){return void 0===t?function(t){return g(e,t)}:t[Symbol.asyncIterator]?function(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=[],r.prev=1,s=b(t);case 3:return r.next=5,d(s.next());case 5:if((u=r.sent).done){r.next=17;break}if(c=u.value,a.push(c),a.length!==e){r.next=15;break}return r.next=12,d(a);case 12:return r.next=14,r.sent;case 14:a=[];case 15:r.next=3;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r.catch(1),n={error:r.t0};case 22:if(r.prev=22,r.prev=23,!u||u.done||!(i=s.return)){r.next=27;break}return r.next=27,d(i.call(s));case 27:if(r.prev=27,!n){r.next=30;break}throw n.error;case 30:return r.finish(27);case 31:return r.finish(22);case 32:if(!(a.length>0)){r.next=37;break}return r.next=35,d(a);case 35:return r.next=37,r.sent;case 37:case"end":return r.stop()}}),r,null,[[1,19,22,32],[23,,27,31]])})))}(e,t):m(e,t)}function k(e){if("function"===typeof e.next)return e;if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function w(){var e,t;return{promise:new Promise((function(r,n){t=r,e=n})),reject:e,resolve:t}}function x(e,t){var r,n,i,a,s,u,f,h,l,p,d;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=[],o.prev=1,i=!0,a=!1,s=void 0,o.prev=5,u=t[Symbol.iterator]();case 7:if(i=(f=u.next()).done){o.next=17;break}if(h=f.value,r.push(h),!(r.length<=e)){o.next=12;break}return o.abrupt("continue",14);case 12:return o.next=14,r.shift();case 14:i=!0,o.next=7;break;case 17:o.next=23;break;case 19:o.prev=19,o.t0=o.catch(5),a=!0,s=o.t0;case 23:o.prev=23,o.prev=24,i||null==u.return||u.return();case 26:if(o.prev=26,!a){o.next=29;break}throw s;case 29:return o.finish(26);case 30:return o.finish(23);case 31:o.next=36;break;case 33:o.prev=33,o.t1=o.catch(1),n=o.t1;case 36:l=0,p=r;case 37:if(!(l<p.length)){o.next=44;break}return d=p[l],o.next=41,d;case 41:l++,o.next=37;break;case 44:if(!n){o.next=46;break}throw n;case 46:case"end":return o.stop()}}),c,null,[[1,33],[5,19,23,31],[24,,26,30]])}function S(e,t){return void 0===t?function(t){return S(e,t)}:t[Symbol.asyncIterator]?function(e,t){var r=k(t),n=[],s=[],u=!1,c=!1;function f(){for(;s.length>0&&n.length>0;){var e=s.shift(),t=n.shift(),r=t.error,i=t.value;r?e.reject(r):e.resolve({done:!1,value:i})}for(;s.length>0&&c;){(0,s.shift().resolve)({done:!0,value:void 0})}}function h(){return l.apply(this,arguments)}function l(){return(l=Object(a.a)(o.a.mark((function t(){var i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=2;break}return t.abrupt("return");case 2:if(!u){t.next=4;break}return t.abrupt("return");case 4:if(!(n.length>=e)){t.next=6;break}return t.abrupt("return");case 6:return u=!0,t.prev=7,t.next=10,r.next();case 10:i=t.sent,a=i.done,s=i.value,a?c=!0:n.push({value:s}),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),c=!0,n.push({error:t.t0});case 20:f(),u=!1,h();case 23:case"end":return t.stop()}}),t,null,[[7,16]])})))).apply(this,arguments)}function p(){return(p=Object(a.a)(o.a.mark((function e(){var t,r,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=6;break}if(t=n.shift(),r=t.error,i=t.value,!r){e.next=4;break}throw r;case 4:return h(),e.abrupt("return",{done:!1,value:i});case 6:if(!c){e.next=8;break}return e.abrupt("return",{done:!0,value:void 0});case 8:return a=w(),s.push(a),h(),e.abrupt("return",a.promise);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=Object(i.a)({next:function(){return p.apply(this,arguments)}},Symbol.asyncIterator,(function(){return d}));return d}(e,t):x(e,t)}function E(){return(E=Object(a.a)(o.a.mark((function e(t){var r,n,i,a,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],e.prev=1,a=b(t);case 3:return e.next=5,a.next();case 5:if((s=e.sent).done){e.next=11;break}u=s.value,i.push(u);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r={error:e.t0};case 16:if(e.prev=16,e.prev=17,!s||s.done||!(n=a.return)){e.next=21;break}return e.next=21,n.call(a);case 21:if(e.prev=21,!r){e.next=24;break}throw r.error;case 24:return e.finish(21);case 25:return e.finish(16);case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,null,[[1,13,16,26],[17,,21,25]])})))).apply(this,arguments)}function _(e){return e[Symbol.asyncIterator]?function(e){return E.apply(this,arguments)}(e):Array.from(e)}function I(e){return v(this,arguments,o.a.mark((function t(){var r,n,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=b(e);case 2:return t.next=4,d(i.next());case 4:if((a=t.sent).done){t.next=14;break}return s=a.value,t.t0=d,t.delegateYield(y(b(s)),"t1",9);case 9:return t.t2=t.t1,t.next=12,(0,t.t0)(t.t2);case 12:t.next=2;break;case 14:t.next=19;break;case 16:t.prev=16,t.t3=t.catch(0),r={error:t.t3};case 19:if(t.prev=19,t.prev=20,!a||a.done||!(n=i.return)){t.next=24;break}return t.next=24,d(n.call(i));case 24:if(t.prev=24,!r){t.next=27;break}throw r.error;case 27:return t.finish(24);case 28:return t.finish(19);case 29:case"end":return t.stop()}}),t,null,[[0,16,19,29],[20,,24,28]])})))}function A(e){var t,r,n,i,a,s;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t=!0,r=!1,n=void 0,o.prev=3,i=e[Symbol.iterator]();case 5:if(t=(a=i.next()).done){o.next=11;break}return s=a.value,o.delegateYield(s,"t0",8);case 8:t=!0,o.next=5;break;case 11:o.next=17;break;case 13:o.prev=13,o.t1=o.catch(3),r=!0,n=o.t1;case 17:o.prev=17,o.prev=18,t||null==i.return||i.return();case 20:if(o.prev=20,!r){o.next=23;break}throw n;case 23:return o.finish(20);case 24:return o.finish(17);case 25:case"end":return o.stop()}}),f,null,[[3,13,17,25],[18,,20,24]])}function T(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.find((function(e){return void 0!==e[Symbol.asyncIterator]}));return n?I(t):A(t)}function C(){return(C=Object(a.a)(o.a.mark((function e(t){var r,n,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,i=b(t);case 2:return e.next=4,i.next();case 4:if((a=e.sent).done){e.next=9;break}a.value;case 7:e.next=2;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r={error:e.t0};case 14:if(e.prev=14,e.prev=15,!a||a.done||!(n=i.return)){e.next=19;break}return e.next=19,n.call(i);case 19:if(e.prev=19,!r){e.next=22;break}throw r.error;case 22:return e.finish(19);case 23:return e.finish(14);case 24:case"end":return e.stop()}}),e,null,[[0,11,14,24],[15,,19,23]])})))).apply(this,arguments)}function B(e){if(e[Symbol.asyncIterator])return function(e){return C.apply(this,arguments)}(e)}function R(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=16;break}return u=s.value,r.next=9,d(e(u));case 9:if(!r.sent){r.next=14;break}return r.next=12,d(u);case 12:return r.next=14,r.sent;case 14:r.next=2;break;case 16:r.next=21;break;case 18:r.prev=18,r.t0=r.catch(0),n={error:r.t0};case 21:if(r.prev=21,r.prev=22,!s||s.done||!(i=a.return)){r.next=26;break}return r.next=26,d(i.call(a));case 26:if(r.prev=26,!n){r.next=29;break}throw n.error;case 29:return r.finish(26);case 30:return r.finish(21);case 31:case"end":return r.stop()}}),r,null,[[0,18,21,31],[22,,26,30]])})))}function N(e,t){return void 0===t?function(t){return R(e,t)}:R(e,t)}function P(e){return v(this,arguments,o.a.mark((function t(){var r,n,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=b(e);case 2:return t.next=4,d(i.next());case 4:if((a=t.sent).done){t.next=21;break}if(!(s=a.value)||"string"===typeof s||!s[Symbol.iterator]&&!s[Symbol.asyncIterator]){t.next=15;break}return t.t0=d,t.delegateYield(y(b(P(s))),"t1",10);case 10:return t.t2=t.t1,t.next=13,(0,t.t0)(t.t2);case 13:t.next=19;break;case 15:return t.next=17,d(s);case 17:return t.next=19,t.sent;case 19:t.next=2;break;case 21:t.next=26;break;case 23:t.prev=23,t.t3=t.catch(0),r={error:t.t3};case 26:if(t.prev=26,t.prev=27,!a||a.done||!(n=i.return)){t.next=31;break}return t.next=31,d(n.call(i));case 31:if(t.prev=31,!r){t.next=34;break}throw r.error;case 34:return t.finish(31);case 35:return t.finish(26);case 36:case"end":return t.stop()}}),t,null,[[0,23,26,36],[27,,31,35]])})))}function M(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=17;break}return u=s.value,r.t0=d,r.next=10,d(e(u));case 10:return r.t1=r.sent,r.next=13,(0,r.t0)(r.t1);case 13:return r.next=15,r.sent;case 15:r.next=2;break;case 17:r.next=22;break;case 19:r.prev=19,r.t2=r.catch(0),n={error:r.t2};case 22:if(r.prev=22,r.prev=23,!s||s.done||!(i=a.return)){r.next=27;break}return r.next=27,d(i.call(a));case 27:if(r.prev=27,!n){r.next=30;break}throw n.error;case 30:return r.finish(27);case 31:return r.finish(22);case 32:case"end":return r.stop()}}),r,null,[[0,19,22,32],[23,,27,31]])})))}function D(e,t){return void 0===t?function(t){return M(e,t)}:M(e,t)}function O(e,t){return void 0===t?function(t){return O(e,t)}:N((function(e){return void 0!==e&&null!==e}),P(D(e,t)))}function L(e,t,r){return void 0===t?function(t,r){return r?L(e,t,r):L(e,t)}:void 0===r?function(r){return L(e,t,r)}:N((function(e){return void 0!==e&&null!==e}),P(function(e,t,r){var n=k(r),s=[],u=[],c=!1,f=!1,h=0,l=null;function p(){for(;u.length>0&&s.length>0;){(0,u.shift().resolve)({done:!1,value:s.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;l?(r(l),l=null):t({done:!0,value:void 0})}}function d(){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(o.a.mark((function t(){var r,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return p(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+s.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,p()):y(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,l=t.t0,p();case 24:f=!1,d();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function y(e){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(o.a.mark((function e(r){var n,i,a,u,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:if(!(a=e.sent)||!a[Symbol.asyncIterator]){e.next=32;break}e.prev=5,u=b(a);case 7:return e.next=9,u.next();case 9:if((f=e.sent).done){e.next=15;break}v=f.value,s.push(v);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),n={error:e.t0};case 20:if(e.prev=20,e.prev=21,!f||f.done||!(i=u.return)){e.next=25;break}return e.next=25,i.call(u);case 25:if(e.prev=25,!n){e.next=28;break}throw n.error;case 28:return e.finish(25);case 29:return e.finish(20);case 30:e.next=33;break;case 32:s.push(a);case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(0),c=!0,l=e.t1;case 39:h--,p(),d();case 42:case"end":return e.stop()}}),e,null,[[0,35],[5,17,20,30],[21,,25,29]])})))).apply(this,arguments)}function g(){return(g=Object(a.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==s.length){e.next=5;break}return t=w(),u.push(t),d(),e.abrupt("return",t.promise);case 5:return r=s.shift(),d(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=Object(i.a)({next:function(){return g.apply(this,arguments)}},Symbol.asyncIterator,(function(){return x}));return x}(e,t,r)))}function K(e){return U.apply(this,arguments)}function U(){return(U=Object(a.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.once("readable",(function(){e()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return"function"===typeof e[Symbol.asyncIterator]?e:function(e){return v(this,arguments,o.a.mark((function t(){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(r=e.read())){t.next=8;break}return t.next=5,d(r);case 5:return t.next=7,t.sent;case 7:return t.abrupt("continue",0);case 8:if(!e._readableState.ended){t.next=12;break}return t.next=11,d(void 0);case 11:return t.abrupt("return",t.sent);case 12:return t.next=14,d(K(e));case 14:t.next=0;break;case 16:case"end":return t.stop()}}),t)})))}(e)}function z(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return v(this,arguments,o.a.mark((function e(){var r,n,i,a,s,u,c,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Set(t.map(k));case 1:if(!(r.size>0)){e.next=39;break}n=!0,i=!1,a=void 0,e.prev=5,s=r[Symbol.iterator]();case 7:if(n=(u=s.next()).done){e.next=23;break}return c=u.value,e.next=11,d(c.next());case 11:if(!(f=e.sent).done){e.next=16;break}r.delete(c),e.next=20;break;case 16:return e.next=18,d(f.value);case 18:return e.next=20,e.sent;case 20:n=!0,e.next=7;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(5),i=!0,a=e.t0;case 29:e.prev=29,e.prev=30,n||null==s.return||s.return();case 32:if(e.prev=32,!i){e.next=35;break}throw a;case 35:return e.finish(32);case 36:return e.finish(29);case 37:e.next=1;break;case 39:case"end":return e.stop()}}),e,null,[[5,25,29,37],[30,,32,36]])})))}function j(e){for(var t=e(),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,s=n;a<s.length;a++){var o=s[a];t=o(t)}return t}function V(e,t,r){return void 0===t?function(t,r){return V(e,t,r)}:void 0===r?function(r){return V(e,t,r)}:function(e,t,r){return v(this,arguments,o.a.mark((function n(){var i,a,s,u,c,f,h,l;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=null,a=function(e){return{value:t(e)}},s=function(e){return v(this,arguments,o.a.mark((function t(){var r,n,a,s,u;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=b(e);case 2:return t.next=4,d(a.next());case 4:if((s=t.sent).done){t.next=17;break}if(u=s.value,!i){t.next=11;break}return t.next=10,d(void 0);case 10:return t.abrupt("return",t.sent);case 11:return t.next=13,d(u);case 13:return t.next=15,t.sent;case 15:t.next=2;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),r={error:t.t0};case 22:if(t.prev=22,t.prev=23,!s||s.done||!(n=a.return)){t.next=27;break}return t.next=27,d(n.call(a));case 27:if(t.prev=27,!r){t.next=30;break}throw r.error;case 30:return t.finish(27);case 31:return t.finish(22);case 32:case"end":return t.stop()}}),t,null,[[0,19,22,32],[23,,27,31]])})))},u=j((function(){return r}),S(1),s,D(a),S(e)),c=k(u);case 5:return n.next=8,d(c.next());case 8:if(f=n.sent,h=f.value,!f.done){n.next=13;break}return n.abrupt("break",29);case 13:return n.prev=13,n.next=16,d(h.value);case 16:if(l=n.sent,i){n.next=22;break}return n.next=20,d(l);case 20:return n.next=22,n.sent;case 22:n.next=27;break;case 24:n.prev=24,n.t0=n.catch(13),i=n.t0;case 27:n.next=5;break;case 29:if(!i){n.next=31;break}throw i;case 31:case"end":return n.stop()}}),n,null,[[13,24]])})))}(e,t,r)}function F(e,t,r){return void 0===t?function(t,r){return r?F(e,t,r):F(e,t)}:void 0===r?function(r){return F(e,t,r)}:N((function(e){return void 0!==e&&null!==e}),P(V(e,t,r)))}function H(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return v(this,arguments,o.a.mark((function e(){var r,i,s,u,c,f,h,l,p,v,y,b,m,g,w,x,S,E,_,I,A,T,C,B;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.map(k),i=new Set,s=new Map,u=null,c=null,f=null,h=function(e){u=e,c&&c(e)},l=function(e){f&&f(e)},p=function(){return new Promise((function(e,t){if(u&&t(u),s.size>0)return e();f=e,c=t}))},v=function(e){var t=Promise.resolve(e.next()).then(function(){var r=Object(a.a)(o.a.mark((function r(n){var a,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=n.done,u=n.value,a||s.set(e,u),i.delete(t);case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());i.add(t),t.then(l,h)},y=!0,b=!1,m=void 0,e.prev=13,g=r[Symbol.iterator]();!(y=(w=g.next()).done);y=!0)x=w.value,v(x);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),b=!0,m=e.t0;case 21:e.prev=21,e.prev=22,y||null==g.return||g.return();case 24:if(e.prev=24,!b){e.next=27;break}throw m;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(0!==i.size||0!==s.size){e.next=34;break}return e.next=33,d(void 0);case 33:return e.abrupt("return",e.sent);case 34:return e.next=36,d(p());case 36:S=!0,E=!1,_=void 0,e.prev=39,I=s[Symbol.iterator]();case 41:if(S=(A=I.next()).done){e.next=52;break}return T=Object(n.a)(A.value,2),C=T[0],B=T[1],s.delete(C),e.next=46,d(B);case 46:return e.next=48,e.sent;case 48:v(C);case 49:S=!0,e.next=41;break;case 52:e.next=58;break;case 54:e.prev=54,e.t1=e.catch(39),E=!0,_=e.t1;case 58:e.prev=58,e.prev=59,S||null==I.return||I.return();case 61:if(e.prev=61,!E){e.next=64;break}throw _;case 64:return e.finish(61);case 65:return e.finish(58);case 66:e.next=29;break;case 68:case"end":return e.stop()}}),e,null,[[13,17,21,29],[22,,24,28],[39,54,58,66],[59,,61,65]])})))}function G(){return(G=Object(a.a)(o.a.mark((function e(t,r,n){var i,a,s,u,c,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=r,e.prev=1,u=b(n);case 3:return e.next=5,u.next();case 5:if((c=e.sent).done){e.next=13;break}return f=c.value,e.next=10,t(s,f);case 10:s=e.sent;case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),i={error:e.t0};case 18:if(e.prev=18,e.prev=19,!c||c.done||!(a=u.return)){e.next=23;break}return e.next=23,a.call(u);case 23:if(e.prev=23,!i){e.next=26;break}throw i.error;case 26:return e.finish(23);case 27:return e.finish(18);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,null,[[1,15,18,28],[19,,23,27]])})))).apply(this,arguments)}function Y(e,t,r){return void 0===t?function(t,r){return r?Y(e,t,r):Y(e,t)}:void 0===r?function(r){return Y(e,t,r)}:function(e,t,r){return G.apply(this,arguments)}(e,t,r)}function W(e,t){var r,n,i,a,s,u,c;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=0,n=!0,i=!1,a=void 0,o.prev=4,s=t[Symbol.iterator]();case 6:if(n=(u=s.next()).done){o.next=16;break}return c=u.value,o.next=10,c;case 10:if(!(++r>=e)){o.next=13;break}return o.abrupt("return");case 13:n=!0,o.next=6;break;case 16:o.next=22;break;case 18:o.prev=18,o.t0=o.catch(4),i=!0,a=o.t0;case 22:o.prev=22,o.prev=23,n||null==s.return||s.return();case 25:if(o.prev=25,!i){o.next=28;break}throw a;case 28:return o.finish(25);case 29:return o.finish(22);case 30:case"end":return o.stop()}}),h,null,[[4,18,22,30],[23,,25,29]])}function J(e,t){return void 0===t?function(t){return J(e,t)}:t[Symbol.asyncIterator]?function(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0,r.prev=1,s=b(t);case 3:return r.next=5,d(s.next());case 5:if((u=r.sent).done){r.next=23;break}return c=u.value,r.t0=d,r.next=11,d(c);case 11:return r.t1=r.sent,r.next=14,(0,r.t0)(r.t1);case 14:return r.next=16,r.sent;case 16:if(!(++a>=e)){r.next=21;break}return r.next=20,d(void 0);case 20:return r.abrupt("return",r.sent);case 21:r.next=3;break;case 23:r.next=28;break;case 25:r.prev=25,r.t2=r.catch(1),n={error:r.t2};case 28:if(r.prev=28,r.prev=29,!u||u.done||!(i=s.return)){r.next=33;break}return r.next=33,d(i.call(s));case 33:if(r.prev=33,!n){r.next=36;break}throw n.error;case 36:return r.finish(33);case 37:return r.finish(28);case 38:case"end":return r.stop()}}),r,null,[[1,25,28,38],[29,,33,37]])})))}(e,t):W(e,t)}function Q(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=15;break}return u=s.value,r.next=9,d(e(u));case 9:return r.next=11,d(u);case 11:return r.next=13,r.sent;case 13:r.next=2;break;case 15:r.next=20;break;case 17:r.prev=17,r.t0=r.catch(0),n={error:r.t0};case 20:if(r.prev=20,r.prev=21,!s||s.done||!(i=a.return)){r.next=25;break}return r.next=25,d(i.call(a));case 25:if(r.prev=25,!n){r.next=28;break}throw n.error;case 28:return r.finish(25);case 29:return r.finish(20);case 30:case"end":return r.stop()}}),r,null,[[0,17,20,30],[21,,25,29]])})))}function X(e,t){return void 0===t?function(t){return Q(e,t)}:Q(e,t)}function Z(e,t){var r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){var i=n%1e9;r+=(n-i)/1e9,n=i}return[r,n]}function $(t,r){return v(this,arguments,o.a.mark((function n(){var i,a,s,u,c,f,h;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=r[Symbol.asyncIterator](),a=[0,0];case 2:return s=e.hrtime(),n.next=6,d(i.next());case 6:if(u=n.sent,c=u.value,f=u.done,h=e.hrtime(s),a=Z(a,h),t.progress&&t.progress(h,a),!f){n.next=17;break}return t.total&&t.total(a),n.next=16,d(c);case 16:return n.abrupt("return",n.sent);case 17:return n.next=19,d(c);case 19:return n.next=21,n.sent;case 21:n.next=2;break;case 23:case"end":return n.stop()}}),n)})))}function ee(t,r){var n,i,a,s,u,c,f;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=r[Symbol.iterator](),i=[0,0];case 2:if(a=e.hrtime(),s=n.next(),u=s.value,c=s.done,f=e.hrtime(a),i=Z(i,f),t.progress&&t.progress(f,i),!c){o.next=11;break}return t.total&&t.total(i),o.abrupt("return",u);case 11:return o.next=13,u;case 13:o.next=2;break;case 15:case"end":return o.stop()}}),l)}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return void 0===t?function(t){return te(e,t)}:void 0!==t[Symbol.asyncIterator]?$(e,t):ee(e,t)}function re(e,t,r){return void 0===t?function(t,r){return r?re(e,t,r):re(e,t)}:void 0===r?function(r){return re(e,t,r)}:function(e,t,r){var n=k(r),s=[],u=[],c=!1,f=!1,h=0,l=null;function p(){for(;u.length>0&&s.length>0;){(0,u.shift().resolve)({done:!1,value:s.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;l?(r(l),l=null):t({done:!0,value:void 0})}}function d(){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(o.a.mark((function t(){var r,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return p(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+s.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,p()):y(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,l=t.t0,p();case 24:f=!1,d();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(o.a.mark((function e(r){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:n=e.sent,s.push(n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),c=!0,l=e.t0;case 11:h--,p(),d();case 14:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function m(){return(m=Object(a.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==s.length){e.next=5;break}return t=w(),u.push(t),d(),e.abrupt("return",t.promise);case 5:return r=s.shift(),d(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=Object(i.a)({next:function(){return m.apply(this,arguments)}},Symbol.asyncIterator,(function(){return g}));return g}(e,t,r)}function ne(e,t){return ie.apply(this,arguments)}function ie(){return(ie=Object(a.a)(o.a.mark((function e(t,r){var n,i,a,s,u,c,f,h,l,p,d,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=null,s=null,u=null,c=function(e){a=e,s&&s(e)},f=function(){u&&u()},h=function(){t.removeListener("error",c),t.removeListener("drain",f)},t.once("error",c),l=function(){return new Promise((function(e,r){if(a)return r(a);t.once("drain",f),u=e,s=r}))},e.prev=8,p=b(r);case 10:return e.next=12,p.next();case 12:if((d=e.sent).done){e.next=22;break}if(v=d.value,!1!==t.write(v)){e.next=18;break}return e.next=18,l();case 18:if(!a){e.next=20;break}return e.abrupt("break",22);case 20:e.next=10;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(8),n={error:e.t0};case 27:if(e.prev=27,e.prev=28,!d||d.done||!(i=p.return)){e.next=32;break}return e.next=32,i.call(p);case 32:if(e.prev=32,!n){e.next=35;break}throw n.error;case 35:return e.finish(32);case 36:return e.finish(27);case 37:if(h(),!a){e.next=40;break}throw a;case 40:case"end":return e.stop()}}),e,null,[[8,24,27,37],[28,,32,36]])})))).apply(this,arguments)}function ae(e,t){return void 0===t?function(t){return ne(e,t)}:ne(e,t)}void 0===Symbol.asyncIterator&&(Symbol.asyncIterator=Symbol.for("asyncIterator"))}.call(this,r(37))},function(e,t,r){"use strict";t.CODE_P2P=421,t.CODE_CIRCUIT=290,t.CLOSE_TIMEOUT=2e3},function(e,t,r){var n=r(809),i=r(2033);e.exports=function(e){var t=e.xdomain,r=e.xscheme,a=e.enablesXDR;try{if("undefined"!==typeof XMLHttpRequest&&(!t||n))return new XMLHttpRequest}catch(s){}try{if("undefined"!==typeof XDomainRequest&&!r&&a)return new XDomainRequest}catch(s){}if(!t)try{return new(i[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}},function(e,t){e.exports="undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")()},function(e,t,r){var n=r(1971),i=r(2035);function a(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=a,i(a.prototype),a.prototype.onError=function(e,t){var r=new Error(e);return r.type="TransportError",r.description=t,this.emit("error",r),this},a.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},a.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},a.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},a.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},a.prototype.onData=function(e){var t=n.decodePacket(e,this.socket.binaryType);this.onPacket(t)},a.prototype.onPacket=function(e){this.emit("packet",e)},a.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),r=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(r){n=0;for(var i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t)}return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,r){"use strict";var n=r(2322),i=r(2329);e.exports=new n("X25519","ED25519",i)},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(88).multihash,u=r(1953),c=r(2365),f=function(){function e(t,r,n){a(this,e),this.dht=t,this.key=r,this.makePath=n,this._log=u.logger(this.dht.peerId,"query:"+o.toB58String(r)),this.running=!1,this._onStart=this._onStart.bind(this),this._onComplete=this._onComplete.bind(this)}return s(e,[{key:"run",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dht._queryManager.running){e.next=3;break}return this._log.error("Attempt to run query after shutdown"),e.abrupt("return",{finalSet:new Set,paths:[]});case 3:if(0!==t.length){e.next=6;break}return this._log.error("Running query with no peers"),e.abrupt("return",{finalSet:new Set,paths:[]});case 6:return this._run=new c(this),this._log("query running with K=".concat(this.dht.kBucketSize,", A=").concat(this.dht.concurrency,", D=").concat(Math.min(this.dht.disjointPaths,t.length))),this._run.once("start",this._onStart),this._run.once("complete",this._onComplete),e.abrupt("return",this._run.execute(t));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onStart",value:function(){this.running=!0,this._startTime=Date.now(),this._log("query:start"),this.dht._queryManager.queryStarted(this)}},{key:"_onComplete",value:function(){this.stop()}},{key:"stop",value:function(){this._log("query:done in ".concat(Date.now()-this._startTime,"ms")),this._run&&this._log("".concat(this._run.errors.length," of ").concat(this._run.peersSeen.size," peers errored (").concat(this._run.errors.length/this._run.peersSeen.size*100,"% fail rate)")),this.running&&(this._run.removeListener("start",this._onStart),this._run.removeListener("complete",this._onComplete),this.running=!1,this._run&&this._run.stop(),this.dht._queryManager.queryCompleted(this))}}]),e}();e.exports=f},function(e,t,r){"use strict";var n=r(2091),i=r(15);t.getPubsubRouting=function(e,t){if(!e||!t.EXPERIMENTAL||!t.EXPERIMENTAL.ipnsPubsub)throw i(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(n.isIpnsPubsubDatastore(e.routing))return e.routing;var r=(e.routing.stores||[]).find((function(e){return n.isIpnsPubsubDatastore(e)}));if(!r)throw i(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return r}},,function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(1994),o=r(2096),u={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},c=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.next=3,s.get().subtle.sign({name:"HMAC"},t,r);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.create=function(){var e=i(n.mark((function e(t,r){var a,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u[t],e.next=3,s.get().subtle.importKey("raw",r,{name:"HMAC",hash:{name:a}},!1,["sign"]);case 3:return f=e.sent,e.abrupt("return",{digest:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c(f,e));case 1:case"end":return t.stop()}}),t)})))()},length:o[t]});case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){var n=r(1950);r(1952),e.exports=n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"===typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var r=e;if("string"===typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var i=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};i.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},i.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},i.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},function(e,t,r){var n=r(1950);r(1952),n.cipher=n.cipher||{};var i=e.exports=n.cipher.modes=n.cipher.modes||{};function a(e,t){if("string"===typeof e&&(e=n.util.createBuffer(e)),n.util.isArray(e)&&e.length>4){var r=e;e=n.util.createBuffer();for(var i=0;i<r.length;++i)e.putByte(r[i])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!n.util.isArray(e)){var a=[],s=t/4;for(i=0;i<s;++i)a.push(e.getInt32());e=a}return e}function s(e){e[e.length-1]=e[e.length-1]+1&4294967295}function o(e){return[e/4294967296|0,4294967295&e]}i.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.ecb.prototype.start=function(e){},i.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},i.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},i.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},i.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},i.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},i.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb.prototype.decrypt=i.ofb.prototype.encrypt,i.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}s(this._inBlock)},i.ctr.prototype.decrypt=i.ctr.prototype.encrypt,i.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0,this._R=3774873600},i.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=n.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?n.util.createBuffer(e.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=n.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=r.length();if(12===i)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];r.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(o(8*i)))}this._inBlock=this._j0.slice(0),s(this._inBlock),this._partialBytes=0,t=n.util.createBuffer(t),this._aDataLength=o(8*t.length());var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},i.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^=e.getInt32());this._cipherLength+=this.blockSize}else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),s(this._inBlock)},i.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),s(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},i.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=n.util.createBuffer();var i=this._aDataLength.concat(o(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var a=[];this.cipher.encrypt(this._j0,a);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^a[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},i.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),i=0;i<128;++i){e[i/32|0]&1<<31-i%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r},i.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},i.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,i=this._m[r][n];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},i.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},i.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,i=16*r,a=new Array(i),s=0;s<i;++s){var o=[0,0,0,0],u=(n-1-s%n)*t;o[s/n|0]=1<<t-1<<u,a[s]=this.generateSubHashTable(this.multiply(o,e),t)}return a},i.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,i=new Array(r);i[n]=e.slice(0);for(var a=n>>>1;a>0;)this.pow(i[2*a],i[a]=[]),a>>=1;for(a=2;a<n;){for(var s=1;s<a;++s){var o=i[a],u=i[s];i[a+s]=[o[0]^u[0],o[1]^u[1],o[2]^u[2],o[3]^u[3]]}a*=2}for(i[0]=[0,0,0,0],a=n+1;a<r;++a){var c=i[a^n];i[a]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return i}},function(e,t,r){(function(t){var n=r(1950);r(2104),r(1967),r(1952);var i,a=n.pkcs5=n.pkcs5||{};n.util.isNodejs&&!n.options.usePureJavaScript&&(i=r(1998)),e.exports=n.pbkdf2=a.pbkdf2=function(e,r,a,s,o,u){if("function"===typeof o&&(u=o,o=null),n.util.isNodejs&&!n.options.usePureJavaScript&&i.pbkdf2&&(null===o||"object"!==typeof o)&&(i.pbkdf2Sync.length>4||!o||"sha1"===o))return"string"!==typeof o&&(o="sha1"),e=t.from(e,"binary"),r=t.from(r,"binary"),u?4===i.pbkdf2Sync.length?i.pbkdf2(e,r,a,s,(function(e,t){if(e)return u(e);u(null,t.toString("binary"))})):i.pbkdf2(e,r,a,s,o,(function(e,t){if(e)return u(e);u(null,t.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(e,r,a,s).toString("binary"):i.pbkdf2Sync(e,r,a,s,o).toString("binary");if("undefined"!==typeof o&&null!==o||(o="sha1"),"string"===typeof o){if(!(o in n.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=n.md[o].create()}var c=o.digestLength;if(s>4294967295*c){var f=new Error("Derived key is too long.");if(u)return u(f);throw f}var h=Math.ceil(s/c),l=s-(h-1)*c,p=n.hmac.create();p.start(o,e);var d,v,y,b="";if(!u){for(var m=1;m<=h;++m){p.start(null,null),p.update(r),p.update(n.util.int32ToBytes(m)),d=y=p.digest().getBytes();for(var g=2;g<=a;++g)p.start(null,null),p.update(y),v=p.digest().getBytes(),d=n.util.xorBytes(d,v,c),y=v;b+=m<h?d:d.substr(0,l)}return b}m=1;function k(){if(m>h)return u(null,b);p.start(null,null),p.update(r),p.update(n.util.int32ToBytes(m)),d=y=p.digest().getBytes(),g=2,w()}function w(){if(g<=a)return p.start(null,null),p.update(y),v=p.digest().getBytes(),d=n.util.xorBytes(d,v,c),y=v,++g,n.util.setImmediate(w);b+=m<h?d:d.substr(0,l),++m,k()}k()}}).call(this,r(3).Buffer)},function(e,t,r){var n=r(1950);r(1967),r(1952);var i=e.exports=n.sha512=n.sha512||{};n.md.sha512=n.md.algorithms.sha512=i;var a=n.sha384=n.sha512.sha384=n.sha512.sha384||{};a.create=function(){return i.create("SHA-384")},n.md.sha384=n.md.algorithms.sha384=a,n.sha512.sha256=n.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256,n.sha512.sha224=n.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224,i.create=function(e){if(o||(s=String.fromCharCode(128),s+=n.util.fillString(String.fromCharCode(0),128),u=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(c={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],c["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],c["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],c["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],o=!0),"undefined"===typeof e&&(e="SHA-512"),!(e in c))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=c[e],r=null,i=n.util.createBuffer(),a=new Array(80),h=0;h<80;++h)a[h]=new Array(2);var l=64;switch(e){case"SHA-384":l=48;break;case"SHA-512/256":l=32;break;case"SHA-512/224":l=28}var p={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:l,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){p.messageLength=0,p.fullMessageLength=p.messageLength128=[];for(var e=p.messageLengthSize/4,a=0;a<e;++a)p.fullMessageLength.push(0);i=n.util.createBuffer(),r=new Array(t.length);for(a=0;a<t.length;++a)r[a]=t[a].slice(0);return p}};return p.start(),p.update=function(e,t){"utf8"===t&&(e=n.util.encodeUtf8(e));var s=e.length;p.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var o=p.fullMessageLength.length-1;o>=0;--o)p.fullMessageLength[o]+=s[1],s[1]=s[0]+(p.fullMessageLength[o]/4294967296>>>0),p.fullMessageLength[o]=p.fullMessageLength[o]>>>0,s[0]=s[1]/4294967296>>>0;return i.putBytes(e),f(r,a,i),(i.read>2048||0===i.length())&&i.compact(),p},p.digest=function(){var t=n.util.createBuffer();t.putBytes(i.bytes());var o,u=p.fullMessageLength[p.fullMessageLength.length-1]+p.messageLengthSize&p.blockLength-1;t.putBytes(s.substr(0,p.blockLength-u));for(var c=8*p.fullMessageLength[0],h=0;h<p.fullMessageLength.length-1;++h)c+=(o=8*p.fullMessageLength[h+1])/4294967296>>>0,t.putInt32(c>>>0),c=o>>>0;t.putInt32(c);var l=new Array(r.length);for(h=0;h<r.length;++h)l[h]=r[h].slice(0);f(l,a,t);var d,v=n.util.createBuffer();d="SHA-512"===e?l.length:"SHA-384"===e?l.length-2:l.length-4;for(h=0;h<d;++h)v.putInt32(l[h][0]),h===d-1&&"SHA-512/224"===e||v.putInt32(l[h][1]);return v},p};var s=null,o=!1,u=null,c=null;function f(e,t,r){for(var n,i,a,s,o,c,f,h,l,p,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C,B,R,N,P,M,D,O,L=r.length();L>=128;){for(B=0;B<16;++B)t[B][0]=r.getInt32()>>>0,t[B][1]=r.getInt32()>>>0;for(;B<80;++B)n=(((R=(P=t[B-2])[0])>>>19|(N=P[1])<<13)^(N>>>29|R<<3)^R>>>6)>>>0,i=((R<<13|N>>>19)^(N<<3|R>>>29)^(R<<26|N>>>6))>>>0,a=(((R=(D=t[B-15])[0])>>>1|(N=D[1])<<31)^(R>>>8|N<<24)^R>>>7)>>>0,s=((R<<31|N>>>1)^(R<<24|N>>>8)^(R<<25|N>>>7))>>>0,M=t[B-7],O=t[B-16],N=i+M[1]+s+O[1],t[B][0]=n+M[0]+a+O[0]+(N/4294967296>>>0)>>>0,t[B][1]=N>>>0;for(d=e[0][0],v=e[0][1],y=e[1][0],b=e[1][1],m=e[2][0],g=e[2][1],k=e[3][0],w=e[3][1],x=e[4][0],S=e[4][1],E=e[5][0],_=e[5][1],I=e[6][0],A=e[6][1],T=e[7][0],C=e[7][1],B=0;B<80;++B)f=((x>>>14|S<<18)^(x>>>18|S<<14)^(S>>>9|x<<23))>>>0,h=(I^x&(E^I))>>>0,o=((d>>>28|v<<4)^(v>>>2|d<<30)^(v>>>7|d<<25))>>>0,c=((d<<4|v>>>28)^(v<<30|d>>>2)^(v<<25|d>>>7))>>>0,l=(d&y|m&(d^y))>>>0,p=(v&b|g&(v^b))>>>0,N=C+(((x<<18|S>>>14)^(x<<14|S>>>18)^(S<<23|x>>>9))>>>0)+((A^S&(_^A))>>>0)+u[B][1]+t[B][1],n=T+f+h+u[B][0]+t[B][0]+(N/4294967296>>>0)>>>0,i=N>>>0,a=o+l+((N=c+p)/4294967296>>>0)>>>0,s=N>>>0,T=I,C=A,I=E,A=_,E=x,_=S,x=k+n+((N=w+i)/4294967296>>>0)>>>0,S=N>>>0,k=m,w=g,m=y,g=b,y=d,b=v,d=n+a+((N=i+s)/4294967296>>>0)>>>0,v=N>>>0;N=e[0][1]+v,e[0][0]=e[0][0]+d+(N/4294967296>>>0)>>>0,e[0][1]=N>>>0,N=e[1][1]+b,e[1][0]=e[1][0]+y+(N/4294967296>>>0)>>>0,e[1][1]=N>>>0,N=e[2][1]+g,e[2][0]=e[2][0]+m+(N/4294967296>>>0)>>>0,e[2][1]=N>>>0,N=e[3][1]+w,e[3][0]=e[3][0]+k+(N/4294967296>>>0)>>>0,e[3][1]=N>>>0,N=e[4][1]+S,e[4][0]=e[4][0]+x+(N/4294967296>>>0)>>>0,e[4][1]=N>>>0,N=e[5][1]+_,e[5][0]=e[5][0]+E+(N/4294967296>>>0)>>>0,e[5][1]=N>>>0,N=e[6][1]+A,e[6][0]=e[6][0]+I+(N/4294967296>>>0)>>>0,e[6][1]=N>>>0,N=e[7][1]+C,e[7][0]=e[7][0]+T+(N/4294967296>>>0)>>>0,e[7][1]=N>>>0,L-=128}}},function(e,t,r){(function(t){var n=r(1950);r(1982),r(1973),r(2044),r(1952);var i=r(2121),a=i.publicKeyValidator,s=i.privateKeyValidator;if("undefined"===typeof o)var o=n.jsbn.BigInteger;var u=n.util.ByteBuffer,c="undefined"===typeof t?Uint8Array:t;n.pki=n.pki||{},e.exports=n.pki.ed25519=n.ed25519=n.ed25519||{};var f=n.ed25519;function h(e){var r=e.message;if(r instanceof Uint8Array||r instanceof c)return r;var n=e.encoding;if(void 0===r){if(!e.md)throw new TypeError('"options.message" or "options.md" not specified.');r=e.md.digest().getBytes(),n="binary"}if("string"===typeof r&&!n)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"===typeof r){if("undefined"!==typeof t)return t.from(r,n);r=new u(r,n)}else if(!(r instanceof u))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var i=new c(r.length()),a=0;a<i.length;++a)i[a]=r.at(a);return i}f.constants={},f.constants.PUBLIC_KEY_BYTE_LENGTH=32,f.constants.PRIVATE_KEY_BYTE_LENGTH=64,f.constants.SEED_BYTE_LENGTH=32,f.constants.SIGN_BYTE_LENGTH=64,f.constants.HASH_BYTE_LENGTH=64,f.generateKeyPair=function(e){var t=(e=e||{}).seed;if(void 0===t)t=n.random.getBytesSync(f.constants.SEED_BYTE_LENGTH);else if("string"===typeof t){if(t.length!==f.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+f.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');t=h({message:t,encoding:"binary"});for(var r=new c(f.constants.PUBLIC_KEY_BYTE_LENGTH),i=new c(f.constants.PRIVATE_KEY_BYTE_LENGTH),a=0;a<32;++a)i[a]=t[a];return function(e,t){var r,n=[D(),D(),D(),D()],i=k(t,32);for(i[0]&=248,i[31]&=127,i[31]|=64,R(n,i),_(e,n),r=0;r<32;++r)t[r+32]=e[r]}(r,i),{publicKey:r,privateKey:i}},f.privateKeyFromAsn1=function(e){var t={},r=[];if(!n.asn1.validate(e,s,t,r)){var i=new Error("Invalid Key.");throw i.errors=r,i}var a=n.asn1.derToOid(t.privateKeyOid),o=n.oids.EdDSA25519;if(a!==o)throw new Error('Invalid OID "'+a+'"; OID must be "'+o+'".');var u=t.privateKey;return{privateKeyBytes:h({message:n.asn1.fromDer(u).value,encoding:"binary"})}},f.publicKeyFromAsn1=function(e){var t={},r=[];if(!n.asn1.validate(e,a,t,r)){var i=new Error("Invalid Key.");throw i.errors=r,i}var s=n.asn1.derToOid(t.publicKeyOid),o=n.oids.EdDSA25519;if(s!==o)throw new Error('Invalid OID "'+s+'"; OID must be "'+o+'".');var u=t.ed25519PublicKey;if(u.length!==f.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return h({message:u,encoding:"binary"})},f.publicKeyFromPrivateKey=function(e){var t=h({message:(e=e||{}).privateKey,encoding:"binary"});if(t.length!==f.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+f.constants.PRIVATE_KEY_BYTE_LENGTH);for(var r=new c(f.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<r.length;++n)r[n]=t[32+n];return r},f.sign=function(e){var t=h(e=e||{}),r=h({message:e.privateKey,encoding:"binary"});if(r.length===f.constants.SEED_BYTE_LENGTH)r=f.generateKeyPair({seed:r}).privateKey;else if(r.length!==f.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+f.constants.SEED_BYTE_LENGTH+" or "+f.constants.PRIVATE_KEY_BYTE_LENGTH);var n=new c(f.constants.SIGN_BYTE_LENGTH+t.length);!function(e,t,r,n){var i,a,s=new Float64Array(64),o=[D(),D(),D(),D()],u=k(n,32);u[0]&=248,u[31]&=127,u[31]|=64;var c=r+64;for(i=0;i<r;++i)e[64+i]=t[i];for(i=0;i<32;++i)e[32+i]=u[32+i];var f=k(e.subarray(32),r+32);for(x(f),R(o,f),_(e,o),i=32;i<64;++i)e[i]=n[i];var h=k(e,r+64);for(x(h),i=32;i<64;++i)s[i]=0;for(i=0;i<32;++i)s[i]=f[i];for(i=0;i<32;++i)for(a=0;a<32;a++)s[i+a]+=h[i]*u[a];w(e.subarray(32),s)}(n,t,t.length,r);for(var i=new c(f.constants.SIGN_BYTE_LENGTH),a=0;a<i.length;++a)i[a]=n[a];return i},f.verify=function(e){var t=h(e=e||{});if(void 0===e.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var r=h({message:e.signature,encoding:"binary"});if(r.length!==f.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+f.constants.SIGN_BYTE_LENGTH);var n=h({message:e.publicKey,encoding:"binary"});if(n.length!==f.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+f.constants.PUBLIC_KEY_BYTE_LENGTH);var i,a=new c(f.constants.SIGN_BYTE_LENGTH+t.length),s=new c(f.constants.SIGN_BYTE_LENGTH+t.length);for(i=0;i<f.constants.SIGN_BYTE_LENGTH;++i)a[i]=r[i];for(i=0;i<t.length;++i)a[i+f.constants.SIGN_BYTE_LENGTH]=t[i];return function(e,t,r,n){var i,a=new c(32),s=[D(),D(),D(),D()],o=[D(),D(),D(),D()];if(-1,r<64)return-1;if(function(e,t){var r=D(),n=D(),i=D(),a=D(),s=D(),o=D(),u=D();N(e[2],p),function(e,t){var r;for(r=0;r<16;++r)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(e[1],t),K(i,e[1]),U(a,i,d),L(i,i,e[2]),O(a,e[2],a),K(s,a),K(o,s),U(u,o,s),U(r,u,i),U(r,r,a),function(e,t){var r,n=D();for(r=0;r<16;++r)n[r]=t[r];for(r=250;r>=0;--r)K(n,n),1!==r&&U(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}(r,r),U(r,r,i),U(r,r,a),U(r,r,a),U(e[0],r,a),K(n,e[0]),U(n,n,a),A(n,i)&&U(e[0],e[0],g);if(K(n,e[0]),U(n,n,a),A(n,i))return-1;C(e[0])===t[31]>>7&&L(e[0],l,e[0]);return U(e[3],e[0],e[1]),0}(o,n))return-1;for(i=0;i<r;++i)e[i]=t[i];for(i=0;i<32;++i)e[i+32]=n[i];var u=k(e,r);if(x(u),B(s,o,u),R(o,t.subarray(32)),S(s,o),_(a,s),r-=64,T(t,0,a,0)){for(i=0;i<r;++i)e[i]=0;return-1}for(i=0;i<r;++i)e[i]=t[i+64];return r}(s,a,a.length,n)>=0};var l=D(),p=D([1]),d=D([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=D([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=D([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),b=D([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),m=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),g=D([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(e,r){var i=n.md.sha512.create(),a=new u(e);i.update(a.getBytes(r),"binary");var s=i.digest().getBytes();if("undefined"!==typeof t)return t.from(s,"binary");for(var o=new c(f.constants.HASH_BYTE_LENGTH),h=0;h<64;++h)o[h]=s.charCodeAt(h);return o}function w(e,t){var r,n,i,a;for(n=63;n>=32;--n){for(r=0,i=n-32,a=n-12;i<a;++i)t[i]+=r-16*t[n]*m[i-(n-32)],r=t[i]+128>>8,t[i]-=256*r;t[i]+=r,t[n]=0}for(r=0,i=0;i<32;++i)t[i]+=r-(t[31]>>4)*m[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;++i)t[i]-=r*m[i];for(n=0;n<32;++n)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function x(e){for(var t=new Float64Array(64),r=0;r<64;++r)t[r]=e[r],e[r]=0;w(e,t)}function S(e,t){var r=D(),n=D(),i=D(),a=D(),s=D(),o=D(),u=D(),c=D(),f=D();L(r,e[1],e[0]),L(f,t[1],t[0]),U(r,r,f),O(n,e[0],e[1]),O(f,t[0],t[1]),U(n,n,f),U(i,e[3],t[3]),U(i,i,v),U(a,e[2],t[2]),O(a,a,a),L(s,n,r),L(o,a,i),O(u,a,i),O(c,n,r),U(e[0],s,o),U(e[1],c,u),U(e[2],u,o),U(e[3],s,c)}function E(e,t,r){for(var n=0;n<4;++n)M(e[n],t[n],r)}function _(e,t){var r=D(),n=D(),i=D();!function(e,t){var r,n=D();for(r=0;r<16;++r)n[r]=t[r];for(r=253;r>=0;--r)K(n,n),2!==r&&4!==r&&U(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}(i,t[2]),U(r,t[0],i),U(n,t[1],i),I(e,n),e[31]^=C(r)<<7}function I(e,t){var r,n,i,a=D(),s=D();for(r=0;r<16;++r)s[r]=t[r];for(P(s),P(s),P(s),n=0;n<2;++n){for(a[0]=s[0]-65517,r=1;r<15;++r)a[r]=s[r]-65535-(a[r-1]>>16&1),a[r-1]&=65535;a[15]=s[15]-32767-(a[14]>>16&1),i=a[15]>>16&1,a[14]&=65535,M(s,a,1-i)}for(r=0;r<16;r++)e[2*r]=255&s[r],e[2*r+1]=s[r]>>8}function A(e,t){var r=new c(32),n=new c(32);return I(r,e),I(n,t),T(r,0,n,0)}function T(e,t,r,n){return function(e,t,r,n,i){var a,s=0;for(a=0;a<i;++a)s|=e[t+a]^r[n+a];return(1&s-1>>>8)-1}(e,t,r,n,32)}function C(e){var t=new c(32);return I(t,e),1&t[0]}function B(e,t,r){var n,i;for(N(e[0],l),N(e[1],p),N(e[2],p),N(e[3],l),i=255;i>=0;--i)E(e,t,n=r[i/8|0]>>(7&i)&1),S(t,e),S(e,e),E(e,t,n)}function R(e,t){var r=[D(),D(),D(),D()];N(r[0],y),N(r[1],b),N(r[2],p),U(r[3],y,b),B(e,r,t)}function N(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function P(e){var t,r,n=1;for(t=0;t<16;++t)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function M(e,t,r){for(var n,i=~(r-1),a=0;a<16;++a)n=i&(e[a]^t[a]),e[a]^=n,t[a]^=n}function D(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;++t)r[t]=e[t];return r}function O(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]+r[n]}function L(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]-r[n]}function K(e,t){U(e,t,t)}function U(e,t,r){var n,i,a=0,s=0,o=0,u=0,c=0,f=0,h=0,l=0,p=0,d=0,v=0,y=0,b=0,m=0,g=0,k=0,w=0,x=0,S=0,E=0,_=0,I=0,A=0,T=0,C=0,B=0,R=0,N=0,P=0,M=0,D=0,O=r[0],L=r[1],K=r[2],U=r[3],q=r[4],z=r[5],j=r[6],V=r[7],F=r[8],H=r[9],G=r[10],Y=r[11],W=r[12],J=r[13],Q=r[14],X=r[15];a+=(n=t[0])*O,s+=n*L,o+=n*K,u+=n*U,c+=n*q,f+=n*z,h+=n*j,l+=n*V,p+=n*F,d+=n*H,v+=n*G,y+=n*Y,b+=n*W,m+=n*J,g+=n*Q,k+=n*X,s+=(n=t[1])*O,o+=n*L,u+=n*K,c+=n*U,f+=n*q,h+=n*z,l+=n*j,p+=n*V,d+=n*F,v+=n*H,y+=n*G,b+=n*Y,m+=n*W,g+=n*J,k+=n*Q,w+=n*X,o+=(n=t[2])*O,u+=n*L,c+=n*K,f+=n*U,h+=n*q,l+=n*z,p+=n*j,d+=n*V,v+=n*F,y+=n*H,b+=n*G,m+=n*Y,g+=n*W,k+=n*J,w+=n*Q,x+=n*X,u+=(n=t[3])*O,c+=n*L,f+=n*K,h+=n*U,l+=n*q,p+=n*z,d+=n*j,v+=n*V,y+=n*F,b+=n*H,m+=n*G,g+=n*Y,k+=n*W,w+=n*J,x+=n*Q,S+=n*X,c+=(n=t[4])*O,f+=n*L,h+=n*K,l+=n*U,p+=n*q,d+=n*z,v+=n*j,y+=n*V,b+=n*F,m+=n*H,g+=n*G,k+=n*Y,w+=n*W,x+=n*J,S+=n*Q,E+=n*X,f+=(n=t[5])*O,h+=n*L,l+=n*K,p+=n*U,d+=n*q,v+=n*z,y+=n*j,b+=n*V,m+=n*F,g+=n*H,k+=n*G,w+=n*Y,x+=n*W,S+=n*J,E+=n*Q,_+=n*X,h+=(n=t[6])*O,l+=n*L,p+=n*K,d+=n*U,v+=n*q,y+=n*z,b+=n*j,m+=n*V,g+=n*F,k+=n*H,w+=n*G,x+=n*Y,S+=n*W,E+=n*J,_+=n*Q,I+=n*X,l+=(n=t[7])*O,p+=n*L,d+=n*K,v+=n*U,y+=n*q,b+=n*z,m+=n*j,g+=n*V,k+=n*F,w+=n*H,x+=n*G,S+=n*Y,E+=n*W,_+=n*J,I+=n*Q,A+=n*X,p+=(n=t[8])*O,d+=n*L,v+=n*K,y+=n*U,b+=n*q,m+=n*z,g+=n*j,k+=n*V,w+=n*F,x+=n*H,S+=n*G,E+=n*Y,_+=n*W,I+=n*J,A+=n*Q,T+=n*X,d+=(n=t[9])*O,v+=n*L,y+=n*K,b+=n*U,m+=n*q,g+=n*z,k+=n*j,w+=n*V,x+=n*F,S+=n*H,E+=n*G,_+=n*Y,I+=n*W,A+=n*J,T+=n*Q,C+=n*X,v+=(n=t[10])*O,y+=n*L,b+=n*K,m+=n*U,g+=n*q,k+=n*z,w+=n*j,x+=n*V,S+=n*F,E+=n*H,_+=n*G,I+=n*Y,A+=n*W,T+=n*J,C+=n*Q,B+=n*X,y+=(n=t[11])*O,b+=n*L,m+=n*K,g+=n*U,k+=n*q,w+=n*z,x+=n*j,S+=n*V,E+=n*F,_+=n*H,I+=n*G,A+=n*Y,T+=n*W,C+=n*J,B+=n*Q,R+=n*X,b+=(n=t[12])*O,m+=n*L,g+=n*K,k+=n*U,w+=n*q,x+=n*z,S+=n*j,E+=n*V,_+=n*F,I+=n*H,A+=n*G,T+=n*Y,C+=n*W,B+=n*J,R+=n*Q,N+=n*X,m+=(n=t[13])*O,g+=n*L,k+=n*K,w+=n*U,x+=n*q,S+=n*z,E+=n*j,_+=n*V,I+=n*F,A+=n*H,T+=n*G,C+=n*Y,B+=n*W,R+=n*J,N+=n*Q,P+=n*X,g+=(n=t[14])*O,k+=n*L,w+=n*K,x+=n*U,S+=n*q,E+=n*z,_+=n*j,I+=n*V,A+=n*F,T+=n*H,C+=n*G,B+=n*Y,R+=n*W,N+=n*J,P+=n*Q,M+=n*X,k+=(n=t[15])*O,s+=38*(x+=n*K),o+=38*(S+=n*U),u+=38*(E+=n*q),c+=38*(_+=n*z),f+=38*(I+=n*j),h+=38*(A+=n*V),l+=38*(T+=n*F),p+=38*(C+=n*H),d+=38*(B+=n*G),v+=38*(R+=n*Y),y+=38*(N+=n*W),b+=38*(P+=n*J),m+=38*(M+=n*Q),g+=38*(D+=n*X),a=(n=(a+=38*(w+=n*L))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),k=(n=k+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=(a+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),k=(n=k+i+65535)-65536*(i=Math.floor(n/65536)),a+=i-1+37*(i-1),e[0]=a,e[1]=s,e[2]=o,e[3]=u,e[4]=c,e[5]=f,e[6]=h,e[7]=l,e[8]=p,e[9]=d,e[10]=v,e[11]=y,e[12]=b,e[13]=m,e[14]=g,e[15]=k}}).call(this,r(3).Buffer)},function(e,t,r){"use strict";var n=r(169).IPFS.matches;t.isValidMultiaddr=function(e){try{return n(e)}catch(t){return!1}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2006),s=r(1948).withTimeoutOption,o=r(19)("ipfs:core:config");function u(e){return c.apply(this,arguments)}function c(){return(c=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.keys(f).map((function(e){return{name:e,description:f[e].description}})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(e){var t=e.repo;return{getAll:s(t.config.getAll),get:s((function(e,r){return e?t.config.get(e,r):Promise.reject(new Error("key argument is required"))})),set:s(t.config.set),replace:s(t.config.replace),profiles:{apply:s((function(e){return r.apply(this,arguments)})),list:s(u)}};function r(){return(r=i(n.mark((function e(r){var i,a,s,u,c,h=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=h.length>1&&void 0!==h[1]?h[1]:{},a=i.dryRun,s=f[r]){e.next=5;break}throw new Error("No profile with name '".concat(r,"' exists"));case 5:return e.prev=5,e.next=8,t.config.getAll(i);case 8:if(u=e.sent,c=JSON.parse(JSON.stringify(u)),c=s.transform(c),a){e.next=14;break}return e.next=14,t.config.replace(c,i);case 14:return delete u.Identity.PrivKey,delete c.Identity.PrivKey,e.abrupt("return",{original:u,updated:c});case 19:throw e.prev=19,e.t0=e.catch(5),o(e.t0),new Error("Could not apply profile '".concat(r,"' to config: ").concat(e.t0.message));case 23:case"end":return e.stop()}}),e,null,[[5,19]])})))).apply(this,arguments)}};var f={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery in local networks.",transform:function(e){return e.Discovery.MDNS.Enabled=!1,e.Discovery.webRTCStar.Enabled=!1,e}},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery in local networks.",transform:function(e){return e.Discovery.MDNS.Enabled=!0,e.Discovery.webRTCStar.Enabled=!0,e}},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:function(e){var t=a();return e.Addresses.API=t.Addresses.API?"/ip4/127.0.0.1/tcp/0":"",e.Addresses.Gateway=t.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":"",e.Addresses.Swarm=t.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[],e.Addresses.Delegates=[],e.Bootstrap=[],e.Discovery.MDNS.Enabled=!1,e.Discovery.webRTCStar.Enabled=!1,e}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:function(e){var t=a();return e.Addresses.API=t.Addresses.API,e.Addresses.Gateway=t.Addresses.Gateway,e.Addresses.Swarm=t.Addresses.Swarm,e.Addresses.Delegates=t.Addresses.Delegates,e.Bootstrap=t.Bootstrap,e.Discovery.MDNS.Enabled=t.Discovery.MDNS.Enabled,e.Discovery.webRTCStar.Enabled=t.Discovery.webRTCStar.Enabled,e}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:function(e){return e.Swarm=e.Swarm||{},e.Swarm.ConnMgr=e.Swarm.ConnMgr||{},e.Swarm.ConnMgr.LowWater=20,e.Swarm.ConnMgr.HighWater=40,e}},"default-power":{description:'Inverse of "lowpower" profile.',transform:function(e){var t=a();return e.Swarm=t.Swarm,e}}};e.exports.profiles=f},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(331),s=function(){function e(t){n(this,e),this.lru=a(t)}return i(e,[{key:"get",value:function(e){var t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}},{key:"set",value:function(e,t,r){this.lru.set(e,{value:t,expire:Date.now()+r})}},{key:"has",value:function(e){return!!this.get(e)}},{key:"remove",value:function(e){this.lru.remove(e)}},{key:"clear",value:function(){this.lru.clear()}}]),e}();e.exports=s},function(e,t,r){"use strict";var n,i=r(1),a=r(2),s=r(468);e.exports=function(e){if(n)return n;var t=s({singleProcess:e});return n={readLock:function(e){return function(){var r=a(i.mark((function r(){var n,a,s,o,u=arguments;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.readLock();case 2:for(n=r.sent,r.prev=3,a=u.length,s=new Array(a),o=0;o<a;o++)s[o]=u[o];return r.next=7,e.apply(null,s);case 7:return r.abrupt("return",r.sent);case 8:return r.prev=8,n(),r.finish(8);case 11:case"end":return r.stop()}}),r,null,[[3,,8,11]])})));return function(){return r.apply(this,arguments)}}()},writeLock:function(e){return function(){var r=a(i.mark((function r(){var n,a,s,o,u=arguments;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.writeLock();case 2:for(n=r.sent,r.prev=3,a=u.length,s=new Array(a),o=0;o<a;o++)s[o]=u[o];return r.next=7,e.apply(null,s);case 7:return r.abrupt("return",r.sent);case 8:return r.prev=8,n(),r.finish(8);case 11:case"end":return r.stop()}}),r,null,[[3,,8,11]])})));return function(){return r.apply(this,arguments)}}()}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(32),s=r(90),o=r(61).DAGNode,u=r(19)("ipfs:mfs:utils:with-mfs-root"),c=r(49),f=r(1955).multihash,h=r(15),l=r(1948).MFS_ROOT_KEY,p=function(){var e=i(n.mark((function e(t,r){var i,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r&&r.signal&&r.signal.aborted)){e.next=2;break}throw h(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});case 2:return e.next=4,t.repo.datastore.open();case 4:return e.prev=4,e.next=7,t.repo.datastore.get(l);case 7:p=e.sent,i=new a(p),e.next=24;break;case 11:if(e.prev=11,e.t0=e.catch(4),"ERR_NOT_FOUND"===e.t0.code){e.next=15;break}throw e.t0;case 15:return u("Creating new MFS root"),d=new o(new s({type:"directory"}).marshal()),e.next=19,t.ipld.put(d,c.DAG_PB,{cidVersion:0,hashAlg:f.names["sha2-256"]});case 19:if(i=e.sent,!(r&&r.signal&&r.signal.aborted)){e.next=22;break}throw h(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});case 22:return e.next=24,t.repo.datastore.put(l,i.buffer);case 24:return u("Loaded MFS root /ipfs/".concat(i)),e.abrupt("return",i);case 26:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t,r){return e.apply(this,arguments)}}();e.exports=p},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(61).DAGNode,o=r(344),u=r(339),c=r(19)("ipfs:mfs:core:utils:hamt-utils"),f=r(90),h=r(49),l=r(1955).multihash,p=r(223),d=r(3).Buffer,v=function(){var e=a(i.mark((function e(t,r,n,a){var o,c,p,v,y,b;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=d.from(n._children.bitField().reverse()),c=f.unmarshal(a.parent.Data),p=new f({type:"hamt-sharded-directory",data:o,fanout:n.tableSize(),hashType:u.hashFn.code,mode:c.mode,mtime:c.mtime}),v=l.names[a.hashAlg],y=new s(p.marshal(),r),e.next=7,t.ipld.put(y,h.DAG_PB,{cidVersion:a.cidVersion,hashAlg:v,onlyHash:!a.flush});case 7:return b=e.sent,e.abrupt("return",{node:y,cid:b,size:y.size});case 9:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),y=function(){var e=a(i.mark((function e(t,r,n,a){var s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new o({hashFn:u.hashFn,hash:n?n._options.hash:void 0},n,a),n&&n._putObjectAt(a,s),e.next=4,b(t,s,r);case 4:return e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),b=function(){var e=a(i.mark((function e(t,r,n){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map((function(e){if(2===e.Name.length){var t=parseInt(e.Name,16);return r._putObjectAt(t,new o({hashFn:u.hashFn},r,t)),Promise.resolve()}return(n||r).put(e.Name.substring(2),{size:e.Tsize,cid:e.Hash})})));case 2:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),m=function(e){return e.toString("16").toUpperCase().padStart(2,"0").substring(0,2)},g=function(){var e=a(i.mark((function e(t,r,n){var a,s,o,u,f,h;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(n.Links,null,null,null);case 2:return a=e.sent,e.next=5,a._findNewBucketAndPos(r);case 5:for(s=e.sent,o=[{bucket:s.bucket,prefix:m(s.pos)}],u=s.bucket;u!==a;)o.push({bucket:u,prefix:m(u._posAtParent)}),u=u._parent;o.reverse(),o[0].node=n,f=i.mark((function e(n){var s,u,f,h,l;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=o[n],u=s.node.Links.filter((function(e){return e.Name.substring(0,2)===s.prefix})).pop()){e.next=5;break}return c("Link ".concat(s.prefix).concat(r," will be added")),e.abrupt("return","continue");case 5:if(u.Name!=="".concat(s.prefix).concat(r)){e.next=8;break}return c("Link ".concat(s.prefix).concat(r," will be replaced")),e.abrupt("return","continue");case 8:return c("Found subshard ".concat(s.prefix)),e.next=11,t.ipld.get(u.Hash);case 11:if(f=e.sent,o[n+1]){e.next=21;break}return c("Loaded new subshard ".concat(s.prefix)),e.next=16,y(f.Links,a,s.bucket,parseInt(s.prefix,16));case 16:return e.next=18,a._findNewBucketAndPos(r);case 18:return h=e.sent,o.push({bucket:h.bucket,prefix:m(h.pos),node:f}),e.abrupt("return","continue");case 21:return l=o[n+1],e.next=24,b(f.Links,l.bucket,a);case 24:l.node=f;case 25:case"end":return e.stop()}}),e)})),h=0;case 13:if(!(h<o.length)){e.next=21;break}return e.delegateYield(f(h),"t0",15);case 15:if("continue"!==e.t0){e.next=18;break}return e.abrupt("continue",18);case 18:h++,e.next=13;break;case 21:return e.next=23,a.put(r,!0);case 23:return o.reverse(),e.abrupt("return",{rootBucket:a,path:o});case 25:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),k=function(){var e=a(i.mark((function e(t,r,a){var s,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=new u({root:!0,dir:!0,parent:null,parentKey:null,path:"",dirty:!0,flat:!1,mtime:a.mtime,mode:a.mode},n({},a,{codec:"dag-pb"})),o=0;case 2:if(!(o<r.length)){e.next=8;break}return e.next=5,s._bucket.put(r[o].name,{size:r[o].size,cid:r[o].cid});case 5:o++,e.next=2;break;case 8:return e.abrupt("return",p(s.flush("",t.block,null)));case 9:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports={generatePath:g,updateHamtDirectory:v,recreateHamtLevel:y,addLinksToHamtBucket:b,toPrefix:m,createShard:k}},function(e){e.exports=JSON.parse('{"_from":"ipfs","_id":"ipfs@0.48.1","_inBundle":false,"_integrity":"sha512-olvmy0xQ2SFB1dd1CI/legZrzVSgU3avd7PFJG7f7d2KpKFjjwUAjBR9ucDxLqqSmUNhgcBZbfuwoY9R8MhFEw==","_location":"/ipfs","_phantomChildren":{"@types/color-name":"1.1.1","ansi-regex":"5.0.0","base-x":"3.0.8","base64-js":"1.3.1","blakejs":"1.1.0","camelcase":"5.3.1","decamelize":"1.2.0","err-code":"2.0.3","get-caller-file":"2.0.5","ieee754":"1.1.13","is-typedarray":"1.0.0","iso-random-stream":"1.1.1","js-sha3":"0.8.0","keypair":"1.0.1","multihashes":"1.0.1","murmurhash3js-revisited":"3.0.0","p-limit":"2.2.2","pem-jwk":"2.0.0","protons":"1.2.1","require-directory":"2.1.1","require-main-filename":"2.0.0","secp256k1":"4.0.1","set-blocking":"2.0.0","string-width":"4.2.0","ursa-optional":"0.10.1","which-module":"2.0.0","y18n":"4.0.0"},"_requested":{"type":"tag","registry":true,"raw":"ipfs","name":"ipfs","escapedName":"ipfs","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/ipfs/-/ipfs-0.48.1.tgz","_shasum":"606fb6d68b8eda35134ed16ea5df1d6c8154e96c","_spec":"ipfs","_where":"/mnt/6b0867de-74e1-417d-8281-ce67ccf712c6/LocalD/work/hacks/hackfs/carolina-react-admin-dashboard-free","bin":{"jsipfs":"src/cli/bin.js"},"browser":{"./src/core/runtime/init-assets-nodejs.js":"./src/core/runtime/init-assets-browser.js","./src/core/runtime/config-nodejs.js":"./src/core/runtime/config-browser.js","./src/core/runtime/dns-nodejs.js":"./src/core/runtime/dns-browser.js","./src/core/runtime/libp2p-nodejs.js":"./src/core/runtime/libp2p-browser.js","./src/core/runtime/libp2p-pubsub-routers-nodejs.js":"./src/core/runtime/libp2p-pubsub-routers-browser.js","./src/core/runtime/preload-nodejs.js":"./src/core/runtime/preload-browser.js","./src/core/runtime/repo-nodejs.js":"./src/core/runtime/repo-browser.js","./src/core/runtime/ipld-nodejs.js":"./src/core/runtime/ipld-browser.js","./test/utils/create-repo-nodejs.js":"./test/utils/create-repo-browser.js","ipfs-utils/src/files/glob-source":false},"bugs":{"url":"https://github.com/ipfs/js-ipfs/issues"},"bundleDependencies":false,"contributors":[{"name":"0xflotus","email":"0xflotus@gmail.com"},{"name":"A_A","email":"21040751+Otto-AA@users.noreply.github.com"},{"name":"Adam Uhl\xed\u0159","email":"adam@uhlir.dev"},{"name":"Alan Shaw","email":"alan.shaw@protocol.ai"},{"name":"Alan Shaw","email":"alan@tableflip.io"},{"name":"Alex North","email":"alex@alexnorth.me"},{"name":"Alex Potsides","email":"alex@achingbrain.net"},{"name":"Andrew Nesbitt","email":"andrewnez@gmail.com"},{"name":"Andrew de Andrade","email":"andrew@deandrade.com.br"},{"name":"Andr\xe9 Cruz","email":"andremiguelcruz@msn.com"},{"name":"Arkadiy Kukarkin","email":"parkan@users.noreply.github.com"},{"name":"Arpit Agarwal","email":"93arpit@gmail.com"},{"name":"Arpit Agarwal","email":"atvanguard@users.noreply.github.com"},{"name":"Ayush Mahajan","email":"mahajan.ayush2306@gmail.com"},{"name":"Bernard Mordan","email":"bernard@tableflip.io"},{"name":"Brian Vander Schaaf","email":"bvs330@gmail.com"},{"name":"Bruno Zell","email":"bruno.zzell@gmail.com"},{"name":"CHEVALAY JOSSELIN","email":"josselin54.chevalay@gmail.com"},{"name":"Caio Gondim","email":"me@caiogondim.com"},{"name":"Chance Hudson","email":"jchancehud@gmail.com"},{"name":"Chirag Shinde","email":"chirag-shinde@users.noreply.github.com"},{"name":"Christian Couder","email":"chriscool@tuxfamily.org"},{"name":"Dafeng","email":"dfguo.joe@gmail.com"},{"name":"Dan Ordille","email":"dordille@gmail.com"},{"name":"Dan Shields","email":"35669742+NukeManDan@users.noreply.github.com"},{"name":"Daniel Buchner","email":"danieljb2@gmail.com"},{"name":"Daniel J. O\'Quinn","email":"danieljoquinn@gmail.com"},{"name":"Daniela Borges Matos de Carvalho","email":"alunassertiva@gmail.com"},{"name":"David Dias","email":"daviddias.p@gmail.com"},{"name":"David Gilbertson","email":"gilbertson.david@gmail.com"},{"name":"David da Silva","email":"dasilvacontin@gmail.com"},{"name":"Diogo Silva","email":"fsdiogo@gmail.com"},{"name":"Dmitriy Ryajov","email":"dryajov@gmail.com"},{"name":"Dominic Della Valle","email":"ddvpublic@Gmail.com"},{"name":"Dzmitry Bachko","email":"dbachko@gmail.com"},{"name":"Enrico Marino","email":"enrico.marino@email.com"},{"name":"Faheel Ahmad","email":"faheel@live.in"},{"name":"Felix Yan","email":"felixonmars@archlinux.org"},{"name":"Francisco Baio Dias","email":"xicombd@gmail.com"},{"name":"Francisco Baio Dias","email":"francisco@typeform.com"},{"name":"Friedel Ziegelmayer","email":"dignifiedquire@gmail.com"},{"name":"Gabriel Garrido Calvo","email":"gabriel.garrido.work@gmail.com"},{"name":"Gar","email":"gar+gh@danger.computer"},{"name":"Georgios Rassias","email":"georassias@gmail.com"},{"name":"Gorka Ludlow","email":"gorka@aquigorka.com"},{"name":"Grant Herman","email":"grantlouisherman041@gmail.com"},{"name":"Greenkeeper","email":"support@greenkeeper.io"},{"name":"Haad","email":"haadcode@users.noreply.github.com"},{"name":"Haoliang Yu","email":"haoliangyu@users.noreply.github.com"},{"name":"Harsh Vakharia","email":"harshjv@users.noreply.github.com"},{"name":"Henrique Dias","email":"hacdias@gmail.com"},{"name":"Henry Rodrick","email":"moshisushi@gmail.com"},{"name":"Heo Sangmin","email":"heo@mapiacompany.com"},{"name":"Hugo Dias","email":"hugomrdias@gmail.com"},{"name":"Hugo Dias","email":"mail@hugodias.me"},{"name":"Irakli Gozalishvili","email":"contact@gozala.io"},{"name":"Jacob Heun","email":"jacobheun@gmail.com"},{"name":"Jacob Heun","email":"jake@andyet.net"},{"name":"Jade Meskill","email":"jade.meskill@gmail.com"},{"name":"Jessica Schilling","email":"jessica@protocol.ai"},{"name":"Johannes Wikner","email":"johannes.wikner@gmail.com"},{"name":"Jon Schlinkert","email":"dev@sellside.com"},{"name":"Jonathan","email":"jkrone@vt.edu"},{"name":"Jonybang","email":"Jonybange@gmail.com"},{"name":"Jorropo","email":"jorropo.pgm@gmail.com"},{"name":"Jo\xe3o Antunes","email":"j.goncalo.antunes@gmail.com"},{"name":"Jo\xe3o Santos","email":"joaosantos15@users.noreply.github.com"},{"name":"Kevin Wang","email":"kevin@fossa.io"},{"name":"Lars Gierth","email":"larsg@systemli.org"},{"name":"Lukas Drgon","email":"lukas.drgon@gmail.com"},{"name":"Maciej Kr\xfcger","email":"mkg20001@gmail.com"},{"name":"Marcin Rataj","email":"lidel@lidel.org"},{"name":"Marcus Bernales","email":"mboperator@gmail.com"},{"name":"Marius Darila","email":"marius.darila@gmail.com"},{"name":"Mark Robert Henderson","email":"henderson.mark@gmail.com"},{"name":"Mat Kelly","email":"machawk1@gmail.com"},{"name":"Michelle Lee","email":"michelle@protocol.ai"},{"name":"Mikeal Rogers","email":"mikeal.rogers@gmail.com"},{"name":"Mithgol","email":"getgit@mithgol.ru"},{"name":"Molly","email":"momack2@users.noreply.github.com"},{"name":"Mounish Sai","email":"pvsmounish@gmail.com"},{"name":"My9Bot","email":"34904312+My9Bot@users.noreply.github.com"},{"name":"Nick Poulden","email":"nick@poulden.com"},{"name":"Nitin Patel","email":"31539366+niinpatel@users.noreply.github.com"},{"name":"Nuno Nogueira","email":"nunofmn@gmail.com"},{"name":"Oli Evans","email":"oli@tableflip.io"},{"name":"Oskar Nyberg","email":"oskar@oskarnyberg.com"},{"name":"Pascal Precht","email":"pascal.precht@googlemail.com"},{"name":"Pau Ramon Revilla","email":"masylum@gmail.com"},{"name":"Paulo Rodrigues","email":"me@paulogr.com"},{"name":"Pedro Santos","email":"pedro.santos@moxy.studio"},{"name":"Pedro Santos","email":"pedromiguelsousasantos@hotmail.com"},{"name":"Pedro Teixeira","email":"i@pgte.me"},{"name":"Portia Burton","email":"plburton@gmail.com"},{"name":"Prabhakar Poudel","email":"yuvrajzohan@gmail.com"},{"name":"Qmstream","email":"51881352+Qmstream@users.noreply.github.com"},{"name":"Raoul Millais","email":"raoul@raoulmillais.com"},{"name":"RasmusErik Voel Jensen","email":"github@solsort.com"},{"name":"Richard Littauer","email":"richard.littauer@gmail.com"},{"name":"Richard Schneider","email":"makaretu@gmail.com"},{"name":"Rob Brackett","email":"rob@robbrackett.com"},{"name":"Rod Keys","email":"rod@zokos.com"},{"name":"Sangwon Hong","email":"qpakzk@gmail.com"},{"name":"Sid Harder","email":"sideharder@gmail.com"},{"name":"SidHarder","email":"softwarenavigator@gmail.com"},{"name":"Stephen Whitmore","email":"stephen.whitmore@gmail.com"},{"name":"Stephen Whitmore","email":"noffle@users.noreply.github.com"},{"name":"Steven Allen","email":"steven@stebalien.com"},{"name":"Tapasweni Pathak","email":"tapaswenipathak@gmail.com"},{"name":"Terence Pae","email":"terencepae@gmail.com"},{"name":"Teri Chadbourne","email":"terichadbourne@users.noreply.github.com"},{"name":"Travis CI","email":"travis@travis-ci.org"},{"name":"Uro\u0161 Jurgli\u010d","email":"jurglic@gmail.com"},{"name":"Vasco Santos","email":"vasco.santos@moxy.studio"},{"name":"Vasco Santos","email":"vasco.santos@ua.pt"},{"name":"Vincent Martin","email":"vince@finalatomicbuster.net"},{"name":"Volker Mische","email":"volker.mische@gmail.com"},{"name":"Xiao Liang","email":"yxliang01@users.noreply.github.com"},{"name":"Yahya","email":"ya7yaz@gmail.com"},{"name":"Yole","email":"yole@ultiledger.io"},{"name":"bitspill","email":"bitspill+github@bitspill.net"},{"name":"datafatmunger","email":"jbg@peerparty.org"},{"name":"dirkmc","email":"dirkmdev@gmail.com"},{"name":"dirkmc","email":"dirk@mccormick.cx"},{"name":"greenkeeper[bot]","email":"23040076+greenkeeper[bot]@users.noreply.github.com"},{"name":"greenkeeper[bot]","email":"greenkeeper[bot]@users.noreply.github.com"},{"name":"haad","email":"haad@headbanggames.com"},{"name":"hapsody","email":"hapsody@gmail.com"},{"name":"jbenet","email":"juan@benet.ai"},{"name":"jonahweissman","email":"19804455+jonahweissman@users.noreply.github.com"},{"name":"kevingzhang","email":"kevin.zhang.canada@gmail.com"},{"name":"kumavis","email":"kumavis@users.noreply.github.com"},{"name":"nginnever","email":"ginneversource@gmail.com"},{"name":"npmcdn-to-unpkg-bot","email":"npmcdn-to-unpkg-bot@users.noreply.github.com"},{"name":"reasv","email":"7143787+reasv@users.noreply.github.com"},{"name":"robbsolter","email":"35879806+robbsolter@users.noreply.github.com"},{"name":"seungwon-kang","email":"ksw3894@gmail.com"},{"name":"swedneck","email":"40505480+swedneck@users.noreply.github.com"},{"name":"tcme","email":"hi@this-connect.me"},{"name":"victorbjelkholm","email":"victorbjelkholm@gmail.com"},{"name":"\u0141ukasz Magiera","email":"magik6k@users.noreply.github.com"},{"name":"\u041c\u0430\u043a\u0441\u0438\u043c \u0418\u043b\u044c\u0438\u043d","email":"negamaxi@gmail.com"}],"dependencies":{"@hapi/ammo":"^3.1.2","@hapi/boom":"^7.4.3","@hapi/content":"^4.1.0","@hapi/hapi":"^18.4.0","@hapi/joi":"^15.1.0","abort-controller":"^3.0.0","any-signal":"^1.1.0","array-shuffle":"^1.0.1","bignumber.js":"^9.0.0","bl":"^4.0.2","bs58":"^4.0.1","buffer":"^5.6.0","byteman":"^1.3.5","cid-tool":"^0.4.0","cids":"^0.8.3","class-is":"^1.1.0","dag-cbor-links":"^1.3.3","datastore-core":"^1.1.0","datastore-pubsub":"^0.3.2","debug":"^4.1.0","dlv":"^1.1.3","err-code":"^2.0.0","file-type":"^14.1.4","fnv1a":"^1.0.1","get-folder-size":"^2.0.0","hamt-sharding":"^1.0.0","hapi-pino":"^6.1.0","hashlru":"^2.3.0","interface-datastore":"^1.0.2","ipfs-bitswap":"^2.0.1","ipfs-block-service":"^0.17.1","ipfs-core-utils":"^0.3.0","ipfs-http-client":"^45.0.0","ipfs-http-response":"^0.5.0","ipfs-repo":"^4.0.0","ipfs-unixfs":"^1.0.3","ipfs-unixfs-exporter":"^2.0.2","ipfs-unixfs-importer":"^2.0.2","ipfs-utils":"^2.2.2","ipld":"^0.26.2","ipld-bitcoin":"^0.3.0","ipld-block":"^0.9.1","ipld-dag-cbor":"^0.15.2","ipld-dag-pb":"^0.18.5","ipld-ethereum":"^4.0.0","ipld-git":"^0.5.0","ipld-raw":"^5.0.0","ipld-zcash":"^0.4.0","ipns":"^0.7.1","is-domain-name":"^1.0.1","is-ipfs":"^1.0.3","iso-url":"^0.4.7","it-all":"^1.0.1","it-concat":"^1.0.0","it-drain":"^1.0.1","it-first":"^1.0.1","it-glob":"0.0.8","it-last":"^1.0.1","it-map":"^1.0.0","it-multipart":"^1.0.1","it-pipe":"^1.1.0","it-tar":"^1.2.2","it-to-stream":"^0.1.1","iterable-ndjson":"^1.1.0","jsondiffpatch":"^0.4.1","just-safe-set":"^2.1.0","libp2p":"^0.28.5","libp2p-bootstrap":"^0.11.0","libp2p-crypto":"^0.17.8","libp2p-delegated-content-routing":"^0.5.0","libp2p-delegated-peer-routing":"^0.5.0","libp2p-floodsub":"^0.21.0","libp2p-gossipsub":"^0.4.0","libp2p-kad-dht":"^0.19.9","libp2p-mdns":"^0.14.1","libp2p-mplex":"^0.9.5","libp2p-noise":"^1.1.1","libp2p-record":"^0.7.3","libp2p-secio":"^0.12.6","libp2p-tcp":"^0.14.5","libp2p-webrtc-star":"^0.18.0","libp2p-websockets":"^0.13.3","mafmt":"^7.0.0","merge-options":"^2.0.0","mortice":"^2.0.0","multiaddr":"^7.4.3","multiaddr-to-uri":"^5.1.0","multibase":"^1.0.1","multicodec":"^1.0.0","multihashing-async":"^1.0.0","p-defer":"^3.0.0","p-queue":"^6.1.0","parse-duration":"^0.4.4","peer-id":"^0.13.12","pretty-bytes":"^5.3.0","progress":"^2.0.1","prom-client":"^12.0.0","prometheus-gc-stats":"^0.6.0","protons":"^1.2.0","semver":"^7.3.2","stream-to-it":"^0.2.1","streaming-iterables":"^5.0.0","temp":"^0.9.0","timeout-abort-controller":"^1.1.0","update-notifier":"^4.0.0","uri-to-multiaddr":"^3.0.2","varint":"^5.0.0","yargs":"^15.1.0","yargs-promise":"^1.1.0"},"deprecated":false,"description":"JavaScript implementation of the IPFS specification","devDependencies":{"aegir":"^23.0.0","base64url":"^3.0.1","clear-module":"^4.0.0","cross-env":"^7.0.0","delay":"^4.3.0","execa":"^4.0.0","form-data":"^3.0.0","go-ipfs":"^0.6.0","interface-ipfs-core":"^0.138.0","ipfs-interop":"^2.0.0","ipfsd-ctl":"^5.0.0","iso-random-stream":"^1.1.1","it-to-buffer":"^1.0.0","nanoid":"^3.0.2","ncp":"^2.0.0","p-event":"^4.1.0","p-map":"^4.0.0","qs":"^6.9.3","rimraf":"^3.0.0","sinon":"^9.0.1","stream-to-promise":"^3.0.0","string-argv":"^0.3.1","temp-write":"^4.0.0","wrtc":"^0.4.4"},"engines":{"node":">=10.0.0","npm":">=6.0.0"},"files":["src","dist"],"gitHead":"93adb1f6efeb033693a47d3f8f654cfcd7a717b4","homepage":"https://github.com/ipfs/js-ipfs/tree/master/packages/ipfs#readme","keywords":["IPFS"],"leadMaintainer":"Alex Potsides <alex@achingbrain.net>","license":"(Apache-2.0 OR MIT)","main":"src/core/index.js","name":"ipfs","optionalDependencies":{"prom-client":"^12.0.0","prometheus-gc-stats":"^0.6.0"},"repository":{"type":"git","url":"git+https://github.com/ipfs/js-ipfs.git"},"scripts":{"build":"aegir build","clean":"rm -rf ./dist","coverage":"nyc --reporter=text --reporter=lcov npm run test:node","dep-check":"aegir dep-check","lint":"aegir lint","test":"aegir test","test:bootstrapers":"IPFS_TEST=bootstrapers aegir test -t browser -f test/bootstrapers.js","test:browser":"aegir test -t browser","test:browser:http":"aegir test -t browser -f test/http-api/index.js","test:cli":"aegir test -t node -f test/cli/index.js","test:electron":"aegir test -t electron-main  -t electron-renderer","test:electron-main":"aegir test -t electron-main","test:electron-renderer":"aegir test -t electron-renderer","test:external":"aegir test-dependant","test:interface":"aegir test -f test/core/interface.spec.js","test:interface:http":"aegir test -f test/http-api/interface.js","test:interop":"cross-env IPFS_JS_EXEC=$PWD/src/cli/bin.js IPFS_JS_MODULE=$PWD IPFS_JS_HTTP_MODULE=$PWD/../ipfs-http-client IPFS_REUSEPORT=false ipfs-interop","test:interop:browser":"cross-env IPFS_JS_EXEC=$PWD/src/cli/bin.js IPFS_JS_MODULE=$PWD IPFS_JS_HTTP_MODULE=$PWD/../ipfs-http-client IPFS_REUSEPORT=false ipfs-interop -- -t browser","test:interop:electron-main":"cross-env IPFS_JS_EXEC=$PWD/src/cli/bin.js IPFS_JS_MODULE=$PWD IPFS_JS_HTTP_MODULE=$PWD/../ipfs-http-client IPFS_REUSEPORT=false ipfs-interop -- -t electron-main -f ./test/node.js","test:interop:electron-renderer":"cross-env IPFS_JS_EXEC=$PWD/src/cli/bin.js IPFS_JS_MODULE=$PWD IPFS_JS_HTTP_MODULE=$PWD/../ipfs-http-client IPFS_REUSEPORT=false ipfs-interop -- -t electron-renderer -f ./test/browser.js","test:interop:node":"cross-env IPFS_JS_EXEC=$PWD/src/cli/bin.js IPFS_JS_MODULE=$PWD IPFS_JS_HTTP_MODULE=$PWD/../ipfs-http-client IPFS_REUSEPORT=false ipfs-interop -- -t node","test:node":"aegir test -t node","test:node:core":"aegir test -t node -f test/core/**/*.js","test:node:gateway":"aegir test -t node -f test/gateway/index.js","test:node:http":"aegir test -t node -f test/http-api/index.js","test:webworker":"aegir test -t webworker"},"version":"0.48.1"}')},function(e,t,r){"use strict";var n=r(5),i=r(28),a=r(27),s=r(29),o=r(110),u=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="NonReversibleMigrationError",r.code="ERR_NON_REVERSIBLE_MIGRATION",r.message=e,r}return s(t,e),t}(o(Error));u.code="ERR_NON_REVERSIBLE_MIGRATION",t.NonReversibleMigrationError=u;var c=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="NotInitializedRepoError",r.code="ERR_NOT_INITIALIZED_REPO",r.message=e,r}return s(t,e),t}(o(Error));c.code="ERR_NOT_INITIALIZED_REPO",t.NotInitializedRepoError=c;var f=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="RequiredParameterError",r.code="ERR_REQUIRED_PARAMETER",r.message=e,r}return s(t,e),t}(o(Error));f.code="ERR_REQUIRED_PARAMETER",t.RequiredParameterError=f;var h=function(e){function t(e){var r;return n(this,t),(r=i(this,a(t).call(this,e))).name="InvalidValueError",r.code="ERR_INVALID_VALUE",r.message=e,r}return s(t,e),t}(o(Error));h.code="ERR_INVALID_VALUE",t.InvalidValueError=h},function(e,t,r){"use strict";var n=r(57).Key,i=r(32),a=r(150),s=r(15);t.cidToKey=function(e){if(!i.isCID(e))throw s(new Error("Not a valid cid"),"ERR_INVALID_CID");return new n("/"+a.encode("base32",e.multihash).toString().slice(1).toUpperCase(),!1)},t.keyToCid=function(e){return new i(1,"raw",a.decode("b"+e.toString().slice(1).toLowerCase()))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2013),s=r(19)("ipfs:repo:lock"),o={};t.lock=function(){var e=i(n.mark((function e(t){var r,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s("locking %s",r=t+"/repo.lock"),!0!==o[r]){e.next=4;break}throw new a.LockExistsError("Lock already being held for file: ".concat(r));case 4:return o[r]=!0,u={close:function(){return i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o[r]&&delete o[r];case 1:case"end":return e.stop()}}),e)})))()}},e.abrupt("return",u);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.locked=function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s("checking lock: ".concat(r=t+"/repo.lock")),e.abrupt("return",Boolean(o[r]));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(55).createFromPrivKey,u=r(15),c=r(19),f=c("ipfs:ipns");f.error=c("ipfs:ipns:error");var h=r(2200),l=r(2201),p=r(2202),d=r(1948).normalizePath,v=r(2048),y=function(){function e(t,r,n,i,s){a(this,e),this.publisher=new h(t,r),this.republisher=new l(this.publisher,r,n,i,s),this.resolver=new p(t),this.cache=new v(1e3),this.routing=t}return s(e,[{key:"publish",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,u,c,l=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=l.length>2&&void 0!==l[2]?l[2]:h.defaultRecordLifetime,e.prev=1,r=d(r),e.next=5,o(t.bytes);case 5:return a=e.sent,e.next=8,this.publisher.publishWithEOL(t,r,i);case 8:return f("IPNS value ".concat(r," was published correctly")),s=a.toB58String(),u=parseFloat(i),c=u<6e4?u:6e4,this.cache.set(s,r,c),f("IPNS value ".concat(r," was cached correctly")),e.abrupt("return",{name:s,value:r});case 17:throw e.prev=17,e.t0=e.catch(1),f.error(e.t0),e.t0;case 21:case"end":return e.stop()}}),e,this,[[1,17]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"resolve",value:function(){var e=i(n.mark((function e(t,r){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t){e.next=2;break}throw u(new Error("name received is not valid"),"ERR_INVALID_NAME");case 2:if((r=r||{}).nocache||r.recursive){e.next=8;break}if(i=t.split("/")[2],!(a=this.cache.get(i))){e.next=8;break}return e.abrupt("return",a);case 8:return e.prev=8,e.next=11,this.resolver.resolve(t,r);case 11:return s=e.sent,f("IPNS record from ".concat(t," was resolved correctly")),e.abrupt("return",s);case 16:throw e.prev=16,e.t0=e.catch(8),f.error(e.t0),e.t0;case 20:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"initializeKeyspace",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.publish(t,r,h.defaultRecordLifetime));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}();e.exports=y},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(57).Key,u=r(191).Record,c=r(3).Buffer,f=r(2058).encodeBase32,h=r(15),l=r(19),p=l("ipfs:ipns:offline-datastore");p.error=l("ipfs:ipns:offline-datastore:error");var d=function(){function e(t){a(this,e),this._repo=t}return s(e,[{key:"put",value:function(){var e=i(n.mark((function e(t,r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isBuffer(t)){e.next=2;break}throw h(new Error("Offline datastore key must be a buffer"),"ERR_INVALID_KEY");case 2:if(c.isBuffer(r)){e.next=4;break}throw h(new Error("Offline datastore value must be a buffer"),"ERR_INVALID_VALUE");case 4:e.prev=4,i=this._routingKey(t),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(4),p.error(e.t0),h(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY");case 12:return a=new u(t,r),e.abrupt("return",this._repo.datastore.put(i,a.serialize()));case 14:case"end":return e.stop()}}),e,this,[[4,8]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isBuffer(t)){e.next=2;break}throw h(new Error("Offline datastore key must be a buffer"),"ERR_INVALID_KEY");case 2:e.prev=2,r=this._routingKey(t),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(2),p.error(e.t0),h(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY");case 10:return e.next=12,this._repo.datastore.get(r);case 12:i=e.sent,e.prev=13,a=u.deserialize(i),e.next=21;break;case 17:throw e.prev=17,e.t1=e.catch(13),p.error(e.t1),e.t1;case 21:return e.abrupt("return",a.value);case 22:case"end":return e.stop()}}),e,this,[[2,6],[13,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_routingKey",value:function(e){return new o("/"+f(e),!1)}}]),e}();e.exports=d},function(e,t,r){"use strict";var n=r(150),i=r(224);e.exports={encodeBase32:function(e){return n.encode("base32",e).slice(1).toString().toUpperCase()},validator:{func:function(e,t,r){return i.validator.validate(t,e,r)}},selector:function(e,t){return i.validator.select(t[0],t[1])}}},function(e,t,r){"use strict";var n=r(48),i=r(1),a=r(5),s=r(7),o=r(28),u=r(87),c=r(27),f=r(127),h=r(29),l=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),p=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&l(t,e,r);return p(t,e),t},v=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function o(e){try{u(n.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))},y=r(2014),b=r(2225),m=r(2061),g=d(r(2017)),k=r(2227),w=r(2062),x=r(2018),S=r(800),E=function(e){function t(e,r){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};a(this,t);var s=[g.GossipsubID],f=Object.assign({gossipIncoming:!0,fallbackToFloodsub:!0},i);return f.fallbackToFloodsub&&s.push(g.FloodSubID),(n=o(this,c(t).call(this,{debugName:"libp2p:gossipsub",multicodecs:s,peerId:e,registrar:r,options:f}))).seenCache=new S,n.mesh=new Map,n.fanout=new Map,n.lastpub=new Map,n.gossip=new Map,n.control=new Map,n._msgIdFn=i.msgIdFn||n.defaultMsgIdFn,n.messageCache=i.messageCache||new b.MessageCache(g.GossipsubHistoryGossip,g.GossipsubHistoryLength,n._msgIdFn),n.heartbeat=new k.Heartbeat(u(n)),n}return h(t,e),s(t,[{key:"_removePeer",value:function(e){f(c(t.prototype),"_removePeer",this).call(this,e);var r=!0,n=!1,i=void 0;try{for(var a,s=this.mesh.values()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){a.value.delete(e)}}catch(d){n=!0,i=d}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}var o=!0,u=!1,h=void 0;try{for(var l,p=this.fanout.values()[Symbol.iterator]();!(o=(l=p.next()).done);o=!0){l.value.delete(e)}}catch(d){u=!0,h=d}finally{try{o||null==p.return||p.return()}finally{if(u)throw h}}return this.gossip.delete(e),this.control.delete(e),e}},{key:"_processRpc",value:function(e,r,n){f(c(t.prototype),"_processRpc",this).call(this,e,r,n),n.control&&this._processRpcControlMessage(r,n.control)}},{key:"_processRpcControlMessage",value:function(e,t){if(t){var r=this._handleIHave(e,t.ihave),n=this._handleIWant(e,t.iwant),i=this._handleGraft(e,t.graft);if(this._handlePrune(e,t.prune),r&&n&&i){var a=x.createGossipRpc(n,{iwant:[r],prune:i});this._sendRpc(e,a)}}}},{key:"_processRpcMessage",value:function(e,r){var n=this,i=this.getMsgId(r);if(!this.seenCache.has(i)){this.seenCache.put(i),f(c(t.prototype),"_processRpcMessage",this).call(this,e,r);var a=r.topicIDs;this._options.gossipIncoming&&(this.peers.forEach((function(e){e.protocols.includes(g.FloodSubID)&&e.id.toB58String()!==r.from&&y.utils.anyMatch(e.topics,a)&&e.isWritable&&(e.sendMessages(y.utils.normalizeOutRpcMessages([r])),n.log("publish msg on topics - floodsub",a,e.id.toB58String()))})),a.forEach((function(e){var t=n.mesh.get(e);t&&t.forEach((function(t){t.isWritable&&t.id.toB58String()!==r.from&&(t.sendMessages(y.utils.normalizeOutRpcMessages([r])),n.log("publish msg on topic - meshsub",e,t.id.toB58String()))}))})))}}},{key:"_handleIHave",value:function(e,t){var r=this,n=new Set;if(t.forEach((function(e){var t=e.topicID,i=e.messageIDs;t&&r.mesh.has(t)&&i.forEach((function(e){r.seenCache.has(e)||n.add(e)}))})),n.size)return this.log("IHAVE: Asking for %d messages from %s",n.size,e.id.toB58String()),{messageIDs:Array.from(n)}}},{key:"_handleIWant",value:function(e,t){var r=this,n=new Map;if(t.forEach((function(e){e.messageIDs.forEach((function(e){var t=r.messageCache.get(e);t&&n.set(e,t)}))})),n.size)return this.log("IWANT: Sending %d messages to %s",n.size,e.id.toB58String()),Array.from(n.values())}},{key:"_handleGraft",value:function(e,t){var r=this,n=[];if(t.forEach((function(t){var i=t.topicID;if(i){var a=r.mesh.get(i);a?(r.log("GRAFT: Add mesh link from %s in %s",e.id.toB58String(),i),a.add(e),e.topics.add(i),r.mesh.set(i,a)):n.push(i)}})),n.length){return n.map((function(e){return{topicID:e}}))}}},{key:"_handlePrune",value:function(e,t){var r=this;t.forEach((function(t){var n=t.topicID;if(n){var i=r.mesh.get(n);i&&(r.log("PRUNE: Remove mesh link to %s in %s",e.id.toB58String(),n),i.delete(e),e.topics.delete(n))}}))}},{key:"start",value:function(){var e=this,r=Object.create(null,{start:{get:function(){return f(c(t.prototype),"start",e)}}});return v(this,void 0,void 0,i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.start.call(this);case 2:this.heartbeat.start();case 3:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){var e=this,r=Object.create(null,{stop:{get:function(){return f(c(t.prototype),"stop",e)}}});return v(this,void 0,void 0,i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.stop.call(this);case 2:this.heartbeat.stop(),this.mesh=new Map,this.fanout=new Map,this.lastpub=new Map,this.gossip=new Map,this.control=new Map;case 8:case"end":return e.stop()}}),e,this)})))}},{key:"_subscribe",value:function(e){f(c(t.prototype),"_subscribe",this).call(this,e),this.join(e)}},{key:"_unsubscribe",value:function(e){f(c(t.prototype),"_unsubscribe",this).call(this,e),this.leave(e)}},{key:"join",value:function(e){var t=this;if(!this.started)throw new Error("Gossipsub has not started");e=y.utils.ensureArray(e),this.log("JOIN %s",e),e.forEach((function(e){var r=t.fanout.get(e);if(r)t.mesh.set(e,r),t.fanout.delete(e),t.lastpub.delete(e);else{var n=w.getGossipPeers(t,e,g.GossipsubD);t.mesh.set(e,n)}t.mesh.get(e).forEach((function(r){t.log("JOIN: Add mesh link to %s in %s",r.id.toB58String(),e),t._sendGraft(r,e)}))}))}},{key:"leave",value:function(e){var t=this;e=y.utils.ensureArray(e),this.log("LEAVE %s",e),e.forEach((function(e){var r=t.mesh.get(e);r&&(r.forEach((function(r){t.log("LEAVE: Remove mesh link to %s in %s",r.id.toB58String(),e),t._sendPrune(r,e)})),t.mesh.delete(e))}))}},{key:"getMsgId",value:function(e){return this._msgIdFn(e)}},{key:"_publish",value:function(e){var t=this;e.forEach((function(e){var r=t.getMsgId(e);t.seenCache.put(r),t.messageCache.put(e);var n=new Set;e.topicIDs.forEach((function(e){var r=t.topics.get(e);if(r){r.forEach((function(e){e.protocols.includes(g.FloodSubID)&&n.add(e)}));var i=t.mesh.get(e);if(!i||!i.size){if(!(i=t.fanout.get(e))){var a=w.getGossipPeers(t,e,g.GossipsubD);a.size>0?(i=a,t.fanout.set(e,a)):i=new Set}t.lastpub.set(e,t._now())}i.forEach((function(e){n.add(e)}))}})),n.forEach((function(r){r.id.toB58String()!==e.from&&t._sendRpc(r,x.createGossipRpc([y.utils.normalizeOutRpcMessage(e)]))}))}))}},{key:"_sendGraft",value:function(e,t){var r=[{topicID:t}],n=x.createGossipRpc([],{graft:r});this._sendRpc(e,n)}},{key:"_sendPrune",value:function(e,t){var r=[{topicID:t}],n=x.createGossipRpc([],{prune:r});this._sendRpc(e,n)}},{key:"_sendRpc",value:function(e,t){if(e&&e.isWritable){var r=this.control.get(e);r&&(this._piggybackControl(e,t,r),this.control.delete(e));var n=this.gossip.get(e);n&&(this._piggybackGossip(e,t,n),this.gossip.delete(e)),e.write(m.RPCCodec.encode(t))}}},{key:"_piggybackControl",value:function(e,t,r){var n=this,i=(r.graft||[]).filter((function(t){var r=t.topicID;return(r&&n.mesh.get(r)||new Set).has(e)})),a=(r.prune||[]).filter((function(t){var r=t.topicID;return!(r&&n.mesh.get(r)||new Set).has(e)}));(i.length||a.length)&&(t.control?(t.control.graft=t.control.graft.concat(i),t.control.prune=t.control.prune.concat(a)):t.control={ihave:[],iwant:[],graft:i,prune:a})}},{key:"_piggybackGossip",value:function(e,t,r){t.control||(t.control={ihave:[],iwant:[],graft:[],prune:[]}),t.control.ihave=r}},{key:"_sendGraftPrune",value:function(e,t){var r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=n(s.value,2),c=u[0],f=u[1].map((function(e){return{topicID:e}})),h=[],l=t.get(c);l&&(h=l.map((function(e){return{topicID:e}})),t.delete(c));var p=x.createGossipRpc([],{graft:f,prune:h});this._sendRpc(c,p)}}catch(E){i=!0,a=E}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}var d=!0,v=!1,y=void 0;try{for(var b,m=t[Symbol.iterator]();!(d=(b=m.next()).done);d=!0){var g=n(b.value,2),k=g[0],w=g[1].map((function(e){return{topicID:e}})),S=x.createGossipRpc([],{prune:w});this._sendRpc(k,S)}}catch(E){v=!0,y=E}finally{try{d||null==m.return||m.return()}finally{if(v)throw y}}}},{key:"_emitGossip",value:function(e,t){var r=this,n=this.messageCache.getGossipIDs(e);n.length&&w.getGossipPeers(this,e,g.GossipsubD).forEach((function(i){t.has(i)||r._pushGossip(i,{topicID:e,messageIDs:n})}))}},{key:"_flush",value:function(){var e=!0,t=!1,r=void 0;try{for(var i,a=this.gossip.entries()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var s=n(i.value,2),o=s[0],u=s[1];this.gossip.delete(o);var c=x.createGossipRpc([],{ihave:u});this._sendRpc(o,c)}}catch(g){t=!0,r=g}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}var f=!0,h=!1,l=void 0;try{for(var p,d=this.control.entries()[Symbol.iterator]();!(f=(p=d.next()).done);f=!0){var v=n(p.value,2),y=v[0],b=v[1];this.control.delete(y);var m=x.createGossipRpc([],{graft:b.graft,prune:b.prune});this._sendRpc(y,m)}}catch(g){h=!0,l=g}finally{try{f||null==d.return||d.return()}finally{if(h)throw l}}}},{key:"_pushGossip",value:function(e,t){this.log("Add gossip to %s",e.id.toB58String());var r=this.gossip.get(e)||[];this.gossip.set(e,r.concat(t))}},{key:"_now",value:function(){return Date.now()}}]),t}(r(2230));E.multicodec=g.GossipsubID,e.exports=E},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(63),s=function(){},o=function(){function e(t){var r=t.min,i=void 0===r?0:r,a=t.max,o=void 0===a?1/0:a,u=t.handlers,c=void 0===u?{}:u;n(this,e),this.min=i,this.max=o,this._onConnect=c.onConnect||s,this._onDisconnect=c.onDisconnect||s,this.peers=new Set}return i(e,[{key:"disconnect",value:function(e){this._onDisconnect(e)}},{key:"registrar",set:function(e){this._registrar=e}}]),e}();e.exports=a(o,{className:"Topology",symbolName:"@libp2p/js-interfaces/topology"})},function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RPCCodec=void 0;var i=n(r(2226)),a=r(73)(i.default);t.RPCCodec=a.RPC},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.getGossipPeers=void 0;var s=a(r(2017)),o=r(2018);t.getGossipPeers=function(e,t,r){var n=e.topics.get(t);if(!n)return new Set;var i=[];return n.forEach((function(e){e.protocols.includes(s.GossipsubID)&&i.push(e)})),i=o.shuffle(i),r>0&&i.length>r&&(i=i.slice(0,r)),new Set(i)}},function(e,t,r){"use strict";var n=r(55),i=r(72),a=r(15),s=r(1954).codes;e.exports=function(e){var t;if("string"===typeof e&&(e=i(e)),i.isMultiaddr(e)){t=e;try{e=n.createFromB58String(e.getPeerId())}catch(r){throw a(new Error("".concat(e," is not a valid peer type")),s.ERR_INVALID_MULTIADDR)}}return{id:e,multiaddrs:t?[t]:void 0}}},function(e,t,r){"use strict";var n=r(68),i=r(1),a=r(48),s=r(2),o=r(46),u=r(5),c=r(7),f=r(802),h=r(1954).codes,l=r(15),p=r(19),d=p("libp2p:transports");d.error=p("libp2p:transports:error");var v=function(){function e(t){var r=t.libp2p,n=t.upgrader,i=t.faultTolerance,a=void 0===i?y.FATAL_ALL:i;u(this,e),this.libp2p=r,this.upgrader=n,this._transports=new Map,this._listeners=new Map,this.faultTolerance=a}return c(e,[{key:"add",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(d("adding %s",e),!e)throw l(new Error("Transport must have a valid key, was given '".concat(e,"'")),h.ERR_INVALID_KEY);if(this._transports.has(e))throw l(new Error("There is already a transport with this key"),h.ERR_DUPLICATE_TRANSPORT);var n=new t(o({},r,{libp2p:this.libp2p,upgrader:this.upgrader}));this._transports.set(e,n),this._listeners.has(e)||this._listeners.set(e,[])}},{key:"close",value:function(){var e=s(i.mark((function e(){var t,r,n,s,o,u,c,f,h,l,p,v,y,b,m,g;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],r=!0,n=!1,s=void 0,e.prev=4,o=this._listeners[Symbol.iterator]();!(r=(u=o.next()).done);r=!0)for(c=a(u.value,2),f=c[0],h=c[1],d("closing listeners for %s",f);h.length;)l=h.pop(),t.push(l.close());e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),n=!0,s=e.t0;case 12:e.prev=12,e.prev=13,r||null==o.return||o.return();case 15:if(e.prev=15,!n){e.next=18;break}throw s;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.next=22,Promise.all(t);case 22:for(d("all listeners closed"),p=!0,v=!1,y=void 0,e.prev=26,b=this._listeners.keys()[Symbol.iterator]();!(p=(m=b.next()).done);p=!0)g=m.value,this._listeners.set(g,[]);e.next=34;break;case 30:e.prev=30,e.t1=e.catch(26),v=!0,y=e.t1;case 34:e.prev=34,e.prev=35,p||null==b.return||b.return();case 37:if(e.prev=37,!v){e.next=40;break}throw y;case 40:return e.finish(37);case 41:return e.finish(34);case 42:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19],[26,30,34,42],[35,,37,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"dial",value:function(){var e=s(i.mark((function e(t,r){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.transportForMultiaddr(t)){e.next=3;break}throw l(new Error("No transport available for address ".concat(String(t))),h.ERR_TRANSPORT_UNAVAILABLE);case 3:return e.prev=3,e.next=6,n.dial(t,r);case 6:return e.abrupt("return",e.sent);case 9:throw e.prev=9,e.t0=e.catch(3),e.t0.code||(e.t0.code=h.ERR_TRANSPORT_DIAL_FAILED),e.t0;case 13:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getAddrs",value:function(){var e=[],t=!0,r=!1,i=void 0;try{for(var a,s=this._listeners.values()[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=a.value,u=!0,c=!1,f=void 0;try{for(var h,l=o[Symbol.iterator]();!(u=(h=l.next()).done);u=!0){var p=h.value;e=[].concat(n(e),n(p.getAddrs()))}}catch(d){c=!0,f=d}finally{try{u||null==l.return||l.return()}finally{if(c)throw f}}}}catch(d){r=!0,i=d}finally{try{t||null==s.return||s.return()}finally{if(r)throw i}}return e}},{key:"getTransports",value:function(){return this._transports.values()}},{key:"transportForMultiaddr",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=this._transports.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;if(s.filter([e]).length)return s}}catch(o){r=!0,n=o}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}return null}},{key:"listen",value:function(){var e=s(i.mark((function e(){var t,r,n,s,o,u,c,p,v,b,m,g,k,w,x,S,E,_,I,A,T;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=this.libp2p.addressManager.getListenAddrs()).length){e.next=4;break}return d("no addresses were provided for listening, this node is dial only"),e.abrupt("return");case 4:r=[],n=!0,s=!1,o=void 0,e.prev=8,u=this._transports.entries()[Symbol.iterator]();case 10:if(n=(c=u.next()).done){e.next=45;break}for(p=a(c.value,2),v=p[0],b=p[1],m=b.filter(t),g=[],k=!0,w=!1,x=void 0,e.prev=17,S=m[Symbol.iterator]();!(k=(E=S.next()).done);k=!0)_=E.value,d("creating listener for %s on %s",v,_),I=b.createListener({},this.onConnection),this._listeners.get(v).push(I),g.push(I.listen(_));e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),w=!0,x=e.t0;case 25:e.prev=25,e.prev=26,k||null==S.return||S.return();case 28:if(e.prev=28,!w){e.next=31;break}throw x;case 31:return e.finish(28);case 32:return e.finish(25);case 33:if(0!==g.length){e.next=36;break}return r.push(v),e.abrupt("continue",42);case 36:return e.next=38,f(g);case 38:if(A=e.sent,A.find((function(e){return!0===e.isFulfilled}))){e.next=42;break}throw l(new Error("Transport (".concat(v,") could not listen on any available address")),h.ERR_NO_VALID_ADDRESSES);case 42:n=!0,e.next=10;break;case 45:e.next=51;break;case 47:e.prev=47,e.t1=e.catch(8),s=!0,o=e.t1;case 51:e.prev=51,e.prev=52,n||null==u.return||u.return();case 54:if(e.prev=54,!s){e.next=57;break}throw o;case 57:return e.finish(54);case 58:return e.finish(51);case 59:if(r.length!==this._transports.size){e.next=64;break}if(T="no valid addresses were provided for transports [".concat(r,"]"),this.faultTolerance!==y.FATAL_ALL){e.next=63;break}throw l(new Error(T),h.ERR_NO_VALID_ADDRESSES);case 63:d("libp2p in dial mode only: ".concat(T));case 64:case"end":return e.stop()}}),e,this,[[8,47,51,59],[17,21,25,33],[26,,28,32],[52,,54,58]])})));return function(){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=s(i.mark((function e(t){var r,n,a,s,o,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d("removing %s",t),!this._listeners.has(t)){e.next=28;break}r=!0,n=!1,a=void 0,e.prev=5,s=this._listeners.get(t)[Symbol.iterator]();case 7:if(r=(o=s.next()).done){e.next=14;break}return u=o.value,e.next=11,u.close();case 11:r=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),n=!0,a=e.t0;case 20:e.prev=20,e.prev=21,r||null==s.return||s.return();case 23:if(e.prev=23,!n){e.next=26;break}throw a;case 26:return e.finish(23);case 27:return e.finish(20);case 28:this._transports.delete(t),this._listeners.delete(t);case 30:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeAll",value:function(){var e=s(i.mark((function e(){var t,r,n,a,s,o,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=[],r=!0,n=!1,a=void 0,e.prev=4,s=this._transports.keys()[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)u=o.value,t.push(this.remove(u));e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),n=!0,a=e.t0;case 12:e.prev=12,e.prev=13,r||null==s.return||s.return();case 15:if(e.prev=15,!n){e.next=18;break}throw a;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.next=22,Promise.all(t);case 22:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19]])})));return function(){return e.apply(this,arguments)}}()}]),e}(),y={FATAL_ALL:0,NO_FATAL:1};v.FaultTolerance=y,e.exports=v},function(e,t,r){"use strict";var n=r(72),i=r(1976).CircuitRelay;function a(e,t){e.write({type:i.Type.STATUS,code:t})}e.exports={validateAddrs:function(e,t){try{e.dstPeer.addrs.forEach((function(e){return n(e)}))}catch(r){throw a(t,e.type===i.Type.HOP?i.Status.HOP_DST_MULTIADDR_INVALID:i.Status.STOP_DST_MULTIADDR_INVALID),r}try{e.srcPeer.addrs.forEach((function(e){return n(e)}))}catch(r){throw a(t,e.type===i.Type.HOP?i.Status.HOP_SRC_MULTIADDR_INVALID:i.Status.STOP_SRC_MULTIADDR_INVALID),r}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1976).CircuitRelay,s=r(2020),o=r(2021),u=r(2065).validateAddrs,c=r(19),f=c("libp2p:circuit:stop");f.error=c("libp2p:circuit:stop:error"),e.exports.handleStop=function(e){var t=e.connection,r=e.request,n=e.streamHandler;try{u(r,n)}catch(i){return f.error("invalid stop request via peer %s",t.remotePeer.toB58String(),i)}return f("stop request is valid"),n.write({type:a.Type.STATUS,code:a.Status.SUCCESS}),n.rest()},e.exports.stop=function(){var e=i(n.mark((function e(t){var r,i,u,c,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,i=t.request,e.next=3,r.newStream([s.relay]);case 3:return u=e.sent,c=u.stream,f("starting stop request to %s",r.remotePeer.toB58String()),(h=new o({stream:c})).write(i),e.next=10,h.read();case 10:if((l=e.sent).code!==a.Status.SUCCESS){e.next=14;break}return f("stop request to %s was successful",r.remotePeer.toB58String()),e.abrupt("return",h.rest());case 14:f("stop request failed with code %d",l.code),h.close();case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(2068),i=r(2248),a=r(2252);t.aes=i,t.hmac=n,t.keys=a,t.randomBytes=r(2028),t.pbkdf2=r(2278)},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(2022),o=r(2247),u={SHA1:"SHA-1",SHA256:"SHA-256",SHA512:"SHA-512"},c=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=a,e.next=3,s.get().subtle.sign({name:"HMAC"},t,r);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.from.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();t.create=function(){var e=i(n.mark((function e(t,r){var a,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u[t],e.next=3,s.get().subtle.importKey("raw",r,{name:"HMAC",hash:{name:a}},!1,["sign"]);case 3:return f=e.sent,e.abrupt("return",{digest:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c(f,e));case 1:case"end":return t.stop()}}),t)})))()},length:o[t]});case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){var n=r(1949);r(1951),e.exports=n.cipher=n.cipher||{},n.cipher.algorithms=n.cipher.algorithms||{},n.cipher.createCipher=function(e,t){var r=e;if("string"===typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!1})},n.cipher.createDecipher=function(e,t){var r=e;if("string"===typeof r&&(r=n.cipher.getAlgorithm(r))&&(r=r()),!r)throw new Error("Unsupported algorithm: "+e);return new n.cipher.BlockCipher({algorithm:r,key:t,decrypt:!0})},n.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),n.cipher.algorithms[e]=t},n.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in n.cipher.algorithms?n.cipher.algorithms[e]:null};var i=n.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};i.prototype.start=function(e){e=e||{};var t={};for(var r in e)t[r]=e[r];t.decrypt=this._decrypt,this._finish=!1,this._input=n.util.createBuffer(),this.output=e.output||n.util.createBuffer(),this.mode.start(t)},i.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},i.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},function(e,t,r){var n=r(1949);r(1951),n.cipher=n.cipher||{};var i=e.exports=n.cipher.modes=n.cipher.modes||{};function a(e,t){if("string"===typeof e&&(e=n.util.createBuffer(e)),n.util.isArray(e)&&e.length>4){var r=e;e=n.util.createBuffer();for(var i=0;i<r.length;++i)e.putByte(r[i])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!n.util.isArray(e)){var a=[],s=t/4;for(i=0;i<s;++i)a.push(e.getInt32());e=a}return e}function s(e){e[e.length-1]=e[e.length-1]+1&4294967295}function o(e){return[e/4294967296|0,4294967295&e]}i.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.ecb.prototype.start=function(e){},i.ecb.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n])},i.ecb.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},i.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},i.cbc.prototype.encrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._outBlock[n]);this._prev=this._outBlock},i.cbc.prototype.decrypt=function(e,t,r){if(e.length()<this.blockSize&&!(r&&e.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(n=0;n<this._ints;++n)t.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)},i.cbc.prototype.pad=function(e,t){var r=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(r,r),!0},i.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var r=e.length(),n=e.at(r-1);return!(n>this.blockSize<<2)&&(e.truncate(n),!0)},i.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.cfb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.cfb.prototype.decrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ofb.prototype.encrypt=function(e,t,r){var n=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}},i.ofb.prototype.decrypt=i.ofb.prototype.encrypt,i.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0},i.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=a(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ctr.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]);else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}s(this._inBlock)},i.ctr.prototype.decrypt=i.ctr.prototype.encrypt,i.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=n.util.createBuffer(),this._partialBytes=0,this._R=3774873600},i.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,r=n.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?n.util.createBuffer(e.additionalData):n.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=n.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=r.length();if(12===i)this._j0=[r.getInt32(),r.getInt32(),r.getInt32(),1];else{for(this._j0=[0,0,0,0];r.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(o(8*i)))}this._inBlock=this._j0.slice(0),s(this._inBlock),this._partialBytes=0,t=n.util.createBuffer(t),this._aDataLength=o(8*t.length());var a=t.length()%this.blockSize;for(a&&t.fillWithByte(0,this.blockSize-a),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},i.gcm.prototype.encrypt=function(e,t,r){var n=e.length();if(0===n)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&n>=this.blockSize){for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^=e.getInt32());this._cipherLength+=this.blockSize}else{var a=(this.blockSize-n)%this.blockSize;a>0&&(a=this.blockSize-a),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(a<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),a>0&&!r)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(a-this._partialBytes)),this._partialBytes=a,!0;t.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),s(this._inBlock)},i.gcm.prototype.decrypt=function(e,t,r){var n=e.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),s(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize},i.gcm.prototype.afterFinish=function(e,t){var r=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=n.util.createBuffer();var i=this._aDataLength.concat(o(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var a=[];this.cipher.encrypt(this._j0,a);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^a[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r},i.gcm.prototype.multiply=function(e,t){for(var r=[0,0,0,0],n=t.slice(0),i=0;i<128;++i){e[i/32|0]&1<<31-i%32&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r},i.gcm.prototype.pow=function(e,t){for(var r=1&e[3],n=3;n>0;--n)t[n]=e[n]>>>1|(1&e[n-1])<<31;t[0]=e[0]>>>1,r&&(t[0]^=this._R)},i.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],r=0;r<32;++r){var n=e[r/8|0]>>>4*(7-r%8)&15,i=this._m[r][n];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},i.gcm.prototype.ghash=function(e,t,r){return t[0]^=r[0],t[1]^=r[1],t[2]^=r[2],t[3]^=r[3],this.tableMultiply(t)},i.gcm.prototype.generateHashTable=function(e,t){for(var r=8/t,n=4*r,i=16*r,a=new Array(i),s=0;s<i;++s){var o=[0,0,0,0],u=(n-1-s%n)*t;o[s/n|0]=1<<t-1<<u,a[s]=this.generateSubHashTable(this.multiply(o,e),t)}return a},i.gcm.prototype.generateSubHashTable=function(e,t){var r=1<<t,n=r>>>1,i=new Array(r);i[n]=e.slice(0);for(var a=n>>>1;a>0;)this.pow(i[2*a],i[a]=[]),a>>=1;for(a=2;a<n;){for(var s=1;s<a;++s){var o=i[a],u=i[s];i[a+s]=[o[0]^u[0],o[1]^u[1],o[2]^u[2],o[3]^u[3]]}a*=2}for(i[0]=[0,0,0,0],a=n+1;a<r;++a){var c=i[a^n];i[a]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return i}},function(e,t,r){var n=r(1949);if(r(1977),r(1960),r(2024),r(1962),r(1978),r(2072),r(2026),r(1963),r(2256),r(1988),r(1951),"undefined"===typeof i)var i=n.jsbn.BigInteger;var a=n.asn1,s=n.pki=n.pki||{};e.exports=s.pbe=n.pbe=n.pbe||{};var o=s.oids,u={name:"EncryptedPrivateKeyInfo",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},c={name:"PBES2Algorithms",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},f={name:"pkcs-12PbeParams",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function l(e){var t;if(e){if(!(t=s.oids[a.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return p(t)}function p(e){var t=n.md;switch(e){case"hmacWithSHA224":t=n.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}s.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var i,u,c,f=n.random.getBytesSync(r.saltSize),h=r.count,l=a.integerToDer(h);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var d,v,y;switch(r.algorithm){case"aes128":i=16,d=16,v=o["aes128-CBC"],y=n.aes.createEncryptionCipher;break;case"aes192":i=24,d=16,v=o["aes192-CBC"],y=n.aes.createEncryptionCipher;break;case"aes256":i=32,d=16,v=o["aes256-CBC"],y=n.aes.createEncryptionCipher;break;case"des":i=8,d=8,v=o.desCBC,y=n.des.createEncryptionCipher;break;default:throw(x=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,x}var b="hmacWith"+r.prfAlgorithm.toUpperCase(),m=p(b),g=n.pkcs5.pbkdf2(t,f,h,i,m),k=n.random.getBytesSync(d);(S=y(g)).start(k),S.update(a.toDer(e)),S.finish(),c=S.output.getBytes();var w=function(e,t,r,i){var o=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,e),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==i&&o.value.push(a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,n.util.hexToBytes(r.toString(16))),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(s.oids[i]).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]));return o}(f,l,i,b);u=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o.pkcs5PBES2).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o.pkcs5PBKDF2).getBytes()),w]),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(v).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,k)])])])}else{var x;if("3des"!==r.algorithm)throw(x=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,x;i=24;var S,E=new n.util.ByteBuffer(f);g=s.pbe.generatePkcs12Key(t,E,1,h,i),k=s.pbe.generatePkcs12Key(t,E,2,h,i);(S=n.des.createEncryptionCipher(g)).start(k),S.update(a.toDer(e)),S.finish(),c=S.output.getBytes(),u=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,f),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,l.getBytes())])])}return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[u,a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,c)])},s.decryptPrivateKeyInfo=function(e,t){var r=null,i={},o=[];if(!a.validate(e,u,i,o)){var c=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=o,c}var f=a.derToOid(i.encryptionOid),h=s.pbe.getCipher(f,i.encryptionParams,t),l=n.util.createBuffer(i.encryptedData);return h.update(l),h.finish()&&(r=a.fromDer(h.output)),r},s.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:a.toDer(e).getBytes()};return n.pem.encode(r,{maxline:t})},s.encryptedPrivateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return a.fromDer(t.body)},s.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var i=s.wrapRsaPrivateKey(s.privateKeyToAsn1(e));return i=s.encryptPrivateKeyInfo(i,t,r),s.encryptedPrivateKeyToPem(i)}var o,u,c,f;switch(r.algorithm){case"aes128":o="AES-128-CBC",c=16,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"aes192":o="AES-192-CBC",c=24,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"aes256":o="AES-256-CBC",c=32,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"3des":o="DES-EDE3-CBC",c=24,u=n.random.getBytesSync(8),f=n.des.createEncryptionCipher;break;case"des":o="DES-CBC",c=8,u=n.random.getBytesSync(8),f=n.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw h.algorithm=r.algorithm,h}var l=f(n.pbe.opensslDeriveBytes(t,u.substr(0,8),c));l.start(u),l.update(a.toDer(s.privateKeyToAsn1(e))),l.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:o,parameters:n.util.bytesToHex(u).toUpperCase()},body:l.output.getBytes()};return n.pem.encode(p)},s.decryptRsaPrivateKey=function(e,t){var r=null,i=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw(c=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=c,c;if(i.procType&&"ENCRYPTED"===i.procType.type){var o,u;switch(i.dekInfo.algorithm){case"DES-CBC":o=8,u=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":o=24,u=n.des.createDecryptionCipher;break;case"AES-128-CBC":o=16,u=n.aes.createDecryptionCipher;break;case"AES-192-CBC":o=24,u=n.aes.createDecryptionCipher;break;case"AES-256-CBC":o=32,u=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":o=5,u=function(e){return n.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":o=8,u=function(e){return n.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":o=16,u=function(e){return n.rc2.createDecryptionCipher(e,128)};break;default:var c;throw(c=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".')).algorithm=i.dekInfo.algorithm,c}var f=n.util.hexToBytes(i.dekInfo.parameters),h=u(n.pbe.opensslDeriveBytes(t,f.substr(0,8),o));if(h.start(f),h.update(n.util.createBuffer(i.body)),!h.finish())return r;r=h.output.getBytes()}else r=i.body;return null!==(r="ENCRYPTED PRIVATE KEY"===i.type?s.decryptPrivateKeyInfo(a.fromDer(r),t):a.fromDer(r))&&(r=s.privateKeyFromAsn1(r)),r},s.pbe.generatePkcs12Key=function(e,t,r,i,a,s){var o,u;if("undefined"===typeof s||null===s){if(!("sha1"in n.md))throw new Error('"sha1" hash algorithm unavailable.');s=n.md.sha1.create()}var c=s.digestLength,f=s.blockLength,h=new n.util.ByteBuffer,l=new n.util.ByteBuffer;if(null!==e&&void 0!==e){for(u=0;u<e.length;u++)l.putInt16(e.charCodeAt(u));l.putInt16(0)}var p=l.length(),d=t.length(),v=new n.util.ByteBuffer;v.fillWithByte(r,f);var y=f*Math.ceil(d/f),b=new n.util.ByteBuffer;for(u=0;u<y;u++)b.putByte(t.at(u%d));var m=f*Math.ceil(p/f),g=new n.util.ByteBuffer;for(u=0;u<m;u++)g.putByte(l.at(u%p));var k=b;k.putBuffer(g);for(var w=Math.ceil(a/c),x=1;x<=w;x++){var S=new n.util.ByteBuffer;S.putBytes(v.bytes()),S.putBytes(k.bytes());for(var E=0;E<i;E++)s.start(),s.update(S.getBytes()),S=s.digest();var _=new n.util.ByteBuffer;for(u=0;u<f;u++)_.putByte(S.at(u%c));var I=Math.ceil(d/f)+Math.ceil(p/f),A=new n.util.ByteBuffer;for(o=0;o<I;o++){var T=new n.util.ByteBuffer(k.getBytes(f)),C=511;for(u=_.length()-1;u>=0;u--)C>>=8,C+=_.at(u)+T.at(u),T.setAt(u,255&C);A.putBuffer(T)}k=A,h.putBuffer(S)}return h.truncate(h.length()-a),h},s.pbe.getCipher=function(e,t,r){switch(e){case s.oids.pkcs5PBES2:return s.pbe.getCipherForPBES2(e,t,r);case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case s.oids["pbewithSHAAnd40BitRC2-CBC"]:return s.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},s.pbe.getCipherForPBES2=function(e,t,r){var i,o={},u=[];if(!a.validate(t,c,o,u))throw(i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=u,i;if((e=a.derToOid(o.kdfOid))!==s.oids.pkcs5PBKDF2)throw(i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,i.supportedOids=["pkcs5PBKDF2"],i;if((e=a.derToOid(o.encOid))!==s.oids["aes128-CBC"]&&e!==s.oids["aes192-CBC"]&&e!==s.oids["aes256-CBC"]&&e!==s.oids["des-EDE3-CBC"]&&e!==s.oids.desCBC)throw(i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i;var f,h,p=o.kdfSalt,d=n.util.createBuffer(o.kdfIterationCount);switch(d=d.getInt(d.length()<<3),s.oids[e]){case"aes128-CBC":f=16,h=n.aes.createDecryptionCipher;break;case"aes192-CBC":f=24,h=n.aes.createDecryptionCipher;break;case"aes256-CBC":f=32,h=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":f=24,h=n.des.createDecryptionCipher;break;case"desCBC":f=8,h=n.des.createDecryptionCipher}var v=l(o.prfOid),y=n.pkcs5.pbkdf2(r,p,d,f,v),b=o.encIv,m=h(y);return m.start(b),m},s.pbe.getCipherForPKCS12PBE=function(e,t,r){var i={},o=[];if(!a.validate(t,f,i,o))throw(v=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=o,v;var u,c,h,p=n.util.createBuffer(i.salt),d=n.util.createBuffer(i.iterations);switch(d=d.getInt(d.length()<<3),e){case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:u=24,c=8,h=n.des.startDecrypting;break;case s.oids["pbewithSHAAnd40BitRC2-CBC"]:u=5,c=8,h=function(e,t){var r=n.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var v;throw(v=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,v}var y=l(i.prfOid),b=s.pbe.generatePkcs12Key(r,p,1,d,u,y);return y.start(),h(b,s.pbe.generatePkcs12Key(r,p,2,d,c,y))},s.pbe.opensslDeriveBytes=function(e,t,r,i){if("undefined"===typeof i||null===i){if(!("md5"in n.md))throw new Error('"md5" hash algorithm unavailable.');i=n.md.md5.create()}null===t&&(t="");for(var a=[h(i,e+t)],s=16,o=1;s<r;++o,s+=16)a.push(h(i,a[o-1]+e+t));return a.join("").substr(0,r)}},function(e,t,r){(function(t){var n=r(1949);r(2253),r(1962),r(1951);var i,a=n.pkcs5=n.pkcs5||{};n.util.isNodejs&&!n.options.usePureJavaScript&&(i=r(2025)),e.exports=n.pbkdf2=a.pbkdf2=function(e,r,a,s,o,u){if("function"===typeof o&&(u=o,o=null),n.util.isNodejs&&!n.options.usePureJavaScript&&i.pbkdf2&&(null===o||"object"!==typeof o)&&(i.pbkdf2Sync.length>4||!o||"sha1"===o))return"string"!==typeof o&&(o="sha1"),e=t.from(e,"binary"),r=t.from(r,"binary"),u?4===i.pbkdf2Sync.length?i.pbkdf2(e,r,a,s,(function(e,t){if(e)return u(e);u(null,t.toString("binary"))})):i.pbkdf2(e,r,a,s,o,(function(e,t){if(e)return u(e);u(null,t.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(e,r,a,s).toString("binary"):i.pbkdf2Sync(e,r,a,s,o).toString("binary");if("undefined"!==typeof o&&null!==o||(o="sha1"),"string"===typeof o){if(!(o in n.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=n.md[o].create()}var c=o.digestLength;if(s>4294967295*c){var f=new Error("Derived key is too long.");if(u)return u(f);throw f}var h=Math.ceil(s/c),l=s-(h-1)*c,p=n.hmac.create();p.start(o,e);var d,v,y,b="";if(!u){for(var m=1;m<=h;++m){p.start(null,null),p.update(r),p.update(n.util.int32ToBytes(m)),d=y=p.digest().getBytes();for(var g=2;g<=a;++g)p.start(null,null),p.update(y),v=p.digest().getBytes(),d=n.util.xorBytes(d,v,c),y=v;b+=m<h?d:d.substr(0,l)}return b}m=1;function k(){if(m>h)return u(null,b);p.start(null,null),p.update(r),p.update(n.util.int32ToBytes(m)),d=y=p.digest().getBytes(),g=2,w()}function w(){if(g<=a)return p.start(null,null),p.update(y),v=p.digest().getBytes(),d=n.util.xorBytes(d,v,c),y=v,++g,n.util.setImmediate(w);b+=m<h?d:d.substr(0,l),++m,k()}k()}}).call(this,r(3).Buffer)},function(e,t,r){var n=r(1949);r(1962),r(1951);var i=e.exports=n.sha512=n.sha512||{};n.md.sha512=n.md.algorithms.sha512=i;var a=n.sha384=n.sha512.sha384=n.sha512.sha384||{};a.create=function(){return i.create("SHA-384")},n.md.sha384=n.md.algorithms.sha384=a,n.sha512.sha256=n.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},n.md["sha512/256"]=n.md.algorithms["sha512/256"]=n.sha512.sha256,n.sha512.sha224=n.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},n.md["sha512/224"]=n.md.algorithms["sha512/224"]=n.sha512.sha224,i.create=function(e){if(o||(s=String.fromCharCode(128),s+=n.util.fillString(String.fromCharCode(0),128),u=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(c={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],c["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],c["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],c["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],o=!0),"undefined"===typeof e&&(e="SHA-512"),!(e in c))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=c[e],r=null,i=n.util.createBuffer(),a=new Array(80),h=0;h<80;++h)a[h]=new Array(2);var l=64;switch(e){case"SHA-384":l=48;break;case"SHA-512/256":l=32;break;case"SHA-512/224":l=28}var p={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:l,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){p.messageLength=0,p.fullMessageLength=p.messageLength128=[];for(var e=p.messageLengthSize/4,a=0;a<e;++a)p.fullMessageLength.push(0);i=n.util.createBuffer(),r=new Array(t.length);for(a=0;a<t.length;++a)r[a]=t[a].slice(0);return p}};return p.start(),p.update=function(e,t){"utf8"===t&&(e=n.util.encodeUtf8(e));var s=e.length;p.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var o=p.fullMessageLength.length-1;o>=0;--o)p.fullMessageLength[o]+=s[1],s[1]=s[0]+(p.fullMessageLength[o]/4294967296>>>0),p.fullMessageLength[o]=p.fullMessageLength[o]>>>0,s[0]=s[1]/4294967296>>>0;return i.putBytes(e),f(r,a,i),(i.read>2048||0===i.length())&&i.compact(),p},p.digest=function(){var t=n.util.createBuffer();t.putBytes(i.bytes());var o,u=p.fullMessageLength[p.fullMessageLength.length-1]+p.messageLengthSize&p.blockLength-1;t.putBytes(s.substr(0,p.blockLength-u));for(var c=8*p.fullMessageLength[0],h=0;h<p.fullMessageLength.length-1;++h)c+=(o=8*p.fullMessageLength[h+1])/4294967296>>>0,t.putInt32(c>>>0),c=o>>>0;t.putInt32(c);var l=new Array(r.length);for(h=0;h<r.length;++h)l[h]=r[h].slice(0);f(l,a,t);var d,v=n.util.createBuffer();d="SHA-512"===e?l.length:"SHA-384"===e?l.length-2:l.length-4;for(h=0;h<d;++h)v.putInt32(l[h][0]),h===d-1&&"SHA-512/224"===e||v.putInt32(l[h][1]);return v},p};var s=null,o=!1,u=null,c=null;function f(e,t,r){for(var n,i,a,s,o,c,f,h,l,p,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C,B,R,N,P,M,D,O,L=r.length();L>=128;){for(B=0;B<16;++B)t[B][0]=r.getInt32()>>>0,t[B][1]=r.getInt32()>>>0;for(;B<80;++B)n=(((R=(P=t[B-2])[0])>>>19|(N=P[1])<<13)^(N>>>29|R<<3)^R>>>6)>>>0,i=((R<<13|N>>>19)^(N<<3|R>>>29)^(R<<26|N>>>6))>>>0,a=(((R=(D=t[B-15])[0])>>>1|(N=D[1])<<31)^(R>>>8|N<<24)^R>>>7)>>>0,s=((R<<31|N>>>1)^(R<<24|N>>>8)^(R<<25|N>>>7))>>>0,M=t[B-7],O=t[B-16],N=i+M[1]+s+O[1],t[B][0]=n+M[0]+a+O[0]+(N/4294967296>>>0)>>>0,t[B][1]=N>>>0;for(d=e[0][0],v=e[0][1],y=e[1][0],b=e[1][1],m=e[2][0],g=e[2][1],k=e[3][0],w=e[3][1],x=e[4][0],S=e[4][1],E=e[5][0],_=e[5][1],I=e[6][0],A=e[6][1],T=e[7][0],C=e[7][1],B=0;B<80;++B)f=((x>>>14|S<<18)^(x>>>18|S<<14)^(S>>>9|x<<23))>>>0,h=(I^x&(E^I))>>>0,o=((d>>>28|v<<4)^(v>>>2|d<<30)^(v>>>7|d<<25))>>>0,c=((d<<4|v>>>28)^(v<<30|d>>>2)^(v<<25|d>>>7))>>>0,l=(d&y|m&(d^y))>>>0,p=(v&b|g&(v^b))>>>0,N=C+(((x<<18|S>>>14)^(x<<14|S>>>18)^(S<<23|x>>>9))>>>0)+((A^S&(_^A))>>>0)+u[B][1]+t[B][1],n=T+f+h+u[B][0]+t[B][0]+(N/4294967296>>>0)>>>0,i=N>>>0,a=o+l+((N=c+p)/4294967296>>>0)>>>0,s=N>>>0,T=I,C=A,I=E,A=_,E=x,_=S,x=k+n+((N=w+i)/4294967296>>>0)>>>0,S=N>>>0,k=m,w=g,m=y,g=b,y=d,b=v,d=n+a+((N=i+s)/4294967296>>>0)>>>0,v=N>>>0;N=e[0][1]+v,e[0][0]=e[0][0]+d+(N/4294967296>>>0)>>>0,e[0][1]=N>>>0,N=e[1][1]+b,e[1][0]=e[1][0]+y+(N/4294967296>>>0)>>>0,e[1][1]=N>>>0,N=e[2][1]+g,e[2][0]=e[2][0]+m+(N/4294967296>>>0)>>>0,e[2][1]=N>>>0,N=e[3][1]+w,e[3][0]=e[3][0]+k+(N/4294967296>>>0)>>>0,e[3][1]=N>>>0,N=e[4][1]+S,e[4][0]=e[4][0]+x+(N/4294967296>>>0)>>>0,e[4][1]=N>>>0,N=e[5][1]+_,e[5][0]=e[5][0]+E+(N/4294967296>>>0)>>>0,e[5][1]=N>>>0,N=e[6][1]+A,e[6][0]=e[6][0]+I+(N/4294967296>>>0)>>>0,e[6][1]=N>>>0,N=e[7][1]+C,e[7][0]=e[7][0]+T+(N/4294967296>>>0)>>>0,e[7][1]=N>>>0,L-=128}}},function(e,t,r){(function(t){var n=r(1949);r(1989),r(1963),r(2073),r(1951);var i=r(2269),a=i.publicKeyValidator,s=i.privateKeyValidator;if("undefined"===typeof o)var o=n.jsbn.BigInteger;var u=n.util.ByteBuffer,c="undefined"===typeof t?Uint8Array:t;n.pki=n.pki||{},e.exports=n.pki.ed25519=n.ed25519=n.ed25519||{};var f=n.ed25519;function h(e){var r=e.message;if(r instanceof Uint8Array||r instanceof c)return r;var n=e.encoding;if(void 0===r){if(!e.md)throw new TypeError('"options.message" or "options.md" not specified.');r=e.md.digest().getBytes(),n="binary"}if("string"===typeof r&&!n)throw new TypeError('"options.encoding" must be "binary" or "utf8".');if("string"===typeof r){if("undefined"!==typeof t)return t.from(r,n);r=new u(r,n)}else if(!(r instanceof u))throw new TypeError('"options.message" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a string with "options.encoding" specifying its encoding.');for(var i=new c(r.length()),a=0;a<i.length;++a)i[a]=r.at(a);return i}f.constants={},f.constants.PUBLIC_KEY_BYTE_LENGTH=32,f.constants.PRIVATE_KEY_BYTE_LENGTH=64,f.constants.SEED_BYTE_LENGTH=32,f.constants.SIGN_BYTE_LENGTH=64,f.constants.HASH_BYTE_LENGTH=64,f.generateKeyPair=function(e){var t=(e=e||{}).seed;if(void 0===t)t=n.random.getBytesSync(f.constants.SEED_BYTE_LENGTH);else if("string"===typeof t){if(t.length!==f.constants.SEED_BYTE_LENGTH)throw new TypeError('"seed" must be '+f.constants.SEED_BYTE_LENGTH+" bytes in length.")}else if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, Uint8Array, or a binary string.');t=h({message:t,encoding:"binary"});for(var r=new c(f.constants.PUBLIC_KEY_BYTE_LENGTH),i=new c(f.constants.PRIVATE_KEY_BYTE_LENGTH),a=0;a<32;++a)i[a]=t[a];return function(e,t){var r,n=[D(),D(),D(),D()],i=k(t,32);for(i[0]&=248,i[31]&=127,i[31]|=64,R(n,i),_(e,n),r=0;r<32;++r)t[r+32]=e[r]}(r,i),{publicKey:r,privateKey:i}},f.privateKeyFromAsn1=function(e){var t={},r=[];if(!n.asn1.validate(e,s,t,r)){var i=new Error("Invalid Key.");throw i.errors=r,i}var a=n.asn1.derToOid(t.privateKeyOid),o=n.oids.EdDSA25519;if(a!==o)throw new Error('Invalid OID "'+a+'"; OID must be "'+o+'".');var u=t.privateKey;return{privateKeyBytes:h({message:n.asn1.fromDer(u).value,encoding:"binary"})}},f.publicKeyFromAsn1=function(e){var t={},r=[];if(!n.asn1.validate(e,a,t,r)){var i=new Error("Invalid Key.");throw i.errors=r,i}var s=n.asn1.derToOid(t.publicKeyOid),o=n.oids.EdDSA25519;if(s!==o)throw new Error('Invalid OID "'+s+'"; OID must be "'+o+'".');var u=t.ed25519PublicKey;if(u.length!==f.constants.PUBLIC_KEY_BYTE_LENGTH)throw new Error("Key length is invalid.");return h({message:u,encoding:"binary"})},f.publicKeyFromPrivateKey=function(e){var t=h({message:(e=e||{}).privateKey,encoding:"binary"});if(t.length!==f.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+f.constants.PRIVATE_KEY_BYTE_LENGTH);for(var r=new c(f.constants.PUBLIC_KEY_BYTE_LENGTH),n=0;n<r.length;++n)r[n]=t[32+n];return r},f.sign=function(e){var t=h(e=e||{}),r=h({message:e.privateKey,encoding:"binary"});if(r.length===f.constants.SEED_BYTE_LENGTH)r=f.generateKeyPair({seed:r}).privateKey;else if(r.length!==f.constants.PRIVATE_KEY_BYTE_LENGTH)throw new TypeError('"options.privateKey" must have a byte length of '+f.constants.SEED_BYTE_LENGTH+" or "+f.constants.PRIVATE_KEY_BYTE_LENGTH);var n=new c(f.constants.SIGN_BYTE_LENGTH+t.length);!function(e,t,r,n){var i,a,s=new Float64Array(64),o=[D(),D(),D(),D()],u=k(n,32);u[0]&=248,u[31]&=127,u[31]|=64;var c=r+64;for(i=0;i<r;++i)e[64+i]=t[i];for(i=0;i<32;++i)e[32+i]=u[32+i];var f=k(e.subarray(32),r+32);for(x(f),R(o,f),_(e,o),i=32;i<64;++i)e[i]=n[i];var h=k(e,r+64);for(x(h),i=32;i<64;++i)s[i]=0;for(i=0;i<32;++i)s[i]=f[i];for(i=0;i<32;++i)for(a=0;a<32;a++)s[i+a]+=h[i]*u[a];w(e.subarray(32),s)}(n,t,t.length,r);for(var i=new c(f.constants.SIGN_BYTE_LENGTH),a=0;a<i.length;++a)i[a]=n[a];return i},f.verify=function(e){var t=h(e=e||{});if(void 0===e.signature)throw new TypeError('"options.signature" must be a node.js Buffer, a Uint8Array, a forge ByteBuffer, or a binary string.');var r=h({message:e.signature,encoding:"binary"});if(r.length!==f.constants.SIGN_BYTE_LENGTH)throw new TypeError('"options.signature" must have a byte length of '+f.constants.SIGN_BYTE_LENGTH);var n=h({message:e.publicKey,encoding:"binary"});if(n.length!==f.constants.PUBLIC_KEY_BYTE_LENGTH)throw new TypeError('"options.publicKey" must have a byte length of '+f.constants.PUBLIC_KEY_BYTE_LENGTH);var i,a=new c(f.constants.SIGN_BYTE_LENGTH+t.length),s=new c(f.constants.SIGN_BYTE_LENGTH+t.length);for(i=0;i<f.constants.SIGN_BYTE_LENGTH;++i)a[i]=r[i];for(i=0;i<t.length;++i)a[i+f.constants.SIGN_BYTE_LENGTH]=t[i];return function(e,t,r,n){var i,a=new c(32),s=[D(),D(),D(),D()],o=[D(),D(),D(),D()];if(-1,r<64)return-1;if(function(e,t){var r=D(),n=D(),i=D(),a=D(),s=D(),o=D(),u=D();N(e[2],p),function(e,t){var r;for(r=0;r<16;++r)e[r]=t[2*r]+(t[2*r+1]<<8);e[15]&=32767}(e[1],t),K(i,e[1]),U(a,i,d),L(i,i,e[2]),O(a,e[2],a),K(s,a),K(o,s),U(u,o,s),U(r,u,i),U(r,r,a),function(e,t){var r,n=D();for(r=0;r<16;++r)n[r]=t[r];for(r=250;r>=0;--r)K(n,n),1!==r&&U(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}(r,r),U(r,r,i),U(r,r,a),U(r,r,a),U(e[0],r,a),K(n,e[0]),U(n,n,a),A(n,i)&&U(e[0],e[0],g);if(K(n,e[0]),U(n,n,a),A(n,i))return-1;C(e[0])===t[31]>>7&&L(e[0],l,e[0]);return U(e[3],e[0],e[1]),0}(o,n))return-1;for(i=0;i<r;++i)e[i]=t[i];for(i=0;i<32;++i)e[i+32]=n[i];var u=k(e,r);if(x(u),B(s,o,u),R(o,t.subarray(32)),S(s,o),_(a,s),r-=64,T(t,0,a,0)){for(i=0;i<r;++i)e[i]=0;return-1}for(i=0;i<r;++i)e[i]=t[i+64];return r}(s,a,a.length,n)>=0};var l=D(),p=D([1]),d=D([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),v=D([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),y=D([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),b=D([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),m=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]),g=D([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(e,r){var i=n.md.sha512.create(),a=new u(e);i.update(a.getBytes(r),"binary");var s=i.digest().getBytes();if("undefined"!==typeof t)return t.from(s,"binary");for(var o=new c(f.constants.HASH_BYTE_LENGTH),h=0;h<64;++h)o[h]=s.charCodeAt(h);return o}function w(e,t){var r,n,i,a;for(n=63;n>=32;--n){for(r=0,i=n-32,a=n-12;i<a;++i)t[i]+=r-16*t[n]*m[i-(n-32)],r=t[i]+128>>8,t[i]-=256*r;t[i]+=r,t[n]=0}for(r=0,i=0;i<32;++i)t[i]+=r-(t[31]>>4)*m[i],r=t[i]>>8,t[i]&=255;for(i=0;i<32;++i)t[i]-=r*m[i];for(n=0;n<32;++n)t[n+1]+=t[n]>>8,e[n]=255&t[n]}function x(e){for(var t=new Float64Array(64),r=0;r<64;++r)t[r]=e[r],e[r]=0;w(e,t)}function S(e,t){var r=D(),n=D(),i=D(),a=D(),s=D(),o=D(),u=D(),c=D(),f=D();L(r,e[1],e[0]),L(f,t[1],t[0]),U(r,r,f),O(n,e[0],e[1]),O(f,t[0],t[1]),U(n,n,f),U(i,e[3],t[3]),U(i,i,v),U(a,e[2],t[2]),O(a,a,a),L(s,n,r),L(o,a,i),O(u,a,i),O(c,n,r),U(e[0],s,o),U(e[1],c,u),U(e[2],u,o),U(e[3],s,c)}function E(e,t,r){for(var n=0;n<4;++n)M(e[n],t[n],r)}function _(e,t){var r=D(),n=D(),i=D();!function(e,t){var r,n=D();for(r=0;r<16;++r)n[r]=t[r];for(r=253;r>=0;--r)K(n,n),2!==r&&4!==r&&U(n,n,t);for(r=0;r<16;++r)e[r]=n[r]}(i,t[2]),U(r,t[0],i),U(n,t[1],i),I(e,n),e[31]^=C(r)<<7}function I(e,t){var r,n,i,a=D(),s=D();for(r=0;r<16;++r)s[r]=t[r];for(P(s),P(s),P(s),n=0;n<2;++n){for(a[0]=s[0]-65517,r=1;r<15;++r)a[r]=s[r]-65535-(a[r-1]>>16&1),a[r-1]&=65535;a[15]=s[15]-32767-(a[14]>>16&1),i=a[15]>>16&1,a[14]&=65535,M(s,a,1-i)}for(r=0;r<16;r++)e[2*r]=255&s[r],e[2*r+1]=s[r]>>8}function A(e,t){var r=new c(32),n=new c(32);return I(r,e),I(n,t),T(r,0,n,0)}function T(e,t,r,n){return function(e,t,r,n,i){var a,s=0;for(a=0;a<i;++a)s|=e[t+a]^r[n+a];return(1&s-1>>>8)-1}(e,t,r,n,32)}function C(e){var t=new c(32);return I(t,e),1&t[0]}function B(e,t,r){var n,i;for(N(e[0],l),N(e[1],p),N(e[2],p),N(e[3],l),i=255;i>=0;--i)E(e,t,n=r[i/8|0]>>(7&i)&1),S(t,e),S(e,e),E(e,t,n)}function R(e,t){var r=[D(),D(),D(),D()];N(r[0],y),N(r[1],b),N(r[2],p),U(r[3],y,b),B(e,r,t)}function N(e,t){var r;for(r=0;r<16;r++)e[r]=0|t[r]}function P(e){var t,r,n=1;for(t=0;t<16;++t)r=e[t]+n+65535,n=Math.floor(r/65536),e[t]=r-65536*n;e[0]+=n-1+37*(n-1)}function M(e,t,r){for(var n,i=~(r-1),a=0;a<16;++a)n=i&(e[a]^t[a]),e[a]^=n,t[a]^=n}function D(e){var t,r=new Float64Array(16);if(e)for(t=0;t<e.length;++t)r[t]=e[t];return r}function O(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]+r[n]}function L(e,t,r){for(var n=0;n<16;++n)e[n]=t[n]-r[n]}function K(e,t){U(e,t,t)}function U(e,t,r){var n,i,a=0,s=0,o=0,u=0,c=0,f=0,h=0,l=0,p=0,d=0,v=0,y=0,b=0,m=0,g=0,k=0,w=0,x=0,S=0,E=0,_=0,I=0,A=0,T=0,C=0,B=0,R=0,N=0,P=0,M=0,D=0,O=r[0],L=r[1],K=r[2],U=r[3],q=r[4],z=r[5],j=r[6],V=r[7],F=r[8],H=r[9],G=r[10],Y=r[11],W=r[12],J=r[13],Q=r[14],X=r[15];a+=(n=t[0])*O,s+=n*L,o+=n*K,u+=n*U,c+=n*q,f+=n*z,h+=n*j,l+=n*V,p+=n*F,d+=n*H,v+=n*G,y+=n*Y,b+=n*W,m+=n*J,g+=n*Q,k+=n*X,s+=(n=t[1])*O,o+=n*L,u+=n*K,c+=n*U,f+=n*q,h+=n*z,l+=n*j,p+=n*V,d+=n*F,v+=n*H,y+=n*G,b+=n*Y,m+=n*W,g+=n*J,k+=n*Q,w+=n*X,o+=(n=t[2])*O,u+=n*L,c+=n*K,f+=n*U,h+=n*q,l+=n*z,p+=n*j,d+=n*V,v+=n*F,y+=n*H,b+=n*G,m+=n*Y,g+=n*W,k+=n*J,w+=n*Q,x+=n*X,u+=(n=t[3])*O,c+=n*L,f+=n*K,h+=n*U,l+=n*q,p+=n*z,d+=n*j,v+=n*V,y+=n*F,b+=n*H,m+=n*G,g+=n*Y,k+=n*W,w+=n*J,x+=n*Q,S+=n*X,c+=(n=t[4])*O,f+=n*L,h+=n*K,l+=n*U,p+=n*q,d+=n*z,v+=n*j,y+=n*V,b+=n*F,m+=n*H,g+=n*G,k+=n*Y,w+=n*W,x+=n*J,S+=n*Q,E+=n*X,f+=(n=t[5])*O,h+=n*L,l+=n*K,p+=n*U,d+=n*q,v+=n*z,y+=n*j,b+=n*V,m+=n*F,g+=n*H,k+=n*G,w+=n*Y,x+=n*W,S+=n*J,E+=n*Q,_+=n*X,h+=(n=t[6])*O,l+=n*L,p+=n*K,d+=n*U,v+=n*q,y+=n*z,b+=n*j,m+=n*V,g+=n*F,k+=n*H,w+=n*G,x+=n*Y,S+=n*W,E+=n*J,_+=n*Q,I+=n*X,l+=(n=t[7])*O,p+=n*L,d+=n*K,v+=n*U,y+=n*q,b+=n*z,m+=n*j,g+=n*V,k+=n*F,w+=n*H,x+=n*G,S+=n*Y,E+=n*W,_+=n*J,I+=n*Q,A+=n*X,p+=(n=t[8])*O,d+=n*L,v+=n*K,y+=n*U,b+=n*q,m+=n*z,g+=n*j,k+=n*V,w+=n*F,x+=n*H,S+=n*G,E+=n*Y,_+=n*W,I+=n*J,A+=n*Q,T+=n*X,d+=(n=t[9])*O,v+=n*L,y+=n*K,b+=n*U,m+=n*q,g+=n*z,k+=n*j,w+=n*V,x+=n*F,S+=n*H,E+=n*G,_+=n*Y,I+=n*W,A+=n*J,T+=n*Q,C+=n*X,v+=(n=t[10])*O,y+=n*L,b+=n*K,m+=n*U,g+=n*q,k+=n*z,w+=n*j,x+=n*V,S+=n*F,E+=n*H,_+=n*G,I+=n*Y,A+=n*W,T+=n*J,C+=n*Q,B+=n*X,y+=(n=t[11])*O,b+=n*L,m+=n*K,g+=n*U,k+=n*q,w+=n*z,x+=n*j,S+=n*V,E+=n*F,_+=n*H,I+=n*G,A+=n*Y,T+=n*W,C+=n*J,B+=n*Q,R+=n*X,b+=(n=t[12])*O,m+=n*L,g+=n*K,k+=n*U,w+=n*q,x+=n*z,S+=n*j,E+=n*V,_+=n*F,I+=n*H,A+=n*G,T+=n*Y,C+=n*W,B+=n*J,R+=n*Q,N+=n*X,m+=(n=t[13])*O,g+=n*L,k+=n*K,w+=n*U,x+=n*q,S+=n*z,E+=n*j,_+=n*V,I+=n*F,A+=n*H,T+=n*G,C+=n*Y,B+=n*W,R+=n*J,N+=n*Q,P+=n*X,g+=(n=t[14])*O,k+=n*L,w+=n*K,x+=n*U,S+=n*q,E+=n*z,_+=n*j,I+=n*V,A+=n*F,T+=n*H,C+=n*G,B+=n*Y,R+=n*W,N+=n*J,P+=n*Q,M+=n*X,k+=(n=t[15])*O,s+=38*(x+=n*K),o+=38*(S+=n*U),u+=38*(E+=n*q),c+=38*(_+=n*z),f+=38*(I+=n*j),h+=38*(A+=n*V),l+=38*(T+=n*F),p+=38*(C+=n*H),d+=38*(B+=n*G),v+=38*(R+=n*Y),y+=38*(N+=n*W),b+=38*(P+=n*J),m+=38*(M+=n*Q),g+=38*(D+=n*X),a=(n=(a+=38*(w+=n*L))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),k=(n=k+i+65535)-65536*(i=Math.floor(n/65536)),a=(n=(a+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(n/65536)),s=(n=s+i+65535)-65536*(i=Math.floor(n/65536)),o=(n=o+i+65535)-65536*(i=Math.floor(n/65536)),u=(n=u+i+65535)-65536*(i=Math.floor(n/65536)),c=(n=c+i+65535)-65536*(i=Math.floor(n/65536)),f=(n=f+i+65535)-65536*(i=Math.floor(n/65536)),h=(n=h+i+65535)-65536*(i=Math.floor(n/65536)),l=(n=l+i+65535)-65536*(i=Math.floor(n/65536)),p=(n=p+i+65535)-65536*(i=Math.floor(n/65536)),d=(n=d+i+65535)-65536*(i=Math.floor(n/65536)),v=(n=v+i+65535)-65536*(i=Math.floor(n/65536)),y=(n=y+i+65535)-65536*(i=Math.floor(n/65536)),b=(n=b+i+65535)-65536*(i=Math.floor(n/65536)),m=(n=m+i+65535)-65536*(i=Math.floor(n/65536)),g=(n=g+i+65535)-65536*(i=Math.floor(n/65536)),k=(n=k+i+65535)-65536*(i=Math.floor(n/65536)),a+=i-1+37*(i-1),e[0]=a,e[1]=s,e[2]=o,e[3]=u,e[4]=c,e[5]=f,e[6]=h,e[7]=l,e[8]=p,e[9]=d,e[10]=v,e[11]=y,e[12]=b,e[13]=m,e[14]=g,e[15]=k}}).call(this,r(3).Buffer)},function(e,t,r){var n=r(1949);r(1977),r(1960),r(2024),r(1962),r(2282),r(1978),r(2026),r(2284),r(1988),r(1951);var i=n.asn1,a=e.exports=n.pki=n.pki||{},s=a.oids,o={};o.CN=s.commonName,o.commonName="CN",o.C=s.countryName,o.countryName="C",o.L=s.localityName,o.localityName="L",o.ST=s.stateOrProvinceName,o.stateOrProvinceName="ST",o.O=s.organizationName,o.organizationName="O",o.OU=s.organizationalUnitName,o.organizationalUnitName="OU",o.E=s.emailAddress,o.emailAddress="E";var u=n.pki.rsa.publicKeyValidator,c={name:"Certificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},u,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},f={name:"rsapss",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},h={name:"CertificationRequestInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},u,{name:"CertificationRequestInfo.attributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0}]}]}]},l={name:"CertificationRequest",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[h,{name:"CertificationRequest.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function p(e,t){"string"===typeof t&&(t={shortName:t});for(var r,n=null,i=0;null===n&&i<e.attributes.length;++i)r=e.attributes[i],t.type&&t.type===r.type?n=r:t.name&&t.name===r.name?n=r:t.shortName&&t.shortName===r.shortName&&(n=r);return n}a.RDNAttributesAsArray=function(e,t){for(var r,n,a,u=[],c=0;c<e.value.length;++c){r=e.value[c];for(var f=0;f<r.value.length;++f)a={},n=r.value[f],a.type=i.derToOid(n.value[0].value),a.value=n.value[1].value,a.valueTagClass=n.value[1].type,a.type in s&&(a.name=s[a.type],a.name in o&&(a.shortName=o[a.name])),t&&(t.update(a.type),t.update(a.value)),u.push(a)}return u},a.CRIAttributesAsArray=function(e){for(var t=[],r=0;r<e.length;++r)for(var n=e[r],u=i.derToOid(n.value[0].value),c=n.value[1].value,f=0;f<c.length;++f){var h={};if(h.type=u,h.value=c[f].value,h.valueTagClass=c[f].type,h.type in s&&(h.name=s[h.type],h.name in o&&(h.shortName=o[h.name])),h.type===s.extensionRequest){h.extensions=[];for(var l=0;l<h.value.length;++l)h.extensions.push(a.certificateExtensionFromAsn1(h.value[l]))}t.push(h)}return t};var d=function(e,t,r){var n={};if(e!==s["RSASSA-PSS"])return n;r&&(n={hash:{algorithmOid:s.sha1},mgf:{algorithmOid:s.mgf1,hash:{algorithmOid:s.sha1}},saltLength:20});var a={},o=[];if(!i.validate(t,f,a,o)){var u=new Error("Cannot read RSASSA-PSS parameter block.");throw u.errors=o,u}return void 0!==a.hashOid&&(n.hash=n.hash||{},n.hash.algorithmOid=i.derToOid(a.hashOid)),void 0!==a.maskGenOid&&(n.mgf=n.mgf||{},n.mgf.algorithmOid=i.derToOid(a.maskGenOid),n.mgf.hash=n.mgf.hash||{},n.mgf.hash.algorithmOid=i.derToOid(a.maskGenHashOid)),void 0!==a.saltLength&&(n.saltLength=a.saltLength.charCodeAt(0)),n};function v(e){for(var t,r,a=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),s=e.attributes,o=0;o<s.length;++o){var u=(t=s[o]).value,c=i.Type.PRINTABLESTRING;"valueTagClass"in t&&(c=t.valueTagClass)===i.Type.UTF8&&(u=n.util.encodeUtf8(u)),r=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.type).getBytes()),i.create(i.Class.UNIVERSAL,c,!1,u)])]),a.value.push(r)}return a}function y(e){for(var t,r=0;r<e.length;++r){if("undefined"===typeof(t=e[r]).name&&(t.type&&t.type in a.oids?t.name=a.oids[t.type]:t.shortName&&t.shortName in o&&(t.name=a.oids[o[t.shortName]])),"undefined"===typeof t.type){if(!(t.name&&t.name in a.oids))throw(u=new Error("Attribute type not specified.")).attribute=t,u;t.type=a.oids[t.name]}if("undefined"===typeof t.shortName&&t.name&&t.name in o&&(t.shortName=o[t.name]),t.type===s.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=i.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var n=0;n<t.extensions.length;++n)t.value.push(a.certificateExtensionToAsn1(b(t.extensions[n])))}var u;if("undefined"===typeof t.value)throw(u=new Error("Attribute value not specified.")).attribute=t,u}}function b(e,t){if(t=t||{},"undefined"===typeof e.name&&e.id&&e.id in a.oids&&(e.name=a.oids[e.id]),"undefined"===typeof e.id){if(!(e.name&&e.name in a.oids))throw(w=new Error("Extension ID not specified.")).extension=e,w;e.id=a.oids[e.name]}if("undefined"!==typeof e.value)return e;if("keyUsage"===e.name){var r=0,o=0,u=0;e.digitalSignature&&(o|=128,r=7),e.nonRepudiation&&(o|=64,r=6),e.keyEncipherment&&(o|=32,r=5),e.dataEncipherment&&(o|=16,r=4),e.keyAgreement&&(o|=8,r=3),e.keyCertSign&&(o|=4,r=2),e.cRLSign&&(o|=2,r=1),e.encipherOnly&&(o|=1,r=0),e.decipherOnly&&(u|=128,r=7);var c=String.fromCharCode(r);0!==u?c+=String.fromCharCode(o)+String.fromCharCode(u):0!==o&&(c+=String.fromCharCode(o)),e.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,c)}else if("basicConstraints"===e.name)e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);var f=e.value.value;for(var h in e)!0===e[h]&&(h in s?f.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(s[h]).getBytes())):-1!==h.indexOf(".")&&f.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(h).getBytes())))}else if("nsCertType"===e.name){r=0,o=0;e.client&&(o|=128,r=7),e.server&&(o|=64,r=6),e.email&&(o|=32,r=5),e.objsign&&(o|=16,r=4),e.reserved&&(o|=8,r=3),e.sslCA&&(o|=4,r=2),e.emailCA&&(o|=2,r=1),e.objCA&&(o|=1,r=0);c=String.fromCharCode(r);0!==o&&(c+=String.fromCharCode(o)),e.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,c)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);for(var l=0;l<e.altNames.length;++l){c=(m=e.altNames[l]).value;if(7===m.type&&m.ip){if(null===(c=n.util.bytesFromIP(m.ip)))throw(w=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,w}else 8===m.type&&(c=m.oid?i.oidToDer(i.oidToDer(m.oid)):i.oidToDer(c));e.value.value.push(i.create(i.Class.CONTEXT_SPECIFIC,m.type,!1,c))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=i.create(i.Class.UNIVERSAL,i.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var p=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=p.toHex(),e.value=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,p.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);f=e.value.value;if(e.keyIdentifier){var d=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;f.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!1,d))}if(e.authorityCertIssuer){var y=[i.create(i.Class.CONTEXT_SPECIFIC,4,!0,[v(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];f.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,y))}if(e.serialNumber){var b=n.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);f.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!1,b))}}else if("cRLDistributionPoints"===e.name){e.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);f=e.value.value;var m,g=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),k=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(l=0;l<e.altNames.length;++l){c=(m=e.altNames[l]).value;if(7===m.type&&m.ip){if(null===(c=n.util.bytesFromIP(m.ip)))throw(w=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.')).extension=e,w}else 8===m.type&&(c=m.oid?i.oidToDer(i.oidToDer(m.oid)):i.oidToDer(c));k.value.push(i.create(i.Class.CONTEXT_SPECIFIC,m.type,!1,c))}g.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[k])),f.push(g)}var w;if("undefined"===typeof e.value)throw(w=new Error("Extension value not specified.")).extension=e,w;return e}function m(e,t){switch(e){case s["RSASSA-PSS"]:var r=[];return void 0!==t.hash.algorithmOid&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.mgf.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.mgf.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&r.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.saltLength).getBytes())])),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,r);default:return i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")}}function g(e){var t=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var r=e.attributes,a=0;a<r.length;++a){var s=r[a],o=s.value,u=i.Type.UTF8;"valueTagClass"in s&&(u=s.valueTagClass),u===i.Type.UTF8&&(o=n.util.encodeUtf8(o));var c=!1;"valueConstructed"in s&&(c=s.valueConstructed);var f=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(s.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,u,c,o)])]);t.value.push(f)}return t}a.certificateFromPem=function(e,t,r){var s=n.pem.decode(e)[0];if("CERTIFICATE"!==s.type&&"X509 CERTIFICATE"!==s.type&&"TRUSTED CERTIFICATE"!==s.type){var o=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw o.headerType=s.type,o}if(s.procType&&"ENCRYPTED"===s.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var u=i.fromDer(s.body,r);return a.certificateFromAsn1(u,t)},a.certificateToPem=function(e,t){var r={type:"CERTIFICATE",body:i.toDer(a.certificateToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},a.publicKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var r=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var s=i.fromDer(t.body);return a.publicKeyFromAsn1(s)},a.publicKeyToPem=function(e,t){var r={type:"PUBLIC KEY",body:i.toDer(a.publicKeyToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},a.publicKeyToRSAPublicKeyPem=function(e,t){var r={type:"RSA PUBLIC KEY",body:i.toDer(a.publicKeyToRSAPublicKey(e)).getBytes()};return n.pem.encode(r,{maxline:t})},a.getPublicKeyFingerprint=function(e,t){var r,s=(t=t||{}).md||n.md.sha1.create();switch(t.type||"RSAPublicKey"){case"RSAPublicKey":r=i.toDer(a.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":r=i.toDer(a.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}s.start(),s.update(r);var o=s.digest();if("hex"===t.encoding){var u=o.toHex();return t.delimiter?u.match(/.{2}/g).join(t.delimiter):u}if("binary"===t.encoding)return o.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return o},a.certificationRequestFromPem=function(e,t,r){var s=n.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==s.type){var o=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw o.headerType=s.type,o}if(s.procType&&"ENCRYPTED"===s.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var u=i.fromDer(s.body,r);return a.certificationRequestFromAsn1(u,t)},a.certificationRequestToPem=function(e,t){var r={type:"CERTIFICATE REQUEST",body:i.toDer(a.certificationRequestToAsn1(e)).getBytes()};return n.pem.encode(r,{maxline:t})},a.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return p(e.issuer,t)},e.issuer.addField=function(t){y([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){y([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,r){y(t),e.subject.attributes=t,delete e.subject.uniqueId,r&&(e.subject.uniqueId=r),e.subject.hash=null},e.setIssuer=function(t,r){y(t),e.issuer.attributes=t,delete e.issuer.uniqueId,r&&(e.issuer.uniqueId=r),e.issuer.hash=null},e.setExtensions=function(t){for(var r=0;r<t.length;++r)b(t[r],{cert:e});e.extensions=t},e.getExtension=function(t){"string"===typeof t&&(t={name:t});for(var r,n=null,i=0;null===n&&i<e.extensions.length;++i)r=e.extensions[i],t.id&&r.id===t.id?n=r:t.name&&r.name===t.name&&(n=r);return n},e.sign=function(t,r){e.md=r||n.md.sha1.create();var o=s[e.md.algorithm+"WithRSAEncryption"];if(!o){var u=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw u.algorithm=e.md.algorithm,u}e.signatureOid=e.siginfo.algorithmOid=o,e.tbsCertificate=a.getTBSCertificate(e);var c=i.toDer(e.tbsCertificate);e.md.update(c.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var r=!1;if(!e.issued(t)){var o=t.issuer,u=e.subject;throw(v=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.")).expectedIssuer=o.attributes,v.actualIssuer=u.attributes,v}var c=t.md;if(null===c){if(t.signatureOid in s)switch(s[t.signatureOid]){case"sha1WithRSAEncryption":c=n.md.sha1.create();break;case"md5WithRSAEncryption":c=n.md.md5.create();break;case"sha256WithRSAEncryption":c=n.md.sha256.create();break;case"sha384WithRSAEncryption":c=n.md.sha384.create();break;case"sha512WithRSAEncryption":c=n.md.sha512.create();break;case"RSASSA-PSS":c=n.md.sha256.create()}if(null===c)throw(v=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=t.signatureOid,v;var f=t.tbsCertificate||a.getTBSCertificate(t),h=i.toDer(f);c.update(h.getBytes())}if(null!==c){var l;switch(t.signatureOid){case s.sha1WithRSAEncryption:l=void 0;break;case s["RSASSA-PSS"]:var p,d,v;if(void 0===(p=s[t.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[p])throw(v=new Error("Unsupported MGF hash function.")).oid=t.signatureParameters.mgf.hash.algorithmOid,v.name=p,v;if(void 0===(d=s[t.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[d])throw(v=new Error("Unsupported MGF function.")).oid=t.signatureParameters.mgf.algorithmOid,v.name=d,v;if(d=n.mgf[d].create(n.md[p].create()),void 0===(p=s[t.signatureParameters.hash.algorithmOid])||void 0===n.md[p])throw{message:"Unsupported RSASSA-PSS hash function.",oid:t.signatureParameters.hash.algorithmOid,name:p};l=n.pss.create(n.md[p].create(),d,t.signatureParameters.saltLength)}r=e.publicKey.verify(c.digest().getBytes(),t.signature,l)}return r},e.isIssuer=function(t){var r=!1,n=e.issuer,i=t.subject;if(n.hash&&i.hash)r=n.hash===i.hash;else if(n.attributes.length===i.attributes.length){var a,s;r=!0;for(var o=0;r&&o<n.attributes.length;++o)a=n.attributes[o],s=i.attributes[o],a.type===s.type&&a.value===s.value||(r=!1)}return r},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return a.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=s.subjectKeyIdentifier,r=0;r<e.extensions.length;++r){var i=e.extensions[r];if(i.id===t){var a=e.generateSubjectKeyIdentifier().getBytes();return n.util.hexToBytes(i.subjectKeyIdentifier)===a}}return!1},e},a.certificateFromAsn1=function(e,t){var r={},o=[];if(!i.validate(e,c,r,o))throw(l=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.")).errors=o,l;if(i.derToOid(r.publicKeyOid)!==a.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var u=a.createCertificate();u.version=r.certVersion?r.certVersion.charCodeAt(0):0;var f=n.util.createBuffer(r.certSerialNumber);u.serialNumber=f.toHex(),u.signatureOid=n.asn1.derToOid(r.certSignatureOid),u.signatureParameters=d(u.signatureOid,r.certSignatureParams,!0),u.siginfo.algorithmOid=n.asn1.derToOid(r.certinfoSignatureOid),u.siginfo.parameters=d(u.siginfo.algorithmOid,r.certinfoSignatureParams,!1),u.signature=r.certSignature;var h=[];if(void 0!==r.certValidity1UTCTime&&h.push(i.utcTimeToDate(r.certValidity1UTCTime)),void 0!==r.certValidity2GeneralizedTime&&h.push(i.generalizedTimeToDate(r.certValidity2GeneralizedTime)),void 0!==r.certValidity3UTCTime&&h.push(i.utcTimeToDate(r.certValidity3UTCTime)),void 0!==r.certValidity4GeneralizedTime&&h.push(i.generalizedTimeToDate(r.certValidity4GeneralizedTime)),h.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(h.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(u.validity.notBefore=h[0],u.validity.notAfter=h[1],u.tbsCertificate=r.tbsCertificate,t){var l;if(u.md=null,u.signatureOid in s)switch(s[u.signatureOid]){case"sha1WithRSAEncryption":u.md=n.md.sha1.create();break;case"md5WithRSAEncryption":u.md=n.md.md5.create();break;case"sha256WithRSAEncryption":u.md=n.md.sha256.create();break;case"sha384WithRSAEncryption":u.md=n.md.sha384.create();break;case"sha512WithRSAEncryption":u.md=n.md.sha512.create();break;case"RSASSA-PSS":u.md=n.md.sha256.create()}if(null===u.md)throw(l=new Error("Could not compute certificate digest. Unknown signature OID.")).signatureOid=u.signatureOid,l;var v=i.toDer(u.tbsCertificate);u.md.update(v.getBytes())}var b=n.md.sha1.create();u.issuer.getField=function(e){return p(u.issuer,e)},u.issuer.addField=function(e){y([e]),u.issuer.attributes.push(e)},u.issuer.attributes=a.RDNAttributesAsArray(r.certIssuer,b),r.certIssuerUniqueId&&(u.issuer.uniqueId=r.certIssuerUniqueId),u.issuer.hash=b.digest().toHex();var m=n.md.sha1.create();return u.subject.getField=function(e){return p(u.subject,e)},u.subject.addField=function(e){y([e]),u.subject.attributes.push(e)},u.subject.attributes=a.RDNAttributesAsArray(r.certSubject,m),r.certSubjectUniqueId&&(u.subject.uniqueId=r.certSubjectUniqueId),u.subject.hash=m.digest().toHex(),r.certExtensions?u.extensions=a.certificateExtensionsFromAsn1(r.certExtensions):u.extensions=[],u.publicKey=a.publicKeyFromAsn1(r.subjectPublicKeyInfo),u},a.certificateExtensionsFromAsn1=function(e){for(var t=[],r=0;r<e.value.length;++r)for(var n=e.value[r],i=0;i<n.value.length;++i)t.push(a.certificateExtensionFromAsn1(n.value[i]));return t},a.certificateExtensionFromAsn1=function(e){var t={};if(t.id=i.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===i.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in s)if(t.name=s[t.id],"keyUsage"===t.name){var r=0,a=0;(u=i.fromDer(t.value)).value.length>1&&(r=u.value.charCodeAt(1),a=u.value.length>2?u.value.charCodeAt(2):0),t.digitalSignature=128===(128&r),t.nonRepudiation=64===(64&r),t.keyEncipherment=32===(32&r),t.dataEncipherment=16===(16&r),t.keyAgreement=8===(8&r),t.keyCertSign=4===(4&r),t.cRLSign=2===(2&r),t.encipherOnly=1===(1&r),t.decipherOnly=128===(128&a)}else if("basicConstraints"===t.name){(u=i.fromDer(t.value)).value.length>0&&u.value[0].type===i.Type.BOOLEAN?t.cA=0!==u.value[0].value.charCodeAt(0):t.cA=!1;var o=null;u.value.length>0&&u.value[0].type===i.Type.INTEGER?o=u.value[0].value:u.value.length>1&&(o=u.value[1].value),null!==o&&(t.pathLenConstraint=i.derToInteger(o))}else if("extKeyUsage"===t.name)for(var u=i.fromDer(t.value),c=0;c<u.value.length;++c){var f=i.derToOid(u.value[c].value);f in s?t[s[f]]=!0:t[f]=!0}else if("nsCertType"===t.name){r=0;(u=i.fromDer(t.value)).value.length>1&&(r=u.value.charCodeAt(1)),t.client=128===(128&r),t.server=64===(64&r),t.email=32===(32&r),t.objsign=16===(16&r),t.reserved=8===(8&r),t.sslCA=4===(4&r),t.emailCA=2===(2&r),t.objCA=1===(1&r)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){var h;t.altNames=[];u=i.fromDer(t.value);for(var l=0;l<u.value.length;++l){var p={type:(h=u.value[l]).type,value:h.value};switch(t.altNames.push(p),h.type){case 1:case 2:case 6:break;case 7:p.ip=n.util.bytesToIP(h.value);break;case 8:p.oid=i.derToOid(h.value)}}}else if("subjectKeyIdentifier"===t.name){u=i.fromDer(t.value);t.subjectKeyIdentifier=n.util.bytesToHex(u.value)}return t},a.certificationRequestFromAsn1=function(e,t){var r={},o=[];if(!i.validate(e,l,r,o))throw(c=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.")).errors=o,c;if(i.derToOid(r.publicKeyOid)!==a.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var u=a.createCertificationRequest();if(u.version=r.csrVersion?r.csrVersion.charCodeAt(0):0,u.signatureOid=n.asn1.derToOid(r.csrSignatureOid),u.signatureParameters=d(u.signatureOid,r.csrSignatureParams,!0),u.siginfo.algorithmOid=n.asn1.derToOid(r.csrSignatureOid),u.siginfo.parameters=d(u.siginfo.algorithmOid,r.csrSignatureParams,!1),u.signature=r.csrSignature,u.certificationRequestInfo=r.certificationRequestInfo,t){var c;if(u.md=null,u.signatureOid in s)switch(s[u.signatureOid]){case"sha1WithRSAEncryption":u.md=n.md.sha1.create();break;case"md5WithRSAEncryption":u.md=n.md.md5.create();break;case"sha256WithRSAEncryption":u.md=n.md.sha256.create();break;case"sha384WithRSAEncryption":u.md=n.md.sha384.create();break;case"sha512WithRSAEncryption":u.md=n.md.sha512.create();break;case"RSASSA-PSS":u.md=n.md.sha256.create()}if(null===u.md)throw(c=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=u.signatureOid,c;var f=i.toDer(u.certificationRequestInfo);u.md.update(f.getBytes())}var h=n.md.sha1.create();return u.subject.getField=function(e){return p(u.subject,e)},u.subject.addField=function(e){y([e]),u.subject.attributes.push(e)},u.subject.attributes=a.RDNAttributesAsArray(r.certificationRequestInfoSubject,h),u.subject.hash=h.digest().toHex(),u.publicKey=a.publicKeyFromAsn1(r.subjectPublicKeyInfo),u.getAttribute=function(e){return p(u,e)},u.addAttribute=function(e){y([e]),u.attributes.push(e)},u.attributes=a.CRIAttributesAsArray(r.certificationRequestInfoAttributes||[]),u},a.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){y([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return p(e,t)},e.addAttribute=function(t){y([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){y(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){y(t),e.attributes=t},e.sign=function(t,r){e.md=r||n.md.sha1.create();var o=s[e.md.algorithm+"WithRSAEncryption"];if(!o){var u=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw u.algorithm=e.md.algorithm,u}e.signatureOid=e.siginfo.algorithmOid=o,e.certificationRequestInfo=a.getCertificationRequestInfo(e);var c=i.toDer(e.certificationRequestInfo);e.md.update(c.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,r=e.md;if(null===r){if(e.signatureOid in s)switch(s[e.signatureOid]){case"sha1WithRSAEncryption":r=n.md.sha1.create();break;case"md5WithRSAEncryption":r=n.md.md5.create();break;case"sha256WithRSAEncryption":r=n.md.sha256.create();break;case"sha384WithRSAEncryption":r=n.md.sha384.create();break;case"sha512WithRSAEncryption":r=n.md.sha512.create();break;case"RSASSA-PSS":r=n.md.sha256.create()}if(null===r)throw(l=new Error("Could not compute certification request digest. Unknown signature OID.")).signatureOid=e.signatureOid,l;var o=e.certificationRequestInfo||a.getCertificationRequestInfo(e),u=i.toDer(o);r.update(u.getBytes())}if(null!==r){var c;switch(e.signatureOid){case s.sha1WithRSAEncryption:break;case s["RSASSA-PSS"]:var f,h,l;if(void 0===(f=s[e.signatureParameters.mgf.hash.algorithmOid])||void 0===n.md[f])throw(l=new Error("Unsupported MGF hash function.")).oid=e.signatureParameters.mgf.hash.algorithmOid,l.name=f,l;if(void 0===(h=s[e.signatureParameters.mgf.algorithmOid])||void 0===n.mgf[h])throw(l=new Error("Unsupported MGF function.")).oid=e.signatureParameters.mgf.algorithmOid,l.name=h,l;if(h=n.mgf[h].create(n.md[f].create()),void 0===(f=s[e.signatureParameters.hash.algorithmOid])||void 0===n.md[f])throw(l=new Error("Unsupported RSASSA-PSS hash function.")).oid=e.signatureParameters.hash.algorithmOid,l.name=f,l;c=n.pss.create(n.md[f].create(),h,e.signatureParameters.saltLength)}t=e.publicKey.verify(r.digest().getBytes(),e.signature,c)}return t},e};var k=new Date("1950-01-01T00:00:00Z"),w=new Date("2050-01-01T00:00:00Z");function x(e){return e>=k&&e<w?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(e)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(e))}a.getTBSCertificate=function(e){var t=x(e.validity.notBefore),r=x(e.validity.notAfter),s=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes())]),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.siginfo.algorithmOid).getBytes()),m(e.siginfo.algorithmOid,e.siginfo.parameters)]),v(e.issuer),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,r]),v(e.subject),a.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&s.value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&s.value.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&s.value.push(a.certificateExtensionsToAsn1(e.extensions)),s},a.getCertificationRequestInfo=function(e){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),v(e.subject),a.publicKeyToAsn1(e.publicKey),g(e)])},a.distinguishedNameToAsn1=function(e){return v(e)},a.certificateToAsn1=function(e){var t=e.tbsCertificate||a.getTBSCertificate(e);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureOid).getBytes()),m(e.signatureOid,e.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},a.certificateExtensionsToAsn1=function(e){var t=i.create(i.Class.CONTEXT_SPECIFIC,3,!0,[]),r=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);t.value.push(r);for(var n=0;n<e.length;++n)r.value.push(a.certificateExtensionToAsn1(e[n]));return t},a.certificateExtensionToAsn1=function(e){var t=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.id).getBytes())),e.critical&&t.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255)));var r=e.value;return"string"!==typeof e.value&&(r=i.toDer(r).getBytes()),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r)),t},a.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||a.getCertificationRequestInfo(e);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[t,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureOid).getBytes()),m(e.signatureOid,e.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},a.createCaStore=function(e){var t={certs:{}};function r(e){return s(e),t.certs[e.hash]||null}function s(e){if(!e.hash){var t=n.md.sha1.create();e.attributes=a.RDNAttributesAsArray(v(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){return r(e.issuer)},t.addCertificate=function(e){if("string"===typeof e&&(e=n.pki.certificateFromPem(e)),s(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var r=t.certs[e.subject.hash];n.util.isArray(r)||(r=[r]),r.push(e),t.certs[e.subject.hash]=r}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"===typeof e&&(e=n.pki.certificateFromPem(e));var t=r(e.subject);if(!t)return!1;n.util.isArray(t)||(t=[t]);for(var s=i.toDer(a.certificateToAsn1(e)).getBytes(),o=0;o<t.length;++o){if(s===i.toDer(a.certificateToAsn1(t[o])).getBytes())return!0}return!1},t.listAllCertificates=function(){var e=[];for(var r in t.certs)if(t.certs.hasOwnProperty(r)){var i=t.certs[r];if(n.util.isArray(i))for(var a=0;a<i.length;++a)e.push(i[a]);else e.push(i)}return e},t.removeCertificate=function(e){var o;if("string"===typeof e&&(e=n.pki.certificateFromPem(e)),s(e.subject),!t.hasCertificate(e))return null;var u=r(e.subject);if(!n.util.isArray(u))return o=t.certs[e.subject.hash],delete t.certs[e.subject.hash],o;for(var c=i.toDer(a.certificateToAsn1(e)).getBytes(),f=0;f<u.length;++f){c===i.toDer(a.certificateToAsn1(u[f])).getBytes()&&(o=u[f],u.splice(f,1))}return 0===u.length&&delete t.certs[e.subject.hash],o},e)for(var o=0;o<e.length;++o){var u=e[o];t.addCertificate(u)}return t},a.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},a.verifyCertificateChain=function(e,t,r){"function"===typeof r&&(r={verify:r}),r=r||{};var i=(t=t.slice(0)).slice(0),s=r.validityCheckDate;"undefined"===typeof s&&(s=new Date);var o=!0,u=null,c=0;do{var f=t.shift(),h=null,l=!1;if(s&&(s<f.validity.notBefore||s>f.validity.notAfter)&&(u={message:"Certificate is not valid yet or has expired.",error:a.certificateError.certificate_expired,notBefore:f.validity.notBefore,notAfter:f.validity.notAfter,now:s}),null===u){if(null===(h=t[0]||e.getIssuer(f))&&f.isIssuer(f)&&(l=!0,h=f),h){var p=h;n.util.isArray(p)||(p=[p]);for(var d=!1;!d&&p.length>0;){h=p.shift();try{d=h.verify(f)}catch(x){}}d||(u={message:"Certificate signature is invalid.",error:a.certificateError.bad_certificate})}null!==u||h&&!l||e.hasCertificate(f)||(u={message:"Certificate is not trusted.",error:a.certificateError.unknown_ca})}if(null===u&&h&&!f.isIssuer(h)&&(u={message:"Certificate issuer is invalid.",error:a.certificateError.bad_certificate}),null===u)for(var v={keyUsage:!0,basicConstraints:!0},y=0;null===u&&y<f.extensions.length;++y){var b=f.extensions[y];!b.critical||b.name in v||(u={message:"Certificate has an unsupported critical extension.",error:a.certificateError.unsupported_certificate})}if(null===u&&(!o||0===t.length&&(!h||l))){var m=f.getExtension("basicConstraints"),g=f.getExtension("keyUsage");if(null!==g&&(g.keyCertSign&&null!==m||(u={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:a.certificateError.bad_certificate})),null!==u||null===m||m.cA||(u={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:a.certificateError.bad_certificate}),null===u&&null!==g&&"pathLenConstraint"in m)c-1>m.pathLenConstraint&&(u={message:"Certificate basicConstraints pathLenConstraint violated.",error:a.certificateError.bad_certificate})}var k=null===u||u.error,w=r.verify?r.verify(k,c,i):k;if(!0!==w)throw!0===k&&(u={message:"The application rejected the certificate.",error:a.certificateError.bad_certificate}),(w||0===w)&&("object"!==typeof w||n.util.isArray(w)?"string"===typeof w&&(u.error=w):(w.message&&(u.message=w.message),w.error&&(u.error=w.error))),u;u=null,o=!1,++c}while(t.length>0);return!0}},function(e,t,r){"use strict";var n=r(68),i=r(5),a=r(7),s=r(28),o=r(27),u=r(87),c=r(29),f=r(15),h=r(19);h("libp2p:peer-store").error=h("libp2p:peer-store:error");var l=r(41).EventEmitter,p=r(55),d=r(2293),v=r(2294),y=r(2295),b=r(2296),m=r(1954).ERR_INVALID_PARAMETERS,g=function(e){function t(){var e;return i(this,t),(e=s(this,o(t).call(this))).addressBook=new d(u(e)),e.keyBook=new v(u(e)),e.metadataBook=new y(u(e)),e.protoBook=new b(u(e)),e}return c(t,e),a(t,[{key:"start",value:function(){}},{key:"stop",value:function(){}},{key:"delete",value:function(e){var t=this.addressBook.delete(e),r=this.keyBook.delete(e),n=this.protoBook.delete(e),i=this.metadataBook.delete(e);return t||r||n||i}},{key:"get",value:function(e){if(!p.isPeerId(e))throw f(new Error("peerId must be an instance of peer-id"),m);var t=this.keyBook.data.get(e.toB58String()),r=this.addressBook.get(e),n=this.metadataBook.get(e),i=this.protoBook.get(e);if(t||r||n||i)return{id:t||e,addresses:r||[],protocols:i||[],metadata:n}}},{key:"peers",get:function(){var e=this,t=new Set([].concat(n(this.addressBook.data.keys()),n(this.keyBook.data.keys()),n(this.protoBook.data.keys()),n(this.metadataBook.data.keys()))),r=new Map;return t.forEach((function(t){r.set(t,e.get(p.createFromCID(t)))})),r}}]),t}(l);e.exports=g},function(e,t,r){(function(t){var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(19)("simple-peer"),c=r(807),f=r(153),h=r(266),l=r(808),p=r(15);function d(e){return e.replace(/a=ice-options:trickle\s\n/g,"")}var v=function(e){"use strict";function r(e){var t;if(n(this,r),e=Object.assign({allowHalfOpen:!1},e),(t=a(this,s(r).call(this,e)))._id=f(4).toString("hex").slice(0,7),t._debug("new peer %o",e),t.channelName=e.initiator?e.channelName||f(20).toString("hex"):null,t.initiator=e.initiator||!1,t.channelConfig=e.channelConfig||r.channelConfig,t.negotiated=t.channelConfig.negotiated,t.config=Object.assign({},r.config,e.config),t.offerOptions=e.offerOptions||{},t.answerOptions=e.answerOptions||{},t.sdpTransform=e.sdpTransform||function(e){return e},t.streams=e.streams||(e.stream?[e.stream]:[]),t.trickle=void 0===e.trickle||e.trickle,t.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,t.iceCompleteTimeout=e.iceCompleteTimeout||5e3,t.destroyed=!1,t._connected=!1,t.remoteAddress=void 0,t.remoteFamily=void 0,t.remotePort=void 0,t.localAddress=void 0,t.localFamily=void 0,t.localPort=void 0,t._wrtc=e.wrtc&&"object"===typeof e.wrtc?e.wrtc:c(),!t._wrtc)throw"undefined"===typeof window?p(new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):p(new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");t._pcReady=!1,t._channelReady=!1,t._iceComplete=!1,t._iceCompleteTimer=null,t._channel=null,t._pendingCandidates=[],t._isNegotiating=!t.negotiated&&!t.initiator,t._batchedNegotiation=!1,t._queuedNegotiation=!1,t._sendersAwaitingStable=[],t._senderMap=new Map,t._firstStable=!0,t._closingInterval=null,t._remoteTracks=[],t._remoteStreams=[],t._chunk=null,t._cb=null,t._interval=null;try{t._pc=new t._wrtc.RTCPeerConnection(t.config)}catch(i){return l((function(){return t.destroy(p(i,"ERR_PC_CONSTRUCTOR"))})),a(t)}return t._isReactNativeWebrtc="number"===typeof t._pc._peerConnectionId,t._pc.oniceconnectionstatechange=function(){t._onIceStateChange()},t._pc.onicegatheringstatechange=function(){t._onIceStateChange()},t._pc.onconnectionstatechange=function(){t._onConnectionStateChange()},t._pc.onsignalingstatechange=function(){t._onSignalingStateChange()},t._pc.onicecandidate=function(e){t._onIceCandidate(e)},t.initiator||t.negotiated?t._setupData({channel:t._pc.createDataChannel(t.channelName,t.channelConfig)}):t._pc.ondatachannel=function(e){t._setupData(e)},t.streams&&t.streams.forEach((function(e){t.addStream(e)})),t._pc.ontrack=function(e){t._onTrack(e)},t.initiator&&t._needsNegotiation(),t._onFinishBound=function(){t._onFinish()},t.once("finish",t._onFinishBound),t}return o(r,e),i(r,[{key:"address",value:function(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}},{key:"signal",value:function(e){var t=this;if(this.destroyed)throw p(new Error("cannot signal after peer is destroyed"),"ERR_SIGNALING");if("string"===typeof e)try{e=JSON.parse(e)}catch(r){e={}}this._debug("signal()"),e.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),e.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(e.transceiverRequest.kind,e.transceiverRequest.init)),e.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(e.candidate):this._pendingCandidates.push(e.candidate)),e.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(e)).then((function(){t.destroyed||(t._pendingCandidates.forEach((function(e){t._addIceCandidate(e)})),t._pendingCandidates=[],"offer"===t._pc.remoteDescription.type&&t._createAnswer())})).catch((function(e){t.destroy(p(e,"ERR_SET_REMOTE_DESCRIPTION"))})),e.sdp||e.candidate||e.renegotiate||e.transceiverRequest||this.destroy(p(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}},{key:"_addIceCandidate",value:function(e){var t=this,r=new this._wrtc.RTCIceCandidate(e);this._pc.addIceCandidate(r).catch((function(e){var n;!r.address||r.address.endsWith(".local")?(n="Ignoring unsupported ICE candidate.",console.warn(n)):t.destroy(p(e,"ERR_ADD_ICE_CANDIDATE"))}))}},{key:"send",value:function(e){this._channel.send(e)}},{key:"addTransceiver",value:function(e,t){if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(e,t),this._needsNegotiation()}catch(r){this.destroy(p(r,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{transceiverRequest:{kind:e,init:t}})}},{key:"addStream",value:function(e){var t=this;this._debug("addStream()"),e.getTracks().forEach((function(r){t.addTrack(r,e)}))}},{key:"addTrack",value:function(e,t){this._debug("addTrack()");var r=this._senderMap.get(e)||new Map,n=r.get(t);if(n)throw n.removed?p(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):p(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(e,t),r.set(t,n),this._senderMap.set(e,r),this._needsNegotiation()}},{key:"replaceTrack",value:function(e,t,r){this._debug("replaceTrack()");var n=this._senderMap.get(e),i=n?n.get(r):null;if(!i)throw p(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");t&&this._senderMap.set(t,n),null!=i.replaceTrack?i.replaceTrack(t):this.destroy(p(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}},{key:"removeTrack",value:function(e,t){this._debug("removeSender()");var r=this._senderMap.get(e),n=r?r.get(t):null;if(!n)throw p(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(i){"NS_ERROR_UNEXPECTED"===i.name?this._sendersAwaitingStable.push(n):this.destroy(p(i,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}},{key:"removeStream",value:function(e){var t=this;this._debug("removeSenders()"),e.getTracks().forEach((function(r){t.removeTrack(r,e)}))}},{key:"_needsNegotiation",value:function(){var e=this;this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,l((function(){e._batchedNegotiation=!1,e._debug("starting batched negotiation"),e.negotiate()})))}},{key:"negotiate",value:function(){var e=this;this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((function(){e._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{renegotiate:!0})),this._isNegotiating=!0}},{key:"destroy",value:function(e){this._destroy(e,(function(){}))}},{key:"_destroy",value:function(e,t){if(!this.destroyed){if(this._debug("destroy (error: %s)",e&&(e.message||e)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this.destroyed=!0,this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(e){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(e){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),this.emit("close"),t()}}},{key:"_setupData",value:function(e){var t=this;if(!e.channel)return this.destroy(p(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=e.channel,this._channel.binaryType="arraybuffer","number"===typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=65536),this.channelName=this._channel.label,this._channel.onmessage=function(e){t._onChannelMessage(e)},this._channel.onbufferedamountlow=function(){t._onChannelBufferedAmountLow()},this._channel.onopen=function(){t._onChannelOpen()},this._channel.onclose=function(){t._onChannelClose()},this._channel.onerror=function(e){t.destroy(p(e,"ERR_DATA_CHANNEL"))};var r=!1;this._closingInterval=setInterval((function(){t._channel&&"closing"===t._channel.readyState?(r&&t._onChannelClose(),r=!0):r=!1}),5e3)}},{key:"_read",value:function(){}},{key:"_write",value:function(e,t,r){if(this.destroyed)return r(p(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(e)}catch(n){return this.destroy(p(n,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>65536?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=r):r(null)}else this._debug("write before connect"),this._chunk=e,this._cb=r}},{key:"_onFinish",value:function(){var e=this;if(!this.destroyed){var t=function(){setTimeout((function(){return e.destroy()}),1e3)};this._connected?t():this.once("connect",t)}}},{key:"_startIceCompleteTimeout",value:function(){var e=this;this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((function(){e._iceComplete||(e._iceComplete=!0,e._debug("iceComplete timeout completed"),e.emit("iceTimeout"),e.emit("_iceComplete"))}),this.iceCompleteTimeout))}},{key:"_createOffer",value:function(){var e=this;this.destroyed||this._pc.createOffer(this.offerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=d(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp})}};e._pc.setLocalDescription(t).then((function(){e._debug("createOffer success"),e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})).catch((function(t){e.destroy(p(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(p(t,"ERR_CREATE_OFFER"))}))}},{key:"_requestMissingTransceivers",value:function(){var e=this;this._pc.getTransceivers&&this._pc.getTransceivers().forEach((function(t){t.mid||!t.sender.track||t.requested||(t.requested=!0,e.addTransceiver(t.sender.track.kind))}))}},{key:"_createAnswer",value:function(){var e=this;this.destroyed||this._pc.createAnswer(this.answerOptions).then((function(t){if(!e.destroyed){e.trickle||e.allowHalfTrickle||(t.sdp=d(t.sdp)),t.sdp=e.sdpTransform(t.sdp);var r=function(){if(!e.destroyed){var r=e._pc.localDescription||t;e._debug("signal"),e.emit("signal",{type:r.type,sdp:r.sdp}),e.initiator||e._requestMissingTransceivers()}};e._pc.setLocalDescription(t).then((function(){e.destroyed||(e.trickle||e._iceComplete?r():e.once("_iceComplete",r))})).catch((function(t){e.destroy(p(t,"ERR_SET_LOCAL_DESCRIPTION"))}))}})).catch((function(t){e.destroy(p(t,"ERR_CREATE_ANSWER"))}))}},{key:"_onConnectionStateChange",value:function(){this.destroyed||"failed"===this._pc.connectionState&&this.destroy(p(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}},{key:"_onIceStateChange",value:function(){if(!this.destroyed){var e=this._pc.iceConnectionState,t=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",e,t),this.emit("iceStateChange",e,t),"connected"!==e&&"completed"!==e||(this._pcReady=!0,this._maybeReady()),"failed"===e&&this.destroy(p(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===e&&this.destroy(p(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}}},{key:"getStats",value:function(e){var t=this,r=function(e){return"[object Array]"===Object.prototype.toString.call(e.values)&&e.values.forEach((function(t){Object.assign(e,t)})),e};0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((function(t){var n=[];t.forEach((function(e){n.push(r(e))})),e(null,n)}),(function(t){return e(t)})):this._pc.getStats.length>0?this._pc.getStats((function(n){if(!t.destroyed){var i=[];n.result().forEach((function(e){var t={};e.names().forEach((function(r){t[r]=e.stat(r)})),t.id=e.id,t.type=e.type,t.timestamp=e.timestamp,i.push(r(t))})),e(null,i)}}),(function(t){return e(t)})):e(null,[])}},{key:"_maybeReady",value:function(){var e=this;if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),!this._connected&&!this._connecting&&this._pcReady&&this._channelReady){this._connecting=!0;!function t(){e.destroyed||e.getStats((function(r,n){if(!e.destroyed){r&&(n=[]);var i={},a={},s={},o=!1;n.forEach((function(e){"remotecandidate"!==e.type&&"remote-candidate"!==e.type||(i[e.id]=e),"localcandidate"!==e.type&&"local-candidate"!==e.type||(a[e.id]=e),"candidatepair"!==e.type&&"candidate-pair"!==e.type||(s[e.id]=e)}));var u=function(t){o=!0;var r=a[t.localCandidateId];r&&(r.ip||r.address)?(e.localAddress=r.ip||r.address,e.localPort=Number(r.port)):r&&r.ipAddress?(e.localAddress=r.ipAddress,e.localPort=Number(r.portNumber)):"string"===typeof t.googLocalAddress&&(r=t.googLocalAddress.split(":"),e.localAddress=r[0],e.localPort=Number(r[1])),e.localAddress&&(e.localFamily=e.localAddress.includes(":")?"IPv6":"IPv4");var n=i[t.remoteCandidateId];n&&(n.ip||n.address)?(e.remoteAddress=n.ip||n.address,e.remotePort=Number(n.port)):n&&n.ipAddress?(e.remoteAddress=n.ipAddress,e.remotePort=Number(n.portNumber)):"string"===typeof t.googRemoteAddress&&(n=t.googRemoteAddress.split(":"),e.remoteAddress=n[0],e.remotePort=Number(n[1])),e.remoteAddress&&(e.remoteFamily=e.remoteAddress.includes(":")?"IPv6":"IPv4"),e._debug("connect local: %s:%s remote: %s:%s",e.localAddress,e.localPort,e.remoteAddress,e.remotePort)};if(n.forEach((function(e){"transport"===e.type&&e.selectedCandidatePairId&&u(s[e.selectedCandidatePairId]),("googCandidatePair"===e.type&&"true"===e.googActiveConnection||("candidatepair"===e.type||"candidate-pair"===e.type)&&e.selected)&&u(e)})),o||Object.keys(s).length&&!Object.keys(a).length){if(e._connecting=!1,e._connected=!0,e._chunk){try{e.send(e._chunk)}catch(r){return e.destroy(p(r,"ERR_DATA_CHANNEL"))}e._chunk=null,e._debug('sent chunk from "write before connect"');var c=e._cb;e._cb=null,c(null)}"number"!==typeof e._channel.bufferedAmountLowThreshold&&(e._interval=setInterval((function(){return e._onInterval()}),150),e._interval.unref&&e._interval.unref()),e._debug("connect"),e.emit("connect")}else setTimeout(t,100)}}))}()}}},{key:"_onInterval",value:function(){!this._cb||!this._channel||this._channel.bufferedAmount>65536||this._onChannelBufferedAmountLow()}},{key:"_onSignalingStateChange",value:function(){var e=this;this.destroyed||("stable"!==this._pc.signalingState||this._firstStable||(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((function(t){e._pc.removeTrack(t),e._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation&&(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()),this._debug("negotiate"),this.emit("negotiate")),this._firstStable=!1,this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}},{key:"_onIceCandidate",value:function(e){this.destroyed||(e.candidate&&this.trickle?this.emit("signal",{candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}}):e.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),e.candidate&&this._startIceCompleteTimeout())}},{key:"_onChannelMessage",value:function(e){if(!this.destroyed){var r=e.data;r instanceof ArrayBuffer&&(r=t.from(r)),this.push(r)}}},{key:"_onChannelBufferedAmountLow",value:function(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);var e=this._cb;this._cb=null,e(null)}}},{key:"_onChannelOpen",value:function(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}},{key:"_onChannelClose",value:function(){this.destroyed||(this._debug("on channel close"),this.destroy())}},{key:"_onTrack",value:function(e){var t=this;this.destroyed||e.streams.forEach((function(r){t._debug("on track"),t.emit("track",e.track,r),t._remoteTracks.push({track:e.track,stream:r}),t._remoteStreams.some((function(e){return e.id===r.id}))||(t._remoteStreams.push(r),l((function(){t.emit("stream",r)})))}))}},{key:"_debug",value:function(){var e=[].slice.call(arguments);e[0]="["+this._id+"] "+e[0],u.apply(null,e)}},{key:"bufferSize",get:function(){return this._channel&&this._channel.bufferedAmount||0}},{key:"connected",get:function(){return this._connected&&"open"===this._channel.readyState}}]),r}(h.Duplex);v.WEBRTC_SUPPORT=!!c(),v.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},v.channelConfig={},e.exports=v}).call(this,r(3).Buffer)},function(e,t,r){var n=r(2313),i=r(2081),a=r(2082),s=r(335),o=r(2083),u=r(475),c=r(19)("socket.io-client:manager"),f=r(474),h=r(815),l=Object.prototype.hasOwnProperty;function p(e,t){if(!(this instanceof p))return new p(e,t);e&&"object"===typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new h({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var r=t.parser||s;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}e.exports=p,p.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)l.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},p.prototype.updateSocketIds=function(){for(var e in this.nsps)l.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},p.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(p.prototype),p.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},p.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},p.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},p.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},p.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},p.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},p.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},p.prototype.open=p.prototype.connect=function(e,t){if(c("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;c("opening %s",this.uri),this.engine=n(this.uri,this.opts);var r=this.engine,i=this;this.readyState="opening",this.skipReconnect=!1;var a=o(r,"open",(function(){i.onopen(),e&&e()})),s=o(r,"error",(function(t){if(c("connect_error"),i.cleanup(),i.readyState="closed",i.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else i.maybeReconnectOnOpen()}));if(!1!==this._timeout){var u=this._timeout;c("connect attempt will timeout after %d",u);var f=setTimeout((function(){c("connect attempt timed out after %d",u),a.destroy(),r.close(),r.emit("error","timeout"),i.emitAll("connect_timeout",u)}),u);this.subs.push({destroy:function(){clearTimeout(f)}})}return this.subs.push(a),this.subs.push(s),this},p.prototype.onopen=function(){c("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(o(e,"data",u(this,"ondata"))),this.subs.push(o(e,"ping",u(this,"onping"))),this.subs.push(o(e,"pong",u(this,"onpong"))),this.subs.push(o(e,"error",u(this,"onerror"))),this.subs.push(o(e,"close",u(this,"onclose"))),this.subs.push(o(this.decoder,"decoded",u(this,"ondecoded")))},p.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},p.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},p.prototype.ondata=function(e){this.decoder.add(e)},p.prototype.ondecoded=function(e){this.emit("packet",e)},p.prototype.onerror=function(e){c("error",e),this.emitAll("error",e)},p.prototype.socket=function(e,t){var r=this.nsps[e];if(!r){r=new i(this,e,t),this.nsps[e]=r;var n=this;r.on("connecting",a),r.on("connect",(function(){r.id=n.generateId(e)})),this.autoConnect&&a()}function a(){~f(n.connecting,r)||n.connecting.push(r)}return r},p.prototype.destroy=function(e){var t=f(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},p.prototype.packet=function(e){c("writing packet %j",e);var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,(function(r){for(var n=0;n<r.length;n++)t.engine.write(r[n],e.options);t.encoding=!1,t.processPacketQueue()})))},p.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},p.prototype.cleanup=function(){c("cleanup");for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},p.prototype.close=p.prototype.disconnect=function(){c("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},p.prototype.onclose=function(e){c("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},p.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)c("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();c("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var r=setTimeout((function(){e.skipReconnect||(c("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open((function(t){t?(c("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(c("reconnect success"),e.onreconnect())})))}),t);this.subs.push({destroy:function(){clearTimeout(r)}})}},p.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,r){var n=r(2032),i=r(2315),a=r(2318),s=r(2319);t.polling=function(e){var t=!1,r=!1,s=!1!==e.jsonp;if("undefined"!==typeof location){var o="https:"===location.protocol,u=location.port;u||(u=o?443:80),t=e.hostname!==location.hostname||u!==e.port,r=e.secure!==o}if(e.xdomain=t,e.xscheme=r,"open"in new n(e)&&!e.forceJSONP)return new i(e);if(!s)throw new Error("JSONP disabled");return new a(e)},t.websocket=s},function(e,t,r){var n=r(2034),i=r(262),a=r(1971),s=r(263),o=r(473),u=r(19)("engine.io-client:polling");e.exports=f;var c=null!=new(r(2032))({xdomain:!1}).responseType;function f(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),n.call(this,e)}s(f,n),f.prototype.name="polling",f.prototype.doOpen=function(){this.poll()},f.prototype.pause=function(e){var t=this;function r(){u("paused"),t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var n=0;this.polling&&(u("we are currently polling - waiting to pause"),n++,this.once("pollComplete",(function(){u("pre-pause polling complete"),--n||r()}))),this.writable||(u("we are currently writing - waiting to pause"),n++,this.once("drain",(function(){u("pre-pause writing complete"),--n||r()})))}else r()},f.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},f.prototype.onData=function(e){var t=this;u("polling got data %s",e);a.decodePayload(e,this.socket.binaryType,(function(e,r,n){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)})),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},f.prototype.doClose=function(){var e=this;function t(){u("writing close packet"),e.write([{type:"close"}])}"open"===this.readyState?(u("transport open - closing"),t()):(u("transport not open - deferring close"),this.once("open",t))},f.prototype.write=function(e){var t=this;this.writable=!1;var r=function(){t.writable=!0,t.emit("drain")};a.encodePayload(e,this.supportsBinary,(function(e){t.doWrite(e,r)}))},f.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",r="";return!1!==this.timestampRequests&&(e[this.timestampParam]=o()),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(r=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e}},function(e,t,r){var n=r(335),i=r(2082),a=r(814),s=r(2083),o=r(475),u=r(19)("socket.io-client:socket"),c=r(262),f=r(472);e.exports=p;var h={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},l=i.prototype.emit;function p(e,t,r){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},r&&r.query&&(this.query=r.query),this.io.autoConnect&&this.open()}i(p.prototype),p.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[s(e,"open",o(this,"onopen")),s(e,"packet",o(this,"onpacket")),s(e,"close",o(this,"onclose"))]}},p.prototype.open=p.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},p.prototype.send=function(){var e=a(arguments);return e.unshift("message"),this.emit.apply(this,e),this},p.prototype.emit=function(e){if(h.hasOwnProperty(e))return l.apply(this,arguments),this;var t=a(arguments),r={type:(void 0!==this.flags.binary?this.flags.binary:f(t))?n.BINARY_EVENT:n.EVENT,data:t,options:{}};return r.options.compress=!this.flags||!1!==this.flags.compress,"function"===typeof t[t.length-1]&&(u("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this.flags={},this},p.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},p.prototype.onopen=function(){if(u("transport is open - connecting"),"/"!==this.nsp)if(this.query){var e="object"===typeof this.query?c.encode(this.query):this.query;u("sending connect packet with query %s",e),this.packet({type:n.CONNECT,query:e})}else this.packet({type:n.CONNECT})},p.prototype.onclose=function(e){u("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},p.prototype.onpacket=function(e){var t=e.nsp===this.nsp,r=e.type===n.ERROR&&"/"===e.nsp;if(t||r)switch(e.type){case n.CONNECT:this.onconnect();break;case n.EVENT:case n.BINARY_EVENT:this.onevent(e);break;case n.ACK:case n.BINARY_ACK:this.onack(e);break;case n.DISCONNECT:this.ondisconnect();break;case n.ERROR:this.emit("error",e.data)}},p.prototype.onevent=function(e){var t=e.data||[];u("emitting event %j",t),null!=e.id&&(u("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?l.apply(this,t):this.receiveBuffer.push(t)},p.prototype.ack=function(e){var t=this,r=!1;return function(){if(!r){r=!0;var i=a(arguments);u("sending ack %j",i),t.packet({type:f(i)?n.BINARY_ACK:n.ACK,id:e,data:i})}}},p.prototype.onack=function(e){var t=this.acks[e.id];"function"===typeof t?(u("calling ack %s with %j",e.id,e.data),t.apply(this,e.data),delete this.acks[e.id]):u("bad ack %s",e.id)},p.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},p.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)l.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},p.prototype.ondisconnect=function(){u("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},p.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},p.prototype.close=p.prototype.disconnect=function(){return this.connected&&(u("performing disconnect (%s)",this.nsp),this.packet({type:n.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},p.prototype.compress=function(e){return this.flags.compress=e,this},p.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t,r){function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}e.exports=n,n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function r(){this.off(e,r),t.apply(this,arguments)}return r.fn=t,this.on(e,r),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var r,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),r=this._callbacks["$"+e];if(r)for(var n=0,i=(r=r.slice(0)).length;n<i;++n)r[n].apply(this,t);return this},n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t){e.exports=function(e,t,r){return e.on(t,r),{destroy:function(){e.removeListener(t,r)}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(18),u=r(172),c=r(816),f=r(3).Buffer,h=r(2031).CLOSE_TIMEOUT,l=r(480),p=r(19),d=p("libp2p:webrtc-star:socket");d.error=p("libp2p:webrtc-star:socket:error");var v=function(e,t){if(e&&t)try{return l(e,t)}catch(r){return d.error(r),l("0.0.0.0",t)}};e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=c.duplex(e),l=r.sink,p=r.source,y=t.remoteAddr||v(e.remoteAddress,e.remotePort),b=v(e.localAddress,e.localPort),m={sink:function(e){return i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.signal&&(e=u(e,t.signal)),r.prev=1,r.next=4,l(s(n.mark((function t(){var r,i,s,u,c,h,l;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,i=!1,t.prev=2,u=o(e);case 4:return t.next=6,a(u.next());case 6:return c=t.sent,r=c.done,t.next=10,a(c.value);case 10:if(h=t.sent,r){t.next=18;break}return l=h,t.next=15,f.isBuffer(l)?l:l.slice();case 15:r=!0,t.next=4;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(2),i=!0,s=t.t0;case 24:if(t.prev=24,t.prev=25,r||null==u.return){t.next=29;break}return t.next=29,a(u.return());case 29:if(t.prev=29,!i){t.next=32;break}throw s;case 32:return t.finish(29);case 33:return t.finish(24);case 34:case"end":return t.stop()}}),t,null,[[2,20,24,34],[25,,29,33]])})))());case 4:r.next=9;break;case 6:r.prev=6,r.t0=r.catch(1),"aborted"!==r.t0.type&&d.error(r.t0);case 9:case"end":return r.stop()}}),r,null,[[1,6]])})))()},source:t.signal?u(p,t.signal):p,conn:e,localAddr:b,remoteAddr:y,timeline:{open:Date.now()},close:function(){if(!e.destroyed)return new Promise((function(t,r){var n=Date.now(),i=setTimeout((function(){if(m.remoteAddr){var t=m.remoteAddr.toOptions(),r=t.host,i=t.port;d("timeout closing socket to %s:%s after %dms, destroying it manually",r,i,Date.now()-n)}e.destroyed||e.destroy()}),h);e.once("close",(function(){t()})),e.end((function(e){if(clearTimeout(i),m.timeline.close=Date.now(),e)return r(e)}))}))}};return e.once("close",(function(){m.timeline.close||(m.timeline.close=Date.now())})),m}},function(e,t,r){"use strict";var n=r(72);(t=e.exports).cleanUrlSIO=function(e){var t=e.toString().split("/"),r=e.protos()[1].name,i=e.protos()[2].name,a=e.stringTuples()[1][1];if("tcp"!==r||"ws"!==i&&"wss"!==i)throw new Error("invalid multiaddr: "+e.toString());return n.isName(e)?"ws"===i?"http://"+t[2]+(80===a?"":":"+a):"wss"===i?"https://"+t[2]+(443===a?"":":"+a):void 0:"http://"+t[2]+":"+t[4]},t.cleanMultiaddr=function(e){var t="/libp2p-webrtc-star";if(-1!==e.indexOf(t)){e=e.substring(t.length,e.length);var r=n(e),i=r.stringTuples().filter((function(e){return 421===e[0]}))[0];e=(r=(r=(r=r.decapsulate("p2p")).encapsulate("/p2p-webrtc-star")).encapsulate("/p2p/".concat(i[1]))).toString()}return e}},function(e,t,r){"use strict";t.custom="inspect"},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=r(2331),o=t.alloc(8,0),u=t.alloc(64,0);u[0]=128;var c=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),f=function(){function e(){n(this,e),this.state=new Uint32Array(8),this.msg=new Uint32Array(64),this.block=t.allocUnsafe(64),this.size=-1}return i(e,[{key:"init",value:function(){return this.state[0]=1779033703,this.state[1]=3144134277,this.state[2]=1013904242,this.state[3]=2773480762,this.state[4]=1359893119,this.state[5]=2600822924,this.state[6]=528734635,this.state[7]=1541459225,this.size=0,this}},{key:"update",value:function(e){return a(t.isBuffer(e)),this._update(e,e.length),this}},{key:"final",value:function(){return this._final(t.allocUnsafe(32))}},{key:"_update",value:function(e,t){a(-1!==this.size,"Context is not initialized.");var r=63&this.size,n=0;if(this.size+=t,r>0){var i=64-r;if(i>t&&(i=t),e.copy(this.block,r,n,n+i),t-=i,n+=i,(r+=i)<64)return;this._transform(this.block,0)}for(;t>=64;)this._transform(e,n),n+=64,t-=64;t>0&&e.copy(this.block,0,n,n+t)}},{key:"_final",value:function(e){a(-1!==this.size,"Context is not initialized.");var t=63&this.size,r=8*this.size;y(o,r*(1/4294967296)>>>0,0),y(o,r>>>0,4),this._update(u,1+(119-t&63)),this._update(o,8);for(var n=0;n<8;n++)y(e,this.state[n],4*n),this.state[n]=0;for(var i=0;i<64;i++)this.msg[i]=0;for(var s=0;s<64;s++)this.block[s]=0;return this.size=-1,e}},{key:"_transform",value:function(e,t){for(var r,n,i,a=this.msg,s=this.state[0],o=this.state[1],u=this.state[2],f=this.state[3],y=this.state[4],b=this.state[5],m=this.state[6],g=this.state[7],k=0;k<16;k++)a[k]=(n=t+4*k,16777216*(r=e)[n++]+65536*r[n++]+256*r[n++]+r[n]);for(;k<64;k++)a[k]=(((i=a[k-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)+a[k-7]+p(a[k-15])+a[k-16];for(k=0;k<64;k++){var w=g+l(y)+d(y,b,m)+c[k]+a[k],x=h(s)+v(s,o,u);g=m,m=b,b=y,y=f+w>>>0,f=u,u=o,o=s,s=w+x>>>0}this.state[0]+=s,this.state[1]+=o,this.state[2]+=u,this.state[3]+=f,this.state[4]+=y,this.state[5]+=b,this.state[6]+=m,this.state[7]+=g}}],[{key:"hash",value:function(){return new e}},{key:"hmac",value:function(){return new s(e,64)}},{key:"digest",value:function(t){return e.ctx.init().update(t).final()}},{key:"root",value:function(r,n){return a(t.isBuffer(r)&&32===r.length),a(t.isBuffer(n)&&32===n.length),e.ctx.init().update(r).update(n).final()}},{key:"multi",value:function(t,r,n){var i=e.ctx;return i.init(),i.update(t),i.update(r),n&&i.update(n),i.final()}},{key:"mac",value:function(t,r){return e.hmac().init(r).update(t).final()}}]),e}();function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function l(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function p(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}function d(e,t,r){return r^e&(t^r)}function v(e,t,r){return e&t|r&(e|t)}function y(e,t,r){return e[r++]=t>>>24,e[r++]=t>>>16,e[r++]=t>>>8,e[r++]=t,r}f.native=0,f.id="SHA256",f.size=32,f.bits=256,f.blockSize=64,f.zero=t.alloc(32,0),f.ctx=new f,e.exports=f}).call(this,r(3).Buffer)},function(e,t,r){"use strict";e.exports=h;var n,i=r(1964),a=i.LongBits,s=i.base64,o=i.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function f(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}function l(e,t,r){t[r]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function d(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function v(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h},h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(d,10,a.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=a.from(e);return this._push(d,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=a.from(e).zzEncode();return this._push(d,t.length(),t)},h.prototype.bool=function(e){return this._push(l,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(v,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=a.from(e);return this._push(v,4,t.lo)._push(v,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var y=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(l,1,0);if(i.isString(e)){var r=h.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(y,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(l,1,0)},h.prototype.fork=function(){return this.states=new f(this),this.head=this.tail=new u(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e}},function(e,t,r){"use strict";e.exports=u;var n,i=r(1964),a=i.LongBits,s=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var c="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function f(){var e=new a(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function l(){if(this.pos+8>this.len)throw o(this,8);return new a(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return h(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|h(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw o(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!==(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return f.call(this)[t](!1)},uint64:function(){return f.call(this)[t](!0)},sint64:function(){return f.call(this).zzDecode()[t](!1)},fixed64:function(){return l.call(this)[t](!0)},sfixed64:function(){return l.call(this)[t](!1)}})}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(264);e.exports=function(){var e=i(n.mark((function e(t,r){var s,o,u,c,f,h=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=h.length>2&&void 0!==h[2]?h[2]:{},o=s.concurrency,u=void 0===o?1/0:o,c=s.stopOnError,f=void 0===c||c,e.abrupt("return",new Promise((function(e,s){if("function"!==typeof r)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(u)&&u!==1/0||!(u>=1))throw new TypeError("Expected `concurrency` to be an integer from 1 and up or `Infinity`, got `".concat(u,"` (").concat(typeof u,")"));for(var o=[],c=[],h=t[Symbol.iterator](),l=!1,p=!1,d=0,v=0,y=function t(){if(!l){var u=h.next(),y=v;if(v++,u.done)return p=!0,void(0===d&&(f||0===c.length?e(o):s(new a(c))));d++,i(n.mark((function e(){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.value;case 3:return i=e.sent,e.next=6,r(i,y);case 6:o[y]=e.sent,d--,t(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),f?(l=!0,s(e.t0)):(c.push(e.t0),d--,t());case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()}},b=0;b<u&&(y(),!p);b++);})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(224),u=r(3).Buffer,c=r(1955).multihash,f=c.fromB58String,h=c.toB58String,l=r(825),p=r(63),d=r(15),v=r(19),y=v("ipfs:ipns:pubsub");y.error=v("ipfs:ipns:pubsub:error");var b=function(){function e(t,r,n){a(this,e),this._pubsub=t,this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new l(t,r,n,o.validator,this._handleSubscriptionKey)}return s(e,[{key:"put",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._pubsubDs.put(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(n.mark((function e(t){var r,i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._pubsubDs.get(t);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),i=e.t0;case 9:if(t.slice(0,o.namespaceLength).toString()===o.namespace&&(a=h(t),s=h(t.slice(o.namespaceLength)),this._subscriptions[a]=s,y("subscribed to pubsub topic ".concat(a,", id ").concat(s))),!i){e.next=13;break}throw i;case 13:return e.abrupt("return",r);case 14:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleSubscriptionKey",value:function(e){u.isBuffer(e)&&(e=h(e));var t,r=this._subscriptions[e];if(!r)throw d(new Error("key ".concat(e," does not correspond to a subscription")),"ERR_INVALID_KEY");try{t=o.getIdKeys(f(r))}catch(n){throw y.error(n),n}return t.routingKey.toBuffer()}},{key:"getSubscriptions",value:function(){return Object.values(this._subscriptions).filter(Boolean).map((function(e){return"".concat(o.namespace).concat(e)}))}},{key:"cancel",value:function(){var e=i(n.mark((function e(t){var r,i,a=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof t){e.next=2;break}throw d(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");case 2:if(t.startsWith(o.namespace)&&(t=t.substring(o.namespaceLength)),r=Object.keys(this._subscriptions).find((function(e){return a._subscriptions[e]===t}))){e.next=6;break}return e.abrupt("return",{canceled:!1});case 6:return i=u.from(r),this._pubsubDs.unsubscribe(i),this._subscriptions[r]=void 0,y("unsubscribed pubsub ".concat(r,": ").concat(t)),e.abrupt("return",{canceled:!0});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports=p(b,{className:"IpnsPubsubDatastore",symbolName:"@js-ipfs/ipns/IpnsPubsubDatastore"})},function(e,t,r){"use strict";e.exports=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}},,function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19)("ipfs"),s=r(103),o=r(787).isTest,u=r(2095),c=r(788),f=r(3).Buffer,h=r(55),l=r(1981),p=r(149),d=r(72),v=r(150),y=r(49),b=r(1955),m=b.multihash,g=r(32),k=r(1974).NotInitializedError,w=r(1984),x=r(2437),S=function(){return{init:!0,start:!0,EXPERIMENTAL:{},preload:{enabled:!o,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}}};function E(){return(E=i(n.mark((function e(t){var r,o,u,c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s(S(),t),r=t.silent?a:console.log,o=new x,u=o.update({init:w.init({apiManager:o,print:r,options:t}),dns:w.dns(),isOnline:w.isOnline({})},i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new k;case 1:case"end":return e.stop()}}),e)})))),c=u.api,t.init){e.next=6;break}return e.abrupt("return",c);case 6:return e.next=8,c.init();case 8:if(t.start){e.next=10;break}return e.abrupt("return",c);case 10:return e.abrupt("return",c.start());case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={create:function(e){return E.apply(this,arguments)},crypto:l,isIPFS:p,Buffer:f,CID:g,multiaddr:d,multibase:v,multihash:m,multihashing:b,multicodec:y,PeerId:h,globSource:u,urlSource:c}},,function(e,t,r){"use strict";e.exports={SHA1:20,SHA256:32,SHA512:64}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2098),s=r(2100);t.create=function(){var e=i(n.mark((function e(t,r){var o,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s(t),u=a.createCipheriv(o,t,r),c=a.createDecipheriv(o,t,r),f={encrypt:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u.update(e));case 1:case"end":return t.stop()}}),t)})))()},decrypt:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.update(e));case 1:case"end":return t.stop()}}),t)})))()}},e.abrupt("return",f);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(3).Buffer;r(1995);var i=r(1950);e.exports={createCipheriv:function(e,t,r){var a=i.cipher.createCipher("AES-CTR",t.toString("binary"));return a.start({iv:r.toString("binary")}),{update:function(e){return a.update(i.util.createBuffer(e.toString("binary"))),n.from(a.output.getBytes(),"binary")}}},createDecipheriv:function(e,t,r){var a=i.cipher.createDecipher("AES-CTR",t.toString("binary"));return a.start({iv:r.toString("binary")}),{update:function(e){return a.update(i.util.createBuffer(e.toString("binary"))),n.from(a.output.getBytes(),"binary")}}}}},function(e,t,r){(function(t){var r={};e.exports=r;var n={};r.encode=function(e,t,r){if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==r&&"number"!==typeof r)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var i=0,a=t.length,s=t.charAt(0),o=[0];for(i=0;i<e.length;++i){for(var u=0,c=e[i];u<o.length;++u)c+=o[u]<<8,o[u]=c%a,c=c/a|0;for(;c>0;)o.push(c%a),c=c/a|0}for(i=0;0===e[i]&&i<e.length-1;++i)n+=s;for(i=o.length-1;i>=0;--i)n+=t[o[i]]}else n=function(e,t){var r=0,n=t.length,i=t.charAt(0),a=[0];for(r=0;r<e.length();++r){for(var s=0,o=e.at(r);s<a.length;++s)o+=a[s]<<8,a[s]=o%n,o=o/n|0;for(;o>0;)a.push(o%n),o=o/n|0}var u="";for(r=0;0===e.at(r)&&r<e.length()-1;++r)u+=i;for(r=a.length-1;r>=0;--r)u+=t[a[r]];return u}(e,t);if(r){var f=new RegExp(".{1,"+r+"}","g");n=n.match(f).join("\r\n")}return n},r.decode=function(e,r){if("string"!==typeof e)throw new TypeError('"input" must be a string.');if("string"!==typeof r)throw new TypeError('"alphabet" must be a string.');var i=n[r];if(!i){i=n[r]=[];for(var a=0;a<r.length;++a)i[r.charCodeAt(a)]=a}e=e.replace(/\s/g,"");var s=r.length,o=r.charAt(0),u=[0];for(a=0;a<e.length;a++){var c=i[e.charCodeAt(a)];if(void 0===c)return;for(var f=0,h=c;f<u.length;++f)h+=u[f]*s,u[f]=255&h,h>>=8;for(;h>0;)u.push(255&h),h>>=8}for(var l=0;e[l]===o&&l<e.length-1;++l)u.push(0);return"undefined"!==typeof t?t.from(u.reverse()):new Uint8Array(u.reverse())}}).call(this,r(3).Buffer)},function(e,t,r){"use strict";var n=r(48),i=r(15),a={16:"aes-128-ctr",32:"aes-256-ctr"};e.exports=function(e){var t=a[e.length];if(!t){var r=Object.entries(a).map((function(e){var t=n(e,2),r=t[0],i=t[1];return"".concat(r," (").concat(i,")")})).join(" / ");throw i(new Error("Invalid key length ".concat(e.length," bytes. Must be ").concat(r)),"ERR_INVALID_KEY_LENGTH")}return t}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(73)(r(1996));r(1972),r(2102);var o=r(1950),u=r(15);t=e.exports;var c={rsa:r(2112),ed25519:r(2122),secp256k1:r(2124)(s,r(2001))};t.supportedKeys=c,t.keysPBM=s;var f="secp256k1 support requires libp2p-crypto-secp256k1 package",h="ERR_MISSING_PACKAGE";function l(e){var t=c[e.toLowerCase()];if(!t){var r=Object.keys(c).join(" / ");throw u(new Error("invalid or unsupported key type ".concat(e,". Must be ").concat(r)),"ERR_UNSUPPORTED_KEY_TYPE")}return t}t.keyStretcher=r(2126),t.generateEphemeralKeyPair=r(2127),t.generateKeyPair=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l(t).generateKeyPair(r));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.generateKeyPairFromSeed=function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l(t),"ed25519"===t.toLowerCase()){e.next=3;break}throw u(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");case 3:return e.abrupt("return",a.generateKeyPairFromSeed(r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),t.unmarshalPublicKey=function(e){var t=s.PublicKey.decode(e),r=t.Data;switch(t.Type){case s.KeyType.RSA:return c.rsa.unmarshalRsaPublicKey(r);case s.KeyType.Ed25519:return c.ed25519.unmarshalEd25519PublicKey(r);case s.KeyType.Secp256k1:if(c.secp256k1)return c.secp256k1.unmarshalSecp256k1PublicKey(r);throw u(new Error(f),h);default:l(t.Type)}},t.marshalPublicKey=function(e,t){return l(t=(t||"rsa").toLowerCase()),e.bytes},t.unmarshalPrivateKey=function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.PrivateKey.decode(t),i=r.Data,e.t0=r.Type,e.next=e.t0===s.KeyType.RSA?5:e.t0===s.KeyType.Ed25519?6:e.t0===s.KeyType.Secp256k1?7:12;break;case 5:return e.abrupt("return",c.rsa.unmarshalRsaPrivateKey(i));case 6:return e.abrupt("return",c.ed25519.unmarshalEd25519PrivateKey(i));case 7:if(!c.secp256k1){e.next=11;break}return e.abrupt("return",c.secp256k1.unmarshalSecp256k1PrivateKey(i));case 11:throw u(new Error(f),h);case 12:l(r.Type);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.marshalPrivateKey=function(e,t){return l(t=(t||"rsa").toLowerCase()),e.bytes},t.import=function(){var e=i(n.mark((function e(t,r){var i,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(i=o.pki.decryptRsaPrivateKey(t,r))){e.next=3;break}throw u(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");case 3:return s=o.asn1.toDer(o.pki.privateKeyToAsn1(i)),s=a.from(s.getBytes(),"binary"),e.abrupt("return",c.rsa.unmarshalRsaPrivateKey(s));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){var n=r(1950);if(r(1995),r(1972),r(2103),r(1967),r(1997),r(2043),r(2105),r(1973),r(2108),r(1999),r(1952),"undefined"===typeof i)var i=n.jsbn.BigInteger;var a=n.asn1,s=n.pki=n.pki||{};e.exports=s.pbe=n.pbe=n.pbe||{};var o=s.oids,u={name:"EncryptedPrivateKeyInfo",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},c={name:"PBES2Algorithms",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:a.Class.UNIVERSAL,type:a.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},f={name:"pkcs-12PbeParams",tagClass:a.Class.UNIVERSAL,type:a.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:a.Class.UNIVERSAL,type:a.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:a.Class.UNIVERSAL,type:a.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function l(e){var t;if(e){if(!(t=s.oids[a.derToOid(e)])){var r=new Error("Unsupported PRF OID.");throw r.oid=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}}else t="hmacWithSHA1";return p(t)}function p(e){var t=n.md;switch(e){case"hmacWithSHA224":t=n.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=e,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}s.encryptPrivateKeyInfo=function(e,t,r){(r=r||{}).saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var i,u,c,f=n.random.getBytesSync(r.saltSize),h=r.count,l=a.integerToDer(h);if(0===r.algorithm.indexOf("aes")||"des"===r.algorithm){var d,v,y;switch(r.algorithm){case"aes128":i=16,d=16,v=o["aes128-CBC"],y=n.aes.createEncryptionCipher;break;case"aes192":i=24,d=16,v=o["aes192-CBC"],y=n.aes.createEncryptionCipher;break;case"aes256":i=32,d=16,v=o["aes256-CBC"],y=n.aes.createEncryptionCipher;break;case"des":i=8,d=8,v=o.desCBC,y=n.des.createEncryptionCipher;break;default:throw(x=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,x}var b="hmacWith"+r.prfAlgorithm.toUpperCase(),m=p(b),g=n.pkcs5.pbkdf2(t,f,h,i,m),k=n.random.getBytesSync(d);(S=y(g)).start(k),S.update(a.toDer(e)),S.finish(),c=S.output.getBytes();var w=function(e,t,r,i){var o=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,e),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==i&&o.value.push(a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,n.util.hexToBytes(r.toString(16))),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(s.oids[i]).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.NULL,!1,"")]));return o}(f,l,i,b);u=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o.pkcs5PBES2).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o.pkcs5PBKDF2).getBytes()),w]),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(v).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,k)])])])}else{var x;if("3des"!==r.algorithm)throw(x=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=r.algorithm,x;i=24;var S,E=new n.util.ByteBuffer(f);g=s.pbe.generatePkcs12Key(t,E,1,h,i),k=s.pbe.generatePkcs12Key(t,E,2,h,i);(S=n.des.createEncryptionCipher(g)).start(k),S.update(a.toDer(e)),S.finish(),c=S.output.getBytes(),u=a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OID,!1,a.oidToDer(o["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,f),a.create(a.Class.UNIVERSAL,a.Type.INTEGER,!1,l.getBytes())])])}return a.create(a.Class.UNIVERSAL,a.Type.SEQUENCE,!0,[u,a.create(a.Class.UNIVERSAL,a.Type.OCTETSTRING,!1,c)])},s.decryptPrivateKeyInfo=function(e,t){var r=null,i={},o=[];if(!a.validate(e,u,i,o)){var c=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=o,c}var f=a.derToOid(i.encryptionOid),h=s.pbe.getCipher(f,i.encryptionParams,t),l=n.util.createBuffer(i.encryptedData);return h.update(l),h.finish()&&(r=a.fromDer(h.output)),r},s.encryptedPrivateKeyToPem=function(e,t){var r={type:"ENCRYPTED PRIVATE KEY",body:a.toDer(e).getBytes()};return n.pem.encode(r,{maxline:t})},s.encryptedPrivateKeyFromPem=function(e){var t=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return a.fromDer(t.body)},s.encryptRsaPrivateKey=function(e,t,r){if(!(r=r||{}).legacy){var i=s.wrapRsaPrivateKey(s.privateKeyToAsn1(e));return i=s.encryptPrivateKeyInfo(i,t,r),s.encryptedPrivateKeyToPem(i)}var o,u,c,f;switch(r.algorithm){case"aes128":o="AES-128-CBC",c=16,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"aes192":o="AES-192-CBC",c=24,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"aes256":o="AES-256-CBC",c=32,u=n.random.getBytesSync(16),f=n.aes.createEncryptionCipher;break;case"3des":o="DES-EDE3-CBC",c=24,u=n.random.getBytesSync(8),f=n.des.createEncryptionCipher;break;case"des":o="DES-CBC",c=8,u=n.random.getBytesSync(8),f=n.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw h.algorithm=r.algorithm,h}var l=f(n.pbe.opensslDeriveBytes(t,u.substr(0,8),c));l.start(u),l.update(a.toDer(s.privateKeyToAsn1(e))),l.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:o,parameters:n.util.bytesToHex(u).toUpperCase()},body:l.output.getBytes()};return n.pem.encode(p)},s.decryptRsaPrivateKey=function(e,t){var r=null,i=n.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw(c=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=c,c;if(i.procType&&"ENCRYPTED"===i.procType.type){var o,u;switch(i.dekInfo.algorithm){case"DES-CBC":o=8,u=n.des.createDecryptionCipher;break;case"DES-EDE3-CBC":o=24,u=n.des.createDecryptionCipher;break;case"AES-128-CBC":o=16,u=n.aes.createDecryptionCipher;break;case"AES-192-CBC":o=24,u=n.aes.createDecryptionCipher;break;case"AES-256-CBC":o=32,u=n.aes.createDecryptionCipher;break;case"RC2-40-CBC":o=5,u=function(e){return n.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":o=8,u=function(e){return n.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":o=16,u=function(e){return n.rc2.createDecryptionCipher(e,128)};break;default:var c;throw(c=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".')).algorithm=i.dekInfo.algorithm,c}var f=n.util.hexToBytes(i.dekInfo.parameters),h=u(n.pbe.opensslDeriveBytes(t,f.substr(0,8),o));if(h.start(f),h.update(n.util.createBuffer(i.body)),!h.finish())return r;r=h.output.getBytes()}else r=i.body;return null!==(r="ENCRYPTED PRIVATE KEY"===i.type?s.decryptPrivateKeyInfo(a.fromDer(r),t):a.fromDer(r))&&(r=s.privateKeyFromAsn1(r)),r},s.pbe.generatePkcs12Key=function(e,t,r,i,a,s){var o,u;if("undefined"===typeof s||null===s){if(!("sha1"in n.md))throw new Error('"sha1" hash algorithm unavailable.');s=n.md.sha1.create()}var c=s.digestLength,f=s.blockLength,h=new n.util.ByteBuffer,l=new n.util.ByteBuffer;if(null!==e&&void 0!==e){for(u=0;u<e.length;u++)l.putInt16(e.charCodeAt(u));l.putInt16(0)}var p=l.length(),d=t.length(),v=new n.util.ByteBuffer;v.fillWithByte(r,f);var y=f*Math.ceil(d/f),b=new n.util.ByteBuffer;for(u=0;u<y;u++)b.putByte(t.at(u%d));var m=f*Math.ceil(p/f),g=new n.util.ByteBuffer;for(u=0;u<m;u++)g.putByte(l.at(u%p));var k=b;k.putBuffer(g);for(var w=Math.ceil(a/c),x=1;x<=w;x++){var S=new n.util.ByteBuffer;S.putBytes(v.bytes()),S.putBytes(k.bytes());for(var E=0;E<i;E++)s.start(),s.update(S.getBytes()),S=s.digest();var _=new n.util.ByteBuffer;for(u=0;u<f;u++)_.putByte(S.at(u%c));var I=Math.ceil(d/f)+Math.ceil(p/f),A=new n.util.ByteBuffer;for(o=0;o<I;o++){var T=new n.util.ByteBuffer(k.getBytes(f)),C=511;for(u=_.length()-1;u>=0;u--)C>>=8,C+=_.at(u)+T.at(u),T.setAt(u,255&C);A.putBuffer(T)}k=A,h.putBuffer(S)}return h.truncate(h.length()-a),h},s.pbe.getCipher=function(e,t,r){switch(e){case s.oids.pkcs5PBES2:return s.pbe.getCipherForPBES2(e,t,r);case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case s.oids["pbewithSHAAnd40BitRC2-CBC"]:return s.pbe.getCipherForPKCS12PBE(e,t,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=e,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}},s.pbe.getCipherForPBES2=function(e,t,r){var i,o={},u=[];if(!a.validate(t,c,o,u))throw(i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=u,i;if((e=a.derToOid(o.kdfOid))!==s.oids.pkcs5PBKDF2)throw(i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,i.supportedOids=["pkcs5PBKDF2"],i;if((e=a.derToOid(o.encOid))!==s.oids["aes128-CBC"]&&e!==s.oids["aes192-CBC"]&&e!==s.oids["aes256-CBC"]&&e!==s.oids["des-EDE3-CBC"]&&e!==s.oids.desCBC)throw(i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i;var f,h,p=o.kdfSalt,d=n.util.createBuffer(o.kdfIterationCount);switch(d=d.getInt(d.length()<<3),s.oids[e]){case"aes128-CBC":f=16,h=n.aes.createDecryptionCipher;break;case"aes192-CBC":f=24,h=n.aes.createDecryptionCipher;break;case"aes256-CBC":f=32,h=n.aes.createDecryptionCipher;break;case"des-EDE3-CBC":f=24,h=n.des.createDecryptionCipher;break;case"desCBC":f=8,h=n.des.createDecryptionCipher}var v=l(o.prfOid),y=n.pkcs5.pbkdf2(r,p,d,f,v),b=o.encIv,m=h(y);return m.start(b),m},s.pbe.getCipherForPKCS12PBE=function(e,t,r){var i={},o=[];if(!a.validate(t,f,i,o))throw(v=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=o,v;var u,c,h,p=n.util.createBuffer(i.salt),d=n.util.createBuffer(i.iterations);switch(d=d.getInt(d.length()<<3),e){case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:u=24,c=8,h=n.des.startDecrypting;break;case s.oids["pbewithSHAAnd40BitRC2-CBC"]:u=5,c=8,h=function(e,t){var r=n.rc2.createDecryptionCipher(e,40);return r.start(t,null),r};break;default:var v;throw(v=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,v}var y=l(i.prfOid),b=s.pbe.generatePkcs12Key(r,p,1,d,u,y);return y.start(),h(b,s.pbe.generatePkcs12Key(r,p,2,d,c,y))},s.pbe.opensslDeriveBytes=function(e,t,r,i){if("undefined"===typeof i||null===i){if(!("md5"in n.md))throw new Error('"md5" hash algorithm unavailable.');i=n.md.md5.create()}null===t&&(t="");for(var a=[h(i,e+t)],s=16,o=1;s<r;++o,s+=16)a.push(h(i,a[o-1]+e+t));return a.join("").substr(0,r)}},function(e,t,r){var n=r(1950);function i(e,t){n.cipher.registerAlgorithm(e,(function(){return new n.des.Algorithm(e,t)}))}r(2041),r(2042),r(1952),e.exports=n.des=n.des||{},n.des.startEncrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!1,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createEncryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!1,mode:t})},n.des.startDecrypting=function(e,t,r,n){var i=d({key:e,output:r,decrypt:!0,mode:n||(null===t?"ECB":"CBC")});return i.start(t),i},n.des.createDecryptionCipher=function(e,t){return d({key:e,output:null,decrypt:!0,mode:t})},n.des.Algorithm=function(e,t){var r=this;r.name=e,r.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return p(r._keys,e,t,!1)},decrypt:function(e,t){return p(r._keys,e,t,!0)}}}),r._init=!1},n.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=n.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,r=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],n=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],a=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],u=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],f=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],l=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],v=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],y=e.length()>8?3:1,b=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],g=0,k=0;k<y;k++){var w=e.getInt32(),x=e.getInt32();w^=(t=252645135&(w>>>4^x))<<4,w^=t=65535&((x^=t)>>>-16^w),w^=(t=858993459&(w>>>2^(x^=t<<-16)))<<2,w^=t=65535&((x^=t)>>>-16^w),w^=(t=1431655765&(w>>>1^(x^=t<<-16)))<<1,w^=t=16711935&((x^=t)>>>8^w),t=(w^=(t=1431655765&(w>>>1^(x^=t<<8)))<<1)<<8|(x^=t)>>>20&240,w=x<<24|x<<8&16711680|x>>>8&65280|x>>>24&240,x=t;for(var S=0;S<m.length;++S){m[S]?(w=w<<2|w>>>26,x=x<<2|x>>>26):(w=w<<1|w>>>27,x=x<<1|x>>>27);var E=r[(w&=-15)>>>28]|n[w>>>24&15]|i[w>>>20&15]|a[w>>>16&15]|s[w>>>12&15]|o[w>>>8&15]|u[w>>>4&15],_=c[(x&=-15)>>>28]|f[x>>>24&15]|h[x>>>20&15]|l[x>>>16&15]|p[x>>>12&15]|d[x>>>8&15]|v[x>>>4&15];t=65535&(_>>>16^E),b[g++]=E^t,b[g++]=_^t<<16}}return b}(t),this._init=!0}},i("DES-ECB",n.cipher.modes.ecb),i("DES-CBC",n.cipher.modes.cbc),i("DES-CFB",n.cipher.modes.cfb),i("DES-OFB",n.cipher.modes.ofb),i("DES-CTR",n.cipher.modes.ctr),i("3DES-ECB",n.cipher.modes.ecb),i("3DES-CBC",n.cipher.modes.cbc),i("3DES-CFB",n.cipher.modes.cfb),i("3DES-OFB",n.cipher.modes.ofb),i("3DES-CTR",n.cipher.modes.ctr);var a=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],s=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],o=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],u=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],c=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],f=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],l=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function p(e,t,r,n){var i,p,d=32===e.length?3:9;i=3===d?n?[30,-2,-2]:[0,32,2]:n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var v=t[0],y=t[1];v^=(p=252645135&(v>>>4^y))<<4,v^=(p=65535&(v>>>16^(y^=p)))<<16,v^=p=858993459&((y^=p)>>>2^v),v^=p=16711935&((y^=p<<2)>>>8^v),v=(v^=(p=1431655765&(v>>>1^(y^=p<<8)))<<1)<<1|v>>>31,y=(y^=p)<<1|y>>>31;for(var b=0;b<d;b+=3){for(var m=i[b+1],g=i[b+2],k=i[b];k!=m;k+=g){var w=y^e[k],x=(y>>>4|y<<28)^e[k+1];p=v,v=y,y=p^(s[w>>>24&63]|u[w>>>16&63]|f[w>>>8&63]|l[63&w]|a[x>>>24&63]|o[x>>>16&63]|c[x>>>8&63]|h[63&x])}p=v,v=y,y=p}y=y>>>1|y<<31,y^=p=1431655765&((v=v>>>1|v<<31)>>>1^y),y^=(p=16711935&(y>>>8^(v^=p<<1)))<<8,y^=(p=858993459&(y>>>2^(v^=p)))<<2,y^=p=65535&((v^=p)>>>16^y),y^=p=252645135&((v^=p<<16)>>>4^y),v^=p<<4,r[0]=v,r[1]=y}function d(e){var t,r="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?n.cipher.createDecipher(r,e.key):n.cipher.createCipher(r,e.key)).start;return t.start=function(e,r){var a=null;r instanceof n.util.ByteBuffer&&(a=r,r={}),(r=r||{}).output=a,r.iv=e,i.call(t,r)},t}},function(e,t,r){var n=r(1950);r(1967),r(1952),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,r=null,i=null,a={start:function(a,s){if(null!==a)if("string"===typeof a){if(!((a=a.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+a+'"');t=n.md.algorithms[a].create()}else t=a;if(null===s)s=e;else{if("string"===typeof s)s=n.util.createBuffer(s);else if(n.util.isArray(s)){var o=s;s=n.util.createBuffer();for(var u=0;u<o.length;++u)s.putByte(o[u])}var c=s.length();c>t.blockLength&&(t.start(),t.update(s.bytes()),s=t.digest()),r=n.util.createBuffer(),i=n.util.createBuffer(),c=s.length();for(u=0;u<c;++u){o=s.at(u);r.putByte(54^o),i.putByte(92^o)}if(c<t.blockLength)for(o=t.blockLength-c,u=0;u<o;++u)r.putByte(54),i.putByte(92);e=s,r=r.bytes(),i=i.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(i),t.update(e),t.digest()}};return a.digest=a.getMac,a}},function(e,t,r){var n=r(1950);r(1952);var i=e.exports=n.pem=n.pem||{};function a(e){for(var t=e.name+": ",r=[],n=function(e,t){return" "+t},i=0;i<e.values.length;++i)r.push(e.values[i].replace(/^(\S+\r\n)/,n));t+=r.join(",")+"\r\n";var a=0,s=-1;for(i=0;i<t.length;++i,++a)if(a>65&&-1!==s){var o=t[s];","===o?(++s,t=t.substr(0,s)+"\r\n "+t.substr(s)):t=t.substr(0,s)+"\r\n"+o+t.substr(s+1),a=i-s-1,s=-1,++i}else" "!==t[i]&&"\t"!==t[i]&&","!==t[i]||(s=i);return t}function s(e){return e.replace(/^\s+/,"")}i.encode=function(e,t){t=t||{};var r,i="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(i+=a(r={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(i+=a(r={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(r={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&r.values.push(e.dekInfo.parameters),i+=a(r)),e.headers)for(var s=0;s<e.headers.length;++s)i+=a(e.headers[s]);return e.procType&&(i+="\r\n"),i+=n.util.encode64(e.body,t.maxline||64)+"\r\n",i+="-----END "+e.type+"-----\r\n"},i.decode=function(e){for(var t,r=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,a=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,o=/\r?\n/;t=i.exec(e);){var u={type:t[1],procType:null,contentDomain:null,dekInfo:null,headers:[],body:n.util.decode64(t[3])};if(r.push(u),t[2]){for(var c=t[2].split(o),f=0;t&&f<c.length;){for(var h=c[f].replace(/\s+$/,""),l=f+1;l<c.length;++l){var p=c[l];if(!/\s/.test(p[0]))break;h+=p,f=l}if(t=h.match(a)){for(var d={name:t[1],values:[]},v=t[2].split(","),y=0;y<v.length;++y)d.values.push(s(v[y]));if(u.procType)if(u.contentDomain||"Content-Domain"!==d.name)if(u.dekInfo||"DEK-Info"!==d.name)u.headers.push(d);else{if(0===d.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');u.dekInfo={algorithm:v[0],parameters:v[1]||null}}else u.contentDomain=v[0]||"";else{if("Proc-Type"!==d.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==d.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');u.procType={version:v[0],type:v[1]}}}++f}if("ENCRYPTED"===u.procType&&!u.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===r.length)throw new Error("Invalid PEM formatted message.");return r}},function(e,t,r){var n=r(1950);r(1967),r(1952);var i=e.exports=n.sha256=n.sha256||{};n.md.sha256=n.md.algorithms.sha256=i,i.create=function(){s||(a=String.fromCharCode(128),a+=n.util.fillString(String.fromCharCode(0),64),o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=!0);var e=null,t=n.util.createBuffer(),r=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,a=0;a<r;++a)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=n.util.encodeUtf8(a));var o=a.length;i.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=o[1],o[1]=o[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,o[0]=o[1]/4294967296>>>0;return t.putBytes(a),u(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var o,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-c));for(var f=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)f+=(o=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(f>>>0),f=o>>>0;s.putInt32(f);var l={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};u(l,r,s);var p=n.util.createBuffer();return p.putInt32(l.h0),p.putInt32(l.h1),p.putInt32(l.h2),p.putInt32(l.h3),p.putInt32(l.h4),p.putInt32(l.h5),p.putInt32(l.h6),p.putInt32(l.h7),p},i};var a=null,s=!1,o=null;function u(e,t,r){for(var n,i,a,s,u,c,f,h,l,p,d,v,y,b=r.length();b>=64;){for(u=0;u<16;++u)t[u]=r.getInt32();for(;u<64;++u)n=((n=t[u-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=((i=t[u-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[u]=n+t[u-7]+i+t[u-16]|0;for(c=e.h0,f=e.h1,h=e.h2,l=e.h3,p=e.h4,d=e.h5,v=e.h6,y=e.h7,u=0;u<64;++u)a=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=c&f|h&(c^f),n=y+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(v^p&(d^v))+o[u]+t[u],y=v,v=d,d=p,p=l+n>>>0,l=h,h=f,f=c,c=n+(i=a+s)>>>0;e.h0=e.h0+c|0,e.h1=e.h1+f|0,e.h2=e.h2+h|0,e.h3=e.h3+l|0,e.h4=e.h4+p|0,e.h5=e.h5+d|0,e.h6=e.h6+v|0,e.h7=e.h7+y|0,b-=64}}},function(e,t,r){(function(t){var n=r(1950);r(1952);var i=null;!n.util.isNodejs||n.options.usePureJavaScript||t.versions["node-webkit"]||(i=r(1998)),(e.exports=n.prng=n.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=e.md,a=new Array(32),s=0;s<32;++s)a[s]=r.create();function o(){if(t.pools[0].messageLength>=32)return u();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),u()}function u(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var r=1,n=0;n<32;++n)t.reseeds%r===0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),r<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var i=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(i),t.generated=0}function c(e){var t=null,r=n.util.globalScope,i=r.crypto||r.msCrypto;i&&i.getRandomValues&&(t=function(e){return i.getRandomValues(e)});var a=n.util.createBuffer();if(t)for(;a.length()<e;){var s=Math.max(1,Math.min(e-a.length(),65536)/4),o=new Uint32Array(Math.floor(s));try{t(o);for(var u=0;u<o.length;++u)a.putInt32(o[u])}catch(p){if(!("undefined"!==typeof QuotaExceededError&&p instanceof QuotaExceededError))throw p}}if(a.length()<e)for(var c,f,h,l=Math.floor(65536*Math.random());a.length()<e;){f=16807*(65535&l),f+=(32767&(c=16807*(l>>16)))<<16,l=4294967295&(f=(2147483647&(f+=c>>15))+(f>>31));for(u=0;u<3;++u)h=l>>>(u<<3),h^=Math.floor(256*Math.random()),a.putByte(String.fromCharCode(255&h))}return a.getBytes(e)}return t.pools=a,t.pool=0,t.generate=function(e,r){if(!r)return t.generateSync(e);var i=t.plugin.cipher,a=t.plugin.increment,s=t.plugin.formatKey,o=t.plugin.formatSeed,c=n.util.createBuffer();t.key=null,function f(h){if(h)return r(h);if(c.length()>=e)return r(null,c.getBytes(e));t.generated>1048575&&(t.key=null);if(null===t.key)return n.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return u(),e();var r=32-t.pools[0].messageLength<<5;t.seedFile(r,(function(r,n){if(r)return e(r);t.collect(n),u(),e()}))}(f)}));var l=i(t.key,t.seed);t.generated+=l.length,c.putBytes(l),t.key=s(i(t.key,a(t.seed))),t.seed=o(i(t.key,t.seed)),n.util.setImmediate(f)}()},t.generateSync=function(e){var r=t.plugin.cipher,i=t.plugin.increment,a=t.plugin.formatKey,s=t.plugin.formatSeed;t.key=null;for(var u=n.util.createBuffer();u.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&o();var c=r(t.key,t.seed);t.generated+=c.length,u.putBytes(c),t.key=a(r(t.key,i(t.seed))),t.seed=s(r(t.key,t.seed))}return u.getBytes(e)},i?(t.seedFile=function(e,t){i.randomBytes(e,(function(e,r){if(e)return t(e);t(null,r.toString())}))},t.seedFileSync=function(e){return i.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,c(e))}catch(r){t(r)}},t.seedFileSync=c),t.collect=function(e){for(var r=e.length,n=0;n<r;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,r){for(var n="",i=0;i<r;i+=8)n+=String.fromCharCode(e>>i&255);t.collect(n)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){self.addEventListener("message",(function e(r){var n=r.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(r){var n=r.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})}))}))}},t}}).call(this,r(37))},function(e,t,r){var n=r(1950);r(1952);var i=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],a=[1,2,3,5],s=function(e,t){return e<<t&65535|(65535&e)>>16-t},o=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=n.rc2=n.rc2||{},n.rc2.expandKey=function(e,t){"string"===typeof e&&(e=n.util.createBuffer(e)),t=t||128;var r,a=e,s=e.length(),o=t,u=Math.ceil(o/8),c=255>>(7&o);for(r=s;r<128;r++)a.putByte(i[a.at(r-1)+a.at(r-s)&255]);for(a.setAt(128-u,i[a.at(128-u)&c]),r=127-u;r>=0;r--)a.setAt(r,i[a.at(r+1)^a.at(r+u)]);return a};var u=function(e,t,r){var i,u,c,f,h=!1,l=null,p=null,d=null,v=[];for(e=n.rc2.expandKey(e,t),c=0;c<64;c++)v.push(e.getInt16Le());r?(i=function(e){for(c=0;c<4;c++)e[c]+=v[f]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),e[c]=s(e[c],a[c]),f++},u=function(e){for(c=0;c<4;c++)e[c]+=v[63&e[(c+3)%4]]}):(i=function(e){for(c=3;c>=0;c--)e[c]=o(e[c],a[c]),e[c]-=v[f]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),f--},u=function(e){for(c=3;c>=0;c--)e[c]-=v[63&e[(c+3)%4]]});var y=function(e){var t=[];for(c=0;c<4;c++){var n=l.getInt16Le();null!==d&&(r?n^=d.getInt16Le():d.putInt16Le(n)),t.push(65535&n)}f=r?0:63;for(var i=0;i<e.length;i++)for(var a=0;a<e[i][0];a++)e[i][1](t);for(c=0;c<4;c++)null!==d&&(r?d.putInt16Le(t[c]):t[c]^=d.getInt16Le()),p.putInt16Le(t[c])},b=null;return b={start:function(e,t){e&&"string"===typeof e&&(e=n.util.createBuffer(e)),h=!1,l=n.util.createBuffer(),p=t||new n.util.createBuffer,d=e,b.output=p},update:function(e){for(h||l.putBuffer(e);l.length()>=8;)y([[5,i],[1,u],[6,i],[1,u],[5,i]])},finish:function(e){var t=!0;if(r)if(e)t=e(8,l,!r);else{var n=8===l.length()?8:8-l.length();l.fillWithByte(n,n)}if(t&&(h=!0,b.update()),!r&&(t=0===l.length()))if(e)t=e(8,p,!r);else{var i=p.length(),a=p.at(i-1);a>i?t=!1:p.truncate(a)}return t}}};n.rc2.startEncrypting=function(e,t,r){var i=n.rc2.createEncryptionCipher(e,128);return i.start(t,r),i},n.rc2.createEncryptionCipher=function(e,t){return u(e,t,!0)},n.rc2.startDecrypting=function(e,t,r){var i=n.rc2.createDecryptionCipher(e,128);return i.start(t,r),i},n.rc2.createDecryptionCipher=function(e,t){return u(e,t,!1)}},function(e,t,r){var n=r(1950);r(1952),r(1973),r(2110);var i=e.exports=n.pkcs1=n.pkcs1||{};function a(e,t,r){r||(r=n.md.sha1.create());for(var i="",a=Math.ceil(t/r.digestLength),s=0;s<a;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);r.start(),r.update(e+o),i+=r.digest().getBytes()}return i.substring(0,t)}i.encode_rsa_oaep=function(e,t,r){var i,s,o,u;"string"===typeof r?(i=r,s=arguments[3]||void 0,o=arguments[4]||void 0):r&&(i=r.label||void 0,s=r.seed||void 0,o=r.md||void 0,r.mgf1&&r.mgf1.md&&(u=r.mgf1.md)),o?o.start():o=n.md.sha1.create(),u||(u=o);var c=Math.ceil(e.n.bitLength()/8),f=c-2*o.digestLength-2;if(t.length>f)throw(y=new Error("RSAES-OAEP input message length is too long.")).length=t.length,y.maxLength=f,y;i||(i=""),o.update(i,"raw");for(var h=o.digest(),l="",p=f-t.length,d=0;d<p;d++)l+="\0";var v=h.getBytes()+l+"\x01"+t;if(s){if(s.length!==o.digestLength){var y;throw(y=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=s.length,y.digestLength=o.digestLength,y}}else s=n.random.getBytes(o.digestLength);var b=a(s,c-o.digestLength-1,u),m=n.util.xorBytes(v,b,v.length),g=a(m,o.digestLength,u),k=n.util.xorBytes(s,g,s.length);return"\0"+k+m},i.decode_rsa_oaep=function(e,t,r){var i,s,o;"string"===typeof r?(i=r,s=arguments[3]||void 0):r&&(i=r.label||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md));var u=Math.ceil(e.n.bitLength()/8);if(t.length!==u)throw(m=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,m.expectedLength=u,m;if(void 0===s?s=n.md.sha1.create():s.start(),o||(o=s),u<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),s.update(i,"raw");for(var c=s.digest().getBytes(),f=t.charAt(0),h=t.substring(1,s.digestLength+1),l=t.substring(1+s.digestLength),p=a(l,s.digestLength,o),d=n.util.xorBytes(h,p,h.length),v=a(d,u-s.digestLength-1,o),y=n.util.xorBytes(l,v,l.length),b=y.substring(0,s.digestLength),m="\0"!==f,g=0;g<s.digestLength;++g)m|=c.charAt(g)!==b.charAt(g);for(var k=1,w=s.digestLength,x=s.digestLength;x<y.length;x++){var S=y.charCodeAt(x),E=1&S^1,_=k?65534:0;m|=S&_,w+=k&=E}if(m||1!==y.charCodeAt(w))throw new Error("Invalid RSAES-OAEP padding.");return y.substring(w+1)}},function(e,t,r){var n=r(1950);r(1967),r(1952);var i=e.exports=n.sha1=n.sha1||{};n.md.sha1=n.md.algorithms.sha1=i,i.create=function(){s||(a=String.fromCharCode(128),a+=n.util.fillString(String.fromCharCode(0),64),s=!0);var e=null,t=n.util.createBuffer(),r=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,a=0;a<r;++a)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=n.util.encodeUtf8(a));var u=a.length;i.messageLength+=u,u=[u/4294967296>>>0,u>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=u[1],u[1]=u[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,u[0]=u[1]/4294967296>>>0;return t.putBytes(a),o(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var u,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-c));for(var f=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)f+=(u=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(f>>>0),f=u>>>0;s.putInt32(f);var l={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};o(l,r,s);var p=n.util.createBuffer();return p.putInt32(l.h0),p.putInt32(l.h1),p.putInt32(l.h2),p.putInt32(l.h3),p.putInt32(l.h4),p},i};var a=null,s=!1;function o(e,t,r){for(var n,i,a,s,o,u,c,f=r.length();f>=64;){for(i=e.h0,a=e.h1,s=e.h2,o=e.h3,u=e.h4,c=0;c<16;++c)n=r.getInt32(),t[c]=n,n=(i<<5|i>>>27)+(o^a&(s^o))+u+1518500249+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<20;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(o^a&(s^o))+u+1518500249+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<32;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+1859775393+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<40;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+1859775393+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<60;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a&s|o&(a^s))+u+2400959708+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<80;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+3395469782+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;e.h0=e.h0+i|0,e.h1=e.h1+a|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,e.h4=e.h4+u|0,f-=64}}},function(e,t,r){var n=r(1950);r(1952),r(1982),r(1973),function(){if(n.prime)e.exports=n.prime;else{var t=e.exports=n.prime=n.prime||{},r=n.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],a=new r(null);a.fromInt(30);var s=function(e,t){return e|t};t.generateProbablePrime=function(e,t,i){"function"===typeof t&&(i=t,t={});var a=(t=t||{}).algorithm||"PRIMEINC";"string"===typeof a&&(a={name:a}),a.options=a.options||{};var s=t.prng||n.random,c={nextBytes:function(e){for(var t=s.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===a.name)return function(e,t,i,a){if("workers"in i)return function(e,t,i,a){if("undefined"===typeof Worker)return o(e,t,i,a);var s=u(e,t),c=i.workers,f=i.workLoad||100,h=30*f/8,l=i.workerScript||"forge/prime.worker.js";if(-1===c)return n.util.estimateCores((function(e,t){e&&(t=2),c=t-1,p()}));function p(){c=Math.max(1,c);for(var n=[],i=0;i<c;++i)n[i]=new Worker(l);for(i=0;i<c;++i)n[i].addEventListener("message",p);var o=!1;function p(i){if(!o){0;var c=i.data;if(c.found){for(var l=0;l<n.length;++l)n[l].terminate();return o=!0,a(null,new r(c.prime,16))}s.bitLength()>e&&(s=u(e,t));var p=s.toString(16);i.target.postMessage({hex:p,workLoad:f}),s.dAddOffset(h,0)}}}p()}(e,t,i,a);return o(e,t,i,a)}(e,c,a.options,i);throw new Error("Invalid prime generation algorithm: "+a.name)}}function o(e,t,r,a){var s=u(e,t),o=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(s.bitLength());"millerRabinTests"in r&&(o=r.millerRabinTests);var c=10;"maxBlockTime"in r&&(c=r.maxBlockTime),function e(t,r,a,s,o,c,f){var h=+new Date;do{if(t.bitLength()>r&&(t=u(r,a)),t.isProbablePrime(o))return f(null,t);t.dAddOffset(i[s++%8],0)}while(c<0||+new Date-h<c);n.util.setImmediate((function(){e(t,r,a,s,o,c,f)}))}(s,e,t,0,o,c,a)}function u(e,t){var n=new r(e,t),i=e-1;return n.testBit(i)||n.bitwiseTo(r.ONE.shiftLeft(i),s,n),n.dAddOffset(31-n.mod(a).byteValue(),0),n}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(1983),u=r(73),c=r(2e3),f=r(15),h=r(2118),l=u(r(1996));r(2044),r(2045);var p=r(1950),d=function(){function e(t){a(this,e),this._key=t}return s(e,[{key:"verify",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.hashAndVerify(this._key,r,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return h.utils.jwkToPkix(this._key)}},{key:"encrypt",value:function(e){return h.encrypt(this._key,e)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bytes",get:function(){return l.PublicKey.encode({Type:l.KeyType.RSA,Data:this.marshal()})}}]),e}(),v=function(){function e(t,r){a(this,e),this._key=t,this._publicKey=r}return s(e,[{key:"genSecret",value:function(){return h.getRandomValues(16)}},{key:"sign",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.hashAndSign(this._key,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(e){return h.decrypt(this._key,e)}},{key:"marshal",value:function(){return h.utils.jwkToPkcs1(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",c.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o,u,c=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:"pkcs-8",i=null,a=new p.util.ByteBuffer(this.marshal()),s=p.asn1.fromDer(a),o=p.pki.privateKeyFromAsn1(s),"pkcs-8"!==r){e.next=10;break}u={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"},i=p.pki.encryptRsaPrivateKey(o,t,u),e.next=11;break;case 10:throw f(new Error("Unknown export format '".concat(r,"'. Must be pkcs-8")),"ERR_INVALID_EXPORT_FORMAT");case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"public",get:function(){if(!this._publicKey)throw f(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new d(this._publicKey)}},{key:"bytes",get:function(){return l.PrivateKey.encode({Type:l.KeyType.RSA,Data:this.marshal()})}}]),e}();function y(){return(y=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.utils.pkcs1ToJwk(t),e.next=3,h.unmarshalPrivateKey(r);case 3:return i=e.sent,e.abrupt("return",new v(i.privateKey,i.publicKey));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.unmarshalPrivateKey(t);case 2:return r=e.sent,e.abrupt("return",new v(r.privateKey,r.publicKey));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.generateKey(t);case 2:return r=e.sent,e.abrupt("return",new v(r.privateKey,r.publicKey));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={RsaPublicKey:d,RsaPrivateKey:v,unmarshalRsaPublicKey:function(e){var t=h.utils.pkixToJwk(e);return new d(t)},unmarshalRsaPrivateKey:function(e){return y.apply(this,arguments)},generateKeyPair:function(e){return m.apply(this,arguments)},fromJwk:function(e){return b.apply(this,arguments)}}},function(e,t,r){"use strict";var n=r(2114),i=r(74),a=r(2115),s=r(2116),o=r(2117),u=[["base1","1","","1"],["base2","0",i,"01"],["base8","7",i,"01234567"],["base10","9",i,"0123456789"],["base16","f",a,"0123456789abcdef"],["base32","b",s,"abcdefghijklmnopqrstuvwxyz234567"],["base32pad","c",s,"abcdefghijklmnopqrstuvwxyz234567="],["base32hex","v",s,"0123456789abcdefghijklmnopqrstuv"],["base32hexpad","t",s,"0123456789abcdefghijklmnopqrstuv="],["base32z","h",s,"ybndrfg8ejkmcpqxot1uwisza345h769"],["base58flickr","Z",i,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base58btc","z",i,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base64","m",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],c=u.reduce((function(e,t){return e[t[0]]=new n(t[0],t[1],t[2],t[3]),e}),{}),f=u.reduce((function(e,t){return e[t[1]]=c[t[0]],e}),{});e.exports={names:c,codes:f}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(t,r,i,a){n(this,e),this.name=t,this.code=r,this.alphabet=a,i&&a&&(this.engine=i(a))}return i(e,[{key:"encode",value:function(e){return this.engine.encode(e)}},{key:"decode",value:function(e){return this.engine.decode(e)}},{key:"isImplemented",value:function(){return this.engine}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){return{encode:function(e){return"string"===typeof e?n.from(e).toString("hex"):e.toString("hex")},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base16 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"hex")}}}},function(e,t,r){"use strict";function n(e,t){var r=e.byteLength,n=new Uint8Array(e),i=t.indexOf("=")===t.length-1;i&&(t=t.substring(0,t.length-1));for(var a=0,s=0,o="",u=0;u<r;u++)for(s=s<<8|n[u],a+=8;a>=5;)o+=t[s>>>a-5&31],a-=5;if(a>0&&(o+=t[s<<5-a&31]),i)for(;o.length%8!==0;)o+="=";return o}e.exports=function(e){return{encode:function(t){return n("string"===typeof t?Uint8Array.from(t):t,e)},decode:function(t){var r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;if(e.indexOf(o)<0)throw new Error("invalid base32 character")}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return function(e,t){for(var r=(e=e.replace(new RegExp("=","g"),"")).length,n=0,i=0,a=0,s=new Uint8Array(5*r/8|0),o=0;o<r;o++)i=i<<5|t.indexOf(e[o]),(n+=5)>=8&&(s[a++]=i>>>n-8&255,n-=8);return s.buffer}(t,e)}}}},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){var t=e.indexOf("=")>-1,r=e.indexOf("-")>-1&&e.indexOf("_")>-1;return{encode:function(e){var i="";i="string"===typeof e?n.from(e).toString("base64"):e.toString("base64"),r&&(i=i.replace(/\+/g,"-").replace(/\//g,"_"));var a=i.indexOf("=");return a>0&&!t&&(i=i.substring(0,a)),i},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base64 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"base64")}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(1994),o=r(2001);function u(e){return Promise.all([s.get().subtle.exportKey("jwk",e.privateKey),s.get().subtle.exportKey("jwk",e.publicKey)])}t.utils=r(2119),t.generateKey=function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);case 2:return r=e.sent,e.next=5,u(r);case 5:return i=e.sent,e.abrupt("return",{privateKey:i[0],publicKey:i[1]});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.unmarshalPrivateKey=function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]);case 2:return r=e.sent,e.t0=r,e.next=6,n=t,s.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);case 6:return e.t1=e.sent,i=[e.t0,e.t1],e.next=10,u({privateKey:i[0],publicKey:i[1]});case 10:return a=e.sent,e.abrupt("return",{privateKey:a[0],publicKey:a[1]});case 12:case"end":return e.stop()}var n}),e)})));return function(t){return e.apply(this,arguments)}}(),t.getRandomValues=o,t.hashAndSign=function(){var e=i(n.mark((function e(t,r){var i,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);case 2:return i=e.sent,e.next=5,s.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},i,Uint8Array.from(r));case 5:return o=e.sent,e.abrupt("return",a.from(o));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.hashAndVerify=function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);case 2:return a=e.sent,e.abrupt("return",s.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},a,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();var c=r(2120),f=c.jwk2pub,h=c.jwk2priv;function l(e,t,r,n){var i=t?f(e):h(e),s=n(a.from(r).toString("binary"),i);return a.from(s,"binary")}t.encrypt=function(e,t){return l(e,!0,t,(function(e,t){return t.encrypt(e)}))},t.decrypt=function(e,t){return l(e,!1,t,(function(e,t){return t.decrypt(e)}))}},function(e,t,r){"use strict";var n=r(3).Buffer;r(1972),r(1999);var i=r(1950),a=r(2002),s=a.bigIntegerToUintBase64url,o=a.base64urlToBigInteger;t.pkcs1ToJwk=function(e){var t=i.asn1.fromDer(e.toString("binary")),r=i.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:s(r.n),e:s(r.e),d:s(r.d),p:s(r.p),q:s(r.q),dp:s(r.dP),dq:s(r.dQ),qi:s(r.qInv),alg:"RS256",kid:"2011-04-29"}},t.jwkToPkcs1=function(e){var t=i.pki.privateKeyToAsn1({n:o(e.n),e:o(e.e),d:o(e.d),p:o(e.p),q:o(e.q),dP:o(e.dp),dQ:o(e.dq),qInv:o(e.qi)});return n.from(i.asn1.toDer(t).getBytes(),"binary")},t.pkixToJwk=function(e){var t=i.asn1.fromDer(e.toString("binary")),r=i.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:s(r.n),e:s(r.e),alg:"RS256",kid:"2011-04-29"}},t.jwkToPkix=function(e){var t=i.pki.publicKeyToAsn1({n:o(e.n),e:o(e.e)});return n.from(i.asn1.toDer(t).getBytes(),"binary")}},function(e,t,r){"use strict";var n=r(68);r(1999);var i=r(1950),a=r(2002).base64urlToBigInteger;function s(e,t){return t.map((function(t){return a(e[t])}))}e.exports={jwk2pub:function(e){var t;return(t=i.pki).setRsaPublicKey.apply(t,n(s(e,["n","e"])))},jwk2priv:function(e){var t;return(t=i.pki).setRsaPrivateKey.apply(t,n(s(e,["n","e","d","p","q","dp","dq","qi"])))}}},function(e,t,r){var n=r(1950);r(1972);var i=n.asn1;t.privateKeyValidator={name:"PrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},t.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(3).Buffer,u=r(1983),c=r(73),f=r(2e3),h=r(15),l=r(2123),p=c(r(1996)),d=function(){function e(t){a(this,e),this._key=m(t,l.publicKeyLength)}return s(e,[{key:"verify",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.hashAndVerify(this._key,r,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return o.from(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bytes",get:function(){return p.PublicKey.encode({Type:p.KeyType.Ed25519,Data:this.marshal()})}}]),e}(),v=function(){function e(t,r){a(this,e),this._key=m(t,l.privateKeyLength),this._publicKey=m(r,l.publicKeyLength)}return s(e,[{key:"sign",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.hashAndSign(this._key,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return o.concat([o.from(this._key),o.from(this._publicKey)])}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",f.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"public",get:function(){return new d(this._publicKey)}},{key:"bytes",get:function(){return p.PrivateKey.encode({Type:p.KeyType.Ed25519,Data:this.marshal()})}}]),e}();function y(){return(y=i(n.mark((function e(){var t,r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.generateKey();case 2:return t=e.sent,r=t.privateKey,i=t.publicKey,e.abrupt("return",new v(r,i));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.generateKeyFromSeed(t);case 2:return r=e.sent,i=r.privateKey,a=r.publicKey,e.abrupt("return",new v(i,a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw h(new Error("Key must be a Uint8Array or Buffer of length ".concat(t,", got ").concat(e.length)),"ERR_INVALID_KEY_TYPE");return e}e.exports={Ed25519PublicKey:d,Ed25519PrivateKey:v,unmarshalEd25519PrivateKey:function(e){if(e.length>l.privateKeyLength){var t=(e=m(e,l.privateKeyLength+l.publicKeyLength)).slice(0,l.privateKeyLength),r=e.slice(l.privateKeyLength,e.length);return new v(t,r)}var n=(e=m(e,l.privateKeyLength)).slice(0,l.privateKeyLength),i=e.slice(l.publicKeyLength);return new v(n,i)},unmarshalEd25519PublicKey:function(e){return e=m(e,l.publicKeyLength),new d(e)},generateKeyPair:function(){return y.apply(this,arguments)},generateKeyPairFromSeed:function(e){return b.apply(this,arguments)}}},function(e,t,r){"use strict";var n=r(1),i=r(2);r(2045);var a=r(1950);t.publicKeyLength=a.pki.ed25519.constants.PUBLIC_KEY_BYTE_LENGTH,t.privateKeyLength=a.pki.ed25519.constants.PRIVATE_KEY_BYTE_LENGTH,t.generateKey=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.generateKeyPair());case 1:case"end":return e.stop()}}),e)}))),t.generateKeyFromSeed=function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.generateKeyPair({seed:t}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.hashAndSign=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.sign({message:r,privateKey:t}));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.hashAndVerify=function(){var e=i(n.mark((function e(t,r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.verify({signature:r,message:i,publicKey:t}));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(2e3),u=r(1983);e.exports=function(e,t,c){c=c||r(2125)(t);var f=function(){function t(e){a(this,t),c.validatePublicKey(e),this._key=e}return s(t,[{key:"verify",value:function(e,t){return c.hashAndVerify(this._key,t,e)}},{key:"marshal",value:function(){return c.compressPublicKey(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){return u.multihashing(this.bytes,"sha2-256")}},{key:"bytes",get:function(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()})}}]),t}(),h=function(){function t(e,r){a(this,t),this._key=e,this._publicKey=r||c.computePublicKey(e),c.validatePrivateKey(this._key),c.validatePublicKey(this._publicKey)}return s(t,[{key:"sign",value:function(e){return c.hashAndSign(this._key,e)}},{key:"marshal",value:function(){return this._key}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){return u.multihashing(this.bytes,"sha2-256")}},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",o.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"public",get:function(){return new f(this._publicKey)}},{key:"bytes",get:function(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()})}}]),t}();function l(){return(l=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.generateKey();case 2:return t=e.sent,e.abrupt("return",new h(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{Secp256k1PublicKey:f,Secp256k1PrivateKey:h,unmarshalSecp256k1PrivateKey:function(e){return new h(e)},unmarshalSecp256k1PublicKey:function(e){return new f(e)},generateKeyPair:function(){return l.apply(this,arguments)}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(464).strict,o=r(465),u=r(1983);function c(e){if(s(e)){var t=a.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return a.from(e)}e.exports=function(e){function t(){return(t=i(n.mark((function e(t,r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.digest(r,"sha2-256");case 2:return i=e.sent,a=o.ecdsaSign(i,t),e.abrupt("return",c(o.signatureExport(a.signature)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r(){return(r=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.digest(i,"sha2-256");case 2:return a=e.sent,r=c(o.signatureImport(r)),e.abrupt("return",o.ecdsaVerify(r,a,t));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a(e){if(!o.privateKeyVerify(e))throw new Error("Invalid private key")}return{generateKey:function(){var t;do{t=e(32)}while(!o.privateKeyVerify(t));return t},privateKeyLength:32,hashAndSign:function(e,r){return t.apply(this,arguments)},hashAndVerify:function(e,t,n){return r.apply(this,arguments)},compressPublicKey:function(e){if(!o.publicKeyVerify(e))throw new Error("Invalid public key");return c(o.publicKeyConvert(e,!0))},decompressPublicKey:function(e){return c(o.publicKeyConvert(e,!1))},validatePrivateKey:a,validatePublicKey:function(e){if(!o.publicKeyVerify(e))throw new Error("Invalid public key")},computePublicKey:function(e){return a(e),c(o.publicKeyCreate(e))}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(15),o=r(2040),u={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};e.exports=function(){var e=i(n.mark((function e(t,r,i){var c,f,h,l,p,d,v,y,b,m,g,k,w,x,S,E,_;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=u[t]){e.next=4;break}throw f=Object.keys(u).join(" / "),s(new Error("unknown cipher type '".concat(t,"'. Must be ").concat(f)),"ERR_INVALID_CIPHER_TYPE");case 4:if(r){e.next=6;break}throw s(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");case 6:return h=c.keySize,l=c.ivSize,20,p=a.from("key expansion"),d=2*(l+h+20),e.next=13,o.create(r,i);case 13:return v=e.sent,e.next=16,v.digest(p);case 16:y=e.sent,b=[],m=0;case 19:if(!(m<d)){e.next=32;break}return e.next=22,v.digest(a.concat([y,p]));case 22:return g=e.sent,k=g.length,m+k>d&&(k=d-m),b.push(g),m+=k,e.next=29,v.digest(y);case 29:y=e.sent,e.next=19;break;case 32:return w=d/2,x=a.concat(b),S=x.slice(0,w),E=x.slice(w,d),_=function(e){return{iv:e.slice(0,l),cipherKey:e.slice(l,l+h),macKey:e.slice(l+h)}},e.abrupt("return",{k1:_(S),k2:_(E)});case 38:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2128);e.exports=function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.generateEphmeralKeyPair(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(15),o=r(3).Buffer,u=r(1994),c=r(2002),f=c.bufferToBase64url,h=c.base64urlToBuffer,l=r(2129),p={"P-256":256,"P-384":384,"P-521":521};t.generateEphmeralKeyPair=function(){var e=a(i.mark((function e(t){var r,n,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(Object.keys(p),t),e.next=3,u.get().subtle.generateKey({name:"ECDH",namedCurve:t},!0,["deriveBits"]);case 3:return r=e.sent,n=function(){var e=a(i.mark((function e(n,a){var s,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}return e.next=3,u.get().subtle.importKey("jwk",b(t,a),{name:"ECDH",namedCurve:t},!1,["deriveBits"]);case 3:s=e.sent,e.next=7;break;case 6:s=r.privateKey;case 7:return e.next=9,u.get().subtle.importKey("jwk",y(t,n),{name:"ECDH",namedCurve:t},!1,[]);case 9:return e.t0=e.sent,e.t1=s,c=[e.t0,e.t1],e.t2=o,e.next=15,u.get().subtle.deriveBits({name:"ECDH",namedCurve:t,public:c[0]},c[1],p[t]);case 15:return e.t3=e.sent,e.abrupt("return",e.t2.from.call(e.t2,e.t3));case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.next=7,u.get().subtle.exportKey("jwk",r.publicKey);case 7:return s=e.sent,e.abrupt("return",{key:v(s),genSharedKey:n});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var d={"P-256":32,"P-384":48,"P-521":66};function v(e){var t=d[e.crv];return o.concat([o.from([4]),h(e.x,t),h(e.y,t)],1+2*t)}function y(e,t){var r=d[e];if(!t.slice(0,1).equals(o.from([4])))throw s(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:f(t.slice(1,r+1),r),y:f(t.slice(1+r),r),ext:!0}}var b=function(e,t){return n({},y(e,t.public),{d:f(t.private)})}},function(e,t,r){"use strict";var n=r(15);e.exports=function(e,t){if(!e.includes(t)){var r=e.join(" / ");throw n(new Error("Unknown curve: ".concat(t,". Must be ").concat(r)),"ERR_INVALID_CURVE")}}},function(e,t,r){"use strict";var n=r(2043),i=r(1952),a=r(15),s={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};e.exports=function(e,t,r,o,u){var c=s[u];if(!c){var f=Object.keys(s).join(" / ");throw a(new Error("Hash '".concat(u,"' is unknown or not supported. Must be ").concat(f)),"ERR_UNSUPPORTED_HASH_TYPE")}var h=n(e,t,r,o,c);return i.encode64(h)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(171),o=r(337),u=r(2132).factory,c=r(2133).fromNumberTo32BitBuf,f=function(e){return function(){var t=i(n.mark((function t(r){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="sha3-224"===t.t0?3:"sha3-256"===t.t0?4:"sha3-384"===t.t0?5:"sha3-512"===t.t0?6:"shake-128"===t.t0?7:"shake-256"===t.t0?8:"keccak-224"===t.t0?9:"keccak-256"===t.t0?10:"keccak-384"===t.t0?11:"keccak-512"===t.t0?12:"murmur3-128"===t.t0?13:"murmur3-32"===t.t0?14:15;break;case 3:return t.abrupt("return",a.from(s.sha3_224.arrayBuffer(r)));case 4:return t.abrupt("return",a.from(s.sha3_256.arrayBuffer(r)));case 5:return t.abrupt("return",a.from(s.sha3_384.arrayBuffer(r)));case 6:return t.abrupt("return",a.from(s.sha3_512.arrayBuffer(r)));case 7:return t.abrupt("return",a.from(s.shake128.create(128).update(r).arrayBuffer()));case 8:return t.abrupt("return",a.from(s.shake256.create(256).update(r).arrayBuffer()));case 9:return t.abrupt("return",a.from(s.keccak224.arrayBuffer(r)));case 10:return t.abrupt("return",a.from(s.keccak256.arrayBuffer(r)));case 11:return t.abrupt("return",a.from(s.keccak384.arrayBuffer(r)));case 12:return t.abrupt("return",a.from(s.keccak512.arrayBuffer(r)));case 13:return t.abrupt("return",a.from(o.x64.hash128(r),"hex"));case 14:return t.abrupt("return",c(o.x86.hash32(r)));case 15:throw new TypeError("".concat(e," is not a supported algorithm"));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};e.exports={identity:function(e){return a.from(e)},sha1:u("sha1"),sha2256:u("sha2-256"),sha2512:u("sha2-512"),dblSha2256:u("dbl-sha2-256"),sha3224:f("sha3-224"),sha3256:f("sha3-256"),sha3384:f("sha3-384"),sha3512:f("sha3-512"),shake128:f("shake-128"),shake256:f("shake-256"),keccak224:f("keccak-224"),keccak256:f("keccak-256"),keccak384:f("keccak-384"),keccak512:f("keccak-512"),murmur3128:f("murmur3-128"),murmur332:f("murmur3-32"),addBlake:r(2134)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(128),o=self.crypto||self.msCrypto,u=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof self&&(self.crypto||self.msCrypto)){e.next=2;break}throw new Error("Please use a browser with webcrypto support and ensure the code has been delivered securely via HTTPS/TLS and run within a Secure Context");case 2:e.t0=r,e.next="sha1"===e.t0?5:"sha2-256"===e.t0?10:"sha2-512"===e.t0?15:"dbl-sha2-256"===e.t0?20:28;break;case 5:return e.t1=a,e.next=8,o.subtle.digest({name:"SHA-1"},t);case 8:return e.t2=e.sent,e.abrupt("return",e.t1.from.call(e.t1,e.t2));case 10:return e.t3=a,e.next=13,o.subtle.digest({name:"SHA-256"},t);case 13:return e.t4=e.sent,e.abrupt("return",e.t3.from.call(e.t3,e.t4));case 15:return e.t5=a,e.next=18,o.subtle.digest({name:"SHA-512"},t);case 18:return e.t6=e.sent,e.abrupt("return",e.t5.from.call(e.t5,e.t6));case 20:return e.next=22,o.subtle.digest({name:"SHA-256"},t);case 22:return i=e.sent,e.t7=a,e.next=26,o.subtle.digest({name:"SHA-256"},i);case 26:return e.t8=e.sent,e.abrupt("return",e.t7.from.call(e.t7,e.t8));case 28:throw new Error("".concat(r," is not a supported algorithm"));case 29:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();e.exports={factory:function(e){return function(){var t=i(n.mark((function t(r){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u(r,e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},digest:u,multihashing:function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t,r,i);case 2:return a=e.sent,e.abrupt("return",s.encode(a,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports={fromNumberTo32BitBuf:function(e){for(var t=new Array(4),r=0;r<4;r++)t[r]=255&e,e>>=8;return n.from(t)}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(228),o={init:s.blake2bInit,update:s.blake2bUpdate,digest:s.blake2bFinal},u={init:s.blake2sInit,update:s.blake2sUpdate,digest:s.blake2sFinal},c=function(e,t){return function(){var r=i(n.mark((function r(i){var s;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=t.init(e,null),t.update(s,i),r.abrupt("return",a.from(t.digest(s)));case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()};e.exports=function(e){for(var t=0;t<64;t++)e[45569+t]=c(t+1,o);for(var r=0;r<32;r++)e[45633+r]=c(r+1,u)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(223);e.exports=function(e){var t=e.addAll;return(function(){var e=i(n.mark((function e(r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a(t(r,i)));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(26),s=r(25),o=r(18),u=r(96),c=r(330),f=r(2137),h=r(2138).parseChunkerString,l=r(78),p=r(1948).withTimeoutOption;function d(e){return function(){var t=a(n.mark((function t(r){var i,a,u,c,f,h,l,p,d;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=!0,a=!1,t.prev=2,c=o(r);case 4:return t.next=6,s(c.next());case 6:return f=t.sent,i=f.done,t.next=10,s(f.value);case 10:if(h=t.sent,i){t.next=22;break}return p=(l=h).cid,1===e.cidVersion&&(p=p.toV1()),d=l.path?l.path:p.toString(),e.wrapWithDirectory&&!l.path&&(d=""),t.next=19,{path:d,cid:p,size:l.size,mode:l.unixfs&&l.unixfs.mode,mtime:l.unixfs&&l.unixfs.mtime};case 19:i=!0,t.next=4;break;case 22:t.next=28;break;case 24:t.prev=24,t.t0=t.catch(2),a=!0,u=t.t0;case 28:if(t.prev=28,t.prev=29,i||null==c.return){t.next=33;break}return t.next=33,s(c.return());case 33:if(t.prev=33,!a){t.next=36;break}throw u;case 36:return t.finish(33);case 37:return t.finish(28);case 38:case"end":return t.stop()}}),t,null,[[2,24,28,38],[29,,33,37]])})));return function(e){return t.apply(this,arguments)}}()}function v(e,t){return function(){var r=a(n.mark((function r(i){var a,u,c,f,h,l,p,d;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=!0,u=!1,r.prev=2,f=o(i);case 4:return r.next=6,s(f.next());case 6:return h=r.sent,a=h.done,r.next=10,s(h.value);case 10:if(l=r.sent,a){r.next=21;break}return d=!(p=l).path||t.wrapWithDirectory?""===p.path:!p.path.includes("/"),d&&!t.onlyHash&&!1!==t.preload&&e(p.cid),r.next=18,p;case 18:a=!0,r.next=4;break;case 21:r.next=27;break;case 23:r.prev=23,r.t0=r.catch(2),u=!0,c=r.t0;case 27:if(r.prev=27,r.prev=28,a||null==f.return){r.next=32;break}return r.next=32,s(f.return());case 32:if(r.prev=32,!u){r.next=35;break}throw c;case 35:return r.finish(32);case 36:return r.finish(27);case 37:case"end":return r.stop()}}),r,null,[[2,23,27,37],[28,,32,36]])})));return function(e){return r.apply(this,arguments)}}()}function y(e,t){return function(){var r=a(n.mark((function r(i){var a,u,c,f,h,l,p,d;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=!0,u=!1,r.prev=2,f=o(i);case 4:return r.next=6,s(f.next());case 6:return h=r.sent,a=h.done,r.next=10,s(h.value);case 10:if(l=r.sent,a){r.next=23;break}if(d=!(p=l).path.includes("/"),!((null==t.pin||t.pin)&&d&&!t.onlyHash)){r.next=18;break}return r.next=18,s(e.add(p.cid,{preload:!1,lock:!1}));case 18:return r.next=20,p;case 20:a=!0,r.next=4;break;case 23:r.next=29;break;case 25:r.prev=25,r.t0=r.catch(2),u=!0,c=r.t0;case 29:if(r.prev=29,r.prev=30,a||null==f.return){r.next=34;break}return r.next=34,s(f.return());case 34:if(r.prev=34,!u){r.next=37;break}throw c;case 37:return r.finish(34);case 38:return r.finish(29);case 39:case"end":return r.stop()}}),r,null,[[2,25,29,39],[30,,34,38]])})));return function(e){return r.apply(this,arguments)}}()}e.exports=function(e){var t=e.block,r=e.gcLock,b=e.preload,m=e.pin,g=e.options,k=g.EXPERIMENTAL&&g.EXPERIMENTAL.sharding;return p(function(){var e=a(n.mark((function e(a,p){var g,w,x,S,E;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(g=i({shardSplitThreshold:k?1e3:1/0},p=p||{},{strategy:"balanced"},h(p.chunker))).hashAlg&&"sha2-256"!==g.hashAlg&&1!==g.cidVersion&&(g.cidVersion=1),g.trickle&&(g.strategy="trickle"),delete g.trickle,g.progress&&(w=0,x=g.progress,g.progress=function(e){x(w+=e)}),S=l(f(a),(function(e){return c(e,t,i({},g,{pin:!1}))}),d(g),v(b,g),y(m,g)),e.next=9,s(r.readLock());case 9:return E=e.sent,e.prev=10,e.delegateYield(u(o(S),s),"t0",12);case 12:return e.prev=12,E(),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[10,,12,15]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(96),a=r(18),s=r(25),o=r(26),u=r(15),c=r(3).Buffer,f=r(261);function h(e){var t={path:e.path||"",mode:e.mode,mtime:e.mtime};return e.content?t.content=l(e.content):e.path||(t.content=l(e)),t}function l(e){if(d(e)||"string"===typeof e)return o(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,p(e);case 2:case"end":return t.stop()}}),t)})))();if(v(e))return function(e){if("function"===typeof e.stream)return b(e.stream());return function(e,t){return g.apply(this,arguments)}(e)}(e);if("function"===typeof e.getReader)return b(e);if(e[Symbol.iterator])return o(n.mark((function t(){var r,i,a,s,o,c,f,h;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e[Symbol.iterator](),!(i=r.next()).done){t.next=4;break}return t.abrupt("return",r);case 4:if(!Number.isInteger(i.value)){t.next=8;break}return t.next=7,p(Array.from(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.value;case 2:return e.delegateYield(r,"t0",3);case 3:case"end":return e.stop()}}),e)}))()));case 7:return t.abrupt("return");case 8:if(!d(i.value)){t.next=38;break}return t.next=11,p(i.value);case 11:a=!0,s=!1,o=void 0,t.prev=14,c=r[Symbol.iterator]();case 16:if(a=(f=c.next()).done){t.next=23;break}return h=f.value,t.next=20,p(h);case 20:a=!0,t.next=16;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(14),s=!0,o=t.t0;case 29:t.prev=29,t.prev=30,a||null==c.return||c.return();case 32:if(t.prev=32,!s){t.next=35;break}throw o;case 35:return t.finish(32);case 36:return t.finish(29);case 37:return t.abrupt("return");case 38:throw u(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT");case 39:case"end":return t.stop()}}),t,null,[[14,25,29,37],[30,,32,36]])})))();if(e[Symbol.asyncIterator])return o(n.mark((function t(){var r,i,o,u,c,f,h;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,i=!1,t.prev=2,u=a(e);case 4:return t.next=6,s(u.next());case 6:return c=t.sent,r=c.done,t.next=10,s(c.value);case 10:if(f=t.sent,r){t.next=18;break}return h=f,t.next=15,p(h);case 15:r=!0,t.next=4;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(2),i=!0,o=t.t0;case 24:if(t.prev=24,t.prev=25,r||null==u.return){t.next=29;break}return t.next=29,s(u.return());case 29:if(t.prev=29,!i){t.next=32;break}throw o;case 32:return t.finish(29);case 33:return t.finish(24);case 34:case"end":return t.stop()}}),t,null,[[2,20,24,34],[25,,29,33]])})))();throw u(new Error("Unexpected input: ".concat(e)),"ERR_UNEXPECTED_INPUT")}function p(e){return d(e)?e:c.from(e)}function d(e){return c.isBuffer(e)||ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function v(e){return"undefined"!==typeof f.Blob&&e instanceof f.Blob}function y(e){return"object"===typeof e&&(e.path||e.content)}function b(e){return m.apply(this,arguments)}function m(){return(m=o(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getReader();case 1:return e.next=4,s(r.read());case 4:if(!(i=e.sent).done){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,i.value;case 9:e.next=1;break;case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=o(n.mark((function e(t,r){var i,a,o,u,h;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=r||{},i=new f.FileReader,a=r.chunkSize||1048576,o=r.offset||0,u=function(){return new Promise((function(e,r){i.onloadend=function(t){var r=t.target.result;e(0===r.byteLength?null:r)},i.onerror=r;var n=o+a,s=t.slice(o,n);i.readAsArrayBuffer(s),o=n}))};case 5:return e.next=8,s(u());case 8:if(null!=(h=e.sent)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,c.from(h);case 13:e.next=5;break;case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(e){if(null===e||void 0===e)throw u(new Error("Unexpected input: ".concat(e)),"ERR_UNEXPECTED_INPUT");if("string"===typeof e||e instanceof String)return o(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:case"end":return t.stop()}}),t)})))();if(d(e)||v(e))return o(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:case"end":return t.stop()}}),t)})))();if(e[Symbol.iterator])return o(n.mark((function t(){var r,i,a,s,o,c,f,l;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e[Symbol.iterator](),!(i=r.next()).done){t.next=4;break}return t.abrupt("return",r);case 4:if(!Number.isInteger(i.value)&&!d(i.value)){t.next=8;break}return t.next=7,h(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.value;case 2:return e.delegateYield(r,"t0",3);case 3:case"end":return e.stop()}}),e)}))());case 7:return t.abrupt("return");case 8:if(!y(i.value)&&!v(i.value)&&"string"!==typeof i.value){t.next=38;break}return t.next=11,h(i.value);case 11:a=!0,s=!1,o=void 0,t.prev=14,c=r[Symbol.iterator]();case 16:if(a=(f=c.next()).done){t.next=23;break}return l=f.value,t.next=20,h(l);case 20:a=!0,t.next=16;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(14),s=!0,o=t.t0;case 29:t.prev=29,t.prev=30,a||null==c.return||c.return();case 32:if(t.prev=32,!s){t.next=35;break}throw o;case 35:return t.finish(32);case 36:return t.finish(29);case 37:return t.abrupt("return");case 38:throw u(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT");case 39:case"end":return t.stop()}}),t,null,[[14,25,29,37],[30,,32,36]])})))();if("function"===typeof e.getReader)return o(n.mark((function t(){var r,i,o,u,c,f,l;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,i=!1,t.prev=2,u=a(b(e));case 4:return t.next=6,s(u.next());case 6:return c=t.sent,r=c.done,t.next=10,s(c.value);case 10:if(f=t.sent,r){t.next=18;break}return l=f,t.next=15,h(l);case 15:r=!0,t.next=4;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(2),i=!0,o=t.t0;case 24:if(t.prev=24,t.prev=25,r||null==u.return){t.next=29;break}return t.next=29,s(u.return());case 29:if(t.prev=29,!i){t.next=32;break}throw o;case 32:return t.finish(29);case 33:return t.finish(24);case 34:case"end":return t.stop()}}),t,null,[[2,20,24,34],[25,,29,33]])})))();if(e[Symbol.asyncIterator])return o(n.mark((function t(){var r,c,f,l,p,b,m,g,k;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e[Symbol.asyncIterator](),t.next=3,s(r.next());case 3:if(!(c=t.sent).done){t.next=6;break}return t.abrupt("return",r);case 6:if(!d(c.value)){t.next=10;break}return t.next=9,h(o(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.value;case 2:return e.delegateYield(i(a(r),s),"t0",3);case 3:case"end":return e.stop()}}),e)})))());case 9:return t.abrupt("return");case 10:if(!y(c.value)&&!v(c.value)&&"string"!==typeof c.value){t.next=48;break}return t.next=13,h(c.value);case 13:f=!0,l=!1,t.prev=15,b=a(r);case 17:return t.next=19,s(b.next());case 19:return m=t.sent,f=m.done,t.next=23,s(m.value);case 23:if(g=t.sent,f){t.next=31;break}return k=g,t.next=28,h(k);case 28:f=!0,t.next=17;break;case 31:t.next=37;break;case 33:t.prev=33,t.t0=t.catch(15),l=!0,p=t.t0;case 37:if(t.prev=37,t.prev=38,f||null==b.return){t.next=42;break}return t.next=42,s(b.return());case 42:if(t.prev=42,!l){t.next=45;break}throw p;case 45:return t.finish(42);case 46:return t.finish(37);case 47:return t.abrupt("return");case 48:throw u(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT");case 49:case"end":return t.stop()}}),t,null,[[15,33,37,47],[38,,42,46]])})))();if(y(e))return o(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e);case 2:case"end":return t.stop()}}),t)})))();throw u(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}},function(e,t,r){"use strict";var n=r(46),i=function(e){var t={},r=e.split("-");switch(r.length){case 1:t.avgChunkSize=262144;break;case 2:t.avgChunkSize=a(r[1],"avg");break;case 4:t.minChunkSize=a(r[1],"min"),t.avgChunkSize=a(r[2],"avg"),t.maxChunkSize=a(r[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return t},a=function(e,t){var r=parseInt(e);if(isNaN(r))throw new Error("Chunker parameter ".concat(t," must be an integer"));return r};e.exports={parseChunkSize:a,parseRabinString:i,parseChunkerString:function(e){if(e){if(e.startsWith("size-")){var t=e.split("-")[1],r=parseInt(t);if(isNaN(r))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:r}}if(e.startsWith("rabin"))return n({chunker:"rabin"},i(e));throw new Error("Unrecognized chunker option: ".concat(e))}return{chunker:"fixed"}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2004).cleanCid,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.blockService,r=e.preload;return s(function(){var e=i(n.mark((function e(i,s){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=s||{},i=a(i),!1!==s.preload&&r(i),e.abrupt("return",t.get(i,s));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(227),s=r(1955),o=r(32),u=r(149),c=r(1948).withTimeoutOption;e.exports=function(e){var t=e.blockService,r=e.pin,f=e.gcLock,h=e.preload;return c(function(){var e=i(n.mark((function e(i,c){var l,p,d,v,y,b;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=c||{},!Array.isArray(i)){e.next=3;break}throw new Error("Array is not supported");case 3:if(a.isBlock(i)){e.next=16;break}if(!c.cid||!u.cid(c.cid)){e.next=8;break}i=new a(i,o.isCID(c.cid)?c.cid:new o(c.cid)),e.next=16;break;case 8:return l=c.mhtype||"sha2-256",p=c.format||"dag-pb",d=null==c.version?"sha2-256"===l&&"dag-pb"===p?0:1:c.version,e.next=13,s(i,l);case 13:v=e.sent,y=new o(d,p,v),i=new a(i,y);case 16:return e.next=18,f.readLock();case 18:return b=e.sent,e.prev=19,e.next=22,t.put(i,{signal:c.signal});case 22:if(!1!==c.preload&&h(i.cid),!0!==c.pin){e.next=26;break}return e.next=26,r.add(i.cid,{recursive:!0,signal:c.signal});case 26:return e.abrupt("return",i);case 27:return e.prev=27,b(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[19,,27,30]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(26),s=r(25),o=r(18),u=r(96),c=r(32),f=r(15),h=r(1993),l=h.parallelMap,p=h.filter,d=r(78),v=r(1986).PinTypes,y=r(2004).cleanCid,b=r(1948).withTimeoutOption;e.exports=function(e){var t=e.blockService,r=e.gcLock,h=e.pinManager;return b(function(){var e=a(n.mark((function e(a,b){var m;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b=b||{},Array.isArray(a)||(a=[a]),e.next=4,s(r.writeLock());case 4:return m=e.sent,e.prev=5,e.delegateYield(u(o(d(a,l(8,function(){var e=i(n.mark((function e(r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=y(r),i={cid:r},e.prev=2,e.next=5,h.isPinnedWithType(r,v.all);case 5:if(!(a=e.sent).pinned){e.next=10;break}if(!c.isCID(a.reason)){e.next=9;break}throw f(new Error("pinned via ".concat(a.reason)));case 9:throw f(new Error("pinned: ".concat(a.reason)));case 10:return e.next=12,t._repo.blocks.has(r);case 12:if(e.sent){e.next=15;break}throw f(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");case 15:return e.next=17,t.delete(r);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(2),b.force||(e.t0.message="cannot remove ".concat(r,": ").concat(e.t0.message),i.error=e.t0);case 22:return e.abrupt("return",i);case 23:case"end":return e.stop()}}),e,null,[[2,19]])})));return function(t){return e.apply(this,arguments)}}()),p((function(){return!b.quiet})))),s),"t0",7);case 7:return e.prev=7,m(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(2),i=r(1),a=r(48),s=i.mark(I),o=r(1955).multihash,u=r(32),c=r(73),f=r(791),h=r(47),l=r(61),p=l.DAGNode,d=l.DAGLink,v=r(49),y=r(151).default,b=r(467),m=r(19)("ipfs:pin:pin-set"),g=r(2143),k=r(3).Buffer,w=o.fromB58String("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),x=c(g);function S(e){return new u(e).toBaseEncodedString()}function E(e){var t=e.Data,r=h.decode(t),n=h.decode.bytes;if(n<=0)throw new Error("Invalid Set header length");if(n+r>t.length)throw new Error("Impossibly large set header length");var i=t.slice(n,r+n),a=x.Set.decode(i);if(1!==a.version)throw new Error("Unsupported Set version: ".concat(a.version));if(a.fanout>e.Links.length)throw new Error("Impossibly large fanout");return{header:a,data:t.slice(r+n)}}function _(e,t){var r=k.alloc(4);r.writeUInt32LE(e,0);var n=k.concat([r,k.from(S(t))]);return f(n.toString("binary"))}function I(e){var t,r,n,o,u,c,f;return i.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t=!0,r=!1,n=void 0,i.prev=3,o=b(e)[Symbol.iterator]();case 5:if(t=(u=o.next()).done){i.next=12;break}return c=a(u.value,2),c[0],f=c[1],i.next=9,f;case 9:t=!0,i.next=5;break;case 12:i.next=18;break;case 14:i.prev=14,i.t0=i.catch(3),r=!0,n=i.t0;case 18:i.prev=18,i.prev=19,t||null==o.return||o.return();case 21:if(i.prev=21,!r){i.next=24;break}throw n;case 24:return i.finish(21);case 25:return i.finish(18);case 26:case"end":return i.stop()}}),s,null,[[3,14,18,26],[19,,21,25]])}e.exports=function(e){var t={hasDescendant:function(){var t=n(i.mark((function t(r,a){var s,o,c,f,h,l,p;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(p=function(e,t){var r=[];"dag-pb"===e.codec?r=t.Links:"dag-cbor"===e.codec&&(r=I(t));var n=!0,i=!1,s=void 0;try{for(var o,u=r[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var p=o.value,d="dag-pb"===e.codec?p.Hash:p[1],v=S(d);if(v===a)return c.clear(),void(f=!0);h[v]||(h[v]=!0,"dag-pb"!==d.codec&&"dag-cbor"!==d.codec||c.add(l(d)))}}catch(y){i=!0,s=y}finally{try{n||null==u.return||u.return()}finally{if(i)throw s}}},l=function(t){return n(i.mark((function r(){var n,a;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!f){r.next=2;break}return r.abrupt("return");case 2:return r.prev=2,r.next=5,e.get(t,{preload:!1});case 5:n=r.sent,a=n.value,p(t,a),r.next=13;break;case 10:r.prev=10,r.t0=r.catch(2),m(r.t0);case 13:case"end":return r.stop()}}),r,null,[[2,10]])})))},"dag-pb"===r.codec||"dag-cbor"===r.codec){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,e.get(r,{preload:!1});case 6:return s=t.sent,o=s.value,c=new y({concurrency:100}),(u.isCID(a)||k.isBuffer(a))&&(a=S(a)),f=!1,h={},p(r,o),t.next=15,c.onIdle();case 15:return t.abrupt("return",f);case 16:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),storeSet:function(){var r=n(i.mark((function r(n){var a,s,o;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=n.map((function(e){return("string"===typeof e||k.isBuffer(e))&&(e=new u(e)),{key:e,data:null}})),r.next=3,t.storeItems(a);case 3:return s=r.sent,r.next=6,e.put(s,{version:0,format:v.DAG_PB,hashAlg:v.SHA2_256,preload:!1});case 6:return o=r.sent,r.abrupt("return",{node:s,cid:o});case 8:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),storeItems:function(){var t=n(i.mark((function t(r){var a,s;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=function(){return(s=n(i.mark((function t(r,s){var o,u,c,f,l,y,b,m,g,S,E,I,A,T,C,B,R,N;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(N=function(){return(N=n(i.mark((function t(r,n){var a,s;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a={version:0,format:v.DAG_PB,hashAlg:v.SHA2_256,preload:!1},t.next=3,e.put(r,a);case 3:s=t.sent,c[n]=new d("",r.size,s);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)},R=function(e,t){return N.apply(this,arguments)},o=x.Set.encode({version:1,fanout:256,seed:s}),u=k.concat([k.from(h.encode(o.length)),o]),c=[],f=0;f<256;f++)c.push(new d("",1,w));if(!(r.length<=8192)){t.next=13;break}return l=r.map((function(e){return{link:new d("",1,e.key),data:e.data||k.alloc(0)}})).sort((function(e,t){return k.compare(e.link.Hash.buffer,t.link.Hash.buffer)})),y=c.concat(l.map((function(e){return e.link}))),b=k.concat([u].concat(l.map((function(e){return e.data})))),t.abrupt("return",new p(b,y));case 13:m=r.reduce((function(e,t){var r=_(s,t.key)%256;return e[r]=r in e?e[r].concat([t]):[t],e}),[]),g=0,S=!0,E=!1,I=void 0,t.prev=18,A=m[Symbol.iterator]();case 20:if(S=(T=A.next()).done){t.next=31;break}return C=T.value,t.next=24,a(C,s+1);case 24:return B=t.sent,t.next=27,R(B,g);case 27:g++;case 28:S=!0,t.next=20;break;case 31:t.next=37;break;case 33:t.prev=33,t.t0=t.catch(18),E=!0,I=t.t0;case 37:t.prev=37,t.prev=38,S||null==A.return||A.return();case 40:if(t.prev=40,!E){t.next=43;break}throw I;case 43:return t.finish(40);case 44:return t.finish(37);case 45:return t.abrupt("return",new p(u,c));case 46:case"end":return t.stop()}}),t,null,[[18,33,37,45],[38,,40,44]])})))).apply(this,arguments)},a=function(e,t){return s.apply(this,arguments)},t.abrupt("return",a(r,0));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),loadSet:function(){var r=n(i.mark((function r(n,a){var s,o,u,c;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=n.Links.find((function(e){return e.Name===a}))){r.next=3;break}throw new Error("No link found with name "+a);case 3:return r.next=5,e.get(s.Hash,{preload:!1});case 5:return o=r.sent,u=[],c=function(e){return u.push(e.Hash)},r.next=10,t.walkItems(o.value,{stepPin:c});case 10:return r.abrupt("return",u);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),walkItems:function(){var r=n(i.mark((function r(n,a){var s,o,u,c,f,h,l,p,d,v,y,b,m,g;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s=a.stepPin,o=void 0===s?function(){}:s,u=a.stepBin,c=void 0===u?function(){}:u,f=E(n),h=0,l=!0,p=!1,d=void 0,r.prev=6,v=n.Links[Symbol.iterator]();case 8:if(l=(y=v.next()).done){r.next=26;break}if(b=y.value,!(h<f.header.fanout)){r.next=21;break}if(m=b.Hash.buffer,w.equals(m)){r.next=19;break}return c(b,h,f.data),r.next=16,e.get(b.Hash,{preload:!1});case 16:return g=r.sent,r.next=19,t.walkItems(g.value,{stepPin:o,stepBin:c});case 19:r.next=22;break;case 21:o(b,h,f.data);case 22:h++;case 23:l=!0,r.next=8;break;case 26:r.next=32;break;case 28:r.prev=28,r.t0=r.catch(6),p=!0,d=r.t0;case 32:r.prev=32,r.prev=33,l||null==v.return||v.return();case 35:if(r.prev=35,!p){r.next=38;break}throw d;case 38:return r.finish(35);case 39:return r.finish(32);case 40:case"end":return r.stop()}}),r,null,[[6,28,32,40],[33,,35,39]])})));return function(e,t){return r.apply(this,arguments)}}(),getInternalCids:function(){var r=n(i.mark((function r(n){var a,s,o,c,f,h,l,p,d;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=[new u(w)],s=function(e){return a.push(e.Hash)},o=!0,c=!1,f=void 0,r.prev=5,h=n.Links[Symbol.iterator]();case 7:if(o=(l=h.next()).done){r.next=18;break}return p=l.value,a.push(p.Hash),r.next=12,e.get(p.Hash,{preload:!1});case 12:return d=r.sent,r.next=15,t.walkItems(d.value,{stepBin:s});case 15:o=!0,r.next=7;break;case 18:r.next=24;break;case 20:r.prev=20,r.t0=r.catch(5),c=!0,f=r.t0;case 24:r.prev=24,r.prev=25,o||null==h.return||h.return();case 27:if(r.prev=27,!c){r.next=30;break}throw f;case 30:return r.finish(27);case 31:return r.finish(24);case 32:return r.abrupt("return",a);case 33:case"end":return r.stop()}}),r,null,[[5,20,24,32],[25,,27,31]])})));return function(e){return r.apply(this,arguments)}}()};return t}},function(e,t,r){"use strict";e.exports='\n  syntax = "proto2";\n\n  package ipfs.pin;\n\n  option go_package = "pb";\n\n  message Set {\n    optional uint32 version = 1;\n    optional uint32 fanout = 2;\n    optional fixed32 seed = 3;\n  }\n'},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2004).cleanCid,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.blockService,r=e.preload;return s(function(){var e=i(n.mark((function e(i,s){var o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=s||{},i=a(i),!1!==s.preload&&r(i),e.next=5,t.get(i);case 5:return o=e.sent,e.abrupt("return",{cid:i,size:o.data.length});case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(139),s=r(32),o=r(1948).withTimeoutOption;e.exports=function(e){var t=e.bitswap;return o(function(){var e=i(n.mark((function e(){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.stat().snapshot,e.abrupt("return",{provideBufLen:parseInt(r.providesBufferLength.toString()),blocksReceived:new a(r.blocksReceived),wantlist:Array.from(t.getWantlist()).map((function(e){return e[1].cid})),peers:t.peers().map((function(e){return new s(e.toB58String())})),dupBlksReceived:new a(r.dupBlksReceived),dupDataReceived:new a(r.dupDataReceived),dataReceived:new a(r.dataReceived),blocksSent:new a(r.blocksSent),dataSent:new a(r.dataSent)});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(32),s=r(15),o=r(1948).withTimeoutOption;e.exports=function(e){var t=e.bitswap;return o(function(){var e=i(n.mark((function e(r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Array.isArray(r)||(r=[r]),e.prev=1,r=r.map((function(e){return new a(e)})),e.next=8;break;case 5:throw e.prev=5,e.t0=e.catch(1),s(e.t0,"ERR_INVALID_CID");case 8:return e.abrupt("return",t.unwant(r,i));case 9:case"end":return e.stop()}}),e,null,[[1,5]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.bitswap;return a(function(){var e=i(n.mark((function e(){var r,i,a=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>0&&void 0!==a[0]?a[0]:{},i=t.getWantlist(r),e.abrupt("return",Array.from(i).map((function(e){return e[1].cid})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(55),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.bitswap;return s(function(){var e=i(n.mark((function e(r){var i,s,o=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>1&&void 0!==o[1]?o[1]:{},s=t.wantlistForPeer(a.createFromCID(r),i),e.abrupt("return",Array.from(s).map((function(e){return e[1].cid})));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2046).isValidMultiaddr,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return s(function(){var e=i(n.mark((function e(r){var i,s,o=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>1&&void 0!==o[1]?o[1]:{},a(r)){e.next=3;break}throw new Error("".concat(r," is not a valid Multiaddr"));case 3:return e.next=5,t.config.getAll(i);case 5:return-1===(s=e.sent).Bootstrap.indexOf(r)&&s.Bootstrap.push(r),e.next=9,t.config.set(s);case 9:return e.abrupt("return",{Peers:[r]});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return a(function(){var e=i(n.mark((function e(){var r,i,a,s=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:{},e.next=3,t.config.getAll(r);case 3:return i=e.sent,a=i.Bootstrap||[],i.Bootstrap=[],e.next=8,t.config.set(i);case 8:return e.abrupt("return",{Peers:a});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return a(function(){var e=i(n.mark((function e(r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.config.get("Bootstrap",r);case 2:return i=e.sent,e.abrupt("return",{Peers:i||[]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2006),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return s(function(){var e=i(n.mark((function e(){var r,i,s=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=s.length>0&&void 0!==s[0]?s[0]:{},e.next=3,t.config.getAll(r);case 3:return(i=e.sent).Bootstrap=a().Bootstrap,e.next=7,t.config.set(i);case 7:return e.abrupt("return",{Peers:a().Bootstrap});case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2046).isValidMultiaddr,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return s(function(){var e=i(n.mark((function e(r){var i,s,o=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=o.length>1&&void 0!==o[1]?o[1]:{},a(r)){e.next=3;break}throw new Error("".concat(r," is not a valid Multiaddr"));case 3:return e.next=5,t.config.getAll(i);case 5:return(s=e.sent).Bootstrap=(s.Bootstrap||[]).filter((function(e){return e!==r})),e.next=9,t.config.set(s);case 9:return e.abrupt("return",{Peers:[r]});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(26),a=r(25),s=r(18),o=r(96),u=r(126),c=r(1948),f=c.normalizeCidPath,h=c.withTimeoutOption;e.exports=function(e){var t=e.ipld,r=e.preload;return h(function(){var e=i(n.mark((function e(i,c){var h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=c||{},i=f(i),!1!==c.preload&&(h=i.split("/"),r(h[0])),e.next=5,a(u(i,t,c));case 5:if(!(l=e.sent).unixfs||!l.unixfs.type.includes("dir")){e.next=8;break}throw new Error("this dag node is a directory");case 8:if(l.content){e.next=10;break}throw new Error("this dag node has no content");case 10:return e.delegateYield(o(s(l.content(c)),a),"t0",11);case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption,s=r(789),o=r(223),u=r(1985);e.exports=function(e){var t=e.ipld,r=e.preload;return a(function(){var e=i(n.mark((function e(i){var a,c,f,h,l=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>1&&void 0!==l[1]?l[1]:{},c=u(i),f=c.cid,(h=c.path)&&(a.path=h),!1!==a.preload&&r(f),!a.path){e.next=8;break}if(!a.localResolve){e.next=7;break}return e.abrupt("return",s(t.resolve(f,a.path)));case 7:return e.abrupt("return",o(t.resolve(f,a.path)));case 8:return e.next=10,t.get(f,a);case 10:return e.t0=e.sent,e.abrupt("return",{value:e.t0,remainderPath:""});case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(49),s=function(e){return a[e.toUpperCase().replace(/-/g,"_")]},o=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,r=e.pin,u=e.gcLock,c=e.preload;return o(function(){var e=i(n.mark((function e(i,o){var f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(o=o||{}).cid||!o.format&&!o.hashAlg){e.next=5;break}throw new Error("Can't put dag node. Please provide either `cid` OR `format` and `hashAlg` options.");case 5:if(!(o.format&&!o.hashAlg||!o.format&&o.hashAlg)){e.next=7;break}throw new Error("Can't put dag node. Please provide `format` AND `hashAlg` options.");case 7:if(f={format:a.DAG_CBOR,hashAlg:a.SHA2_256},o.format&&"string"===typeof o.format&&(o.format=s(o.format)),o.hashAlg&&"string"===typeof o.hashAlg&&(o.hashAlg=s(o.hashAlg)),void 0===(o=o.cid?o:Object.assign({},f,o)).version&&(o.format===a.DAG_PB&&o.hashAlg===a.SHA2_256?o.version=0:o.version=1),!o.pin){e.next=16;break}return e.next=15,u.readLock();case 15:h=e.sent;case 16:return e.prev=16,e.next=19,t.put(i,o.format,{hashAlg:o.hashAlg,cidVersion:o.version,signal:o.signal});case 19:if(l=e.sent,!o.pin){e.next=23;break}return e.next=23,r.add(l,{lock:!1});case 23:return!1!==o.preload&&c(l),e.abrupt("return",l);case 25:return e.prev=25,h&&h(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[16,,25,28]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(18),s=r(32),o=r(1948).withTimeoutOption,u=r(1985);e.exports=function(e){var t=e.ipld,r=e.preload;return o(function(){var e=i(n.mark((function e(i){var o,c,f,h,l,p,d,v,y,b,m,g,k,w,x,S=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=S.length>1&&void 0!==S[1]?S[1]:{},c=u(i),f=c.cid,h=c.path,!1!==o.preload&&r(f),h&&(o.path=h),l=f,(p=o.path||"").startsWith("/")&&(p=p.substring(1)),!o.path){e.next=51;break}e.prev=8,d=!0,v=!1,e.prev=11,b=a(t.resolve(f,o.path,{signal:o.signal}));case 13:return e.next=15,b.next();case 15:return m=e.sent,d=m.done,e.next=19,m.value;case 19:if(g=e.sent,d){e.next=29;break}if(w=(k=g).value,x=k.remainderPath,s.isCID(w)){e.next=24;break}return e.abrupt("break",29);case 24:p=x,l=w;case 26:d=!0,e.next=13;break;case 29:e.next=35;break;case 31:e.prev=31,e.t0=e.catch(11),v=!0,y=e.t0;case 35:if(e.prev=35,e.prev=36,d||null==b.return){e.next=40;break}return e.next=40,b.return();case 40:if(e.prev=40,!v){e.next=43;break}throw y;case 43:return e.finish(40);case 44:return e.finish(35);case 45:e.next=51;break;case 47:throw e.prev=47,e.t1=e.catch(8),e.t1.message.startsWith("Object has no property")&&(e.t1.message='no link named "'.concat(p.split("/")[0],'" under ').concat(l),e.t1.code="ERR_NO_LINK"),e.t1;case 51:return e.abrupt("return",{cid:l,remainderPath:p||""});case 52:case"end":return e.stop()}}),e,null,[[8,47],[11,31,35,45],[36,,40,44]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(26),a=r(25),s=r(18),o=r(96),u=r(1948).withTimeoutOption,c=r(1985);e.exports=function(e){var t=e.ipld,r=e.preload;return u(function(){var e=i(n.mark((function e(i){var u,f,h,l,p=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=p.length>1&&void 0!==p[1]?p[1]:{},f=c(i),h=f.cid,(l=f.path)&&(u.path=l),!1!==u.preload&&r(h),e.delegateYield(o(s(t.tree(h,u.path,u)),a),"t0",5);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(18),u=r(55),c=r(32),f=r(15),h=r(1948).withTimeoutOption,l=r(3).Buffer;e.exports=function(e){var t=e.libp2p,r=e.repo;return{get:h(function(){var e=i(n.mark((function e(r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=i||{},l.isBuffer(r)){e.next=10;break}e.prev=2,r=r.toString().split("/").filter((function(e){return e&&"ipfs"!==e&&"ipns"!==e})).shift(),r=new c(r).buffer,e.next=10;break;case 7:throw e.prev=7,e.t0=e.catch(2),f(e.t0,"ERR_INVALID_CID");case 10:return e.abrupt("return",t._dht.get(r,i));case 11:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t,r){return e.apply(this,arguments)}}()),put:h(function(){var e=i(n.mark((function e(r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l.isBuffer(r)){e.next=9;break}e.prev=1,r=r.toString().split("/").filter((function(e){return e&&"ipfs"!==e&&"ipns"!==e})).shift(),r=new c(r).buffer,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(1),f(e.t0,"ERR_INVALID_CID");case 9:return e.abrupt("return",t._dht.put(r,i));case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,r){return e.apply(this,arguments)}}()),findProvs:h(function(){var e=s(n.mark((function e(r,i){var s,u,h,l,p,d,v;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=i||{},"string"!==typeof r){e.next=9;break}e.prev=2,r=new c(r),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),f(e.t0,"ERR_INVALID_CID");case 9:i.numProviders&&(i.maxNumProviders=i.numProviders),s=!0,u=!1,e.prev=12,l=o(t._dht.findProviders(r,i));case 14:return e.next=16,a(l.next());case 16:return p=e.sent,s=p.done,e.next=20,a(p.value);case 20:if(d=e.sent,s){e.next=28;break}return v=d,e.next=25,{id:v.id.toB58String(),addrs:v.addrs};case 25:s=!0,e.next=14;break;case 28:e.next=34;break;case 30:e.prev=30,e.t1=e.catch(12),u=!0,h=e.t1;case 34:if(e.prev=34,e.prev=35,s||null==l.return){e.next=39;break}return e.next=39,a(l.return());case 39:if(e.prev=39,!u){e.next=42;break}throw h;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}}),e,null,[[2,6],[12,30,34,44],[35,,39,43]])})));return function(t,r){return e.apply(this,arguments)}}()),findPeer:h(function(){var e=i(n.mark((function e(r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"string"===typeof r&&(r=u.createFromCID(r)),e.next=3,t._dht.findPeer(r);case 3:return i=e.sent,e.abrupt("return",{id:i.id.toB58String(),addrs:i.multiaddrs});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),provide:h(function(){var e=s(n.mark((function e(i,s){var o,u,h,l,p,d,v,y;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Array.isArray(i)?i:[i],s=s||{},e.t0=n.keys(i);case 3:if((e.t1=e.t0()).done){e.next=15;break}if(o=e.t1.value,"string"!==typeof i[o]){e.next=13;break}e.prev=6,i[o]=new c(i[o]),e.next=13;break;case 10:throw e.prev=10,e.t2=e.catch(6),f(e.t2,"ERR_INVALID_CID");case 13:e.next=3;break;case 15:return e.next=17,a(Promise.all(i.map((function(e){return r.blocks.has(e)}))));case 17:if(u=e.sent,u.every((function(e){return e}))){e.next=21;break}throw f(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");case 21:if(!s.recursive){e.next=23;break}throw f(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");case 23:h=!0,l=!1,p=void 0,e.prev=26,d=i[Symbol.iterator]();case 28:if(h=(v=d.next()).done){e.next=35;break}return y=v.value,e.next=32,t._dht.provide(y);case 32:h=!0,e.next=28;break;case 35:e.next=41;break;case 37:e.prev=37,e.t3=e.catch(26),l=!0,p=e.t3;case 41:e.prev=41,e.prev=42,h||null==d.return||d.return();case 44:if(e.prev=44,!l){e.next=47;break}throw p;case 47:return e.finish(44);case 48:return e.finish(41);case 49:case"end":return e.stop()}}),e,null,[[6,10],[26,37,41,49],[42,,44,48]])})));return function(t,r){return e.apply(this,arguments)}}()),query:h(function(){var e=s(n.mark((function e(r){var i,s,c,f,h,l,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"string"===typeof r&&(r=u.createFromCID(r)),i=!0,s=!1,e.prev=3,f=o(t._dht.getClosestPeers(r.toBytes()));case 5:return e.next=7,a(f.next());case 7:return h=e.sent,i=h.done,e.next=11,a(h.value);case 11:if(l=e.sent,i){e.next=19;break}return p=l,e.next=16,{id:p.toB58String(),addrs:[]};case 16:i=!0,e.next=5;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),s=!0,c=e.t0;case 25:if(e.prev=25,e.prev=26,i||null==f.return){e.next=30;break}return e.next=30,a(f.return());case 30:if(e.prev=30,!s){e.next=33;break}throw c;case 33:return e.finish(30);case 34:return e.finish(25);case 35:case"end":return e.stop()}}),e,null,[[3,21,25,35],[26,,30,34]])})));return function(t){return e.apply(this,arguments)}}())}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2161),s=r(1948).withTimeoutOption;function o(e){return e.endsWith(".eth")&&(e=e.replace(/.eth$/,".eth.link")),e}e.exports=function(){return s(function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},"string"===typeof t){e.next=3;break}throw new Error("Invalid arguments, domain must be a string");case 3:return t=o(t),e.abrupt("return",a(t,r));case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2048),s=r(151).default,o=r(338),u=new a(1e3),c=new s({concurrency:4}),f=function(e){if(e.Path)return e.Path;throw new Error(e.Message)};e.exports=function(){var e=i(n.mark((function e(t,r){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=i(n.mark((function e(t,r){var a,s,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},(a=new URLSearchParams(r)).set("arg",t),s=a.toString(),r.nocache||!u.has(s)){e.next=7;break}return h=u.get(s),e.abrupt("return",f(h));case 7:return e.next=9,c.add(i(n.mark((function e(){var t,r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get("https://ipfs.io/api/v0/dns",{searchParams:a});case 2:return t=e.sent,r=new URL(t.url).search.slice(1),e.next=6,t.json();case 6:return i=e.sent,u.set(r,i,6e4),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e)}))));case 9:return l=e.sent,e.abrupt("return",f(l));case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.abrupt("return",a(t,r));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(25),s=r(26),o=r(18),u=r(2049),c=r(149),f={stat:r(1987)},h={chmod:r(2163),cp:r(2008),flush:r(2167),mkdir:r(2009),mv:r(2168),rm:r(2011),touch:r(2169)},l={write:r(2170),read:r(2172),ls:r(2173)},p=function(e){var t=e.options,r=e.mfs,n=e.operations,i=e.lock;Object.keys(n).forEach((function(e){r[e]=i(n[e](t))}))},d={repoOwner:!0,ipld:null,repo:null};e.exports=function(e){var t=e.ipld,r=e.block,v=e.blockService,y=e.repo,b=e.preload,m=e.options,g=function(e){var t=Object.assign({},d||{},e).repoOwner;e.repo={blocks:e.blocks,datastore:e.datastore};var r=u(t),n={};return p({options:e,mfs:n,operations:f,lock:function(e){return r.readLock(e)}}),p({options:e,mfs:n,operations:h,lock:function(e){return r.writeLock(e)}}),Object.keys(l).forEach((function(t){n[t]=l[t](e)})),n}({ipld:t,block:r,blocks:v,datastore:y.root,repoOwner:m.repoOwner}),k=function(e){return function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var i=r.filter((function(e){return c.ipfsPath(e)||c.cid(e)}));if(i.length){var a=r[r.length-1];a&&!1!==a.preload&&i.forEach((function(e){return b(e)}))}return e.apply(void 0,r)}};return i({},g,{chmod:g.chmod,cp:k(g.cp),mkdir:g.mkdir,stat:k(g.stat),rm:g.rm,read:k(g.read),touch:g.touch,write:g.write,mv:k(g.mv),flush:g.flush,ls:k(function(){var e=s(n.mark((function e(){var t,r,s,u,c,f,h,l=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,e.prev=2,u=o(g.ls.apply(g,l));case 4:return e.next=6,a(u.next());case 6:return c=e.sent,t=c.done,e.next=10,a(c.value);case 10:if(f=e.sent,t){e.next=18;break}return h=f,e.next=15,i({},h,{size:h.size||0});case 15:t=!0,e.next=4;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(2),r=!0,s=e.t0;case 24:if(e.prev=24,e.prev=25,t||null==u.return){e.next=29;break}return e.next=29,a(u.return());case 29:if(e.prev=29,!r){e.next=32;break}throw s;case 32:return e.finish(29);case 33:return e.finish(24);case 34:case"end":return e.stop()}}),e,null,[[2,20,24,34],[25,,29,33]])})));return function(){return e.apply(this,arguments)}}())})}},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(48),o=r(25),u=r(26),c=r(18),f=r(1959),h=r(1956),l=r(19)("ipfs:mfs:touch"),p=r(15),d=r(90),v=r(1975),y=r(1968),b=r(1969),m=r(1970),g=r(61).DAGNode,k=r(49),w=r(1955).multihash,x=r(78),S=r(330),E=r(126),_=r(223),I=r(2008),A=r(2011),T=r(192),C=r(1948).withTimeoutOption,B={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1,signal:void 0};function R(e,t,r){t||(t=0);var n=e.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!n)throw new Error("Invalid file mode: ".concat(e));var i=s(n,4),a=(i[0],i[1]),o=i[2],u=i[3];"a"!==a&&a||(a="ugo");var c=function(e,t,r){var n=0;return(e.includes("x")||e.includes("X")&&(r||1&t||8&t||64&t))&&(n+=1),e.includes("w")&&(n+=2),e.includes("r")&&(n+=4),n}(u,t,r);return c=function(e,t){var r=0;return e.includes("u")&&(r+=t<<6),e.includes("g")&&(r+=t<<3),e.includes("o")&&(r+=t),r}(a,c),c=function(e,t,r){return t.includes("t")&&(r+=parseInt("1000",8)),t.includes("s")&&(e.includes("u")&&(r+=parseInt("4000",8)),e.includes("g")&&(r+=parseInt("2000",8))),r}(a,u,c),"="===o?(a.includes("u")&&(t&=parseInt("7077",8),t|=c),a.includes("g")&&(t&=parseInt("7707",8),t|=c),a.includes("o")&&(t&=parseInt("7770",8),t|=c),t):"+"===o?c|t:"-"===o?c^t:void 0}function N(e,t){return("string"===typeof e||e instanceof String)&&(e=e.match(/^\d+$/g)?parseInt(e,8):e.split(",").reduce((function(e,r){return R(r,e,t.isDirectory())}),t.mode)),e}e.exports=function(e){return C(function(){var t=a(i.mark((function t(r,s,C){var R,P,M,D,O,L,K,U,q,z,j,V,F;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return C=f(C,B),l("Fetching stats for ".concat(r)),t.next=4,h(e,r,C);case 4:if(R=t.sent,P=R.cid,M=R.mfsDirectory,D=R.name,"dag-pb"===P.codec){t.next=10;break}throw p(new Error("".concat(r," was not a UnixFS node")),"ERR_NOT_UNIXFS");case 10:if(!C.recursive){t.next=19;break}return t.next=13,x(u(i.mark((function t(){var r,n,a,u,f,h,l,p;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,n=!1,t.prev=2,u=c(E.recursive(P,e.ipld));case 4:return t.next=6,o(u.next());case 6:return f=t.sent,r=f.done,t.next=10,o(f.value);case 10:if(h=t.sent,r){t.next=23;break}return l=h,t.next=15,o(e.ipld.get(l.cid));case 15:return p=t.sent,l.unixfs.mode=N(s,l.unixfs),p=new g(l.unixfs.marshal(),p.Links),t.next=20,{path:l.path,content:p};case 20:r=!0,t.next=4;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(2),n=!0,a=t.t0;case 29:if(t.prev=29,t.prev=30,r||null==u.return){t.next=34;break}return t.next=34,o(u.return());case 34:if(t.prev=34,!n){t.next=37;break}throw a;case 37:return t.finish(34);case 38:return t.finish(29);case 39:case"end":return t.stop()}}),t,null,[[2,25,29,39],[30,,34,38]])}))),(function(t){return S(t,e.block,n({},C,{pin:!1,dagBuilder:function(){var e=u(i.mark((function e(t,r,n){var s,u,f,h,l,p,v;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=!0,u=!1,e.prev=2,h=i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v,e.next=3,a(i.mark((function e(){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T(t.content.serialize(),r,n);case 2:return a=e.sent,e.abrupt("return",{cid:a,path:t.path,unixfs:d.unmarshal(t.content.Data),node:t.content});case 4:case"end":return e.stop()}}),e)})));case 3:case"end":return e.stop()}}),e)})),l=c(t);case 5:return e.next=7,o(l.next());case 7:return p=e.sent,s=p.done,e.next=11,o(p.value);case 11:if(v=e.sent,s){e.next=17;break}return e.delegateYield(h(),"t0",14);case 14:s=!0,e.next=5;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(2),u=!0,f=e.t1;case 23:if(e.prev=23,e.prev=24,s||null==l.return){e.next=28;break}return e.next=28,o(l.return());case 28:if(e.prev=28,!u){e.next=31;break}throw f;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])})));return function(t,r,n){return e.apply(this,arguments)}}()}))}),(function(e){return _(e)}));case 13:return O=t.sent,t.next=16,A(e)(r,C);case 16:return t.next=18,I(e)("/ipfs/".concat(O.cid),r,C);case 18:return t.abrupt("return");case 19:return t.next=21,e.ipld.get(P);case 21:return L=t.sent,(K=d.unmarshal(L.Data)).mode=N(s,K),L=new g(K.marshal(),L.Links),t.next=27,e.ipld.put(L,k.DAG_PB,{cidVersion:P.version,hashAlg:w.names[C.hashAlg],onlyHash:!C.flush});case 27:return U=t.sent,t.next=30,v(e,M,C);case 30:return q=t.sent,z=q[q.length-1],t.next=34,e.ipld.get(z.cid);case 34:return j=t.sent,t.next=37,y(e,{parent:j,name:D,cid:U,size:L.serialize().length,flush:C.flush,hashAlg:C.hashAlg,cidVersion:P.version});case 37:return V=t.sent,z.cid=V.cid,t.next=41,b(e,q,C);case 41:return F=t.sent,t.next=44,m(e,F,C);case 44:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(90),s=r(61).DAGNode,o=r(49),u=r(1955).multihash,c=function(){var e=i(n.mark((function e(t,r,i){var c,f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=u.names[i.hashAlg],f=new a({type:r,mode:i.mode,mtime:i.mtime}),h=new s(f.marshal()),e.next=5,t.ipld.put(h,o.DAG_PB,{cidVersion:i.cidVersion,hashAlg:c,onlyHash:!i.flush});case 5:return l=e.sent,e.abrupt("return",{cid:l,node:h});case 7:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2010);function s(){return(s=i(n.mark((function e(t,r,i){var s,o,u,c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a(t,r,i);case 2:return s=e.sent,o=s.sources,u=s.options,c=o.pop(),e.abrupt("return",{destination:c,sources:o,options:u});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=function(e,t,r){return s.apply(this,arguments)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61),s=a.DAGNode,o=a.DAGLink,u=r(32),c=r(19)("ipfs:mfs:core:utils:remove-link"),f=r(90),h=r(2051),l=h.generatePath,p=h.updateHamtDirectory,d=r(15),v=r(49),y=r(1955).multihash,b=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r.parentCid||r.parent){e.next=2;break}throw d(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");case 2:if(!r.parentCid||u.isCID(r.parentCid)){e.next=4;break}throw d(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");case 4:if(r.parent){e.next=9;break}return c("Loading parent node ".concat(r.parentCid)),e.next=8,t.ipld.get(r.parentCid);case 8:r.parent=e.sent;case 9:if(r.name){e.next=11;break}throw d(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");case 11:if("hamt-sharded-directory"!==f.unmarshal(r.parent.Data).type){e.next=15;break}return c("Removing ".concat(r.name," from sharded directory")),e.abrupt("return",g(t,r));case 15:return c("Removing link ".concat(r.name," regular directory")),e.abrupt("return",m(t,r));case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),m=function(){var e=i(n.mark((function e(t,r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=y.names[r.hashAlg],r.parent.rmLink(r.name),e.next=4,t.ipld.put(r.parent,v.DAG_PB,{cidVersion:r.cidVersion,hashAlg:i});case 4:return a=e.sent,c("Updated regular directory ".concat(a)),e.abrupt("return",{node:r.parent,cid:a});case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),g=function(){var e=i(n.mark((function e(t,r){var i,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(t,r.name,r.parent);case 2:return i=e.sent,a=i.rootBucket,s=i.path,e.next=7,a.del(r.name);case 7:return e.next=9,k(t,s,{name:r.name,cid:r.cid,size:r.size,hashAlg:r.hashAlg,cidVersion:r.cidVersion,flush:r.flush},r);case 9:return o=e.sent,u=o.node,e.abrupt("return",p(t,u.Links,a,r));case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),k=function(){var e=i(n.mark((function e(t,r,i,a){var o,u,f,h,l,v,y,b;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=r.pop(),u=o.bucket,f=o.prefix,h=o.node,l=h.Links.find((function(e){return e.Name.substring(0,2)===f}))){e.next=4;break}throw d(new Error("No link found with prefix ".concat(f," for file ").concat(i.name)),"ERR_NOT_FOUND");case 4:if(l.Name!=="".concat(f).concat(i.name)){e.next=10;break}return c("Removing existing link ".concat(l.Name)),h.rmLink(l.Name),e.next=9,u.del(i.name);case 9:return e.abrupt("return",p(t,h.Links,u,a));case 10:return c("Descending into sub-shard ".concat(l.Name," for ").concat(f).concat(i.name)),e.next=13,k(t,r,i,a);case 13:return v=e.sent,y=f,1===v.node.Links.length&&(c("Removing subshard for ".concat(f)),v.cid=v.node.Links[0].Hash,v.node=v.node.Links[0],y="".concat(f).concat(v.node.Name.substring(2))),c("Updating shard ".concat(f," with name ").concat(y)),b=s.isDAGNode(v.node)?v.node.size:v.node.Tsize,e.abrupt("return",w(t,u,h,f,y,b,v.cid,a));case 19:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),w=function(e,t,r,n,i,a,s,u){return r.rmLink(n),r.addLink(new o(i,a,s)),p(e,r.Links,t,u)};e.exports=b},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1959),s=r(1987),o=r(1948).withTimeoutOption,u={signal:void 0};e.exports=function(e){return o(function(){var t=i(n.mark((function t(r){var i,o,c,f=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=f.length>1&&void 0!==f[1]?f[1]:{},i=a(i,u),t.next=4,s(e)(r,i);case 4:return o=t.sent,c=o.cid,t.abrupt("return",c);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2010),s=r(2008),o=r(2011),u=r(1948).withTimeoutOption,c={parents:!1,recursive:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3,signal:void 0};e.exports=function(e){return u(function(){var t=i(n.mark((function t(){var r,i,u,f,h,l,p,d,v=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=v.length,i=new Array(r),u=0;u<r;u++)i[u]=v[u];return t.next=3,a(e,i,c);case 3:return f=t.sent,h=f.sources,l=f.options,p=h.map((function(e){return e.path})).concat(l),d=h.slice(0,-1).map((function(e){return e.path})).concat(Object.assign(l,{recursive:!0})),t.next=10,s(e).apply(null,p);case 10:return t.next=12,o(e).apply(null,d);case 12:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1959),s=r(1956),o=r(19)("ipfs:mfs:touch"),u=r(15),c=r(90),f=r(1975),h=r(1968),l=r(1969),p=r(1970),d=r(61).DAGNode,v=r(49),y=r(1955).multihash,b=r(1948).withTimeoutOption,m={mtime:void 0,flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256",signal:void 0};e.exports=function(e){return b(function(){var t=i(n.mark((function t(r,i){var b,g,k,w,x,S,E,_,I,A,T,C,B,R,N;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(i=a(i=i||{},m)).mtime=i.mtime||new Date,o("Touching ".concat(r," mtime: ").concat(i.mtime)),t.next=6,s(e,r,i);case 6:if(b=t.sent,g=b.cid,k=b.mfsDirectory,w=b.name,x=b.exists,_=i.cidVersion,x){t.next=20;break}return I=new c({type:"file",mtime:i.mtime}),S=new d(I.marshal()),t.next=17,e.ipld.put(S,v.DAG_PB,{cidVersion:i.cidVersion,hashAlg:y.names["sha2-256"],onlyHash:!i.flush});case 17:E=t.sent,t.next=32;break;case 20:if("dag-pb"===g.codec){t.next=22;break}throw u(new Error("".concat(r," was not a UnixFS node")),"ERR_NOT_UNIXFS");case 22:return _=g.version,t.next=25,e.ipld.get(g);case 25:return S=t.sent,(A=c.unmarshal(S.Data)).mtime=i.mtime,S=new d(A.marshal(),S.Links),t.next=31,e.ipld.put(S,v.DAG_PB,{cidVersion:g.version,hashAlg:y.names["sha2-256"],onlyHash:!i.flush});case 31:E=t.sent;case 32:return t.next=34,f(e,k,i);case 34:return T=t.sent,C=T[T.length-1],t.next=38,e.ipld.get(C.cid);case 38:return B=t.sent,t.next=41,h(e,{parent:B,name:w,cid:E,size:S.serialize().length,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:"sha2-256",cidVersion:_});case 41:return R=t.sent,C.cid=R.cid,t.next=45,l(e,T,i);case 45:return N=t.sent,t.next=48,p(e,N,i);case 48:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(50),i=r(1),a=r(2),s=r(96),o=r(18),u=r(25),c=r(26),f=r(19)("ipfs:mfs:write"),h=r(330),l=r(3).Buffer,p=r(1987),d=r(2009),v=r(1968),y=r(1959),b=r(2049),m=r(2171),g=r(1956),k=r(2007),w=r(1975),x=r(1969),S=r(1970),E=r(15),_=r(1948).MFS_MAX_CHUNK_SIZE,I=r(223),A=r(1948).withTimeoutOption,T={offset:0,length:void 0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:function(){},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3,mode:void 0,mtime:void 0,signal:void 0};e.exports=function(e){return A(function(){var t=a(i.mark((function t(r,n,s){var o,u,c;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=y(s,T),f("Reading source, destination and parent"),t.next=4,b().readLock(a(i.mark((function t(){return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(n,s);case 2:return o=t.sent,t.next=5,g(e,r,s);case 5:return u=t.sent,t.next=8,g(e,u.mfsDirectory,s);case 8:c=t.sent;case 9:case"end":return t.stop()}}),t)}))))();case 4:if(f("Read source, destination and parent"),s.parents||c.exists){t.next=7;break}throw E(new Error("directory does not exist"),"ERR_NO_EXIST");case 7:if(s.create||u.exists){t.next=9;break}throw E(new Error("file does not exist"),"ERR_NO_EXIST");case 9:return t.abrupt("return",C(e,r,o,u,s));case 10:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}())};var C=function(){var e=a(i.mark((function e(t,r,n,s,o){var u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,n,s,o);case 2:return u=e.sent,e.next=5,b().writeLock(a(i.mark((function e(){var n,a,s,c,f,h,l,y,b;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=k(r),a=n.pop(),s=!1,e.prev=3,e.next=6,p(t)("/".concat(n.join("/")),o);case 6:s=!0,e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),"ERR_NOT_FOUND"===e.t0.code){e.next=13;break}throw e.t0;case 13:if(s){e.next=16;break}return e.next=16,d(t)("/".concat(n.join("/")),o);case 16:return e.next=18,g(t,r,o);case 18:return c=e.sent,e.next=21,w(t,c.mfsDirectory,o);case 21:if(f=e.sent,(h=f[f.length-1]).type.includes("directory")){e.next=25;break}throw E(new Error("cannot write to ".concat(h.name,": Not a directory")),"ERR_NOT_A_DIRECTORY");case 25:return e.next=27,t.ipld.get(h.cid);case 27:return l=e.sent,e.next=30,v(t,{parent:l,name:a,cid:u.cid,size:u.size,flush:o.flush,shardSplitThreshold:o.shardSplitThreshold,hashAlg:o.hashAlg,cidVersion:o.cidVersion});case 30:return y=e.sent,h.cid=y.cid,e.next=34,x(t,f,o);case 34:return b=e.sent,e.next=37,S(t,b,o);case 37:case"end":return e.stop()}}),e,null,[[3,9]])}))))();case 5:case"end":return e.stop()}}),e)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}(),B=function(){var e=a(i.mark((function e(t,r,a,s){var o,u,l,p,d,v;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.exists?f("Overwriting file ".concat(a.cid," offset ").concat(s.offset," length ").concat(s.length)):f("Writing file offset ".concat(s.offset," length ").concat(s.length)),o=[],s.offset>0&&(a.unixfs?(f("Writing first ".concat(s.offset," bytes of original file")),o.push((function(){return a.content({offset:0,length:s.offset})})),a.unixfs.fileSize()<s.offset&&(u=s.offset-a.unixfs.fileSize(),f("Writing zeros for extra ".concat(u," bytes")),o.push(N(u)))):(f("Writing zeros for first ".concat(s.offset," bytes")),o.push(N(s.offset)))),o.push(R(r,s.length)),l=M(P(o),(function(e){if(a.unixfs&&!s.truncate){var t=a.unixfs.fileSize();if(t>e)return f("Writing last ".concat(t-e," of ").concat(t," bytes from original file starting at offset ").concat(e)),a.content({offset:e});f("Not writing last bytes from original file")}return n({},Symbol.asyncIterator,c(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))))})),void 0!==s.mode&&null!==s.mode?p=s.mode:a&&a.unixfs&&(p=a.unixfs.mode),void 0!==s.mtime&&null!==s.mtine?d=s.mtime:a&&a.unixfs&&(d=a.unixfs.mtime),e.next=9,I(h([{content:l,mode:p,mtime:d}],t.block,{progress:s.progress,hashAlg:s.hashAlg,cidVersion:s.cidVersion,strategy:s.strategy,rawLeaves:s.rawLeaves,reduceSingleLeafToSelf:s.reduceSingleLeafToSelf,leafType:s.leafType,pin:!1}));case 9:return v=e.sent,f("Wrote ".concat(v.cid)),e.abrupt("return",{cid:v.cid,size:v.size});case 12:case"end":return e.stop()}}),e)})));return function(t,r,n,i){return e.apply(this,arguments)}}(),R=function(e,t){return function(){var r=c(i.mark((function r(){var n,a,s,c,f,h,l,p;return i.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=0,a=!0,s=!1,r.prev=3,f=o(e);case 5:return r.next=7,u(f.next());case 7:return h=r.sent,a=h.done,r.next=11,u(h.value);case 11:if(l=r.sent,a){r.next=24;break}if(!((n+=(p=l).length)>t)){r.next=19;break}return r.next=18,p.slice(0,t-n);case 18:return r.abrupt("return");case 19:return r.next=21,p;case 21:a=!0,r.next=5;break;case 24:r.next=30;break;case 26:r.prev=26,r.t0=r.catch(3),s=!0,c=r.t0;case 30:if(r.prev=30,r.prev=31,a||null==f.return){r.next=35;break}return r.next=35,u(f.return());case 35:if(r.prev=35,!s){r.next=38;break}throw c;case 38:return r.finish(35);case 39:return r.finish(30);case 40:case"end":return r.stop()}}),r,null,[[3,26,30,40],[31,,35,39]])})));return function(){return r.apply(this,arguments)}}()},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_,r=l.alloc(t,0),a=n({},Symbol.asyncIterator,i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,r.slice();case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e)})));return R(a,e)},P=function(){var e=c(i.mark((function e(t){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t.length)){e.next=6;break}return e.delegateYield(s(o(t[r]()),u),"t0",3);case 3:r++,e.next=1;break;case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=c(i.mark((function e(t,r){var n,a,s,c,f,h,l,p,d,v,y,b,m,g,k;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0,a=!0,s=!1,e.prev=3,f=o(t);case 5:return e.next=7,u(f.next());case 7:return h=e.sent,a=h.done,e.next=11,u(h.value);case 11:if(l=e.sent,a){e.next=20;break}return n+=(p=l).length,e.next=17,p;case 17:a=!0,e.next=5;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(3),s=!0,c=e.t0;case 26:if(e.prev=26,e.prev=27,a||null==f.return){e.next=31;break}return e.next=31,u(f.return());case 31:if(e.prev=31,!s){e.next=34;break}throw c;case 34:return e.finish(31);case 35:return e.finish(26);case 36:d=!0,v=!1,e.prev=38,b=o(r(n));case 40:return e.next=42,u(b.next());case 42:return m=e.sent,d=m.done,e.next=46,u(m.value);case 46:if(g=e.sent,d){e.next=55;break}return n+=(k=g).length,e.next=52,k;case 52:d=!0,e.next=40;break;case 55:e.next=61;break;case 57:e.prev=57,e.t1=e.catch(38),v=!0,y=e.t1;case 61:if(e.prev=61,e.prev=62,d||null==b.return){e.next=66;break}return e.next=66,u(b.return());case 66:if(e.prev=66,!v){e.next=69;break}throw y;case 69:return e.finish(66);case 70:return e.finish(61);case 71:case"end":return e.stop()}}),e,null,[[3,22,26,36],[27,,31,35],[38,57,61,71],[62,,66,70]])})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";(function(t){var n=r(50),i=r(1),a=r(15),s=r(3).Buffer,o=r(19)("ipfs:mfs:utils:to-async-iterator"),u=r(1948).MFS_MAX_CHUNK_SIZE;e.exports=function(e){if(!e)throw a(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if(("string"===typeof e||e instanceof String)&&(o("Content was a string"),e=s.from(e)),e.length)return o("Content was array-like"),n({},Symbol.asyncIterator,i.mark((function t(){return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e;case 2:case"end":return t.stop()}}),t)})));if(e[Symbol.asyncIterator])return o("Content was an async iterator"),e;if(e[Symbol.iterator])return o("Content was an iterator"),e;if(t.Blob&&e instanceof t.Blob){o("Content was an HTML5 Blob");var r=0,c={next:function(){return r>e.size?{done:!0}:new Promise((function(n,i){var a=e.slice(r,u);r+=u;var o=new t.FileReader;o.addEventListener("loadend",(function e(t){if(o.removeEventListener("loadend",e,!1),t.error)return i(t.error);n({done:!1,value:s.from(o.result)})})),o.readAsArrayBuffer(a)}))}};return n({},Symbol.asyncIterator,(function(){return c}))}throw a(new Error("Don't know how to convert ".concat(e," into an async iterator")),"ERR_INVALID_PARAMS")}}).call(this,r(38))},function(e,t,r){"use strict";var n=r(50),i=r(1),a=r(25),s=r(26),o=r(18),u=r(126),c=r(1959),f=r(1956),h=r(15),l=r(1948).withTimeoutOption,p={offset:0,length:1/0,signal:void 0};e.exports=function(e){return l((function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=c(r,p),n({},Symbol.asyncIterator,function(){var n=s(i.mark((function n(){var s,c,l,p,d,v,y,b,m;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,a(f(e,t,r));case 2:return s=n.sent,n.next=5,a(u(s.mfsPath,e.ipld));case 5:if("file"===(c=n.sent).unixfs.type){n.next=8;break}throw h(new Error("".concat(t," was not a file")),"ERR_NOT_FILE");case 8:if(c.content){n.next=10;break}throw h(new Error("Could not load content stream from ".concat(t)),"ERR_NO_CONTENT");case 10:l=!0,p=!1,n.prev=12,v=o(c.content({offset:r.offset,length:r.length}));case 14:return n.next=16,a(v.next());case 16:return y=n.sent,l=y.done,n.next=20,a(y.value);case 20:if(b=n.sent,l){n.next=28;break}return m=b,n.next=25,m;case 25:l=!0,n.next=14;break;case 28:n.next=34;break;case 30:n.prev=30,n.t0=n.catch(12),p=!0,d=n.t0;case 34:if(n.prev=34,n.prev=35,l||null==v.return){n.next=39;break}return n.next=39,a(v.return());case 39:if(n.prev=39,!p){n.next=42;break}throw d;case 42:return n.finish(39);case 43:return n.finish(34);case 44:case"end":return n.stop()}}),n,null,[[12,30,34,44],[35,,39,43]])})));return function(){return n.apply(this,arguments)}}())}))}},function(e,t,r){"use strict";var n=r(1),i=r(25),a=r(26),s=r(18),o=r(126),u=r(1956),c=r(1948),f=c.MFS_FILE_TYPES,h=c.withTimeoutOption,l=function(e){var t,r,n=0,i=e.node.size||e.node.length;e.unixfs&&(i=e.unixfs.fileSize(),n=f[e.unixfs.type],t=e.unixfs.mode,r=e.unixfs.mtime);var a={cid:e.cid,name:e.name,type:n,size:i};return void 0!==r&&(a.mtime=r),void 0!==t&&(a.mode=t),a};e.exports=function(e){return h(function(){var t=a(n.mark((function t(r){var a,c,f,h,p,d,v,y,b,m,g=arguments;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=g.length>1&&void 0!==g[1]?g[1]:{},t.next=3,i(u(e,r,a));case 3:return c=t.sent,t.next=6,i(o(c.mfsPath,e.ipld));case 6:if((f=t.sent).unixfs&&f.unixfs.type.includes("directory")){t.next=11;break}return t.next=10,l(f);case 10:return t.abrupt("return");case 11:h=!0,p=!1,t.prev=13,v=s(f.content(a));case 15:return t.next=17,i(v.next());case 17:return y=t.sent,h=y.done,t.next=21,i(y.value);case 21:if(b=t.sent,h){t.next=29;break}return m=b,t.next=26,l(m);case 26:h=!0,t.next=15;break;case 29:t.next=35;break;case 31:t.prev=31,t.t0=t.catch(13),p=!0,d=t.t0;case 35:if(t.prev=35,t.prev=36,h||null==v.return){t.next=40;break}return t.next=40,i(v.return());case 40:if(t.prev=40,!p){t.next=43;break}throw d;case 43:return t.finish(40);case 44:return t.finish(35);case 45:case"end":return t.stop()}}),t,null,[[13,31,35,45],[36,,40,44]])})));return function(e){return t.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(25),s=r(26),o=r(18),u=r(126),c=r(15),f=r(1948),h=f.normalizeCidPath,l=f.mapFile,p=f.withTimeoutOption;e.exports=function(e){var t=e.ipld,r=e.preload;return p(function(){var e=s(n.mark((function e(s,f){var p,d,v,y,b,m,g,k;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1===(f=f||{}).preload){e.next=10;break}e.prev=2,p=h(s).split("/"),e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(2),c(e.t0,"ERR_INVALID_PATH");case 9:r(p[0]);case 10:d=!0,v=!1,e.prev=12,b=o(u.recursive(s,t,f));case 14:return e.next=16,a(b.next());case 16:return m=e.sent,d=m.done,e.next=20,a(m.value);case 20:if(g=e.sent,d){e.next=28;break}return k=g,e.next=25,l(k,i({},f,{includeContent:!0}));case 25:d=!0,e.next=14;break;case 28:e.next=34;break;case 30:e.prev=30,e.t1=e.catch(12),v=!0,y=e.t1;case 34:if(e.prev=34,e.prev=35,d||null==b.return){e.next=39;break}return e.next=39,a(b.return());case 39:if(e.prev=39,!v){e.next=42;break}throw y;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}}),e,null,[[2,6],[12,30,34,44],[35,,39,43]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2052).version,s=r(72),o=r(1948).withTimeoutOption;e.exports=function(e){var t=e.peerId,r=e.libp2p;return o(function(){var e=i(n.mark((function e(){var i,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.toB58String(),o=[],r&&(o=r.transportManager.getAddrs()),e.abrupt("return",{id:i,publicKey:t.pubKey.bytes.toString("base64"),addresses:o.map((function(e){var t=e.toString();return t.endsWith("/p2p/".concat(i))?t:"".concat(t,"/p2p/").concat(i)})).sort().map((function(e){return s(e)})),agentVersion:"js-ipfs/".concat(a),protocolVersion:"9000"});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(2),s=r(19)("ipfs:components:init"),o=r(55),u=r(3).Buffer,c=r(103),f=r(2006),h=r(2177),l=r(468),p=r(61).DAGNode,d=r(90),v=r(49),y=r(1974),b=y.AlreadyInitializingError,m=y.AlreadyInitializedError,g=y.NotStartedError,k=y.NotEnabledError,w=r(796),x=r(797),S=r(2197),E=r(2198),_=r(2012).errors.ERR_REPO_NOT_INITIALIZED,I=r(2056),A=r(2057),T=r(2203),C=r(1986),B=r(1984);function R(e,t){return N.apply(this,arguments)}function N(){return(N=a(n.mark((function e(t,r){var i,a,o,u,h,l,p,d,v,y;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.privateKey,a=r.emptyRepo,o=r.bits,u=r.profiles,h=r.config,l=r.pass,p=r.print,a=a||!1,o=null==o?2048:Number(o),h=c(L(u,f()),h),e.next=6,t.exists();case 6:if(d=e.sent,s("repo exists?",d),!0!==d){e.next=10;break}throw new Error("repo already exists");case 10:return e.next=12,D({privateKey:i,bits:o,print:p});case 12:return v=e.sent,s("identity generated"),h.Identity={PeerID:v.toB58String(),PrivKey:v.privKey.bytes.toString("base64")},i=v.privKey,s("peer identity: %s",h.Identity.PeerID),e.next=19,t.init(h);case 19:return e.next=21,t.open();case 21:if(s("repo opened"),!(y=B.libp2p({peerId:v,repo:t,config:h,keychainConfig:{pass:l}})).keychain||!y.keychain.opts){e.next=28;break}return e.next=26,y.loadKeychain();case 26:return e.next=28,t.config.set("Keychain",{dek:y.keychain.opts.dek});case 28:return e.abrupt("return",{peerId:v,keychain:y.keychain});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return M.apply(this,arguments)}function M(){return(M=a(n.mark((function e(t,r){var a,s,u,f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.config,s=r.profiles,u=r.pass,e.next=3,t.config.getAll();case 3:if(f=e.sent,!a&&!s){e.next=9;break}return s&&(f=L(s,f)),a&&(f=c(f,a)),e.next=9,t.config.set(f);case 9:return e.next=11,o.createFromPrivKey(f.Identity.PrivKey);case 11:if(h=e.sent,l=B.libp2p({peerId:h,repo:t,config:f,keychainConfig:i({pass:u},f.Keychain)}),e.t0=l.keychain,!e.t0){e.next=17;break}return e.next=17,l.loadKeychain();case 17:return e.abrupt("return",{peerId:h,keychain:l.keychain});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){var t=e.privateKey,r=e.bits,n=e.print;return t?(s("using user-supplied private-key"),"object"===typeof t?t:o.createFromPrivKey(u.from(t,"base64"))):(n("generating %s-bit RSA keypair...",r),o.create({bits:r}))}function O(e){var t=e.dag,r=new p(new d("directory").marshal());return t.put(r,{version:0,format:v.DAG_PB,hashAlg:v.SHA2_256,preload:!1})}function L(e,t){return(e||[]).reduce((function(e,t){var n=r(2047).profiles[t];if(!n)throw new Error("Could not find profile with name '".concat(t,"'"));return s("applying profile %s",t),n.transform(e)}),t)}function K(e){var t=e.add,r=e.apiManager,i=e.constructorOptions,s=e.block,o=e.blockService,u=e.dag,c=e.gcLock,f=e.initOptions,h=e.ipld,l=e.keychain,p=e.object,d=e.peerId,v=e.pin,y=e.pinManager,b=e.preload,k=e.print,w=e.repo,x=function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new g;case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=B.resolve({ipld:h}),E=B.refs({ipld:h,resolve:S,preload:b});return E.local=B.refs.local({repo:w}),{add:t,bitswap:{stat:x,unwant:x,wantlist:x,wantlistForPeer:x},bootstrap:{add:B.bootstrap.add({repo:w}),list:B.bootstrap.list({repo:w}),rm:B.bootstrap.rm({repo:w})},block:s,cat:B.cat({ipld:h,preload:b}),config:B.config({repo:w}),dag:u,dns:B.dns(),files:B.files({ipld:h,block:s,blockService:o,repo:w,preload:b,options:i}),get:B.get({ipld:h,preload:b}),id:B.id({peerId:d}),init:function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new m;case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isOnline:B.isOnline({}),key:{export:B.key.export({keychain:l}),gen:B.key.gen({keychain:l}),import:B.key.import({keychain:l}),info:B.key.info({keychain:l}),list:B.key.list({keychain:l}),rename:B.key.rename({keychain:l}),rm:B.key.rm({keychain:l})},ls:B.ls({ipld:h,preload:b}),object:p,pin:v,refs:E,repo:{gc:B.repo.gc({gcLock:c,pin:v,pinManager:y,refs:E,repo:w}),stat:B.repo.stat({repo:w}),version:B.repo.version({repo:w})},resolve:S,start:B.start({apiManager:r,options:i,blockService:o,gcLock:c,initOptions:f,ipld:h,keychain:l,peerId:d,pinManager:y,preload:b,print:k,repo:w}),stats:{bitswap:x,bw:x,repo:B.repo.stat({repo:w})},stop:function(){},swarm:{addrs:x,connect:x,disconnect:x,localAddrs:B.swarm.localAddrs({multiaddrs:[]}),peers:x},version:B.version({repo:w})}}e.exports=function(e){var t=e.apiManager,r=e.print,o=e.options;return(function(){var e=a(n.mark((function e(a){var u,f,p,d,v,y,m,N,M,D,L,U,q,z,j,V,F,H,G,Y,W;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=t.update({init:function(){throw new b}}),f=u.cancel,e.prev=1,a=a||{},"object"===typeof o.init&&(a=c(o.init,a)),a.pass=a.pass||o.pass,o.config&&(a.config=c(a.config,o.config)),a.repo=a.repo||o.repo,a.repoAutoMigrate=a.repoAutoMigrate||o.repoAutoMigrate,p="string"===typeof a.repo||null==a.repo?h({path:a.repo,autoMigrate:a.repoAutoMigrate}):a.repo,d=!0,!p.closed){e.next=23;break}return e.prev=11,e.next=14,p.open();case 14:e.next=23;break;case 16:if(e.prev=16,e.t0=e.catch(11),e.t0.code!==_){e.next=22;break}d=!1,e.next=23;break;case 22:throw e.t0;case 23:if(d||!1!==a.allowNew){e.next=25;break}throw new k("new repo initialization is not enabled");case 25:if(!d){e.next=31;break}return e.next=28,P(p,a);case 28:e.t1=e.sent,e.next=34;break;case 31:return e.next=33,R(p,i({},a,{print:r}));case 33:e.t1=e.sent;case 34:return v=e.t1,y=v.peerId,m=v.keychain,s("peer created"),N=new w(p),M=new x(S(N,o.ipld,s)),D=E(o.preload),e.next=43,D.start();case 43:return L=l(p.path,{singleProcess:!1!==o.repoOwner}),U={get:B.dag.get({ipld:M,preload:D}),resolve:B.dag.resolve({ipld:M,preload:D}),tree:B.dag.tree({ipld:M,preload:D})},q={data:B.object.data({ipld:M,preload:D}),get:B.object.get({ipld:M,preload:D}),links:B.object.links({dag:U}),new:B.object.new({ipld:M,preload:D}),patch:{addLink:B.object.patch.addLink({ipld:M,gcLock:L,preload:D}),appendData:B.object.patch.appendData({ipld:M,gcLock:L,preload:D}),rmLink:B.object.patch.rmLink({ipld:M,gcLock:L,preload:D}),setData:B.object.patch.setData({ipld:M,gcLock:L,preload:D})},put:B.object.put({ipld:M,gcLock:L,preload:D}),stat:B.object.stat({ipld:M,preload:D})},z=new C(p,U),e.next=49,z.load();case 49:if(j={add:B.pin.add({pinManager:z,gcLock:L,dag:U}),ls:B.pin.ls({pinManager:z,dag:U}),rm:B.pin.rm({pinManager:z,gcLock:L,dag:U})},U.put=B.dag.put({ipld:M,pin:j,gcLock:L,preload:D}),V={get:B.block.get({blockService:N,preload:D}),put:B.block.put({blockService:N,pin:j,gcLock:L,preload:D}),rm:B.block.rm({blockService:N,gcLock:L,pinManager:z}),stat:B.block.stat({blockService:N,preload:D})},F=B.addAll({block:V,preload:D,pin:j,gcLock:L,options:o}),d||a.emptyRepo){e.next=65;break}return e.next=56,O({dag:U});case 56:return H=e.sent,s("adding default assets"),e.next=60,T({addAll:F,print:r});case 60:return s("initializing IPNS keyspace"),G=new A(p),Y=new I(G,p.datastore,y,m,{pass:a.pass}),e.next=65,Y.initializeKeyspace(y.privKey,H.toString());case 65:W=K({add:B.add({addAll:F}),addAll:F,apiManager:t,constructorOptions:o,block:V,blockService:N,dag:U,gcLock:L,initOptions:a,ipld:M,keychain:m,object:q,peerId:y,pin:j,pinManager:z,preload:D,print:r,repo:p}),t.update(W,(function(){throw new g})),e.next=73;break;case 69:throw e.prev=69,e.t2=e.catch(1),f(),e.t2;case 73:return e.abrupt("return",t.api);case 74:case"end":return e.stop()}}),e,null,[[1,69],[11,16]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(2012);e.exports=function(e){var t=(e=e||{}).path||"ipfs";return new n(t,{autoMigrate:e.autoMigrate})}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2179),s=r(2182),o=r(2184),u=r(2053),c=r(19)("repo-migrations:migrator");function f(e){return e=e||a,Array.isArray(e)&&0!==e.length?e[e.length-1].version:0}function h(){return(h=i(n.mark((function e(t,r,i){var h,l,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=i.ignoreLock,l=void 0!==h&&h,d=i.repoOptions,v=i.onProgress,y=i.isDryRun,b=void 0!==y&&y,m=(m=i.migrations)||a,v=v||function(){},t){e.next=5;break}throw new u.RequiredParameterError("Path argument is required!");case 5:if(r){e.next=7;break}throw new u.RequiredParameterError("toVersion argument is required!");case 7:if(Number.isInteger(r)&&!(r<=0)){e.next=9;break}throw new u.InvalidValueError("Version has to be positive integer!");case 9:return e.next=11,s.getVersion(t);case 11:if((g=e.sent)!==r){e.next=15;break}return c("Nothing to migrate."),e.abrupt("return");case 15:if(!(g>r)){e.next=17;break}throw new u.InvalidValueError("Current repo's version (".concat(g,") is higher then toVersion (").concat(r,"), you probably wanted to revert it?"));case 17:if(p(m,g,r),b||l){e.next=22;break}return e.next=21,o.lock(g,t);case 21:k=e.sent;case 22:e.prev=22,w=0,x=r-g,S=!0,E=!1,_=void 0,e.prev=28,I=m[Symbol.iterator]();case 30:if(S=(A=I.next()).done){e.next=57;break}if(T=A.value,!(void 0!==r&&T.version>r)){e.next=34;break}return e.abrupt("break",57);case 34:if(!(T.version<=g)){e.next=36;break}return e.abrupt("continue",54);case 36:if(w++,c("Migrating version ".concat(T.version)),e.prev=38,b){e.next=42;break}return e.next=42,T.migrate(t,d);case 42:e.next=52;break;case 44:return e.prev=44,e.t0=e.catch(38),C=T.version-1,c("An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ".concat(C)),e.next=50,s.setVersion(t,C);case 50:throw e.t0.message="During migration to version ".concat(T.version," exception was raised: ").concat(e.t0.message),e.t0;case 52:v(T,w,x),c("Migrating to version ".concat(T.version," finished"));case 54:S=!0,e.next=30;break;case 57:e.next=63;break;case 59:e.prev=59,e.t1=e.catch(28),E=!0,_=e.t1;case 63:e.prev=63,e.prev=64,S||null==I.return||I.return();case 66:if(e.prev=66,!E){e.next=69;break}throw _;case 69:return e.finish(66);case 70:return e.finish(63);case 71:if(b){e.next=74;break}return e.next=74,s.setVersion(t,r||f(m));case 74:c("Repo successfully migrated ",void 0!==r?"to version ".concat(r,"!"):"to latest version!");case 75:if(e.prev=75,b||l){e.next=79;break}return e.next=79,k.close();case 79:return e.finish(75);case 80:case"end":return e.stop()}}),e,null,[[22,,75,80],[28,59,63,71],[38,44],[64,,66,70]])})))).apply(this,arguments)}function l(){return(l=i(n.mark((function e(t,r,i){var f,h,l,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=i.ignoreLock,h=void 0!==f&&f,l=i.repoOptions,d=i.onProgress,v=i.isDryRun,y=void 0!==v&&v,b=(b=i.migrations)||a,d=d||function(){},t){e.next=5;break}throw new u.RequiredParameterError("Path argument is required!");case 5:if(r){e.next=7;break}throw new u.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");case 7:if(Number.isInteger(r)&&!(r<=0)){e.next=9;break}throw new u.InvalidValueError("Version has to be positive integer!");case 9:return e.next=11,s.getVersion(t);case 11:if((m=e.sent)!==r){e.next=15;break}return c("Nothing to revert."),e.abrupt("return");case 15:if(!(m<r)){e.next=17;break}throw new u.InvalidValueError("Current repo's version (".concat(m,") is lower then toVersion (").concat(r,"), you probably wanted to migrate it?"));case 17:if(p(b,r,m,!0),y||h){e.next=22;break}return e.next=21,o.lock(m,t);case 21:g=e.sent;case 22:c("Reverting from version ".concat(m," to ").concat(r)),e.prev=23,k=0,w=m-r,x=b.slice().reverse(),S=!0,E=!1,_=void 0,e.prev=30,I=x[Symbol.iterator]();case 32:if(S=(A=I.next()).done){e.next=59;break}if(!((T=A.value).version<=r)){e.next=36;break}return e.abrupt("break",59);case 36:if(!(T.version>m)){e.next=38;break}return e.abrupt("continue",56);case 38:if(k++,c("Reverting migration version ".concat(T.version)),e.prev=40,y){e.next=44;break}return e.next=44,T.revert(t,l);case 44:e.next=54;break;case 46:return e.prev=46,e.t0=e.catch(40),C=T.version,c("An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ".concat(C)),e.next=52,s.setVersion(t,C);case 52:throw e.t0.message="During reversion to version ".concat(T.version," exception was raised: ").concat(e.t0.message),e.t0;case 54:d(T,k,w),c("Reverting to version ".concat(T.version," finished"));case 56:S=!0,e.next=32;break;case 59:e.next=65;break;case 61:e.prev=61,e.t1=e.catch(30),E=!0,_=e.t1;case 65:e.prev=65,e.prev=66,S||null==I.return||I.return();case 68:if(e.prev=68,!E){e.next=71;break}throw _;case 71:return e.finish(68);case 72:return e.finish(65);case 73:if(y){e.next=76;break}return e.next=76,s.setVersion(t,r);case 76:c("All migrations successfully reverted to version ".concat(r,"!"));case 77:if(e.prev=77,y||h){e.next=81;break}return e.next=81,g.close();case 81:return e.finish(77);case 82:case"end":return e.stop()}}),e,null,[[23,,77,82],[30,61,65,73],[40,46],[66,,68,72]])})))).apply(this,arguments)}function p(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=0,a=!0,s=!1,o=void 0;try{for(var c,f=e[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var h=c.value;if(h.version>r)break;if(h.version>t){if(n&&!h.revert)throw new u.NonReversibleMigrationError("It is not possible to revert to version ".concat(t," because migration version ").concat(h.version," is not reversible. Cancelling reversion."));i++}}}catch(l){s=!0,o=l}finally{try{a||null==f.return||f.return()}finally{if(s)throw o}}if(i!==r-t)throw new u.InvalidValueError("The ipfs-repo-migrations package does not have all migration to migrate from version ".concat(t," to ").concat(r))}t.getCurrentRepoVersion=s.getVersion,t.errors=u,t.getLatestMigrationVersion=f,t.migrate=function(e,t,r){return h.apply(this,arguments)},t.revert=function(e,t,r){return l.apply(this,arguments)}},function(e,t,r){"use strict";var n={description:"Empty migration.",migrate:function(){},revert:function(){},empty:!0};e.exports=[Object.assign({version:1},n),Object.assign({version:2},n),Object.assign({version:3},n),Object.assign({version:4},n),Object.assign({version:5},n),Object.assign({version:6},n),Object.assign({version:7},n),r(2180)]},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(18),s=r(140),o=r(32),u=r(57).Key,c=r(462),f=c.ShardingDatastore,h=r(150),l=r(2181),p=r(19)("ipfs-repo-migrations:migration-8");function d(e,t){return v.apply(this,arguments)}function v(){return(v=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!1!==r.sharding){e.next=2;break}return e.abrupt("return",t);case 2:return i=new c.shard.NextToLast(2),e.abrupt("return",f.createOrOpen(t,i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){var t=h.decode("b".concat(e.toString().slice(1))),r=new o(t).multihash;return r=(r=h.encode("base32",r).slice(1)).toString().toUpperCase(),new u("/".concat(r),!1)}function b(e){var t=h.decode("b".concat(e.toString().slice(1))),r=h.encode("base32",new o(1,"raw",t).buffer).slice(1);return new u("/".concat(r).toUpperCase(),!1)}function m(e,t,r){return g.apply(this,arguments)}function g(){return(g=i(n.mark((function e(t,r,i){var o,u,c,f,h,v,y,b,m,g,k,w,x,S;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=l.getDatastoreAndOptions(r,"blocks"),u=o.StorageBackend,c=o.storageOptions,f=new u(s.join(t,"blocks"),c),e.next=4,f.open();case 4:return e.next=6,d(f,c);case 6:return h=e.sent,e.next=9,h.open();case 9:e.prev=9,v=0,y=!0,b=!1,e.prev=13,g=a(h.query({}));case 15:return e.next=17,g.next();case 17:return k=e.sent,y=k.done,e.next=21,k.value;case 21:if(w=e.sent,y){e.next=35;break}if((S=i((x=w).key)).toString()===x.key.toString()){e.next=32;break}return v+=1,p("Migrating Block from ".concat(x.key.toString()," to ").concat(S.toString())),e.next=30,h.delete(x.key);case 30:return e.next=32,h.put(S,x.value);case 32:y=!0,e.next=15;break;case 35:e.next=41;break;case 37:e.prev=37,e.t0=e.catch(13),b=!0,m=e.t0;case 41:if(e.prev=41,e.prev=42,y||null==g.return){e.next=46;break}return e.next=46,g.return();case 46:if(e.prev=46,!b){e.next=49;break}throw m;case 49:return e.finish(46);case 50:return e.finish(41);case 51:p("Changed ".concat(v," blocks"));case 52:return e.prev=52,e.next=55,h.close();case 55:return e.finish(52);case 56:case"end":return e.stop()}}),e,null,[[9,,52,56],[13,37,41,51],[42,,46,50]])})))).apply(this,arguments)}e.exports={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m(e,t,y)},revert:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return m(e,t,b)}}},function(e,t,r){"use strict";var n=r(222);t.getDatastoreAndOptions=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n;return{StorageBackend:void 0!==e&&void 0!==e.storageBackends&&void 0!==e.storageBackends[t]?e.storageBackends[t]:r,storageOptions:void 0!==e&&void 0!==e.storageBackendOptions&&void 0!==e.storageBackendOptions[t]?e.storageBackendOptions[t]:{}}},t.containsIrreversibleMigration=function(e,t,r){return r.filter((function(r){return r.version>e&&r.version<=t})).some((function(e){return void 0===e.revert}))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(2053),o=r(2183),u=r(222),c=new(0,r(57).Key)("version");function f(){return(f=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.isRepoInitialized(t);case 2:if(e.sent){e.next=4;break}throw new s.NotInitializedRepoError("Repo in path ".concat(t," is not initialized!"));case 4:return r=new u(t,{extension:"",createIfMissing:!1}),e.next=7,r.open();case 7:return e.t0=parseInt,e.next=10,r.get(c);case 10:return e.t1=e.sent,i=(0,e.t0)(e.t1),e.next=14,r.close();case 14:return e.abrupt("return",i);case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new u(t,{extension:"",createIfMissing:!1}),e.next=3,i.open();case 3:return e.next=5,i.put(c,a.from(String(r)));case 5:return e.next=7,i.close();case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.getVersion=function(e){return f.apply(this,arguments)},t.setVersion=function(e,t){return h.apply(this,arguments)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(222),s=r(19)("repo-migrations:repo:init"),o=r(57).Key,u=new o("/version"),c=new o("/config");t.isRepoInitialized=function(){var e=i(n.mark((function e(t){var r,i,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=new a(t,{extension:"",createIfMissing:!1}),e.next=4,r.open();case 4:return e.next=6,r.has(u);case 6:return i=e.sent,e.next=9,r.has(c);case 9:if(o=e.sent,i&&o){e.next=14;break}return s("Version entry present: ".concat(i)),s("Config entry present: ".concat(o)),e.abrupt("return",!1);case 14:return e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(0),s("While checking if repo is initialized error was thrown: "+e.t0.message),e.abrupt("return",!1);case 21:if(e.prev=21,void 0===r){e.next=25;break}return e.next=25,r.close();case 25:return e.finish(21);case 26:case"end":return e.stop()}}),e,null,[[0,17,21,26]])})));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19)("repo-migrations:repo_mem_lock"),s={};t.lock=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a("locking %s",i=r+"/repo.lock"),!0!==s[i]){e.next=4;break}throw Error("There is already present lock for: ".concat(i));case 4:return s[i]=!0,e.abrupt("return",{close:function(){s[i]&&(a("releasing lock %s",i),delete s[i])}});case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";e.exports=function(e,t){if("string"===typeof e)return u(e);if("number"===typeof e)return o(e,t);return null},e.exports.format=o,e.exports.parse=u;var n=/\B(?=(\d{3})+(?!\d))/g,i=/(?:\.0*|(\.[^0]+)0+)$/,a={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},s=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function o(e,t){if(!Number.isFinite(e))return null;var r=Math.abs(e),s=t&&t.thousandsSeparator||"",o=t&&t.unitSeparator||"",u=t&&void 0!==t.decimalPlaces?t.decimalPlaces:2,c=Boolean(t&&t.fixedDecimals),f=t&&t.unit||"";f&&a[f.toLowerCase()]||(f=r>=a.pb?"PB":r>=a.tb?"TB":r>=a.gb?"GB":r>=a.mb?"MB":r>=a.kb?"KB":"B");var h=(e/a[f.toLowerCase()]).toFixed(u);return c||(h=h.replace(i,"$1")),s&&(h=h.replace(n,s)),h+o+f}function u(e){if("number"===typeof e&&!isNaN(e))return e;if("string"!==typeof e)return null;var t,r=s.exec(e),n="b";return r?(t=parseFloat(r[1]),n=r[4].toLowerCase()):(t=parseInt(e,10),n="b"),Math.floor(a[n]*t)}},function(e,t,r){"use strict";e.exports={repoVersion:8}},function(e,t,r){"use strict";t.create=function(e,t,r){return new(0,r.storageBackends[e])(t,Object.assign({},r.storageBackendOptions[e]||{}))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(57).Key,o=r(19)("ipfs:repo:version"),u=new s("version");e.exports=function(e){return{exists:function(){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.has(u));case 1:case"end":return t.stop()}}),t)})))()},get:function(){return i(n.mark((function t(){var r;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(u);case 2:return r=t.sent,t.abrupt("return",parseInt(r.toString().trim(),10));case 4:case"end":return t.stop()}}),t)})))()},set:function(t){return i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.put(u,a.from(String(t))));case 1:case"end":return r.stop()}}),r)})))()},check:function(e){var t=this;return i(n.mark((function r(){var i,a;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.get();case 2:return i=r.sent,o("comparing version: %s and %s",i,e),a=6===i&&7===e||6===e&&7===i,r.abrupt("return",i===e||a);case 6:case"end":return r.stop()}}),r)})))()}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(57).Key,o=r(151).default,u=r(469),c=r(793),f=r(15),h=r(2013),l=new s("config");e.exports=function(e){var t=new o({concurrency:1}),r={getAll:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.get(void 0,e));case 1:case"end":return t.stop()}}),t)})))()},get:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(n.mark((function i(){var a,s,o;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t||(t=void 0),n.next=3,e.get(l);case 3:if(a=n.sent,!r.signal||!r.signal.aborted){n.next=6;break}return n.abrupt("return");case 6:if(s=JSON.parse(a.toString()),void 0===t||void 0!==u(s,t)){n.next=9;break}throw new h.NotFoundError("Key ".concat(t," does not exist in config"));case 9:return o=void 0!==t?u(s,t):s,n.abrupt("return",o);case 11:case"end":return n.stop()}}),i)})))()},set:function(e,r){var o=arguments,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(1!==o.length){n.next=5;break}r=e,e=void 0,n.next=7;break;case 5:if(e&&"string"===typeof e){n.next=7;break}throw f(new Error("Invalid key type: "+typeof e),"ERR_INVALID_KEY");case 7:if(void 0!==r&&!a.isBuffer(r)){n.next=9;break}throw f(new Error("Invalid value type: "+typeof r),"ERR_INVALID_VALUE");case 9:return n.abrupt("return",t.add((function(){return s({key:e,value:r},u.signal)})));case 10:case"end":return n.stop()}}),i)})))()},replace:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&!a.isBuffer(e)){n.next=2;break}throw f(new Error("Invalid value type: "+typeof e),"ERR_INVALID_VALUE");case 2:return n.abrupt("return",t.add((function(){return s({key:void 0,value:e},r.signal)})));case 3:case"end":return n.stop()}}),i)})))()},exists:function(){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.has(l));case 1:case"end":return t.stop()}}),t)})))()}};return r;function s(e,t){return p.apply(this,arguments)}function p(){return(p=i(n.mark((function e(t,i){var a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||!i.aborted){e.next=2;break}return e.abrupt("return");case 2:if(a=t.key,s=t.value,!a){e.next=10;break}return e.next=7,r.get();case 7:return o=e.sent,c(o,a,s),e.abrupt("return",d(o));case 10:return e.abrupt("return",d(s));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(t){var r=a.from(JSON.stringify(t,null,2));return e.put(l,r)}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(57).Key,o=r(2191),u=new s("datastore_spec");e.exports=function(e){return{exists:function(){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.has(u));case 1:case"end":return t.stop()}}),t)})))()},get:function(){return i(n.mark((function t(){var r;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(u);case 2:return r=t.sent,t.abrupt("return",JSON.parse(r.toString()));case 4:case"end":return t.stop()}}),t)})))()},set:function(t){return i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.put(u,a.from(JSON.stringify(o(t,{deep:!0})))));case 1:case"end":return r.stop()}}),r)})))()}}}},function(e,t,r){"use strict";var n=r(68),i=r(2192);e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!i(e))throw new TypeError("Expected a plain object");var r=t.deep,a=[],s=[],o=function e(t){var r=a.indexOf(t);if(-1!==r)return s[r];var o=[];return a.push(t),s.push(o),o.push.apply(o,n(t.map((function(t){return Array.isArray(t)?e(t):i(t)?u(t):t})))),o},u=function e(n){var u=a.indexOf(n);if(-1!==u)return s[u];var c={},f=Object.keys(n).sort(t.compare);a.push(n),s.push(c);var h=!0,l=!1,p=void 0;try{for(var d,v=f[Symbol.iterator]();!(h=(d=v.next()).done);h=!0){var y=d.value,b=n[y];r&&Array.isArray(b)?c[y]=o(b):c[y]=r&&i(b)?e(b):b}}catch(m){l=!0,p=m}finally{try{h||null==v.return||v.return()}finally{if(l)throw p}}return c};return u(e)}},function(e,t,r){"use strict";e.exports=function(e){if("[object Object]"!==Object.prototype.toString.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=new(0,r(57).Key)("api");e.exports=function(e){return{get:function(){return i(n.mark((function t(){var r;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get(s);case 2:return r=t.sent,t.abrupt("return",r&&r.toString());case 4:case"end":return t.stop()}}),t)})))()},set:function(t){return i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.put(s,a.from(t.toString())));case 1:case"end":return r.stop()}}),r)})))()},delete:function(){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.delete(s));case 1:case"end":return t.stop()}}),t)})))()}}}},function(e,t,r){"use strict";(function(t,n){var i=r(1),a=r(2),s=r(96),o=r(25),u=r(26),c=r(18),f=r(462),h=f.ShardingDatastore,l=r(227),p=r(2054),d=p.cidToKey,v=p.keyToCid,y=r(794),b=r(790),m=r(265);function g(e,t){if(t.sharding){var r=new f.shard.NextToLast(2);return h.createOrOpen(e,r)}return e}function k(e){return{query:function(t,r){return u(i.mark((function n(){var a,s,u,f,h,p,d,y,b;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!0,s=!1,n.prev=2,f=c(e.query(t,r));case 4:return n.next=6,o(f.next());case 6:return h=n.sent,a=h.done,n.next=10,o(h.value);case 10:if(p=n.sent,a){n.next=22;break}if(y=(d=p).key,b=d.value,!t.keysOnly){n.next=17;break}return n.next=16,v(y);case 16:return n.abrupt("continue",19);case 17:return n.next=19,new l(b,v(y));case 19:a=!0,n.next=4;break;case 22:n.next=28;break;case 24:n.prev=24,n.t0=n.catch(2),s=!0,u=n.t0;case 28:if(n.prev=28,n.prev=29,a||null==f.return){n.next=33;break}return n.next=33,o(f.return());case 33:if(n.prev=33,!s){n.next=36;break}throw u;case 36:return n.finish(33);case 37:return n.finish(28);case 38:case"end":return n.stop()}}),n,null,[[2,24,28,38],[29,,33,37]])})))()},get:function(t,r){return a(i.mark((function n(){var a,s;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=d(t),n.next=3,e.get(a,r);case 3:return s=n.sent,n.abrupt("return",new l(s,t));case 5:case"end":return n.stop()}}),n)})))()},getMany:function(e,t){var r=this;return u(i.mark((function n(){var a,s,u,f,h,l,p;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!0,s=!1,n.prev=2,f=c(e);case 4:return n.next=6,o(f.next());case 6:return h=n.sent,a=h.done,n.next=10,o(h.value);case 10:if(l=n.sent,a){n.next=18;break}return p=l,n.next=15,r.get(p,t);case 15:a=!0,n.next=4;break;case 18:n.next=24;break;case 20:n.prev=20,n.t0=n.catch(2),s=!0,u=n.t0;case 24:if(n.prev=24,n.prev=25,a||null==f.return){n.next=29;break}return n.next=29,o(f.return());case 29:if(n.prev=29,!s){n.next=32;break}throw u;case 32:return n.finish(29);case 33:return n.finish(24);case 34:case"end":return n.stop()}}),n,null,[[2,20,24,34],[25,,29,33]])})))()},put:function(t,r){return a(i.mark((function n(){var a;return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(l.isBlock(t)){n.next=2;break}throw new Error("invalid block");case 2:return a=d(t.cid),n.next=5,e.has(a,r);case 5:if(n.sent){n.next=9;break}return n.next=9,e.put(a,t.data,r);case 9:return n.abrupt("return",t);case 10:case"end":return n.stop()}}),n)})))()},putMany:function(r,f){return u(i.mark((function h(){var l;return i.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return l=m(),(t&&t.nextTick?t.nextTick:n)(a(i.mark((function t(){return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,b(e.putMany(u(i.mark((function t(){var n,a,s,u,h,p,v,y;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,a=!1,t.prev=2,u=c(r);case 4:return t.next=6,o(u.next());case 6:return h=t.sent,n=h.done,t.next=10,o(h.value);case 10:if(p=t.sent,n){t.next=24;break}return y=d((v=p).cid),t.next=16,o(e.has(y,f));case 16:if(t.sent){t.next=20;break}return t.next=20,{key:y,value:v.data};case 20:l.push(v);case 21:n=!0,t.next=4;break;case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(2),a=!0,s=t.t0;case 30:if(t.prev=30,t.prev=31,n||null==u.return){t.next=35;break}return t.next=35,o(u.return());case 35:if(t.prev=35,!a){t.next=38;break}throw s;case 38:return t.finish(35);case 39:return t.finish(30);case 40:case"end":return t.stop()}}),t,null,[[2,26,30,40],[31,,35,39]])})))()));case 3:l.end(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),l.end(t.t0);case 9:case"end":return t.stop()}}),t,null,[[0,6]])})))),h.delegateYield(s(c(l),o),"t0",4);case 4:case"end":return h.stop()}}),h)})))()},has:function(t,r){return a(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e.has(d(t),r));case 1:case"end":return n.stop()}}),n)})))()},delete:function(t,r){return a(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",e.delete(d(t),r));case 1:case"end":return n.stop()}}),n)})))()},deleteMany:function(t,r){return u(i.mark((function n(){return i.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(s(c(e.deleteMany(y(t,(function(e){return d(e)})),r)),o),"t0",1);case 1:case"end":return n.stop()}}),n)})))()},close:function(){return a(i.mark((function t(){return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.close());case 1:case"end":return t.stop()}}),t)})))()}}}e.exports=function(){var e=a(i.mark((function e(t,r){var n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(t,r);case 2:return n=e.sent,e.abrupt("return",k(n));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}).call(this,r(37),r(111).setImmediate)},function(e,t,r){"use strict";e.exports={lock:"memory",storageBackends:{root:r(222),blocks:r(222),keys:r(222),datastore:r(222)},storageBackendOptions:{root:{extension:"",prefix:"",version:2},blocks:{sharding:!1,prefix:"",version:2},keys:{sharding:!1,prefix:"",version:2},datastore:{sharding:!1,prefix:"",version:2}}}},function(e,t,r){"use strict";e.exports={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}}},function(e,t,r){"use strict";var n=r(103),i=r(342),a=r(61),s=r(798);e.exports=function(e,t){return t=t||{},n.call({concatArrays:!0},{blockService:e,formats:[i,a,s]},t)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(478),s=r(19),o=r(32),u=r(799),c=r(152),f=r(2199),h=s("ipfs:preload");h.error=s("ipfs:preload:error"),e.exports=function(e){if((e=e||{}).enabled=Boolean(e.enabled),e.addresses=e.addresses||[],!e.enabled||!e.addresses.length){h("preload disabled");var t=function(){};return t.start=function(){},t.stop=function(){},t}var r=!0,s=[],l=e.addresses.map(a),p=function(){var e=i(n.mark((function e(t){var i,a,p,d,v,y,b,m,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!r){e.next=3;break}throw new Error("preload ".concat(t," but preloader is not started"));case 3:"string"!==typeof t&&(t=new o(t).toString()),i=u(l),a=!1,p=Date.now(),d=!0,v=!1,y=void 0,e.prev=10,b=n.mark((function e(){var i,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=g.value,!r){e.next=3;break}throw new Error("preload aborted for ".concat(t));case 3:return o=void 0,e.prev=4,o=new c,s=s.concat(o),e.next=9,f("".concat(i,"/api/v0/refs?r=true&arg=").concat(encodeURIComponent(t)),{signal:o.signal});case 9:a=!0,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),"aborted"!==e.t0.type&&h.error(e.t0);case 15:return e.prev=15,s=s.filter((function(e){return e!==o})),e.finish(15);case 18:if(!a){e.next=20;break}return e.abrupt("return","break");case 20:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})),m=i[Symbol.iterator]();case 13:if(d=(g=m.next()).done){e.next=21;break}return e.delegateYield(b(),"t0",15);case 15:if("break"!==e.t0){e.next=18;break}return e.abrupt("break",21);case 18:d=!0,e.next=13;break;case 21:e.next=27;break;case 23:e.prev=23,e.t1=e.catch(10),v=!0,y=e.t1;case 27:e.prev=27,e.prev=28,d||null==m.return||m.return();case 30:if(e.prev=30,!v){e.next=33;break}throw y;case 33:return e.finish(30);case 34:return e.finish(27);case 35:h("".concat(a?"":"un","successfully preloaded ").concat(t," in ").concat(Date.now()-p,"ms")),e.next=41;break;case 38:e.prev=38,e.t2=e.catch(0),h.error(e.t2);case 41:case"end":return e.stop()}}),e,null,[[0,38],[10,23,27,35],[28,,30,34]])})));return function(t){return e.apply(this,arguments)}}();return p.start=function(){r=!1},p.stop=function(){r=!0,h("aborting ".concat(s.length," pending preload request(s)")),s.forEach((function(e){return e.abort()})),s=[]},p}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(151).default,s=r(338),o=r(19),u=o("ipfs:preload");u.error=o("ipfs:preload:error");var c=new a({concurrency:4});e.exports=function(e,t){return u(e),t=t||{},c.add(i(n.mark((function r(){var i,a,o;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,s.post(e,{signal:t.signal});case 2:i=r.sent,a=i.body.getReader(),r.prev=4;case 5:return r.next=8,a.read();case 8:if(o=r.sent,!o.done){r.next=12;break}return r.abrupt("return");case 12:r.next=5;break;case 14:return r.prev=14,a.releaseLock(),r.finish(14);case 17:case"end":return r.stop()}}),r,null,[[4,,14,17]])}))))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(55),u=r(57),c=u.Key,f=u.Errors,h=r(15),l=r(19),p=l("ipfs:ipns:publisher");p.error=l("ipfs:ipns:publisher:error");var d=r(224),v=f.notFoundError().code,y=function(){function e(t,r){a(this,e),this._routing=t,this._datastore=r}return s(e,[{key:"publishWithEOL",value:function(){var e=i(n.mark((function e(t,r,i){var a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.bytes){e.next=2;break}throw h(new Error("invalid private key"),"ERR_INVALID_PRIVATE_KEY");case 2:return e.next=4,o.createFromPrivKey(t.bytes);case 4:return a=e.sent,e.next=7,this._updateOrCreateRecord(t,r,i,a);case 7:return s=e.sent,e.abrupt("return",this._putRecordToRouting(s,a));case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"publish",value:function(e,t){return this.publishWithEOL(e,t,36e5)}},{key:"_putRecordToRouting",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isPeerId(r)){e.next=4;break}throw i="peerId received is not valid",p.error(i),h(new Error(i),"ERR_INVALID_PEER_ID");case 4:return a=r._pubKey,e.next=7,d.embedPublicKey(a,t);case 7:return s=e.sent,u=d.getIdKeys(r.toBytes()),e.next=11,this._publishEntry(u.routingKey,s||t,r);case 11:return e.next=13,this._publishPublicKey(u.routingPubKey,a);case 13:return e.abrupt("return",s||t);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_publishEntry",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isKey(t)){e.next=4;break}throw i="datastore key does not have a valid format",p.error(i),h(new Error(i),"ERR_INVALID_DATASTORE_KEY");case 4:e.prev=4,a=d.marshal(r),e.next=12;break;case 8:throw e.prev=8,e.t0=e.catch(4),p.error(e.t0),e.t0;case 12:return e.prev=12,e.next=15,this._routing.put(t.toBuffer(),a);case 15:return s=e.sent,p("ipns record for ".concat(t.toString("base64")," was stored in the routing")),e.abrupt("return",s);case 20:throw e.prev=20,e.t1=e.catch(12),o="ipns record for ".concat(t.toString("base64")," could not be stored in the routing"),p.error(o),p.error(e.t1),h(new Error(o),"ERR_PUTTING_TO_ROUTING");case 26:case"end":return e.stop()}}),e,this,[[4,8],[12,20]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_publishPublicKey",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isKey(t)){e.next=4;break}throw i="datastore key does not have a valid format",p.error(i),h(new Error(i),"ERR_INVALID_DATASTORE_KEY");case 4:if(r&&r.bytes){e.next=8;break}throw a="one or more of the provided parameters are not defined",p.error(a),h(new Error(a),"ERR_UNDEFINED_PARAMETER");case 8:return e.prev=8,e.next=11,this._routing.put(t.toBuffer(),r.bytes);case 11:return s=e.sent,p("public key for ".concat(t.toString("base64")," was stored in the routing")),e.abrupt("return",s);case 16:throw e.prev=16,e.t0=e.catch(8),o="public key for ".concat(t.toString("base64")," could not be stored in the routing"),p.error(o),p.error(e.t0),h(new Error(o),"ERR_PUTTING_TO_ROUTING");case 22:case"end":return e.stop()}}),e,this,[[8,16]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getPublished",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isPeerId(t)){e.next=4;break}throw i="peerId received is not valid",p.error(i),h(new Error(i),"ERR_INVALID_PEER_ID");case 4:return a=!1!==(r=r||{}).checkRouting,e.prev=6,e.next=9,this._datastore.get(d.getLocalKey(t.id));case 9:return s=e.sent,e.abrupt("return",this._unmarshalData(s));case 13:if(e.prev=13,e.t0=e.catch(6),e.t0.code===v){e.next=19;break}throw u="unexpected error getting the ipns record ".concat(t.id," from datastore"),p.error(u),h(new Error(u),"ERR_UNEXPECTED_DATASTORE_RESPONSE");case 19:if(a){e.next=21;break}throw h(e.t0);case 21:return e.prev=21,c=d.getIdKeys(t.toBytes()),e.next=25,this._routing.get(c.routingKey.toBuffer());case 25:return f=e.sent,e.abrupt("return",this._unmarshalData(f));case 29:throw e.prev=29,e.t1=e.catch(21),p.error(e.t1),e.t1;case 33:case"end":return e.stop()}}),e,this,[[6,13],[21,29]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_unmarshalData",value:function(e){try{return d.unmarshal(e)}catch(t){throw h(t,"ERR_INVALID_RECORD_DATA")}}},{key:"_updateOrCreateRecord",value:function(){var e=i(n.mark((function e(t,r,i,a){var s,u,c,f,l,y,b,m,g;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.isPeerId(a)){e.next=4;break}throw s="peerId received is not valid",p.error(s),h(new Error(s),"ERR_INVALID_PEER_ID");case 4:return u={checkRouting:!0},e.prev=5,e.next=8,this._getPublished(a,u);case 8:c=e.sent,e.next=17;break;case 11:if(e.prev=11,e.t0=e.catch(5),e.t0.code===v){e.next=17;break}throw f="unexpected error when determining the last published IPNS record for ".concat(a.id),p.error(f),h(new Error(f),"ERR_DETERMINING_PUBLISHED_RECORD");case 17:return l=0,c&&void 0!==c.sequence&&(l=c.value.toString()!==r?c.sequence+1:c.sequence),e.prev=19,e.next=22,d.create(t,r,l,i);case 22:y=e.sent,e.next=30;break;case 25:throw e.prev=25,e.t1=e.catch(19),b="ipns record for ".concat(r," could not be created"),p.error(e.t1),h(new Error(b),"ERR_CREATING_IPNS_RECORD");case 30:return e.prev=30,m=d.marshal(y),e.next=34,this._datastore.put(d.getLocalKey(a.id),m);case 34:return p("ipns record for ".concat(r," was stored in the datastore")),e.abrupt("return",y);case 38:throw e.prev=38,e.t2=e.catch(30),g="ipns record for ".concat(r," could not be stored in the datastore"),p.error(g),h(new Error(g),"ERR_STORING_IN_DATASTORE");case 43:case"end":return e.stop()}}),e,this,[[5,11],[19,25],[30,38]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()}]),e}();y.defaultRecordLifetime=36e5,e.exports=y},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(224),u=r(1981),c=r(55),f=r(15),h=r(3).Buffer,l=r(19),p=l("ipfs:ipns:republisher");p.error=l("ipfs:ipns:republisher:error");var d=function(){function e(t,r,n,i,s){a(this,e),this._publisher=t,this._datastore=r,this._peerId=n,this._keychain=i,this._options=s||{},this._republishHandle=null}return s(e,[{key:"start",value:function(){var e=i(n.mark((function e(){var t,r,a,s,o=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._republishHandle){e.next=2;break}throw f(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");case 2:t={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:function(e){t._timeoutId=setTimeout(i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t._timeoutId=null,r.prev=1,t._inflightTask=t._task(),r.next=5,t._inflightTask;case 5:t._task&&t.runPeriodically(e),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(1),p.error(r.t0);case 11:case"end":return r.stop()}}),r,null,[[1,8]])}))),e())},cancel:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(t._timeoutId),t._task=null,e.next=4,t._inflightTask;case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},r=this._peerId.privKey,a=this._options.pass,s=!0,t._task=function(){return o._republishEntries(r,a)},t.runPeriodically((function(){return s?(s=!1,o._options.initialBroadcastInterval||6e4):o._options.broadcastInterval||144e5})),this._republishHandle=t;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._republishHandle){e.next=3;break}throw f(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");case 3:return this._republishHandle=null,e.next=6,t.cancel();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_republishEntries",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o,c,f,h,l,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._republishEntry(t);case 3:e.next=10;break;case 5:return e.prev=5,e.t0=e.catch(0),"cannot republish entry for the node's private key",p.error("cannot republish entry for the node's private key"),e.abrupt("return");case 10:if(!r){e.next=52;break}return e.prev=11,e.next=14,this._keychain.listKeys();case 14:i=e.sent,a=!0,s=!1,o=void 0,e.prev=18,c=i[Symbol.iterator]();case 20:if(a=(f=c.next()).done){e.next=33;break}return h=f.value,e.next=24,this._keychain.exportKey(h.name,r);case 24:return l=e.sent,e.next=27,u.keys.import(l,r);case 27:return d=e.sent,e.next=30,this._republishEntry(d);case 30:a=!0,e.next=20;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(18),s=!0,o=e.t1;case 39:e.prev=39,e.prev=40,a||null==c.return||c.return();case 42:if(e.prev=42,!s){e.next=45;break}throw o;case 45:return e.finish(42);case 46:return e.finish(39);case 47:e.next=52;break;case 49:e.prev=49,e.t2=e.catch(11),p.error(e.t2);case 52:case"end":return e.stop()}}),e,this,[[0,5],[11,49],[18,35,39,47],[40,,42,46]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_republishEntry",value:function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&t.bytes){e.next=2;break}throw f(new Error("invalid private key"),"ERR_INVALID_PRIVATE_KEY");case 2:return e.prev=2,e.next=5,c.createFromPrivKey(t.bytes);case 5:return r=e.sent,e.next=8,this._getPreviousValue(r);case 8:return i=e.sent,e.next=11,this._publisher.publishWithEOL(t,i,864e5);case 11:e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(2),"ERR_NO_ENTRY_FOUND"!==e.t0.code){e.next=17;break}return e.abrupt("return");case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,this,[[2,13]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_getPreviousValue",value:function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c.isPeerId(t)){e.next=2;break}throw f(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");case 2:return e.prev=2,e.next=5,this._datastore.get(o.getLocalKey(t.id));case 5:if(r=e.sent,h.isBuffer(r)){e.next=8;break}throw f(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");case 8:return e.prev=8,i=o.unmarshal(r),e.abrupt("return",i.value);case 13:throw e.prev=13,e.t0=e.catch(8),p.error(e.t0),f(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD");case 17:e.next=24;break;case 19:if(e.prev=19,e.t1=e.catch(2),!e.t1||!e.t1.notFound){e.next=23;break}throw f(new Error("no previous entry for record with id: ".concat(t.id)),"ERR_NO_ENTRY_FOUND");case 23:throw e.t1;case 24:case"end":return e.stop()}}),e,this,[[2,19],[8,13]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports=d},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(224),u=r(1981),c=r(55),f=r(15),h=r(19),l=h("ipfs:ipns:resolver");l.error=h("ipfs:ipns:resolver:error");var p=r(57).Errors.notFoundError().code,d=function(){function e(t){a(this,e),this._routing=t}return s(e,[{key:"resolve",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=r||{},"string"===typeof t){e.next=3;break}throw f(new Error("invalid name"),"ERR_INVALID_NAME");case 3:if(i=(r=r||{}).recursive&&"true"===r.recursive.toString(),3===(a=t.split("/")).length&&""===a[0]){e.next=8;break}throw f(new Error("invalid name"),"ERR_INVALID_NAME");case 8:return s=a[2],i&&(o=32),e.next=12,this.resolver(s,o);case 12:return u=e.sent,l("".concat(t," was locally resolved correctly")),e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"resolver",value:function(){var e=i(n.mark((function e(t,r){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==r){e.next=4;break}throw i="could not resolve name (recursion limit of ".concat(32," exceeded)"),l.error(i),f(new Error(i),"ERR_RESOLVE_RECURSION_LIMIT");case 4:return e.next=6,this._resolveName(t);case 6:if(a=e.sent,"ipfs"!==(s=a.split("/"))[1]&&r){e.next=10;break}return e.abrupt("return",a);case 10:return e.abrupt("return",this.resolver(s[2],r-1));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_resolveName",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,h,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=c.createFromCID(t),i=o.getIdKeys(r.toBytes()),a=i.routingKey,e.prev=2,e.next=5,this._routing.get(a.toBuffer());case 5:s=e.sent,e.next=14;break;case 8:if(e.prev=8,e.t0=e.catch(2),l.error(e.t0),e.t0.code!==p){e.next=13;break}throw f(new Error("record requested for ".concat(t," was not found in the network")),"ERR_NO_RECORD_FOUND");case 13:throw f(new Error("unexpected error getting the ipns record ".concat(r.id)),"ERR_UNEXPECTED_ERROR_GETTING_RECORD");case 14:e.prev=14,h=o.unmarshal(s),e.next=22;break;case 18:throw e.prev=18,e.t1=e.catch(14),l.error(e.t1),f(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_RECORD_RECEIVED");case 22:if(!h.pubKey){e.next=24;break}return e.abrupt("return",this._validateRecord(r,h));case 24:return e.prev=24,e.next=27,this._routing.get(a.toBuffer());case 27:d=e.sent,e.next=36;break;case 30:if(e.prev=30,e.t2=e.catch(24),l.error(e.t2),e.t2.code!==p){e.next=35;break}throw f(new Error("public key requested for ".concat(t," was not found in the network")),"ERR_NO_RECORD_FOUND");case 35:throw f(new Error("unexpected error getting the public key for the ipns record ".concat(r.id)),"ERR_UNEXPECTED_ERROR_GETTING_PUB_KEY");case 36:e.prev=36,r.pubKey=u.keys.unmarshalPublicKey(d),e.next=44;break;case 40:throw e.prev=40,e.t3=e.catch(36),l.error(e.t3),f(new Error("found public key record that we couldn't convert to a value"),"ERR_INVALID_PUB_KEY_RECEIVED");case 44:return e.abrupt("return",this._validateRecord(r,h));case 45:case"end":return e.stop()}}),e,this,[[2,8],[14,18],[24,30],[36,40]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_validateRecord",value:function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.extractPublicKey(t,r);case 2:return i=e.sent,e.next=5,o.validate(i,r);case 5:return e.abrupt("return",r.value.toString());case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}();e.exports=d},function(e,t,r){"use strict";e.exports=function(){}},function(e,t,r){"use strict";e.exports=function(e){var t=e.libp2p;return function(){return Boolean(t&&t.isStarted())}}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t.exportKey(e,r,n)}))}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e,r){return r=r||{},t.createKey(e,r.type||"rsa",r.size||2048)}))}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e,r,n,i){return t.importKey(e,r,n,i)}))}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e,r){return t.findKeyByName(e,r)}))}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e){return t.listKeys(e)}))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return a(function(){var e=i(n.mark((function e(r,i,a){var s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.renameKey(r,i,a);case 2:return s=e.sent,e.abrupt("return",{was:r,now:s.name,id:s.id,overwrite:!1});case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.keychain;return n((function(e,r){return t.removeKey(e,r)}))}},function(e,t,r){"use strict";var n=r(46),i=r(332),a=r(103),s=r(15),o=r(2213);e.exports=function(e){var t=e.options,u=e.peerId,c=e.multiaddrs,f=void 0===c?[]:c,h=e.repo,l=e.keychainConfig,p=void 0===l?{}:l,d=e.config;t=t||{},d=d||{};var v=h.datastore,y=function(e){var t=e.options,u=e.config,c=e.datastore,f=e.keys,h=e.keychainConfig,l=e.peerId,p=e.multiaddrs,d={datastore:c,peerId:l,modules:{}},v={modules:{pubsub:function(){var e=i(u,"Pubsub.Router")||"gossipsub";if(!o[e])throw s(new Error("Router unavailable. Configure libp2p.modules.pubsub to use the ".concat(e," router.")),"ERR_NOT_SUPPORTED");return o[e]}()},config:{peerDiscovery:{mdns:{enabled:i(t,"config.Discovery.MDNS.Enabled",i(u,"Discovery.MDNS.Enabled",!0))},webRTCStar:{enabled:i(t,"config.Discovery.webRTCStar.Enabled",i(u,"Discovery.webRTCStar.Enabled",!0))},bootstrap:{list:i(t,"config.Bootstrap",i(u,"Bootstrap",[]))}},relay:{enabled:i(t,"relay.enabled",i(u,"relay.enabled",!0)),hop:{enabled:i(t,"relay.hop.enabled",i(u,"relay.hop.enabled",!1)),active:i(t,"relay.hop.active",i(u,"relay.hop.active",!1))}},dht:{enabled:"none"!==i(u,"Routing.Type","none"),clientMode:"dhtserver"!==i(u,"Routing.Type","dht"),kBucketSize:i(t,"dht.kBucketSize",20)},pubsub:{enabled:i(t,"config.Pubsub.Enabled",i(u,"Pubsub.Enabled",!0))}},addresses:{listen:p},connectionManager:i(t,"connectionManager",{maxConnections:i(t,"config.Swarm.ConnMgr.HighWater",i(u,"Swarm.ConnMgr.HighWater")),minConnections:i(t,"config.Swarm.ConnMgr.LowWater",i(u,"Swarm.ConnMgr.LowWater"))}),keychain:n({datastore:f},h)},y=r(2307),b=i(t,"libp2p",{});"function"===typeof b&&(b={});var m=a(d,y(),v,b);i(m,"config.peerDiscovery.bootstrap.list",[]).length>0&&m.modules.peerDiscovery.push(r(2379));return m}({options:t,config:d,datastore:v,keys:h.keys,keychainConfig:p,peerId:u,multiaddrs:f});return"function"===typeof t.libp2p?t.libp2p({libp2pOptions:y,options:t,config:d,datastore:v,peerId:u}):new(r(2232))(y)}},function(e,t,r){"use strict";e.exports={gossipsub:r(2059)}},function(e,t,r){"use strict";e.exports="\nmessage RPC {\n  repeated SubOpts subscriptions = 1;\n  repeated Message msgs = 2;\n\n  message SubOpts {\n    optional bool subscribe = 1; // subscribe or unsubcribe\n    optional string topicID = 2;\n  }\n\n  message Message {\n    optional bytes from = 1;\n    optional bytes data = 2;\n    optional bytes seqno = 3;\n    repeated string topicIDs = 4;\n    optional bytes signature = 5;\n    optional bytes key = 6;\n  }\n}"},function(e,t,r){"use strict";e.exports="\n// topicCID = cid(merkledag_protobuf(topicDescriptor)); (not the topic.name)\nmessage TopicDescriptor {\n  optional string name = 1;\n  optional AuthOpts auth = 2;\n  optional EncOpts enc = 2;\n\n  message AuthOpts {\n    optional AuthMode mode = 1;\n    repeated bytes keys = 2; // root keys to trust\n\n    enum AuthMode {\n      NONE = 0; // no authentication, anyone can publish\n      KEY = 1; // only messages signed by keys in the topic descriptor are accepted\n      WOT = 2; // web of trust, certificates can allow publisher set to grow\n    }\n  }\n\n  message EncOpts {\n    optional EncMode mode = 1;\n    repeated bytes keyHashes = 2; // the hashes of the shared keys used (salted)\n\n    enum EncMode {\n      NONE = 0; // no encryption, anyone can read\n      SHAREDKEY = 1; // messages are encrypted with shared key\n      WOT = 2; // web of trust, certificates can allow publisher set to grow\n    }\n  }\n}"},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(28),u=r(27),c=r(29),f=r(41),h=r(100),l=r(265),p=r(78),d=r(19),v=d("libp2p-pubsub:peer");v.error=d("libp2p-pubsub:peer:error");var y=r(2016).RPC,b=function(e){function t(e){var r,n=e.id,i=e.protocols;return a(this,t),(r=o(this,u(t).call(this))).id=n,r.protocols=i,r.conn=null,r.topics=new Set,r.stream=null,r}return c(t,e),s(t,[{key:"write",value:function(e){if(!this.isWritable){var t=this.id.toB58String();throw new Error("No writable connection to "+t)}this.stream.push(e)}},{key:"attachConnection",value:function(){var e=i(n.mark((function e(t){var r,i=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.stream)){e.next=4;break}return e.next=4,r.end(!1);case 4:this.stream=l({onEnd:function(e){i.conn.reset&&i.conn.reset(),i.conn=null,i.stream=null,!1!==e&&i.emit("close")}}),this.conn=t,p(this.stream,h.encode(),t).catch((function(e){v.error(e)})),r||this.emit("connection");case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sendRawSubscriptions",value:function(e,t){if(0!==e.size){var r=[];e.forEach((function(e){r.push({subscribe:t,topicID:e})})),this.write(y.encode({subscriptions:r}))}}},{key:"sendSubscriptions",value:function(e){this._sendRawSubscriptions(e,!0)}},{key:"sendUnsubscriptions",value:function(e){this._sendRawSubscriptions(e,!1)}},{key:"sendMessages",value:function(e){this.write(y.encode({msgs:e}))}},{key:"updateSubscriptions",value:function(e){var t=this;e.forEach((function(e){e.subscribe?t.topics.add(e.topicID):t.topics.delete(e.topicID)}))}},{key:"close",value:function(){this.stream&&this.stream.end(),this.conn=null,this.stream=null,this.emit("close")}},{key:"isConnected",get:function(){return Boolean(this.conn)}},{key:"isWritable",get:function(){return Boolean(this.stream)}}]),t}(f);e.exports=b},function(e,t,r){"use strict";var n=r(3).Buffer,i=r(104),a=r(2218);(t=e.exports).randomSeqno=function(){return i.randomBytes(8)},t.msgId=function(e,t){return e+t.toString("hex")},t.anyMatch=function(e,t){var r;r=Array.isArray(t)?function(e){return t.indexOf(e)>-1}:function(e){return t.has(e)};var n=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){if(r(s.value))return!0}}catch(u){i=!0,a=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return!1},t.ensureArray=function(e){return Array.isArray(e)?e:[e]},t.normalizeInRpcMessage=function(e){var t=Object.assign({},e);return n.isBuffer(e.from)&&(t.from=a.encode("base58btc",e.from).toString().slice(1)),t},t.normalizeInRpcMessages=function(e){return e?e.map(t.normalizeInRpcMessage):e},t.normalizeOutRpcMessage=function(e){var t=Object.assign({},e);return("string"===typeof e.from||e.from instanceof String)&&(t.from=a.decode("z"+e.from)),t},t.normalizeOutRpcMessages=function(e){return e?e.map(t.normalizeOutRpcMessage):e}},function(e,t,r){"use strict";var n=r(3).Buffer,i=r(2219);function a(e,t){if(!t)throw new Error("requires an encoded buffer");var r=s(e),i=n.from(r.code);return function(e,t){s(e).decode(t.toString())}(r.name,t),n.concat([i,t])}function s(e){var t;if(i.names[e])t=i.names[e];else{if(!i.codes[e])throw new Error("Unsupported encoding");t=i.codes[e]}if(!t.isImplemented())throw new Error("Base "+e+" is not implemented yet");return t}(t=e.exports=a).encode=function(e,t){var r=s(e);return a(r.name,n.from(r.encode(t)))},t.decode=function(e){n.isBuffer(e)&&(e=e.toString());var t=e.substring(0,1);"string"===typeof(e=e.substring(1,e.length))&&(e=n.from(e));var r=s(t);return n.from(r.decode(e.toString()))},t.isEncoded=function(e){n.isBuffer(e)&&(e=e.toString());if("[object String]"!==Object.prototype.toString.call(e))return!1;var t=e.substring(0,1);try{return s(t).name}catch(r){return!1}},t.names=Object.freeze(Object.keys(i.names)),t.codes=Object.freeze(Object.keys(i.codes))},function(e,t,r){"use strict";var n=r(2220),i=r(74),a=r(2221),s=r(2222),o=r(2223),u=[["base1","1","","1"],["base2","0",i,"01"],["base8","7",i,"01234567"],["base10","9",i,"0123456789"],["base16","f",a,"0123456789abcdef"],["base32","b",s,"abcdefghijklmnopqrstuvwxyz234567"],["base32pad","c",s,"abcdefghijklmnopqrstuvwxyz234567="],["base32hex","v",s,"0123456789abcdefghijklmnopqrstuv"],["base32hexpad","t",s,"0123456789abcdefghijklmnopqrstuv="],["base32z","h",s,"ybndrfg8ejkmcpqxot1uwisza345h769"],["base58flickr","Z",i,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base58btc","z",i,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base64","m",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],c=u.reduce((function(e,t){return e[t[0]]=new n(t[0],t[1],t[2],t[3]),e}),{}),f=u.reduce((function(e,t){return e[t[1]]=c[t[0]],e}),{});e.exports={names:c,codes:f}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(t,r,i,a){n(this,e),this.name=t,this.code=r,this.alphabet=a,i&&a&&(this.engine=i(a))}return i(e,[{key:"encode",value:function(e){return this.engine.encode(e)}},{key:"decode",value:function(e){return this.engine.decode(e)}},{key:"isImplemented",value:function(){return this.engine}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){return{encode:function(e){return"string"===typeof e?n.from(e).toString("hex"):e.toString("hex")},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base16 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"hex")}}}},function(e,t,r){"use strict";function n(e,t){var r=e.byteLength,n=new Uint8Array(e),i=t.indexOf("=")===t.length-1;i&&(t=t.substring(0,t.length-1));for(var a=0,s=0,o="",u=0;u<r;u++)for(s=s<<8|n[u],a+=8;a>=5;)o+=t[s>>>a-5&31],a-=5;if(a>0&&(o+=t[s<<5-a&31]),i)for(;o.length%8!==0;)o+="=";return o}e.exports=function(e){return{encode:function(t){return n("string"===typeof t?Uint8Array.from(t):t,e)},decode:function(t){var r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;if(e.indexOf(o)<0)throw new Error("invalid base32 character")}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return function(e,t){for(var r=(e=e.replace(new RegExp("=","g"),"")).length,n=0,i=0,a=0,s=new Uint8Array(5*r/8|0),o=0;o<r;o++)i=i<<5|t.indexOf(e[o]),(n+=5)>=8&&(s[a++]=i>>>n-8&255,n-=8);return s.buffer}(t,e)}}}},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){var t=e.indexOf("=")>-1,r=e.indexOf("-")>-1&&e.indexOf("_")>-1;return{encode:function(e){var i="";i="string"===typeof e?n.from(e).toString("base64"):e.toString("base64"),r&&(i=i.replace(/\+/g,"-").replace(/\//g,"_"));var a=i.indexOf("=");return a>0&&!t&&(i=i.substring(0,a)),i},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base64 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"base64")}}}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(2),s=r(3).Buffer,o=r(55),u=r(2016).Message,c=s.from("libp2p-pubsub:");function f(){return(f=a(n.mark((function e(t,r){var a,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.concat([c,u.encode(r)]),e.next=3,t.privKey.sign(a);case 3:return o=e.sent,e.abrupt("return",i({},r,{signature:o,key:t.pubKey.bytes}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(){return(h=a(n.mark((function e(t){var r,a,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return delete(r=i({},t)).signature,delete r.key,a=s.concat([c,u.encode(r)]),e.next=6,l(t);case 6:return o=e.sent,e.abrupt("return",o.verify(a,t.signature));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(e){return p.apply(this,arguments)}function p(){return(p=a(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.key){e.next=9;break}return e.next=3,o.createFromPubKey(t.key);case 3:if(!(r=e.sent).isEqual(t.from)){e.next=6;break}return e.abrupt("return",r.pubKey);case 6:throw new Error("Public Key does not match the originator");case 9:if(!(i=o.createFromBytes(t.from)).pubKey){e.next=14;break}return e.abrupt("return",i.pubKey);case 14:throw new Error("Could not get the public key from the originator id");case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={messagePublicKey:l,signMessage:function(e,t){return f.apply(this,arguments)},SignPrefix:c,verifySignature:function(e){return h.apply(this,arguments)}}},function(e,t,r){"use strict";var n=r(5),i=r(7);Object.defineProperty(t,"__esModule",{value:!0}),t.MessageCache=void 0;var a=function(){function e(t,r,i){n(this,e),this.msgs=new Map,this.history=[];for(var a=0;a<r;a++)this.history[a]=[];this.gossip=t,this.msgIdFn=i}return i(e,[{key:"put",value:function(e){var t=this.getMsgId(e);this.msgs.set(t,e),this.history[0].push({msgID:t,topics:e.topicIDs})}},{key:"getMsgId",value:function(e){return this.msgIdFn(e)}},{key:"get",value:function(e){return this.msgs.get(e)}},{key:"getGossipIDs",value:function(e){for(var t=[],r=0;r<this.gossip;r++)this.history[r].forEach((function(r){var n=!0,i=!1,a=void 0;try{for(var s,o=r.topics[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){if(s.value===e){t.push(r.msgID);break}}}catch(u){i=!0,a=u}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}}));return t}},{key:"shift",value:function(){var e=this;this.history[this.history.length-1].forEach((function(t){e.msgs.delete(t.msgID)})),this.history.pop(),this.history.unshift([])}}]),e}();t.MessageCache=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default="\nmessage RPC {\n  repeated SubOpts subscriptions = 1;\n  repeated Message msgs = 2;\n  optional ControlMessage control = 3;\n\n  message SubOpts {\n    optional bool subscribe = 1; // subscribe or unsubcribe\n    optional string topicID = 2;\n  }\n\n  message Message {\n    optional bytes from = 1;\n    optional bytes data = 2;\n    optional bytes seqno = 3;\n    repeated string topicIDs = 4; \n    optional bytes signature = 5;\n    optional bytes key = 6;\n  }\n\n  message ControlMessage {\n    repeated ControlIHave ihave = 1;\n    repeated ControlIWant iwant = 2;\n    repeated ControlGraft graft = 3;\n    repeated ControlPrune prune = 4;\n  }\n\n  message ControlIHave {\n    optional string topicID = 1;\n    repeated string messageIDs = 2;\n  }\n\n  message ControlIWant {\n    repeated string messageIDs = 1;  \n  }\n\n  message ControlGraft {\n    optional string topicID = 1;\n  }\n\n  message ControlPrune {\n    optional string topicID = 1;\n  }\n}"},function(e,t,r){"use strict";var n=r(5),i=r(7),a=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&a(t,e,r);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Heartbeat=void 0;var u=o(r(2017)),c=r(2062),f=r(2018),h=r(15),l=function(){function e(t){n(this,e),this.gossipsub=t}return i(e,[{key:"start",value:function(){var e=this;if(this._heartbeatTimer){var t="Heartbeat timer is already running";throw this.gossipsub.log(t),h(new Error(t),"ERR_HEARTBEAT_ALREADY_RUNNING")}var r=this._heartbeat.bind(this),n=setTimeout((function(){r(),e._heartbeatTimer.runPeriodically(r,u.GossipsubHeartbeatInterval)}),u.GossipsubHeartbeatInitialDelay);this._heartbeatTimer={_intervalId:void 0,runPeriodically:function(t,r){e._heartbeatTimer._intervalId=setInterval(t,r)},cancel:function(){clearTimeout(n),clearInterval(e._heartbeatTimer._intervalId)}}}},{key:"stop",value:function(){if(!this._heartbeatTimer){var e="Heartbeat timer is not running";throw this.gossipsub.log(e),h(new Error(e),"ERR_HEARTBEAT_NO_RUNNING")}this._heartbeatTimer.cancel(),this._heartbeatTimer=null}},{key:"_heartbeat",value:function(){var e=this;this.gossipsub._flush();var t=new Map,r=new Map;this.gossipsub.mesh.forEach((function(n,i){if(n.size<u.GossipsubDlo){var a=u.GossipsubD-n.size;c.getGossipPeers(e.gossipsub,i,a).forEach((function(r){if(!n.has(r)){e.gossipsub.log("HEARTBEAT: Add mesh link to %s in %s",r.id.toB58String(),i),n.add(r);var a=t.get(r);a?a.push(i):t.set(r,[i])}}))}if(n.size>u.GossipsubDhi){var s=n.size-u.GossipsubD,o=Array.from(n);(o=(o=f.shuffle(o)).slice(0,s)).forEach((function(t){e.gossipsub.log("HEARTBEAT: Remove mesh link to %s in %s",t.id.toB58String(),i),n.delete(t);var a=r.get(t);a?a.push(i):r.set(t,[i])}))}e.gossipsub._emitGossip(i,n)}));var n=this.gossipsub._now();this.gossipsub.lastpub.forEach((function(t,r){t+u.GossipsubFanoutTTL<n&&(e.gossipsub.fanout.delete(r),e.gossipsub.lastpub.delete(r))})),this.gossipsub.fanout.forEach((function(t,r){var n=e.gossipsub.topics.get(r);if(t.forEach((function(e){n.has(e)&&t.delete(e)})),t.size<u.GossipsubD){var i=u.GossipsubD-t.size;c.getGossipPeers(e.gossipsub,r,i).forEach((function(e){t.has(e)&&t.add(e)}))}e.gossipsub._emitGossip(r,t)})),this.gossipsub._sendGraftPrune(t,r),this.gossipsub.messageCache.shift(),this.gossipsub.emit("gossipsub:heartbeat")}}]),e}();t.Heartbeat=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createGossipRpc=void 0,t.createGossipRpc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{subscriptions:[],msgs:e,control:Object.assign({ihave:[],iwant:[],graft:[],prune:[]},t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shuffle=void 0,t.shuffle=function(e){if(e.length<=1)return e;for(var t=0;t<e.length;t++){var r=Math.floor(Math.random()*Math.floor(e.length)),n=e[t];e[t]=e[r],e[r]=n}return e}},function(e,t,r){"use strict";var n=r(1),i=r(5),a=r(7),s=r(28),o=r(27),u=r(127),c=r(29),f=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{u(n.next(e))}catch(t){a(t)}}function o(e){try{u(n.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,o)}u((n=n.apply(e,t||[])).next())}))},h=this&&this.__asyncValues||function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e="function"===typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}},l=r(15),p=r(3).Buffer,d=r(55),v=r(78),y=r(100),b=r(2231),m=r(2014),g=r(2014).utils,k=r(2061).RPCCodec,w=function(e){function t(e){var r,n=e.debugName,a=e.multicodecs,u=e.peerId,c=e.registrar,f=e.options,h=void 0===f?{}:f;if(i(this,t),!d.isPeerId(u))throw new Error("peerId must be an instance of `peer-id`");var l=Object.assign({emitSelf:!1},h);return(r=s(this,o(t).call(this,Object.assign({debugName:n,multicodecs:a,peerId:u,registrar:c},l)))).subscriptions=new Set,r._options=l,r.defaultMsgIdFn=function(e){return g.msgId(e.from,e.seqno)},r.topicValidators=new Map,r}return c(t,e),a(t,[{key:"_onPeerConnected",value:function(e,r){var i=this,a=Object.create(null,{_onPeerConnected:{get:function(){return u(o(t.prototype),"_onPeerConnected",i)}}});return f(this,void 0,void 0,n.mark((function t(){var i,s;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a._onPeerConnected.call(this,e,r);case 2:i=e.toB58String(),(s=this.peers.get(i))&&s.isWritable&&s.sendSubscriptions(this.subscriptions);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"_processMessages",value:function(e,t,r){return f(this,void 0,void 0,n.mark((function i(){var a=this;return n.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,v(t,y.decode(),(function(t){var i,s;return f(a,void 0,void 0,n.mark((function a(){var o,u,c,f,l;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:n.prev=0,i=h(t);case 2:return n.next=4,i.next();case 4:if((s=n.sent).done){n.next=12;break}c=s.value,f=p.isBuffer(c)?c:c.slice(),l=this._decodeRpc(f),this._processRpc(e,r,l);case 10:n.next=2;break;case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0),o={error:n.t0};case 17:if(n.prev=17,n.prev=18,!s||s.done||!(u=i.return)){n.next=22;break}return n.next=22,u.call(i);case 22:if(n.prev=22,!o){n.next=25;break}throw o.error;case 25:return n.finish(22);case 26:return n.finish(17);case 27:case"end":return n.stop()}}),a,this,[[0,14,17,27],[18,,22,26]])})))}));case 3:i.next=8;break;case 5:i.prev=5,i.t0=i.catch(0),this._onPeerDisconnected(r.id,i.t0);case 8:case"end":return i.stop()}}),i,this,[[0,5]])})))}},{key:"_decodeRpc",value:function(e){return k.decode(e)}},{key:"_processRpc",value:function(e,t,r){var i=this;this.log("rpc from",e);var a=r.subscriptions,s=r.msgs;a.length&&(t.updateSubscriptions(a),a.forEach((function(e){return i._processRpcSubOpt(t,e)})),this.emit("pubsub:subscription-change",t.id,t.topics,a)),s.length&&s.forEach((function(e){return f(i,void 0,void 0,n.mark((function r(){var i;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=g.normalizeInRpcMessage(e),r.prev=1,r.next=4,this.validate(e,t);case 4:if(r.sent){r.next=8;break}return this.log("Message is invalid, dropping it."),r.abrupt("return");case 8:r.next=14;break;case 10:return r.prev=10,r.t0=r.catch(1),this.log("Error in message validation, dropping it. %O",r.t0),r.abrupt("return");case 14:this._processRpcMessage(t,i);case 15:case"end":return r.stop()}}),r,this,[[1,10]])})))}))}},{key:"validate",value:function(e,r){var i=this,a=Object.create(null,{validate:{get:function(){return u(o(t.prototype),"validate",i)}}});return f(this,void 0,void 0,n.mark((function t(){var i=this;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.validate.call(this,e,r);case 2:if(t.sent){t.next=5;break}return t.abrupt("return",!1);case 5:if(r){t.next=7;break}return t.abrupt("return",!0);case 7:return t.abrupt("return",e.topicIDs.every((function(t){var n=i.topicValidators.get(t);return!n||i._processTopicValidatorResult(t,r,e,n(t,r,e))})));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"_processTopicValidatorResult",value:function(e,t,r,n){return Boolean(n)}},{key:"_processRpcSubOpt",value:function(e,t){var r=t.topicID,n=this.topics.get(r);n||(n=new Set,this.topics.set(r,n)),t.subscribe?n.add(e):n.delete(e)}},{key:"_processRpcMessage",value:function(e,t){(this.peerId.toB58String()!==t.from||this._options.emitSelf)&&this._emitMessage(t.topicIDs,t)}},{key:"_emitMessage",value:function(e,t){var r=this;e.forEach((function(e){r.subscriptions.has(e)&&r.emit(e,t)}))}},{key:"stop",value:function(){var e=this,r=Object.create(null,{stop:{get:function(){return u(o(t.prototype),"stop",e)}}});return f(this,void 0,void 0,n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.stop.call(this);case 2:this.subscriptions=new Set;case 3:case"end":return e.stop()}}),e,this)})))}},{key:"subscribe",value:function(e){var t=this;if(!this.started)throw new Error("Pubsub has not started");var r=(e=g.ensureArray(e)).filter((function(e){return!t.subscriptions.has(e)}));0!==r.length&&this._subscribe(r)}},{key:"_subscribe",value:function(e){var t=this;e.forEach((function(e){t.subscriptions.add(e)})),this.peers.forEach((function(t){return function t(r){if(r&&r.isWritable)return r.sendSubscriptions(e);var n=function e(){r.removeListener("connection",e),t(r)};r.on("connection",n),r.once("close",(function(){return r.removeListener("connection",n)}))}(t)}))}},{key:"unsubscribe",value:function(e){var t=this;if(!this.started)throw new Error("Pubsub has not started");var r=(e=g.ensureArray(e)).filter((function(e){return t.subscriptions.has(e)}));0!==r.length&&this._unsubscribe(r)}},{key:"_unsubscribe",value:function(e){var t=this;e.forEach((function(e){t.subscriptions.delete(e)})),this.peers.forEach((function(t){return function t(r){if(r&&r.isWritable)return r.sendUnsubscriptions(e);var n=function e(){r.removeListener("connection",e),t(r)};r.on("connection",n),r.once("close",(function(){return r.removeListener("connection",n)}))}(t)}))}},{key:"publish",value:function(e,t){return f(this,void 0,void 0,n.mark((function r(){var i,a,s,o=this;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(this.started){r.next=2;break}throw new Error("Pubsub has not started");case 2:return this.log("publish",e,t),e=g.ensureArray(e),t=g.ensureArray(t),i=this.peerId.toB58String(),a=function(t,r){var n=g.randomSeqno(),a={from:i,data:t,seqno:n,topicIDs:e};return o._options.emitSelf&&o._emitMessages(e,[a]),o._buildMessage(a)},r.next=9,b(t,a);case 9:s=r.sent,this._publish(g.normalizeOutRpcMessages(s));case 11:case"end":return r.stop()}}),r,this)})))}},{key:"getTopics",value:function(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}},{key:"getMsgId",value:function(e){return this.defaultMsgIdFn(e)}},{key:"_emitMessages",value:function(e,t){var r=this;e.forEach((function(e){r.subscriptions.has(e)&&t.forEach((function(t){r.emit(e,t)}))}))}},{key:"_publish",value:function(e){throw l(new Error("_publish must be implemented by the subclass"),"ERR_NOT_IMPLEMENTED")}}]),t}(m);e.exports=w},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(264);e.exports=function(){var e=i(n.mark((function e(t,r){var s,o,u,c,f,h=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=h.length>2&&void 0!==h[2]?h[2]:{},o=s.concurrency,u=void 0===o?1/0:o,c=s.stopOnError,f=void 0===c||c,e.abrupt("return",new Promise((function(e,s){if("function"!==typeof r)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(u)&&u!==1/0||!(u>=1))throw new TypeError("Expected `concurrency` to be an integer from 1 and up or `Infinity`, got `".concat(u,"` (").concat(typeof u,")"));for(var o=[],c=[],h=t[Symbol.iterator](),l=!1,p=!1,d=0,v=0,y=function t(){if(!l){var u=h.next(),y=v;if(v++,u.done)return p=!0,void(0===d&&(f||0===c.length?e(o):s(new a(c))));d++,i(n.mark((function e(){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.value;case 3:return i=e.sent,e.next=6,r(i,y);case 6:o[y]=e.sent,d--,t(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),f?(l=!0,s(e.t0)):(c.push(e.t0),d--,t());case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()}},b=0;b<u&&(y(),!p);b++);})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(46),s=r(5),o=r(7),u=r(28),c=r(87),f=r(27),h=r(127),l=r(29),p=r(41).EventEmitter,d=r(19),v=r(261),y=d("libp2p");y.error=d("libp2p:error");var b=r(55),m=r(2233),g=r(2234),k=r(2235),w=r(2063),x=r(2236).validate,S=r(1954).codes,E=r(2237),_=r(2238),I=r(2241),A=r(2244),T=r(2246),C=r(2286),B=r(2064),R=r(2289),N=r(2076),P=r(2297),M=r(2301),D=r(2302),O=r(2304),L=O.IdentifyService,K=O.multicodecs,U=function(e){function t(e){var r;if(s(this,t),(r=u(this,f(t).call(this)))._options=x(e),r.peerId=r._options.peerId,r.datastore=r._options.datastore,r.peerStore=r.datastore&&r._options.peerStore.persistence?new P(a({datastore:r.datastore},r._options.peerStore)):new N,r.addresses=r._options.addresses,r.addressManager=new E(r._options.addresses),r._modules=r._options.modules,r._config=r._options.config,r._transport=[],r._discovery=new Map,r._options.connectionManager.minPeers&&(r._options.connectionManager.minConnections=r._options.connectionManager.minPeers),r.connectionManager=new _(c(r),a({autoDial:r._config.peerDiscovery.autoDial},r._options.connectionManager)),r._options.metrics.enabled&&(r.metrics=new C(a({},r._options.metrics,{connectionManager:r.connectionManager}))),r._options.keychain&&r._options.keychain.pass&&r._options.keychain.datastore){y("creating keychain");var n=T.generateOptions();r.keychain=new T(r._options.keychain.datastore,a({passPhrase:r._options.keychain.pass},n,{},r._options.keychain)),y("keychain constructed")}(r.upgrader=new R({localPeer:r.peerId,metrics:r.metrics,onConnection:function(e){return r.connectionManager.onConnect(e)},onConnectionEnd:function(e){return r.connectionManager.onDisconnect(e)}}),r.transportManager=new B({libp2p:c(r),upgrader:r.upgrader,faultTolerance:r._options.transportManager.faultTolerance}),r.registrar=new M({peerStore:r.peerStore,connectionManager:r.connectionManager}),r.handle=r.handle.bind(c(r)),r.registrar.handle=r.handle,r._modules.connEncryption)&&r._modules.connEncryption.forEach((function(e){r.upgrader.cryptos.set(e.protocol,e)}));(r.dialer=new A({transportManager:r.transportManager,peerStore:r.peerStore,concurrency:r._options.dialer.maxParallelDials,perPeerLimit:r._options.dialer.maxDialsPerPeer,timeout:r._options.dialer.dialTimeout}),r._modules.transport.forEach((function(e){var t=e.prototype[Symbol.toStringTag],n=r._config.transport[t];r.transportManager.add(t,e,n)})),r._config.relay.enabled&&r.transportManager.add(I.prototype[Symbol.toStringTag],I),r._modules.streamMuxer)&&(r._modules.streamMuxer.forEach((function(e){r.upgrader.muxers.set(e.multicodec,e)})),r.identifyService=new L({libp2p:c(r),protocols:r.upgrader.protocols}),r.handle(Object.values(K),r.identifyService.handleMessage));if(r._modules.connProtector)r.upgrader.protector=r._modules.connProtector;else if(void 0!==v.process&&v.process.env&&v.process.env.LIBP2P_FORCE_PNET)throw new Error("Private network is enforced, but no protector was provided");if(r._modules.dht){var i=r._modules.dht;r._dht=new i(a({libp2p:c(r),dialer:r.dialer,peerId:r.peerId,peerStore:r.peerStore,registrar:r.registrar,datastore:r.datastore},r._config.dht))}return r._modules.pubsub&&(r.pubsub=k(c(r),r._modules.pubsub,r._config.pubsub)),r.peerRouting=m(c(r)),r.contentRouting=g(c(r)),D.mount(c(r)),r._onDiscoveryPeer=r._onDiscoveryPeer.bind(c(r)),r}return l(t,e),o(t,[{key:"emit",value:function(e){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];var a;"error"!==e||this._events.error?(a=h(f(t.prototype),"emit",this)).call.apply(a,[this,e].concat(n)):y.error.apply(y,n)}},{key:"start",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y("libp2p is starting"),e.prev=1,e.next=4,this._onStarting();case 4:return e.next=6,this._onDidStart();case 6:y("libp2p has started"),e.next=16;break;case 9:return e.prev=9,e.t0=e.catch(1),this.emit("error",e.t0),y.error("An error occurred starting libp2p",e.t0),e.next=15,this.stop();case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[1,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=i(n.mark((function e(){var t,r,i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(y("libp2p is stopping"),e.prev=1,t=!0,r=!1,i=void 0,e.prev=5,a=this._discovery.values()[Symbol.iterator]();!(t=(s=a.next()).done);t=!0)s.value.removeListener("peer",this._onDiscoveryPeer);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),r=!0,i=e.t0;case 13:e.prev=13,e.prev=14,t||null==a.return||a.return();case 16:if(e.prev=16,!r){e.next=19;break}throw i;case 19:return e.finish(16);case 20:return e.finish(13);case 21:return e.next=23,Promise.all(Array.from(this._discovery.values(),(function(e){return e.stop()})));case 23:return this._discovery=new Map,e.next=26,this.peerStore.stop();case 26:return e.next=28,this.connectionManager.stop();case 28:return e.next=30,Promise.all([this.pubsub&&this.pubsub.stop(),this._dht&&this._dht.stop(),this.metrics&&this.metrics.stop()]);case 30:return e.next=32,this.transportManager.close();case 32:D.unmount(this),this.dialer.destroy(),e.next=39;break;case 36:e.prev=36,e.t1=e.catch(1),e.t1&&(y.error(e.t1),this.emit("error",e.t1));case 39:this._isStarted=!1,y("libp2p has stopped");case 41:case"end":return e.stop()}}),e,this,[[1,36],[5,9,13,21],[14,,16,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadKeychain",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.keychain.findKeyByName("self");case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),e.next=9,this.keychain.importPeer("self",this.peerId);case 9:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"isStarted",value:function(){return this._isStarted}},{key:"dial",value:function(e,t){return this.dialProtocol(e,null,t)}},{key:"dialProtocol",value:function(){var e=i(n.mark((function e(t,r,i){var a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=w(t),s=a.id,o=a.multiaddrs,u=this.connectionManager.get(s)){e.next=8;break}return e.next=5,this.dialer.connectToPeer(t,i);case 5:u=e.sent,e.next=9;break;case 8:o&&this.peerStore.addressBook.add(s,o);case 9:if(!r){e.next=11;break}return e.abrupt("return",u.newStream(r));case 11:return e.abrupt("return",u);case 12:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"hangUp",value:function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=w(t),i=r.id,a=this.connectionManager.connections.get(i.toB58String())){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,Promise.all(a.map((function(e){return e.close()})));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ping",value:function(e){var t=w(e),r=t.id,n=t.multiaddrs;return D(this,n?n[0]:r)}},{key:"handle",value:function(e,t){var r=this;(e=Array.isArray(e)?e:[e]).forEach((function(e){r.upgrader.protocols.set(e,t)})),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}},{key:"unhandle",value:function(e){var t=this;(e=Array.isArray(e)?e:[e]).forEach((function(e){t.upgrader.protocols.delete(e)})),this.isStarted()&&this.identifyService&&this.identifyService.pushToPeerStore(this.peerStore)}},{key:"_onStarting",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.transportManager.listen();case 2:return e.next=4,this.peerStore.start();case 4:this._config.pubsub.enabled&&this.pubsub&&this.pubsub.start(),this._config.dht.enabled&&(this._dht&&this._dht.start(),this._dht.on("peer",this._onDiscoveryPeer)),this.metrics&&this.metrics.start();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onDidStart",value:function(){var e=i(n.mark((function e(){var t,r,i,a,s,o,u=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(this._isStarted=!0,this.peerStore.on("peer",(function(e){u.emit("peer:discovery",e),u._maybeConnect(e)})),t=!0,r=!1,i=void 0,e.prev=5,a=this.peerStore.peers.values()[Symbol.iterator]();!(t=(s=a.next()).done);t=!0)o=s.value,this.emit("peer:discovery",o.id);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),r=!0,i=e.t0;case 13:e.prev=13,e.prev=14,t||null==a.return||a.return();case 16:if(e.prev=16,!r){e.next=19;break}throw i;case 19:return e.finish(16);case 20:return e.finish(13);case 21:return this.connectionManager.start(),e.next=24,this._setupPeerDiscovery();case 24:case"end":return e.stop()}}),e,this,[[5,9,13,21],[14,,16,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"_onDiscoveryPeer",value:function(e){e.id.toB58String()!==this.peerId.toB58String()?(e.multiaddrs&&this.peerStore.addressBook.add(e.id,e.multiaddrs),e.protocols&&this.peerStore.protoBook.set(e.id,e.protocols)):y.error(new Error(S.ERR_DISCOVERED_SELF))}},{key:"_maybeConnect",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this._config.peerDiscovery.autoDial||this.connectionManager.get(t)){e.next=12;break}if(!((this._options.connectionManager.minConnections||0)>this.connectionManager.size)){e.next=12;break}return y("connecting to discovered peer %s",t.toB58String()),e.prev=4,e.next=7,this.dialer.connectToPeer(t);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),y.error("could not connect to discovered peer",e.t0);case 12:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_setupPeerDiscovery",value:function(){var e=i(n.mark((function e(){var t,r,i,s,o,u,c,f,h,l,p,d,v,y=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=function(e){var t,r={enabled:!0};(e.tag&&y._config.peerDiscovery&&y._config.peerDiscovery[e.tag]&&(r=a({},r,{},y._config.peerDiscovery[e.tag])),r.enabled&&!y._discovery.has(e.tag))&&((t="function"===typeof e?new e(Object.assign({},r,{peerId:y.peerId,libp2p:y})):e).on("peer",y._onDiscoveryPeer),y._discovery.set(e.tag,t))},r=!0,i=!1,s=void 0,e.prev=4,o=(this._modules.peerDiscovery||[])[Symbol.iterator]();!(r=(u=o.next()).done);r=!0)c=u.value,t(c);e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),i=!0,s=e.t0;case 12:e.prev=12,e.prev=13,r||null==o.return||o.return();case 15:if(e.prev=15,!i){e.next=18;break}throw s;case 18:return e.finish(15);case 19:return e.finish(12);case 20:for(f=!0,h=!1,l=void 0,e.prev=23,p=this.transportManager.getTransports()[Symbol.iterator]();!(f=(d=p.next()).done);f=!0)(v=d.value).discovery&&t(v.discovery);e.next=31;break;case 27:e.prev=27,e.t1=e.catch(23),h=!0,l=e.t1;case 31:e.prev=31,e.prev=32,f||null==p.return||p.return();case 34:if(e.prev=34,!h){e.next=37;break}throw l;case 37:return e.finish(34);case 38:return e.finish(31);case 39:return e.next=41,Promise.all(Array.from(this._discovery.values(),(function(e){return e.start()})));case 41:case"end":return e.stop()}}),e,this,[[4,8,12,20],[13,,15,19],[23,27,31,39],[32,,34,38]])})));return function(){return e.apply(this,arguments)}}()},{key:"connections",get:function(){return this.connectionManager.connections}},{key:"multiaddrs",get:function(){var e=this.addressManager.getNoAnnounceAddrs();return this.transportManager.getAddrs().concat(this.addressManager.getAnnounceAddrs()).filter((function(t,r,n){return n.findIndex((function(e){return e.equals(t)}))===r&&!e.find((function(e){return e.equals(t)}))}))}}]),t}(p);U.create=function(){var e=i(n.mark((function e(){var t,r,i=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=i.length>0&&void 0!==i[0]?i[0]:{}).peerId){e.next=3;break}return e.abrupt("return",new U(t));case 3:return e.next=5,b.create();case 5:return r=e.sent,t.peerId=r,e.abrupt("return",new U(t));case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.exports=U},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(15),s=r(333);e.exports=function(e){var t=e._modules.peerRouting||[];return e._dht&&t.unshift(e._dht),{findPeer:function(){var e=i(n.mark((function e(r,o){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}throw a(new Error("No peer routers available"),"NO_ROUTERS_AVAILABLE");case 2:return e.abrupt("return",s(t.map(function(){var e=i(n.mark((function e(t){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.findPeer(r,o);case 2:if((i=e.sent)&&0!==Object.keys(i).length){e.next=5;break}throw a(new Error("not found"),"NOT_FOUND");case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(15),u=r(1954),c=u.messages,f=u.codes,h=r(343),l=r(333);e.exports=function(e){var t=e._modules.contentRouting||[],r=e._dht;return r&&t.unshift(r),{findProviders:function(e,r){return s(n.mark((function s(){var u,c,f,p,d,v,y;return n.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(t.length){s.next=2;break}throw o(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");case 2:return s.next=4,a(l(t.map(function(){var t=i(n.mark((function t(i){var a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(i.findProviders(e,r));case 2:if((a=t.sent)&&a.length){t.next=5;break}throw o(new Error("not found"),"NOT_FOUND");case 5:return t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())));case 4:u=s.sent,c=!0,f=!1,p=void 0,s.prev=8,d=u[Symbol.iterator]();case 10:if(c=(v=d.next()).done){s.next=17;break}return y=v.value,s.next=14,y;case 14:c=!0,s.next=10;break;case 17:s.next=23;break;case 19:s.prev=19,s.t0=s.catch(8),f=!0,p=s.t0;case 23:s.prev=23,s.prev=24,c||null==d.return||d.return();case 26:if(s.prev=26,!f){s.next=29;break}throw p;case 29:return s.finish(26);case 30:return s.finish(23);case 31:case"end":return s.stop()}}),s,null,[[8,19,23,31],[24,,26,30]])})))()},provide:function(e){return i(n.mark((function r(){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.length){r.next=2;break}throw o(new Error("No content routers available"),"NO_ROUTERS_AVAILABLE");case 2:return r.abrupt("return",Promise.all(t.map((function(t){return t.provide(e)}))));case 3:case"end":return r.stop()}}),r)})))()},put:function(t,a,s){return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isStarted()&&r.isStarted){n.next=2;break}throw o(new Error(c.NOT_STARTED_YET),f.DHT_NOT_STARTED);case 2:return n.abrupt("return",r.put(t,a,s));case 3:case"end":return n.stop()}}),i)})))()},get:function(t,a){return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isStarted()&&r.isStarted){n.next=2;break}throw o(new Error(c.NOT_STARTED_YET),f.DHT_NOT_STARTED);case 2:return n.abrupt("return",r.get(t,a));case 3:case"end":return n.stop()}}),i)})))()},getMany:function(t,a,s){return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.isStarted()&&r.isStarted){n.next=2;break}throw o(new Error(c.NOT_STARTED_YET),f.DHT_NOT_STARTED);case 2:return n.abrupt("return",r.getMany(t,a,s));case 3:case"end":return n.stop()}}),i)})))()}}}},function(e,t,r){"use strict";var n=r(3).Buffer,i=r(15),a=r(1954),s=a.messages,o=a.codes;e.exports=function(e,t,r){var a=new t(e.peerId,e.registrar,r);return{subscribe:function(t,r){if(!e.isStarted()&&!a.started)throw i(new Error(s.NOT_STARTED_YET),o.PUBSUB_NOT_STARTED);0===a.listenerCount(t)&&a.subscribe(t),a.on(t,r)},unsubscribe:function(t,r){if(!e.isStarted()&&!a.started)throw i(new Error(s.NOT_STARTED_YET),o.PUBSUB_NOT_STARTED);r?a.removeListener(t,r):a.removeAllListeners(t),0===a.listenerCount(t)&&a.unsubscribe(t)},publish:function(t,r){if(!e.isStarted()&&!a.started)throw i(new Error(s.NOT_STARTED_YET),o.PUBSUB_NOT_STARTED);try{r=n.from(r)}catch(u){throw i(new Error("data must be convertible to a Buffer"),"ERR_DATA_IS_NOT_VALID")}return a.publish(t,r)},getTopics:function(){if(!e.isStarted()&&!a.started)throw i(new Error(s.NOT_STARTED_YET),o.PUBSUB_NOT_STARTED);return a.getTopics()},getSubscribers:function(t){if(!e.isStarted()&&!a.started)throw i(new Error(s.NOT_STARTED_YET),o.PUBSUB_NOT_STARTED);return a.getSubscribers(t)},setMaxListeners:function(e){return a.setMaxListeners(e)},_pubsub:a,start:function(){return a.start()},stop:function(){return a.stop()}}}},function(e,t,r){"use strict";var n=r(103),i=r(2019),a={addresses:{listen:[],announce:[],noAnnounce:[]},connectionManager:{minConnections:25},transportManager:{faultTolerance:r(2064).FaultTolerance.FATAL_ALL},dialer:{maxParallelDials:i.MAX_PARALLEL_DIALS,maxDialsPerPeer:i.MAX_PER_PEER_DIALS,dialTimeout:i.DIAL_TIMEOUT},metrics:{enabled:!1},peerStore:{persistence:!1,threshold:5},config:{dht:{enabled:!1,kBucketSize:20,randomWalk:{enabled:!1,queriesPerPeriod:1,interval:3e5,timeout:1e4}},peerDiscovery:{autoDial:!0},pubsub:{enabled:!0,emitSelf:!0,signMessages:!0,strictSigning:!0},relay:{enabled:!0,hop:{enabled:!1,active:!1}},transport:{}}};e.exports.validate=function(e){if((e=n(a,e)).modules.transport.length<1)throw new Error("'options.modules.transport' must contain at least 1 transport");return e}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(19);a("libp2p:addresses").error=a("libp2p:addresses:error");var s=r(72),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.listen,i=void 0===r?[]:r,a=t.announce,s=void 0===a?[]:a,o=t.noAnnounce,u=void 0===o?[]:o;n(this,e),this.listen=new Set(i),this.announce=new Set(s),this.noAnnounce=new Set(u)}return i(e,[{key:"getListenAddrs",value:function(){return Array.from(this.listen).map((function(e){return s(e)}))}},{key:"getAnnounceAddrs",value:function(){return Array.from(this.announce).map((function(e){return s(e)}))}},{key:"getNoAnnounceAddrs",value:function(){return Array.from(this.noAnnounce).map((function(e){return s(e)}))}}]),e}();e.exports=o},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(28),u=r(27),c=r(87),f=r(29),h=r(19),l=h("libp2p:connection-manager");l.error=h("libp2p:connection-manager:error");var p=r(15),d=r(103),v=r(2239),y=r(341),b=r(41).EventEmitter,m=r(55),g=r(1954).ERR_INVALID_PARAMETERS,k={maxConnections:1/0,minConnections:0,maxData:1/0,maxSentData:1/0,maxReceivedData:1/0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,defaultPeerValue:1},w=function(e){function t(e,r){var n;if(a(this,t),(n=o(this,u(t).call(this)))._libp2p=e,n._peerId=e.peerId.toB58String(),n._options=d.call({ignoreUndefined:!0},k,r),n._options.maxConnections<n._options.minConnections)throw p(new Error("Connection Manager maxConnections must be greater than minConnections"),g);return l("options: %j",n._options),n._libp2p=e,n._peerValues=new Map,n.connections=new Map,n._started=!1,n._timer=null,n._autoDialTimeout=null,n._checkMetrics=n._checkMetrics.bind(c(n)),n._autoDial=n._autoDial.bind(c(n)),n}return f(t,e),s(t,[{key:"start",value:function(){this._libp2p.metrics&&(this._timer=this._timer||y(this._checkMetrics,this._options.pollInterval)),this._latencyMonitor=new v({latencyCheckIntervalMs:this._options.pollInterval,dataEmitIntervalMs:this._options.pollInterval}),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this._latencyMonitor.on("data",this._onLatencyMeasure),this._started=!0,l("started"),this._options.autoDial&&this._autoDial()}},{key:"stop",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._autoDialTimeout&&this._autoDialTimeout.clear(),this._timer&&this._timer.clear(),this._latencyMonitor&&this._latencyMonitor.removeListener("data",this._onLatencyMeasure),this._started=!1,e.next=6,this._close();case 6:l("stopped");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_close",value:function(){var e=i(n.mark((function e(){var t,r,i,a,s,o,u,c,f,h,l,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=!0,i=!1,a=void 0,e.prev=4,s=this.connections.values()[Symbol.iterator]();case 6:if(r=(o=s.next()).done){e.next=30;break}for(u=o.value,c=!0,f=!1,h=void 0,e.prev=11,l=u[Symbol.iterator]();!(c=(p=l.next()).done);c=!0)d=p.value,t.push(d.close());e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),f=!0,h=e.t0;case 19:e.prev=19,e.prev=20,c||null==l.return||l.return();case 22:if(e.prev=22,!f){e.next=25;break}throw h;case 25:return e.finish(22);case 26:return e.finish(19);case 27:r=!0,e.next=6;break;case 30:e.next=36;break;case 32:e.prev=32,e.t1=e.catch(4),i=!0,a=e.t1;case 36:e.prev=36,e.prev=37,r||null==s.return||s.return();case 39:if(e.prev=39,!i){e.next=42;break}throw a;case 42:return e.finish(39);case 43:return e.finish(36);case 44:return e.next=46,t;case 46:this.connections.clear();case 47:case"end":return e.stop()}}),e,this,[[4,32,36,44],[11,15,19,27],[20,,22,26],[37,,39,43]])})));return function(){return e.apply(this,arguments)}}()},{key:"setPeerValue",value:function(e,t){if(t<0||t>1)throw new Error("value should be a number between 0 and 1");e.toB58String&&(e=e.toB58String()),this._peerValues.set(e,t)}},{key:"_checkMetrics",value:function(){var e=this._libp2p.metrics.global.movingAverages,t=e.dataReceived[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxReceivedData",t);var r=e.dataSent[this._options.movingAverageInterval].movingAverage();this._checkMaxLimit("maxSentData",r);var n=t+r;this._checkMaxLimit("maxData",n),l("metrics update",n),this._timer=y(this._checkMetrics,this._options.pollInterval)}},{key:"onConnect",value:function(e){var t=e.remotePeer,r=t.toB58String(),n=this.connections.get(r);this.emit("peer:connect",e),n?n.push(e):this.connections.set(r,[e]),this._libp2p.peerStore.keyBook.set(t,t.pubKey),this._peerValues.has(r)||this._peerValues.set(r,this._options.defaultPeerValue),this._checkMaxLimit("maxConnections",this.size)}},{key:"onDisconnect",value:function(e){var t=e.remotePeer.toB58String(),r=this.connections.get(t);r&&r.length>1?(r=r.filter((function(t){return t.id!==e.id})),this.connections.set(t,r)):r&&(this.connections.delete(t),this._peerValues.delete(e.remotePeer.toB58String()),this.emit("peer:disconnect",e))}},{key:"get",value:function(e){var t=this.getAll(e);return t.length?t[0]:null}},{key:"getAll",value:function(e){if(!m.isPeerId(e))throw p(new Error("peerId must be an instance of peer-id"),g);var t=e.toB58String(),r=this.connections.get(t);return r?r.filter((function(e){return"open"===e.stat.status})):[]}},{key:"_onLatencyMeasure",value:function(e){this._checkMaxLimit("maxEventLoopDelay",e.avgMs)}},{key:"_checkMaxLimit",value:function(e,t){var r=this._options[e];l("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(l("%s: limit exceeded: %s, %d",this._peerId,e,t),this._maybeDisconnectOne())}},{key:"_autoDial",value:function(){var e=i(n.mark((function e(){var t,r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._options.minConnections,!(this.size>=t)){e.next=4;break}return this._autoDialTimeout=y(this._autoDial,this._options.autoDialInterval),e.abrupt("return");case 4:r=Array.from(this._libp2p.peerStore.peers.values()).sort((function(e,t){return!t.protocols||!t.protocols.length||e.protocols&&e.protocols.length?t.id.pubKey&&!e.id.pubKey?1:-1:1})),i=0;case 6:if(!(i<r.length&&this.size<t)){e.next=22;break}if(this.get(r[i].id)){e.next=19;break}return l("connecting to a peerStore stored peer %s",r[i].id.toB58String()),e.prev=9,e.next=12,this._libp2p.dialer.connectToPeer(r[i].id);case 12:if(this._started){e.next=14;break}return e.abrupt("return");case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),l.error("could not connect to peerStore stored peer",e.t0);case 19:i++,e.next=6;break;case 22:this._autoDialTimeout=y(this._autoDial,this._options.autoDialInterval);case 23:case"end":return e.stop()}}),e,this,[[9,16]])})));return function(){return e.apply(this,arguments)}}()},{key:"_maybeDisconnectOne",value:function(){if(this._options.minConnections<this.connections.size){var e=Array.from(this._peerValues).sort(x);l("%s: sorted peer values: %j",this._peerId,e);var t=e[0];if(t){var r=t[0];l("%s: lowest value peer is %s",this._peerId,r),l("%s: closing a connection to %j",this._peerId,r);var n=!0,i=!1,a=void 0;try{for(var s,o=this.connections.values()[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;if(u[0].remotePeer.toB58String()===r){u[0].close();break}}}catch(c){i=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}}}}},{key:"size",get:function(){return Array.from(this.connections.values()).reduce((function(e,t){return e+t.length}),0)}}]),t}(b);function x(e,t){return e[1]-t[1]}e.exports=w},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(87),u=r(29),c=r(261),f=r(41),h=r(2240),l=r(19)("latency-monitor:LatencyMonitor"),p=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.latencyCheckIntervalMs,u=r.dataEmitIntervalMs,f=r.asyncTestFn,p=r.latencyRandomPercentage;n(this,t),e=a(this,s(t).call(this));var v=o(e);return v.latencyCheckIntervalMs=i||500,v.latencyRandomPercentage=p||10,v._latecyCheckMultiply=v.latencyRandomPercentage/100*2*v.latencyCheckIntervalMs,v._latecyCheckSubtract=v._latecyCheckMultiply/2,v.dataEmitIntervalMs=null===u||0===u?void 0:u||5e3,l("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",v.latencyCheckIntervalMs,v.dataEmitIntervalMs),v.dataEmitIntervalMs?l("Expecting ~%s events per summary",v.latencyCheckIntervalMs/v.dataEmitIntervalMs):l("Not emitting summaries"),v.asyncTestFn=f,c.process&&c.process.hrtime?(l("Using process.hrtime for timing"),v.now=c.process.hrtime,v.getDeltaMS=function(e){var t=v.now(e);return 1e3*t[0]+t[1]/1e6}):"undefined"!==typeof window&&window.performance&&window.performance.now?(l("Using performance.now for timing"),v.now=window.performance.now.bind(window.performance),v.getDeltaMS=function(e){return Math.round(v.now()-e)}):(l("Using Date.now for timing"),v.now=Date.now,v.getDeltaMS=function(e){return v.now()-e}),v._latencyData=v._initLatencyData(),d()&&(v._visibilityChangeEmitter=new h,v._visibilityChangeEmitter.on("visibilityChange",(function(e){e?v._startTimers():(v._emitSummary(),v._stopTimers())}))),v._visibilityChangeEmitter&&!v._visibilityChangeEmitter.isVisible()||v._startTimers(),e}return u(t,e),i(t,[{key:"_startTimers",value:function(){var e=this;this._checkLatencyID||(this._checkLatency(),this.dataEmitIntervalMs&&(this._emitIntervalID=setInterval((function(){return e._emitSummary()}),this.dataEmitIntervalMs),"function"===typeof this._emitIntervalID.unref&&this._emitIntervalID.unref()))}},{key:"_stopTimers",value:function(){this._checkLatencyID&&(clearTimeout(this._checkLatencyID),this._checkLatencyID=void 0),this._emitIntervalID&&(clearInterval(this._emitIntervalID),this._emitIntervalID=void 0)}},{key:"_emitSummary",value:function(){var e=this.getSummary();e.events>0&&this.emit("data",e)}},{key:"getSummary",value:function(){var e={events:this._latencyData.events,minMs:this._latencyData.minMs,maxMs:this._latencyData.maxMs,avgMs:this._latencyData.events?this._latencyData.totalMs/this._latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this._latencyData.startTime)};return this._latencyData=this._initLatencyData(),l("Summary: %O",e),e}},{key:"_checkLatency",value:function(){var e=this,t=this,r=Math.random()*t._latecyCheckMultiply-t._latecyCheckSubtract,n={deltaOffset:Math.ceil(t.latencyCheckIntervalMs+r),startTime:t.now()},i=function(){if(e._checkLatencyID){var r=t.getDeltaMS(n.startTime)-n.deltaOffset;t._checkLatency(),t._latencyData.events++,t._latencyData.minMs=Math.min(t._latencyData.minMs,r),t._latencyData.maxMs=Math.max(t._latencyData.maxMs,r),t._latencyData.totalMs+=r,l("MS: %s Data: %O",r,t._latencyData)}};l("localData: %O",n),this._checkLatencyID=setTimeout((function(){t.asyncTestFn?(n.deltaOffset=0,n.startTime=t.now(),t.asyncTestFn(i)):(n.deltaOffset-=1,i())}),n.deltaOffset),"function"===typeof this._checkLatencyID.unref&&this._checkLatencyID.unref()}},{key:"_initLatencyData",value:function(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}]),t}(f);function d(){return"undefined"!==typeof window}e.exports=p},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(41),c=r(19)("latency-monitor:VisibilityChangeEmitter");e.exports=function(e){function t(){var e;return n(this,t),e=a(this,s(t).call(this)),"undefined"===typeof document?(c('This is not a browser, no "document" found. Stopping.'),a(e)):(e._initializeVisibilityVarNames(),e._addVisibilityChangeListener(),e)}return o(t,e),i(t,[{key:"_initializeVisibilityVarNames",value:function(){var e,t;"undefined"!==typeof document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==typeof document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):"undefined"!==typeof document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==typeof document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),this._hidden=e,this._visibilityChange=t}},{key:"_addVisibilityChangeListener",value:function(){"undefined"===typeof document.addEventListener||"undefined"===typeof document[this._hidden]?c("Checking page visibility requires a browser that supports the Page Visibility API."):document.addEventListener(this._visibilityChange,this._handleVisibilityChange.bind(this),!1)}},{key:"isVisible",value:function(){if(void 0!==this._hidden&&void 0!==document[this._hidden])return!document[this._hidden]}},{key:"_handleVisibilityChange",value:function(){var e=!document[this._hidden];c(e?"Page Visible":"Page Hidden"),this.emit("visibilityChange",e)}}]),t}(u)},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(169),u=r(72),c=r(55),f=r(63),h=r(1976).CircuitRelay,l=r(19),p=l("libp2p:circuit");p.error=l("libp2p:circuit:error");var d=r(801),v=r(2020).relay,y=r(2242),b=r(2243),m=b.handleCanHop,g=b.handleHop,k=b.hop,w=r(2066).handleStop,x=r(2021),S=function(){function e(t){var r=t.libp2p,n=t.upgrader;a(this,e),this._dialer=r.dialer,this._registrar=r.registrar,this._connectionManager=r.connectionManager,this._upgrader=n,this._options=r._config.relay,this._libp2p=r,this.peerId=r.peerId,this._registrar.handle(v,this._onProtocol.bind(this))}return s(e,[{key:"_onProtocol",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o,c,f,l,v,y,b;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,i=t.stream,t.protocol,a=new x({stream:i}),e.next=4,a.read();case 4:s=e.sent,o=this,e.t0=s.type,e.next=e.t0===h.Type.CAN_HOP?9:e.t0===h.Type.HOP?13:e.t0===h.Type.STOP?18:23;break;case 9:return p("received CAN_HOP request from %s",r.remotePeer.toB58String()),e.next=12,m({circuit:o,connection:r,streamHandler:a});case 12:return e.abrupt("break",24);case 13:return p("received HOP request from %s",r.remotePeer.toB58String()),e.next=16,g({connection:r,request:s,streamHandler:a,circuit:o});case 16:return c=e.sent,e.abrupt("break",24);case 18:return p("received STOP request from %s",r.remotePeer.toB58String()),e.next=21,w({connection:r,request:s,streamHandler:a,circuit:o});case 21:return c=e.sent,e.abrupt("break",24);case 23:p("Request of type %s not supported",s.type);case 24:if(!c){e.next=35;break}return f=u(s.dstPeer.addrs[0]),l=u(s.srcPeer.addrs[0]),v=d({stream:c,remoteAddr:f,localAddr:l}),y=h.Type===h.Type.HOP?"relay":"inbound",p("new %s connection %s",y,v.remoteAddr),e.next=32,this._upgrader.upgradeInbound(v);case 32:b=e.sent,p("%s connection %s upgraded",y,v.remoteAddr),this.handler&&this.handler(b);case 35:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dial",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o,f,l,v,y,b,m;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.toString().split("/p2p-circuit"),a=u(i[0]),s=u(i[i.length-1]),o=c.createFromCID(a.getPeerId()),f=c.createFromCID(s.getPeerId()),l=!1,v=this._connectionManager.get(o)){e.next=12;break}return e.next=10,this._dialer.connectToPeer(a,r);case 10:v=e.sent,l=!0;case 12:return e.prev=12,e.next=15,k({connection:v,circuit:this,request:{type:h.Type.HOP,srcPeer:{id:this.peerId.toBytes(),addrs:this._libp2p.multiaddrs.map((function(e){return e.buffer}))},dstPeer:{id:f.toBytes(),addrs:[u(s).buffer]}}});case 15:return y=e.sent,b=a.encapsulate("/p2p-circuit/p2p/".concat(this.peerId.toB58String())),m=d({stream:y,remoteAddr:t,localAddr:b}),p("new outbound connection %s",m.remoteAddr),e.abrupt("return",this._upgrader.upgradeOutbound(m));case 22:if(e.prev=22,e.t0=e.catch(12),p.error("Circuit relay dial failed",e.t0),e.t1=l,!e.t1){e.next=29;break}return e.next=29,v.close();case 29:throw e.t0;case 30:case"end":return e.stop()}}),e,this,[[12,22]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createListener",value:function(e,t){return"function"===typeof e&&(t=e,e={}),this.handler=t,y(this,e)}},{key:"filter",value:function(e){return(e=Array.isArray(e)?e:[e]).filter((function(e){return o.Circuit.matches(e)}))}}]),e}();e.exports=f(S,{className:"Circuit",symbolName:"@libp2p/js-libp2p-circuit/circuit"})},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(41),s=r(72),o=r(19);o("libp2p:circuit:listener").err=o("libp2p:circuit:error:listener"),e.exports=function(e){var t=new a,r=new Map;return t.listen=function(){var a=i(n.mark((function i(a){var o,u,c;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=String(a).split("/p2p-circuit").find((function(e){return""!==e})),n.next=3,e._dialer.connectToPeer(s(o));case 3:u=n.sent,c=u.remoteAddr.encapsulate("/p2p-circuit"),r.set(u.remotePeer.toB58String(),c),t.emit("listening");case 7:case"end":return n.stop()}}),i)})));return function(e){return a.apply(this,arguments)}}(),t.close=function(){},t.getAddrs=function(){var e=[],t=!0,n=!1,i=void 0;try{for(var a,s=r.values()[Symbol.iterator]();!(t=(a=s.next()).done);t=!0){var o=a.value;e.push(o)}}catch(u){n=!0,i=u}finally{try{t||null==s.return||s.return()}finally{if(n)throw i}}return e},t}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19),s=a("libp2p:circuit:hop");s.error=a("libp2p:circuit:hop:error");var o=r(55),u=r(2065).validateAddrs,c=r(2021),f=r(1976).CircuitRelay,h=r(78),l=r(15),p=r(1954).codes,d=r(2066).stop,v=r(2020);e.exports.handleHop=function(){var e=i(n.mark((function e(t){var r,i,a,c,l,p,v,y,b;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.connection,i=t.request,a=t.streamHandler,(c=t.circuit)._options.hop.enabled){e.next=4;break}return s("HOP request received but we are not acting as a relay"),e.abrupt("return",a.end({type:f.Type.STATUS,code:f.Status.HOP_CANT_SPEAK_RELAY}));case 4:e.prev=4,u(i,a),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(4),e.abrupt("return",s.error("invalid hop request via peer %s",r.remotePeer.toB58String(),e.t0));case 11:if(l=new o(i.dstPeer.id),(p=c._connectionManager.get(l))||c._options.hop.active){e.next=16;break}return s("HOP request received but we are not connected to the destination peer"),e.abrupt("return",a.end({type:f.Type.STATUS,code:f.Status.HOP_NO_CONN_TO_DST}));case 16:return v={type:f.Type.STOP,dstPeer:i.dstPeer,srcPeer:i.srcPeer},e.prev=17,e.next=20,d({connection:p,request:v,circuit:c});case 20:y=e.sent,e.next=26;break;case 23:return e.prev=23,e.t1=e.catch(17),e.abrupt("return",s.error(e.t1));case 26:return s("hop request from %s is valid",r.remotePeer.toB58String()),a.write({type:f.Type.STATUS,code:f.Status.SUCCESS}),b=a.rest(),e.abrupt("return",h(b,y,b));case 30:case"end":return e.stop()}}),e,null,[[4,8],[17,23]])})));return function(t){return e.apply(this,arguments)}}(),e.exports.hop=function(){var e=i(n.mark((function e(t){var r,i,a,o,u,h;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,i=t.request,e.next=3,r.newStream([v.relay]);case 3:return a=e.sent,o=a.stream,(u=new c({stream:o})).write(i),e.next=9,u.read();case 9:if((h=e.sent).code!==f.Status.SUCCESS){e.next=13;break}return s("hop request was successful"),e.abrupt("return",u.rest());case 13:throw s("hop request failed with code %d, closing stream",h.code),u.close(),l(new Error("HOP request failed with code ".concat(h.code)),p.ERR_HOP_REQUEST_FAILED);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.exports.handleCanHop=function(e){var t=e.connection,r=e.streamHandler,n=e.circuit._options.hop.enabled;s("can hop (%s) request from %s",n,t.remotePeer.toB58String()),r.end({type:f.Type.STATUS,code:n?f.Status.SUCCESS:f.Status.HOP_CANT_SPEAK_RELAY})}},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(68),o=r(5),u=r(7),c=r(72),f=r(15),h=r(466),l=r(226),p=r(19),d=p("libp2p:dialer");d.error=p("libp2p:dialer:error");var v=r(2245).DialRequest,y=r(2063),b=r(1954).codes,m=r(2019),g=m.DIAL_TIMEOUT,k=m.MAX_PARALLEL_DIALS,w=m.MAX_PER_PEER_DIALS,x=function(){function e(t){var r=t.transportManager,n=t.peerStore,i=t.concurrency,a=void 0===i?k:i,u=t.timeout,c=void 0===u?g:u,f=t.perPeerLimit,h=void 0===f?w:f;o(this,e),this.transportManager=r,this.peerStore=n,this.concurrency=a,this.timeout=c,this.perPeerLimit=h,this.tokens=s(new Array(a)).map((function(e,t){return t})),this._pendingDials=new Map}return u(e,[{key:"destroy",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,i=this._pendingDials.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var a=n.value;try{a.controller.abort()}catch(s){d.error(s)}}}catch(s){t=!0,r=s}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this._pendingDials.clear()}},{key:"connectToPeer",value:function(){var e=a(i.mark((function e(t){var r,n,a,s,o=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.length>1&&void 0!==o[1]?o[1]:{},(n=this._createDialTarget(t)).addrs.length){e.next=4;break}throw f(new Error("The dial request has no addresses"),b.ERR_NO_VALID_ADDRESSES);case 4:return a=this._pendingDials.get(n.id)||this._createPendingDial(n,r),e.prev=5,e.next=8,a.promise;case 8:return s=e.sent,d("dial succeeded to %s",n.id),e.abrupt("return",s);case 13:throw e.prev=13,e.t0=e.catch(5),a.controller.signal.aborted&&(e.t0.code=b.ERR_TIMEOUT),d.error(e.t0),e.t0;case 18:return e.prev=18,a.destroy(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[5,13,18,21]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createDialTarget",value:function(e){var t=y(e),r=t.id,n=t.multiaddrs;n&&this.peerStore.addressBook.add(r,n);var i=this.peerStore.addressBook.getMultiaddrsForPeer(r)||[];return c.isMultiaddr(e)&&(i=i.filter((function(t){return!e.equals(t)}))).unshift(e),{id:r.toB58String(),addrs:i}}},{key:"_createPendingDial",value:function(e,t){var r=this,i=new v({addrs:e.addrs,dialAction:function(e,t){if(t.signal.aborted)throw f(new Error("already aborted"),b.ERR_ALREADY_ABORTED);return r.transportManager.dial(e,t)},dialer:this}),a=new h(this.timeout),s=[a.signal];t.signal&&s.push(t.signal);var o=l(s),u={dialRequest:i,controller:a,promise:i.run(n({},t,{signal:o})),destroy:function(){a.clear(),r._pendingDials.delete(e.id)}};return this._pendingDials.set(e.id,u),u}},{key:"getTokens",value:function(e){var t=Math.min(e,this.perPeerLimit,this.tokens.length),r=this.tokens.splice(0,t);return d("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),r}},{key:"releaseToken",value:function(e){this.tokens.indexOf(e)>-1||(d("token %d released",e),this.tokens.push(e))}}]),e}();e.exports=x},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(2),s=r(5),o=r(7),u=r(152),c=r(226),f=r(19),h=r(15);f("libp2p:dialer:request").error=f("libp2p:dialer:request:error");var l=r(479),p=r(333),d=function(){function e(t){var r=t.addrs,n=t.dialAction,i=t.dialer;s(this,e),this.addrs=r,this.dialer=i,this.dialAction=n}return o(e,[{key:"run",value:function(){var e=a(n.mark((function e(t){var r,s,o,f,d=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((r=this.dialer.getTokens(this.addrs.length)).length<1)){e.next=3;break}throw h(new Error("No dial tokens available"),"ERR_NO_DIAL_TOKENS");case 3:return s=new l,r.forEach((function(e){return s.push(e)})),o=this.addrs.map((function(){return new u})),f=0,e.prev=7,e.next=10,p(this.addrs.map(function(){var e=a(n.mark((function e(a,u){var h,l,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.shift();case 2:return h=e.sent,e.prev=3,p=o[u].signal,e.next=7,d.dialAction(a,i({},t,{signal:c([p,t.signal])}));case 7:l=e.sent,o.splice(u,1);case 9:return e.prev=9,f++,d.addrs.length-f>=r.length?s.push(h):d.dialer.releaseToken(r.splice(r.indexOf(h),1)[0]),e.finish(9);case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}}),e,null,[[3,,9,13]])})));return function(t,r){return e.apply(this,arguments)}}()));case 10:return e.abrupt("return",e.sent);case 11:return e.prev=11,o.map((function(e){return e.abort()})),r.forEach((function(e){return d.dialer.releaseToken(e)})),e.finish(11);case 15:case"end":return e.stop()}}),e,this,[[7,,11,15]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports.DialRequest=d},function(e,t,r){"use strict";var n=r(1),i=r(5),a=r(7),s=r(2),o=r(18),u=r(795),c=r(103),f=r(2067),h=r(57),l=r(2279),p=r(15),d=14,v=16,y=1e3,b={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function m(e){return!!e&&("string"===typeof e&&e===u(e.trim()))}function g(e){return k.apply(this,arguments)}function k(){return(k=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 200,1e3,r=800*Math.random()+200,e.next=5,new Promise((function(e){return setTimeout(e,r)}));case 5:throw t;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return new h.Key("/pkcs8/"+e)}function x(e){return new h.Key("/info/"+e)}var S=function(){function e(t,r){if(i(this,e),!t)throw new Error("store is required");if(this.store=t,this.opts=c(b,r),!this.opts.passPhrase||this.opts.passPhrase.length<20)throw new Error("passPhrase must be least 20 characters");if(this.opts.dek.keyLength<d)throw new Error("dek.keyLength must be least ".concat(d," bytes"));if(this.opts.dek.salt.length<v)throw new Error("dek.saltLength must be least ".concat(v," bytes"));if(this.opts.dek.iterationCount<y)throw new Error("dek.iterationCount must be least ".concat(y));var n=f.pbkdf2(this.opts.passPhrase,this.opts.dek.salt,this.opts.dek.iterationCount,this.opts.dek.keyLength,this.opts.dek.hash);Object.defineProperty(this,"_",{value:function(){return n}})}return a(e,[{key:"createKey",value:function(){var e=s(n.mark((function e(t,r,i){var a,s,o,u,c,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,m(t)&&"self"!==t){e.next=3;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 3:if("string"===typeof r){e.next=5;break}return e.abrupt("return",g(p(new Error("Invalid key type '".concat(r,"'")),"ERR_INVALID_KEY_TYPE")));case 5:if(Number.isSafeInteger(i)){e.next=7;break}return e.abrupt("return",g(p(new Error("Invalid key size '".concat(i,"'")),"ERR_INVALID_KEY_SIZE")));case 7:return s=w(t),e.next=10,a.store.has(s);case 10:if(!e.sent){e.next=13;break}return e.abrupt("return",g(p(new Error("Key '".concat(t,"' already exists")),"ERR_KEY_ALREADY_EXISTS")));case 13:e.t0=r.toLowerCase(),e.next="rsa"===e.t0?16:19;break;case 16:if(!(i<2048)){e.next=18;break}return e.abrupt("return",g(p(new Error("Invalid RSA key size ".concat(i)),"ERR_INVALID_KEY_SIZE")));case 18:case 19:return e.abrupt("break",20);case 20:return e.prev=20,e.next=23,f.keys.generateKeyPair(r,i);case 23:return u=e.sent,e.next=26,u.id();case 26:return c=e.sent,e.next=29,u.export(this._());case 29:return h=e.sent,o={name:t,id:c},(l=a.store.batch()).put(s,h),l.put(x(t),JSON.stringify(o)),e.next=36,l.commit();case 36:e.next=41;break;case 38:return e.prev=38,e.t1=e.catch(20),e.abrupt("return",g(e.t1));case 41:return e.abrupt("return",o);case 42:case"end":return e.stop()}}),e,this,[[20,38]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"listKeys",value:function(){var e=s(n.mark((function e(){var t,r,i,a,s,u,c,f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this,r={prefix:"/info/"},i=[],a=!0,s=!1,e.prev=5,c=o(t.store.query(r));case 7:return e.next=9,c.next();case 9:return f=e.sent,a=f.done,e.next=13,f.value;case 13:if(h=e.sent,a){e.next=20;break}l=h,i.push(JSON.parse(l.value));case 17:a=!0,e.next=7;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),s=!0,u=e.t0;case 26:if(e.prev=26,e.prev=27,a||null==c.return){e.next=31;break}return e.next=31,c.return();case 31:if(e.prev=31,!s){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",i);case 37:case"end":return e.stop()}}),e,this,[[5,22,26,36],[27,,31,35]])})));return function(){return e.apply(this,arguments)}}()},{key:"findKeyById",value:function(){var e=s(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.listKeys();case 3:return r=e.sent,e.abrupt("return",r.find((function(e){return e.id===t})));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",g(e.t0));case 10:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"findKeyByName",value:function(){var e=s(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(t)){e.next=2;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 2:return r=x(t),e.prev=3,e.next=6,this.store.get(r);case 6:return i=e.sent,e.abrupt("return",JSON.parse(i.toString()));case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",g(p(new Error("Key '".concat(t,"' does not exist. ").concat(e.t0.message)),"ERR_KEY_NOT_FOUND")));case 13:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeKey",value:function(){var e=s(n.mark((function e(t){var r,i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this,m(t)&&"self"!==t){e.next=3;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 3:return i=w(t),e.next=6,r.findKeyByName(t);case 6:return a=e.sent,(s=r.store.batch()).delete(i),s.delete(x(t)),e.next=12,s.commit();case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renameKey",value:function(){var e=s(n.mark((function e(t,r){var i,a,s,o,u,c,f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this,m(t)&&"self"!==t){e.next=3;break}return e.abrupt("return",g(p(new Error("Invalid old key name '".concat(t,"'")),"ERR_OLD_KEY_NAME_INVALID")));case 3:if(m(r)&&"self"!==r){e.next=5;break}return e.abrupt("return",g(p(new Error("Invalid new key name '".concat(r,"'")),"ERR_NEW_KEY_NAME_INVALID")));case 5:return a=w(t),s=w(r),o=x(t),u=x(r),e.next=11,i.store.has(s);case 11:if(!e.sent){e.next=14;break}return e.abrupt("return",g(p(new Error("Key '".concat(r,"' already exists")),"ERR_KEY_ALREADY_EXISTS")));case 14:return e.prev=14,e.next=17,this.store.get(a);case 17:return c=e.sent,f=c.toString(),e.next=21,i.store.get(o);case 21:return c=e.sent,(h=JSON.parse(c.toString())).name=r,(l=i.store.batch()).put(s,f),l.put(u,JSON.stringify(h)),l.delete(a),l.delete(o),e.next=31,l.commit();case 31:return e.abrupt("return",h);case 34:return e.prev=34,e.t0=e.catch(14),e.abrupt("return",g(e.t0));case 37:case"end":return e.stop()}}),e,this,[[14,34]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"exportKey",value:function(){var e=s(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(t)){e.next=2;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 2:if(r){e.next=4;break}return e.abrupt("return",g(p(new Error("Password is required"),"ERR_PASSWORD_REQUIRED")));case 4:return i=w(t),e.prev=5,e.next=8,this.store.get(i);case 8:return a=e.sent,s=a.toString(),e.next=12,f.keys.import(s,this._());case 12:return o=e.sent,e.abrupt("return",o.export(r));case 16:return e.prev=16,e.t0=e.catch(5),e.abrupt("return",g(e.t0));case 19:case"end":return e.stop()}}),e,this,[[5,16]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"importKey",value:function(){var e=s(n.mark((function e(t,r,i){var a,s,o,u,c,h;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this,m(t)&&"self"!==t){e.next=3;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 3:if(r){e.next=5;break}return e.abrupt("return",g(p(new Error("PEM encoded key is required"),"ERR_PEM_REQUIRED")));case 5:return s=w(t),e.next=8,a.store.has(s);case 8:if(!e.sent){e.next=11;break}return e.abrupt("return",g(p(new Error("Key '".concat(t,"' already exists")),"ERR_KEY_ALREADY_EXISTS")));case 11:return e.prev=11,e.next=14,f.keys.import(r,i);case 14:o=e.sent,e.next=20;break;case 17:return e.prev=17,e.t0=e.catch(11),e.abrupt("return",g(p(new Error("Cannot read the key, most likely the password is wrong"),"ERR_CANNOT_READ_KEY")));case 20:return e.prev=20,e.next=23,o.id();case 23:return u=e.sent,e.next=26,o.export(this._());case 26:r=e.sent,e.next=32;break;case 29:return e.prev=29,e.t1=e.catch(20),e.abrupt("return",g(e.t1));case 32:return c={name:t,id:u},(h=a.store.batch()).put(s,r),h.put(x(t),JSON.stringify(c)),e.next=38,h.commit();case 38:return e.abrupt("return",c);case 39:case"end":return e.stop()}}),e,this,[[11,17],[20,29]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"importPeer",value:function(){var e=s(n.mark((function e(t,r){var i,a,s,o,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this,m(t)){e.next=3;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 3:if(r&&r.privKey){e.next=5;break}return e.abrupt("return",g(p(new Error("Peer.privKey is required"),"ERR_MISSING_PRIVATE_KEY")));case 5:return a=r.privKey,s=w(t),e.next=9,i.store.has(s);case 9:if(!e.sent){e.next=12;break}return e.abrupt("return",g(p(new Error("Key '".concat(t,"' already exists")),"ERR_KEY_ALREADY_EXISTS")));case 12:return e.prev=12,e.next=15,a.id();case 15:return o=e.sent,e.next=18,a.export(this._());case 18:return u=e.sent,c={name:t,id:o},(f=i.store.batch()).put(s,u),f.put(x(t),JSON.stringify(c)),e.next=25,f.commit();case 25:return e.abrupt("return",c);case 28:return e.prev=28,e.t0=e.catch(12),e.abrupt("return",g(e.t0));case 31:case"end":return e.stop()}}),e,this,[[12,28]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getPrivateKey",value:function(){var e=s(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(t)){e.next=2;break}return e.abrupt("return",g(p(new Error("Invalid key name '".concat(t,"'")),"ERR_INVALID_KEY_NAME")));case 2:return e.prev=2,r=w(t),e.next=6,this.store.get(r);case 6:return i=e.sent,e.abrupt("return",i.toString());case 10:return e.prev=10,e.t0=e.catch(2),e.abrupt("return",g(p(new Error("Key '".concat(t,"' does not exist. ").concat(e.t0.message)),"ERR_KEY_NOT_FOUND")));case 13:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"cms",get:function(){return new l(this)}}],[{key:"generateOptions",value:function(){var e=Object.assign({},b),t=3*Math.ceil(v/3);return e.dek.salt=f.randomBytes(t).toString("base64"),e}},{key:"options",get:function(){return b}}]),e}();e.exports=S},function(e,t,r){"use strict";e.exports={SHA1:20,SHA256:32,SHA512:64}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2249),s=r(2251);t.create=function(){var e=i(n.mark((function e(t,r){var o,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=s(t),u=a.createCipheriv(o,t,r),c=a.createDecipheriv(o,t,r),f={encrypt:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u.update(e));case 1:case"end":return t.stop()}}),t)})))()},decrypt:function(e){return i(n.mark((function t(){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",c.update(e));case 1:case"end":return t.stop()}}),t)})))()}},e.abrupt("return",f);case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(3).Buffer;r(1977);var i=r(1949);e.exports={createCipheriv:function(e,t,r){var a=i.cipher.createCipher("AES-CTR",t.toString("binary"));return a.start({iv:r.toString("binary")}),{update:function(e){return a.update(i.util.createBuffer(e.toString("binary"))),n.from(a.output.getBytes(),"binary")}}},createDecipheriv:function(e,t,r){var a=i.cipher.createDecipher("AES-CTR",t.toString("binary"));return a.start({iv:r.toString("binary")}),{update:function(e){return a.update(i.util.createBuffer(e.toString("binary"))),n.from(a.output.getBytes(),"binary")}}}}},function(e,t,r){(function(t){var r={};e.exports=r;var n={};r.encode=function(e,t,r){if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==r&&"number"!==typeof r)throw new TypeError('"maxline" must be a number.');var n="";if(e instanceof Uint8Array){var i=0,a=t.length,s=t.charAt(0),o=[0];for(i=0;i<e.length;++i){for(var u=0,c=e[i];u<o.length;++u)c+=o[u]<<8,o[u]=c%a,c=c/a|0;for(;c>0;)o.push(c%a),c=c/a|0}for(i=0;0===e[i]&&i<e.length-1;++i)n+=s;for(i=o.length-1;i>=0;--i)n+=t[o[i]]}else n=function(e,t){var r=0,n=t.length,i=t.charAt(0),a=[0];for(r=0;r<e.length();++r){for(var s=0,o=e.at(r);s<a.length;++s)o+=a[s]<<8,a[s]=o%n,o=o/n|0;for(;o>0;)a.push(o%n),o=o/n|0}var u="";for(r=0;0===e.at(r)&&r<e.length()-1;++r)u+=i;for(r=a.length-1;r>=0;--r)u+=t[a[r]];return u}(e,t);if(r){var f=new RegExp(".{1,"+r+"}","g");n=n.match(f).join("\r\n")}return n},r.decode=function(e,r){if("string"!==typeof e)throw new TypeError('"input" must be a string.');if("string"!==typeof r)throw new TypeError('"alphabet" must be a string.');var i=n[r];if(!i){i=n[r]=[];for(var a=0;a<r.length;++a)i[r.charCodeAt(a)]=a}e=e.replace(/\s/g,"");var s=r.length,o=r.charAt(0),u=[0];for(a=0;a<e.length;a++){var c=i[e.charCodeAt(a)];if(void 0===c)return;for(var f=0,h=c;f<u.length;++f)h+=u[f]*s,u[f]=255&h,h>>=8;for(;h>0;)u.push(255&h),h>>=8}for(var l=0;e[l]===o&&l<e.length-1;++l)u.push(0);return"undefined"!==typeof t?t.from(u.reverse()):new Uint8Array(u.reverse())}}).call(this,r(3).Buffer)},function(e,t,r){"use strict";var n=r(48),i=r(15),a={16:"aes-128-ctr",32:"aes-256-ctr"};e.exports=function(e){var t=a[e.length];if(!t){var r=Object.entries(a).map((function(e){var t=n(e,2),r=t[0],i=t[1];return"".concat(r," (").concat(i,")")})).join(" / ");throw i(new Error("Invalid key length ".concat(e.length," bytes. Must be ").concat(r)),"ERR_INVALID_KEY_LENGTH")}return t}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(73)(r(2023));r(1960),r(2071);var o=r(1949),u=r(15);t=e.exports;var c={rsa:r(2260),ed25519:r(2270),secp256k1:r(2272)(s,r(2028))};t.supportedKeys=c,t.keysPBM=s;var f="secp256k1 support requires libp2p-crypto-secp256k1 package",h="ERR_MISSING_PACKAGE";function l(e){var t=c[e.toLowerCase()];if(!t){var r=Object.keys(c).join(" / ");throw u(new Error("invalid or unsupported key type ".concat(e,". Must be ").concat(r)),"ERR_UNSUPPORTED_KEY_TYPE")}return t}t.keyStretcher=r(2274),t.generateEphemeralKeyPair=r(2275),t.generateKeyPair=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l(t).generateKeyPair(r));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.generateKeyPairFromSeed=function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l(t),"ed25519"===t.toLowerCase()){e.next=3;break}throw u(new Error("Seed key derivation is unimplemented for RSA or secp256k1"),"ERR_UNSUPPORTED_KEY_DERIVATION_TYPE");case 3:return e.abrupt("return",a.generateKeyPairFromSeed(r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),t.unmarshalPublicKey=function(e){var t=s.PublicKey.decode(e),r=t.Data;switch(t.Type){case s.KeyType.RSA:return c.rsa.unmarshalRsaPublicKey(r);case s.KeyType.Ed25519:return c.ed25519.unmarshalEd25519PublicKey(r);case s.KeyType.Secp256k1:if(c.secp256k1)return c.secp256k1.unmarshalSecp256k1PublicKey(r);throw u(new Error(f),h);default:l(t.Type)}},t.marshalPublicKey=function(e,t){return l(t=(t||"rsa").toLowerCase()),e.bytes},t.unmarshalPrivateKey=function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.PrivateKey.decode(t),i=r.Data,e.t0=r.Type,e.next=e.t0===s.KeyType.RSA?5:e.t0===s.KeyType.Ed25519?6:e.t0===s.KeyType.Secp256k1?7:12;break;case 5:return e.abrupt("return",c.rsa.unmarshalRsaPrivateKey(i));case 6:return e.abrupt("return",c.ed25519.unmarshalEd25519PrivateKey(i));case 7:if(!c.secp256k1){e.next=11;break}return e.abrupt("return",c.secp256k1.unmarshalSecp256k1PrivateKey(i));case 11:throw u(new Error(f),h);case 12:l(r.Type);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.marshalPrivateKey=function(e,t){return l(t=(t||"rsa").toLowerCase()),e.bytes},t.import=function(){var e=i(n.mark((function e(t,r){var i,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(i=o.pki.decryptRsaPrivateKey(t,r))){e.next=3;break}throw u(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");case 3:return s=o.asn1.toDer(o.pki.privateKeyToAsn1(i)),s=a.from(s.getBytes(),"binary"),e.abrupt("return",c.rsa.unmarshalRsaPrivateKey(s));case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){var n=r(1949);r(1962),r(1951),(e.exports=n.hmac=n.hmac||{}).create=function(){var e=null,t=null,r=null,i=null,a={start:function(a,s){if(null!==a)if("string"===typeof a){if(!((a=a.toLowerCase())in n.md.algorithms))throw new Error('Unknown hash algorithm "'+a+'"');t=n.md.algorithms[a].create()}else t=a;if(null===s)s=e;else{if("string"===typeof s)s=n.util.createBuffer(s);else if(n.util.isArray(s)){var o=s;s=n.util.createBuffer();for(var u=0;u<o.length;++u)s.putByte(o[u])}var c=s.length();c>t.blockLength&&(t.start(),t.update(s.bytes()),s=t.digest()),r=n.util.createBuffer(),i=n.util.createBuffer(),c=s.length();for(u=0;u<c;++u){o=s.at(u);r.putByte(54^o),i.putByte(92^o)}if(c<t.blockLength)for(o=t.blockLength-c,u=0;u<o;++u)r.putByte(54),i.putByte(92);e=s,r=r.bytes(),i=i.bytes()}t.start(),t.update(r)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(i),t.update(e),t.digest()}};return a.digest=a.getMac,a}},function(e,t,r){var n=r(1949);r(1962),r(1951);var i=e.exports=n.sha256=n.sha256||{};n.md.sha256=n.md.algorithms.sha256=i,i.create=function(){s||(a=String.fromCharCode(128),a+=n.util.fillString(String.fromCharCode(0),64),o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=!0);var e=null,t=n.util.createBuffer(),r=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,a=0;a<r;++a)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=n.util.encodeUtf8(a));var o=a.length;i.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=o[1],o[1]=o[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,o[0]=o[1]/4294967296>>>0;return t.putBytes(a),u(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var o,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-c));for(var f=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)f+=(o=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(f>>>0),f=o>>>0;s.putInt32(f);var l={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};u(l,r,s);var p=n.util.createBuffer();return p.putInt32(l.h0),p.putInt32(l.h1),p.putInt32(l.h2),p.putInt32(l.h3),p.putInt32(l.h4),p.putInt32(l.h5),p.putInt32(l.h6),p.putInt32(l.h7),p},i};var a=null,s=!1,o=null;function u(e,t,r){for(var n,i,a,s,u,c,f,h,l,p,d,v,y,b=r.length();b>=64;){for(u=0;u<16;++u)t[u]=r.getInt32();for(;u<64;++u)n=((n=t[u-2])>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,i=((i=t[u-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[u]=n+t[u-7]+i+t[u-16]|0;for(c=e.h0,f=e.h1,h=e.h2,l=e.h3,p=e.h4,d=e.h5,v=e.h6,y=e.h7,u=0;u<64;++u)a=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=c&f|h&(c^f),n=y+((p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(v^p&(d^v))+o[u]+t[u],y=v,v=d,d=p,p=l+n>>>0,l=h,h=f,f=c,c=n+(i=a+s)>>>0;e.h0=e.h0+c|0,e.h1=e.h1+f|0,e.h2=e.h2+h|0,e.h3=e.h3+l|0,e.h4=e.h4+p|0,e.h5=e.h5+d|0,e.h6=e.h6+v|0,e.h7=e.h7+y|0,b-=64}}},function(e,t,r){(function(t){var n=r(1949);r(1951);var i=null;!n.util.isNodejs||n.options.usePureJavaScript||t.versions["node-webkit"]||(i=r(2025)),(e.exports=n.prng=n.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=e.md,a=new Array(32),s=0;s<32;++s)a[s]=r.create();function o(){if(t.pools[0].messageLength>=32)return u();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),u()}function u(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var r=1,n=0;n<32;++n)t.reseeds%r===0&&(e.update(t.pools[n].digest().getBytes()),t.pools[n].start()),r<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var i=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(i),t.generated=0}function c(e){var t=null,r=n.util.globalScope,i=r.crypto||r.msCrypto;i&&i.getRandomValues&&(t=function(e){return i.getRandomValues(e)});var a=n.util.createBuffer();if(t)for(;a.length()<e;){var s=Math.max(1,Math.min(e-a.length(),65536)/4),o=new Uint32Array(Math.floor(s));try{t(o);for(var u=0;u<o.length;++u)a.putInt32(o[u])}catch(p){if(!("undefined"!==typeof QuotaExceededError&&p instanceof QuotaExceededError))throw p}}if(a.length()<e)for(var c,f,h,l=Math.floor(65536*Math.random());a.length()<e;){f=16807*(65535&l),f+=(32767&(c=16807*(l>>16)))<<16,l=4294967295&(f=(2147483647&(f+=c>>15))+(f>>31));for(u=0;u<3;++u)h=l>>>(u<<3),h^=Math.floor(256*Math.random()),a.putByte(String.fromCharCode(255&h))}return a.getBytes(e)}return t.pools=a,t.pool=0,t.generate=function(e,r){if(!r)return t.generateSync(e);var i=t.plugin.cipher,a=t.plugin.increment,s=t.plugin.formatKey,o=t.plugin.formatSeed,c=n.util.createBuffer();t.key=null,function f(h){if(h)return r(h);if(c.length()>=e)return r(null,c.getBytes(e));t.generated>1048575&&(t.key=null);if(null===t.key)return n.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return u(),e();var r=32-t.pools[0].messageLength<<5;t.seedFile(r,(function(r,n){if(r)return e(r);t.collect(n),u(),e()}))}(f)}));var l=i(t.key,t.seed);t.generated+=l.length,c.putBytes(l),t.key=s(i(t.key,a(t.seed))),t.seed=o(i(t.key,t.seed)),n.util.setImmediate(f)}()},t.generateSync=function(e){var r=t.plugin.cipher,i=t.plugin.increment,a=t.plugin.formatKey,s=t.plugin.formatSeed;t.key=null;for(var u=n.util.createBuffer();u.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&o();var c=r(t.key,t.seed);t.generated+=c.length,u.putBytes(c),t.key=a(r(t.key,i(t.seed))),t.seed=s(r(t.key,t.seed))}return u.getBytes(e)},i?(t.seedFile=function(e,t){i.randomBytes(e,(function(e,r){if(e)return t(e);t(null,r.toString())}))},t.seedFileSync=function(e){return i.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,c(e))}catch(r){t(r)}},t.seedFileSync=c),t.collect=function(e){for(var r=e.length,n=0;n<r;++n)t.pools[t.pool].update(e.substr(n,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,r){for(var n="",i=0;i<r;i+=8)n+=String.fromCharCode(e>>i&255);t.collect(n)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){self.addEventListener("message",(function e(r){var n=r.data;n.forge&&n.forge.prng&&(self.removeEventListener("message",e),t(n.forge.prng.err,n.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(r){var n=r.data;n.forge&&n.forge.prng&&t.seedFile(n.forge.prng.needed,(function(t,r){e.postMessage({forge:{prng:{err:t,bytes:r}}})}))}))}},t}}).call(this,r(37))},function(e,t,r){var n=r(1949);r(1951);var i=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],a=[1,2,3,5],s=function(e,t){return e<<t&65535|(65535&e)>>16-t},o=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=n.rc2=n.rc2||{},n.rc2.expandKey=function(e,t){"string"===typeof e&&(e=n.util.createBuffer(e)),t=t||128;var r,a=e,s=e.length(),o=t,u=Math.ceil(o/8),c=255>>(7&o);for(r=s;r<128;r++)a.putByte(i[a.at(r-1)+a.at(r-s)&255]);for(a.setAt(128-u,i[a.at(128-u)&c]),r=127-u;r>=0;r--)a.setAt(r,i[a.at(r+1)^a.at(r+u)]);return a};var u=function(e,t,r){var i,u,c,f,h=!1,l=null,p=null,d=null,v=[];for(e=n.rc2.expandKey(e,t),c=0;c<64;c++)v.push(e.getInt16Le());r?(i=function(e){for(c=0;c<4;c++)e[c]+=v[f]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),e[c]=s(e[c],a[c]),f++},u=function(e){for(c=0;c<4;c++)e[c]+=v[63&e[(c+3)%4]]}):(i=function(e){for(c=3;c>=0;c--)e[c]=o(e[c],a[c]),e[c]-=v[f]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),f--},u=function(e){for(c=3;c>=0;c--)e[c]-=v[63&e[(c+3)%4]]});var y=function(e){var t=[];for(c=0;c<4;c++){var n=l.getInt16Le();null!==d&&(r?n^=d.getInt16Le():d.putInt16Le(n)),t.push(65535&n)}f=r?0:63;for(var i=0;i<e.length;i++)for(var a=0;a<e[i][0];a++)e[i][1](t);for(c=0;c<4;c++)null!==d&&(r?d.putInt16Le(t[c]):t[c]^=d.getInt16Le()),p.putInt16Le(t[c])},b=null;return b={start:function(e,t){e&&"string"===typeof e&&(e=n.util.createBuffer(e)),h=!1,l=n.util.createBuffer(),p=t||new n.util.createBuffer,d=e,b.output=p},update:function(e){for(h||l.putBuffer(e);l.length()>=8;)y([[5,i],[1,u],[6,i],[1,u],[5,i]])},finish:function(e){var t=!0;if(r)if(e)t=e(8,l,!r);else{var n=8===l.length()?8:8-l.length();l.fillWithByte(n,n)}if(t&&(h=!0,b.update()),!r&&(t=0===l.length()))if(e)t=e(8,p,!r);else{var i=p.length(),a=p.at(i-1);a>i?t=!1:p.truncate(a)}return t}}};n.rc2.startEncrypting=function(e,t,r){var i=n.rc2.createEncryptionCipher(e,128);return i.start(t,r),i},n.rc2.createEncryptionCipher=function(e,t){return u(e,t,!0)},n.rc2.startDecrypting=function(e,t,r){var i=n.rc2.createDecryptionCipher(e,128);return i.start(t,r),i},n.rc2.createDecryptionCipher=function(e,t){return u(e,t,!1)}},function(e,t,r){var n=r(1949);r(1951),r(1963),r(2258);var i=e.exports=n.pkcs1=n.pkcs1||{};function a(e,t,r){r||(r=n.md.sha1.create());for(var i="",a=Math.ceil(t/r.digestLength),s=0;s<a;++s){var o=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);r.start(),r.update(e+o),i+=r.digest().getBytes()}return i.substring(0,t)}i.encode_rsa_oaep=function(e,t,r){var i,s,o,u;"string"===typeof r?(i=r,s=arguments[3]||void 0,o=arguments[4]||void 0):r&&(i=r.label||void 0,s=r.seed||void 0,o=r.md||void 0,r.mgf1&&r.mgf1.md&&(u=r.mgf1.md)),o?o.start():o=n.md.sha1.create(),u||(u=o);var c=Math.ceil(e.n.bitLength()/8),f=c-2*o.digestLength-2;if(t.length>f)throw(y=new Error("RSAES-OAEP input message length is too long.")).length=t.length,y.maxLength=f,y;i||(i=""),o.update(i,"raw");for(var h=o.digest(),l="",p=f-t.length,d=0;d<p;d++)l+="\0";var v=h.getBytes()+l+"\x01"+t;if(s){if(s.length!==o.digestLength){var y;throw(y=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=s.length,y.digestLength=o.digestLength,y}}else s=n.random.getBytes(o.digestLength);var b=a(s,c-o.digestLength-1,u),m=n.util.xorBytes(v,b,v.length),g=a(m,o.digestLength,u),k=n.util.xorBytes(s,g,s.length);return"\0"+k+m},i.decode_rsa_oaep=function(e,t,r){var i,s,o;"string"===typeof r?(i=r,s=arguments[3]||void 0):r&&(i=r.label||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md));var u=Math.ceil(e.n.bitLength()/8);if(t.length!==u)throw(m=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,m.expectedLength=u,m;if(void 0===s?s=n.md.sha1.create():s.start(),o||(o=s),u<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),s.update(i,"raw");for(var c=s.digest().getBytes(),f=t.charAt(0),h=t.substring(1,s.digestLength+1),l=t.substring(1+s.digestLength),p=a(l,s.digestLength,o),d=n.util.xorBytes(h,p,h.length),v=a(d,u-s.digestLength-1,o),y=n.util.xorBytes(l,v,l.length),b=y.substring(0,s.digestLength),m="\0"!==f,g=0;g<s.digestLength;++g)m|=c.charAt(g)!==b.charAt(g);for(var k=1,w=s.digestLength,x=s.digestLength;x<y.length;x++){var S=y.charCodeAt(x),E=1&S^1,_=k?65534:0;m|=S&_,w+=k&=E}if(m||1!==y.charCodeAt(w))throw new Error("Invalid RSAES-OAEP padding.");return y.substring(w+1)}},function(e,t,r){var n=r(1949);r(1962),r(1951);var i=e.exports=n.sha1=n.sha1||{};n.md.sha1=n.md.algorithms.sha1=i,i.create=function(){s||(a=String.fromCharCode(128),a+=n.util.fillString(String.fromCharCode(0),64),s=!0);var e=null,t=n.util.createBuffer(),r=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var r=i.messageLengthSize/4,a=0;a<r;++a)i.fullMessageLength.push(0);return t=n.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(a,s){"utf8"===s&&(a=n.util.encodeUtf8(a));var u=a.length;i.messageLength+=u,u=[u/4294967296>>>0,u>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=u[1],u[1]=u[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,u[0]=u[1]/4294967296>>>0;return t.putBytes(a),o(e,r,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=n.util.createBuffer();s.putBytes(t.bytes());var u,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(a.substr(0,i.blockLength-c));for(var f=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)f+=(u=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(f>>>0),f=u>>>0;s.putInt32(f);var l={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};o(l,r,s);var p=n.util.createBuffer();return p.putInt32(l.h0),p.putInt32(l.h1),p.putInt32(l.h2),p.putInt32(l.h3),p.putInt32(l.h4),p},i};var a=null,s=!1;function o(e,t,r){for(var n,i,a,s,o,u,c,f=r.length();f>=64;){for(i=e.h0,a=e.h1,s=e.h2,o=e.h3,u=e.h4,c=0;c<16;++c)n=r.getInt32(),t[c]=n,n=(i<<5|i>>>27)+(o^a&(s^o))+u+1518500249+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<20;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(o^a&(s^o))+u+1518500249+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<32;++c)n=(n=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|n>>>31,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+1859775393+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<40;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+1859775393+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<60;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a&s|o&(a^s))+u+2400959708+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;for(;c<80;++c)n=(n=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|n>>>30,t[c]=n,n=(i<<5|i>>>27)+(a^s^o)+u+3395469782+n,u=o,o=s,s=(a<<30|a>>>2)>>>0,a=i,i=n;e.h0=e.h0+i|0,e.h1=e.h1+a|0,e.h2=e.h2+s|0,e.h3=e.h3+o|0,e.h4=e.h4+u|0,f-=64}}},function(e,t,r){var n=r(1949);r(1951),r(1989),r(1963),function(){if(n.prime)e.exports=n.prime;else{var t=e.exports=n.prime=n.prime||{},r=n.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],a=new r(null);a.fromInt(30);var s=function(e,t){return e|t};t.generateProbablePrime=function(e,t,i){"function"===typeof t&&(i=t,t={});var a=(t=t||{}).algorithm||"PRIMEINC";"string"===typeof a&&(a={name:a}),a.options=a.options||{};var s=t.prng||n.random,c={nextBytes:function(e){for(var t=s.getBytesSync(e.length),r=0;r<e.length;++r)e[r]=t.charCodeAt(r)}};if("PRIMEINC"===a.name)return function(e,t,i,a){if("workers"in i)return function(e,t,i,a){if("undefined"===typeof Worker)return o(e,t,i,a);var s=u(e,t),c=i.workers,f=i.workLoad||100,h=30*f/8,l=i.workerScript||"forge/prime.worker.js";if(-1===c)return n.util.estimateCores((function(e,t){e&&(t=2),c=t-1,p()}));function p(){c=Math.max(1,c);for(var n=[],i=0;i<c;++i)n[i]=new Worker(l);for(i=0;i<c;++i)n[i].addEventListener("message",p);var o=!1;function p(i){if(!o){0;var c=i.data;if(c.found){for(var l=0;l<n.length;++l)n[l].terminate();return o=!0,a(null,new r(c.prime,16))}s.bitLength()>e&&(s=u(e,t));var p=s.toString(16);i.target.postMessage({hex:p,workLoad:f}),s.dAddOffset(h,0)}}}p()}(e,t,i,a);return o(e,t,i,a)}(e,c,a.options,i);throw new Error("Invalid prime generation algorithm: "+a.name)}}function o(e,t,r,a){var s=u(e,t),o=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(s.bitLength());"millerRabinTests"in r&&(o=r.millerRabinTests);var c=10;"maxBlockTime"in r&&(c=r.maxBlockTime),function e(t,r,a,s,o,c,f){var h=+new Date;do{if(t.bitLength()>r&&(t=u(r,a)),t.isProbablePrime(o))return f(null,t);t.dAddOffset(i[s++%8],0)}while(c<0||+new Date-h<c);n.util.setImmediate((function(){e(t,r,a,s,o,c,f)}))}(s,e,t,0,o,c,a)}function u(e,t){var n=new r(e,t),i=e-1;return n.testBit(i)||n.bitwiseTo(r.ONE.shiftLeft(i),s,n),n.dAddOffset(31-n.mod(a).byteValue(),0),n}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(225),u=r(73),c=r(2027),f=r(15),h=r(2266),l=u(r(2023));r(2073),r(2074);var p=r(1949),d=function(){function e(t){a(this,e),this._key=t}return s(e,[{key:"verify",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.hashAndVerify(this._key,r,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return h.utils.jwkToPkix(this._key)}},{key:"encrypt",value:function(e){return h.encrypt(this._key,e)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bytes",get:function(){return l.PublicKey.encode({Type:l.KeyType.RSA,Data:this.marshal()})}}]),e}(),v=function(){function e(t,r){a(this,e),this._key=t,this._publicKey=r}return s(e,[{key:"genSecret",value:function(){return h.getRandomValues(16)}},{key:"sign",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h.hashAndSign(this._key,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(e){return h.decrypt(this._key,e)}},{key:"marshal",value:function(){return h.utils.jwkToPkcs1(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",o.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",c.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"export",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o,u,c=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:"pkcs-8",i=null,a=new p.util.ByteBuffer(this.marshal()),s=p.asn1.fromDer(a),o=p.pki.privateKeyFromAsn1(s),"pkcs-8"!==r){e.next=10;break}u={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"},i=p.pki.encryptRsaPrivateKey(o,t,u),e.next=11;break;case 10:throw f(new Error("Unknown export format '".concat(r,"'. Must be pkcs-8")),"ERR_INVALID_EXPORT_FORMAT");case 11:return e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"public",get:function(){if(!this._publicKey)throw f(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new d(this._publicKey)}},{key:"bytes",get:function(){return l.PrivateKey.encode({Type:l.KeyType.RSA,Data:this.marshal()})}}]),e}();function y(){return(y=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=h.utils.pkcs1ToJwk(t),e.next=3,h.unmarshalPrivateKey(r);case 3:return i=e.sent,e.abrupt("return",new v(i.privateKey,i.publicKey));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.unmarshalPrivateKey(t);case 2:return r=e.sent,e.abrupt("return",new v(r.privateKey,r.publicKey));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return(m=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.generateKey(t);case 2:return r=e.sent,e.abrupt("return",new v(r.privateKey,r.publicKey));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={RsaPublicKey:d,RsaPrivateKey:v,unmarshalRsaPublicKey:function(e){var t=h.utils.pkixToJwk(e);return new d(t)},unmarshalRsaPrivateKey:function(e){return y.apply(this,arguments)},generateKeyPair:function(e){return m.apply(this,arguments)},fromJwk:function(e){return b.apply(this,arguments)}}},function(e,t,r){"use strict";var n=r(2262),i=r(74),a=r(2263),s=r(2264),o=r(2265),u=[["base1","1","","1"],["base2","0",i,"01"],["base8","7",i,"01234567"],["base10","9",i,"0123456789"],["base16","f",a,"0123456789abcdef"],["base32","b",s,"abcdefghijklmnopqrstuvwxyz234567"],["base32pad","c",s,"abcdefghijklmnopqrstuvwxyz234567="],["base32hex","v",s,"0123456789abcdefghijklmnopqrstuv"],["base32hexpad","t",s,"0123456789abcdefghijklmnopqrstuv="],["base32z","h",s,"ybndrfg8ejkmcpqxot1uwisza345h769"],["base58flickr","Z",i,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base58btc","z",i,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base64","m",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",o,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],c=u.reduce((function(e,t){return e[t[0]]=new n(t[0],t[1],t[2],t[3]),e}),{}),f=u.reduce((function(e,t){return e[t[1]]=c[t[0]],e}),{});e.exports={names:c,codes:f}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(t,r,i,a){n(this,e),this.name=t,this.code=r,this.alphabet=a,i&&a&&(this.engine=i(a))}return i(e,[{key:"encode",value:function(e){return this.engine.encode(e)}},{key:"decode",value:function(e){return this.engine.decode(e)}},{key:"isImplemented",value:function(){return this.engine}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){return{encode:function(e){return"string"===typeof e?n.from(e).toString("hex"):e.toString("hex")},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base16 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"hex")}}}},function(e,t,r){"use strict";function n(e,t){var r=e.byteLength,n=new Uint8Array(e),i=t.indexOf("=")===t.length-1;i&&(t=t.substring(0,t.length-1));for(var a=0,s=0,o="",u=0;u<r;u++)for(s=s<<8|n[u],a+=8;a>=5;)o+=t[s>>>a-5&31],a-=5;if(a>0&&(o+=t[s<<5-a&31]),i)for(;o.length%8!==0;)o+="=";return o}e.exports=function(e){return{encode:function(t){return n("string"===typeof t?Uint8Array.from(t):t,e)},decode:function(t){var r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;if(e.indexOf(o)<0)throw new Error("invalid base32 character")}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return function(e,t){for(var r=(e=e.replace(new RegExp("=","g"),"")).length,n=0,i=0,a=0,s=new Uint8Array(5*r/8|0),o=0;o<r;o++)i=i<<5|t.indexOf(e[o]),(n+=5)>=8&&(s[a++]=i>>>n-8&255,n-=8);return s.buffer}(t,e)}}}},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports=function(e){var t=e.indexOf("=")>-1,r=e.indexOf("-")>-1&&e.indexOf("_")>-1;return{encode:function(e){var i="";i="string"===typeof e?n.from(e).toString("base64"):e.toString("base64"),r&&(i=i.replace(/\+/g,"-").replace(/\//g,"_"));var a=i.indexOf("=");return a>0&&!t&&(i=i.substring(0,a)),i},decode:function(t){var r=!0,i=!1,a=void 0;try{for(var s,o=t[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;if(e.indexOf(u)<0)throw new Error("invalid base64 character")}}catch(c){i=!0,a=c}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n.from(t,"base64")}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(2022),o=r(2028);function u(e){return Promise.all([s.get().subtle.exportKey("jwk",e.privateKey),s.get().subtle.exportKey("jwk",e.publicKey)])}t.utils=r(2267),t.generateKey=function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]);case 2:return r=e.sent,e.next=5,u(r);case 5:return i=e.sent,e.abrupt("return",{privateKey:i[0],publicKey:i[1]});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.unmarshalPrivateKey=function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]);case 2:return r=e.sent,e.t0=r,e.next=6,n=t,s.get().subtle.importKey("jwk",{kty:n.kty,n:n.n,e:n.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"]);case 6:return e.t1=e.sent,i=[e.t0,e.t1],e.next=10,u({privateKey:i[0],publicKey:i[1]});case 10:return a=e.sent,e.abrupt("return",{privateKey:a[0],publicKey:a[1]});case 12:case"end":return e.stop()}var n}),e)})));return function(t){return e.apply(this,arguments)}}(),t.getRandomValues=o,t.hashAndSign=function(){var e=i(n.mark((function e(t,r){var i,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);case 2:return i=e.sent,e.next=5,s.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},i,Uint8Array.from(r));case 5:return o=e.sent,e.abrupt("return",a.from(o));case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.hashAndVerify=function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);case 2:return a=e.sent,e.abrupt("return",s.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},a,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();var c=r(2268),f=c.jwk2pub,h=c.jwk2priv;function l(e,t,r,n){var i=t?f(e):h(e),s=n(a.from(r).toString("binary"),i);return a.from(s,"binary")}t.encrypt=function(e,t){return l(e,!0,t,(function(e,t){return t.encrypt(e)}))},t.decrypt=function(e,t){return l(e,!1,t,(function(e,t){return t.decrypt(e)}))}},function(e,t,r){"use strict";var n=r(3).Buffer;r(1960),r(1988);var i=r(1949),a=r(2029),s=a.bigIntegerToUintBase64url,o=a.base64urlToBigInteger;t.pkcs1ToJwk=function(e){var t=i.asn1.fromDer(e.toString("binary")),r=i.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:s(r.n),e:s(r.e),d:s(r.d),p:s(r.p),q:s(r.q),dp:s(r.dP),dq:s(r.dQ),qi:s(r.qInv),alg:"RS256",kid:"2011-04-29"}},t.jwkToPkcs1=function(e){var t=i.pki.privateKeyToAsn1({n:o(e.n),e:o(e.e),d:o(e.d),p:o(e.p),q:o(e.q),dP:o(e.dp),dQ:o(e.dq),qInv:o(e.qi)});return n.from(i.asn1.toDer(t).getBytes(),"binary")},t.pkixToJwk=function(e){var t=i.asn1.fromDer(e.toString("binary")),r=i.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:s(r.n),e:s(r.e),alg:"RS256",kid:"2011-04-29"}},t.jwkToPkix=function(e){var t=i.pki.publicKeyToAsn1({n:o(e.n),e:o(e.e)});return n.from(i.asn1.toDer(t).getBytes(),"binary")}},function(e,t,r){"use strict";var n=r(68);r(1988);var i=r(1949),a=r(2029).base64urlToBigInteger;function s(e,t){return t.map((function(t){return a(e[t])}))}e.exports={jwk2pub:function(e){var t;return(t=i.pki).setRsaPublicKey.apply(t,n(s(e,["n","e"])))},jwk2priv:function(e){var t;return(t=i.pki).setRsaPrivateKey.apply(t,n(s(e,["n","e","d","p","q","dp","dq","qi"])))}}},function(e,t,r){var n=r(1949);r(1960);var i=n.asn1;t.privateKeyValidator={name:"PrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},t.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,composed:!0,captureBitStringValue:"ed25519PublicKey"}]}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(3).Buffer,u=r(225),c=r(73),f=r(2027),h=r(15),l=r(2271),p=c(r(2023)),d=function(){function e(t){a(this,e),this._key=m(t,l.publicKeyLength)}return s(e,[{key:"verify",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.hashAndVerify(this._key,r,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return o.from(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bytes",get:function(){return p.PublicKey.encode({Type:p.KeyType.Ed25519,Data:this.marshal()})}}]),e}(),v=function(){function e(t,r){a(this,e),this._key=m(t,l.privateKeyLength),this._publicKey=m(r,l.publicKeyLength)}return s(e,[{key:"sign",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",l.hashAndSign(this._key,t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"marshal",value:function(){return o.concat([o.from(this._key),o.from(this._publicKey)])}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",u.multihashing(this.bytes,"sha2-256"));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",f.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"public",get:function(){return new d(this._publicKey)}},{key:"bytes",get:function(){return p.PrivateKey.encode({Type:p.KeyType.Ed25519,Data:this.marshal()})}}]),e}();function y(){return(y=i(n.mark((function e(){var t,r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.generateKey();case 2:return t=e.sent,r=t.privateKey,i=t.publicKey,e.abrupt("return",new v(r,i));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){return(b=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.generateKeyFromSeed(t);case 2:return r=e.sent,i=r.privateKey,a=r.publicKey,e.abrupt("return",new v(i,a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e,t){if((e=Uint8Array.from(e||[])).length!==t)throw h(new Error("Key must be a Uint8Array or Buffer of length ".concat(t,", got ").concat(e.length)),"ERR_INVALID_KEY_TYPE");return e}e.exports={Ed25519PublicKey:d,Ed25519PrivateKey:v,unmarshalEd25519PrivateKey:function(e){if(e.length>l.privateKeyLength){var t=(e=m(e,l.privateKeyLength+l.publicKeyLength)).slice(0,l.privateKeyLength),r=e.slice(l.privateKeyLength,e.length);return new v(t,r)}var n=(e=m(e,l.privateKeyLength)).slice(0,l.privateKeyLength),i=e.slice(l.publicKeyLength);return new v(n,i)},unmarshalEd25519PublicKey:function(e){return e=m(e,l.publicKeyLength),new d(e)},generateKeyPair:function(){return y.apply(this,arguments)},generateKeyPairFromSeed:function(e){return b.apply(this,arguments)}}},function(e,t,r){"use strict";var n=r(1),i=r(2);r(2074);var a=r(1949);t.publicKeyLength=a.pki.ed25519.constants.PUBLIC_KEY_BYTE_LENGTH,t.privateKeyLength=a.pki.ed25519.constants.PRIVATE_KEY_BYTE_LENGTH,t.generateKey=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.generateKeyPair());case 1:case"end":return e.stop()}}),e)}))),t.generateKeyFromSeed=function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.generateKeyPair({seed:t}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.hashAndSign=function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.sign({message:r,privateKey:t}));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),t.hashAndVerify=function(){var e=i(n.mark((function e(t,r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.pki.ed25519.verify({signature:r,message:i,publicKey:t}));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(2027),u=r(225);e.exports=function(e,t,c){c=c||r(2273)(t);var f=function(){function t(e){a(this,t),c.validatePublicKey(e),this._key=e}return s(t,[{key:"verify",value:function(e,t){return c.hashAndVerify(this._key,t,e)}},{key:"marshal",value:function(){return c.compressPublicKey(this._key)}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){return u.multihashing(this.bytes,"sha2-256")}},{key:"bytes",get:function(){return e.PublicKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()})}}]),t}(),h=function(){function t(e,r){a(this,t),this._key=e,this._publicKey=r||c.computePublicKey(e),c.validatePrivateKey(this._key),c.validatePublicKey(this._publicKey)}return s(t,[{key:"sign",value:function(e){return c.hashAndSign(this._key,e)}},{key:"marshal",value:function(){return this._key}},{key:"equals",value:function(e){return this.bytes.equals(e.bytes)}},{key:"hash",value:function(){return u.multihashing(this.bytes,"sha2-256")}},{key:"id",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.public.hash();case 2:return t=e.sent,e.abrupt("return",o.encode("base58btc",t).toString().slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"public",get:function(){return new f(this._publicKey)}},{key:"bytes",get:function(){return e.PrivateKey.encode({Type:e.KeyType.Secp256k1,Data:this.marshal()})}}]),t}();function l(){return(l=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.generateKey();case 2:return t=e.sent,e.abrupt("return",new h(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return{Secp256k1PublicKey:f,Secp256k1PrivateKey:h,unmarshalSecp256k1PrivateKey:function(e){return new h(e)},unmarshalSecp256k1PublicKey:function(e){return new f(e)},generateKeyPair:function(){return l.apply(this,arguments)}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(464).strict,o=r(465),u=r(225);function c(e){if(s(e)){var t=a.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(t=t.slice(e.byteOffset,e.byteOffset+e.byteLength)),t}return a.from(e)}e.exports=function(e){function t(){return(t=i(n.mark((function e(t,r){var i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.digest(r,"sha2-256");case 2:return i=e.sent,a=o.ecdsaSign(i,t),e.abrupt("return",c(o.signatureExport(a.signature)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function r(){return(r=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.digest(i,"sha2-256");case 2:return a=e.sent,r=c(o.signatureImport(r)),e.abrupt("return",o.ecdsaVerify(r,a,t));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a(e){if(!o.privateKeyVerify(e))throw new Error("Invalid private key")}return{generateKey:function(){var t;do{t=e(32)}while(!o.privateKeyVerify(t));return t},privateKeyLength:32,hashAndSign:function(e,r){return t.apply(this,arguments)},hashAndVerify:function(e,t,n){return r.apply(this,arguments)},compressPublicKey:function(e){if(!o.publicKeyVerify(e))throw new Error("Invalid public key");return c(o.publicKeyConvert(e,!0))},decompressPublicKey:function(e){return c(o.publicKeyConvert(e,!1))},validatePrivateKey:a,validatePublicKey:function(e){if(!o.publicKeyVerify(e))throw new Error("Invalid public key")},computePublicKey:function(e){return a(e),c(o.publicKeyCreate(e))}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(15),o=r(2068),u={"AES-128":{ivSize:16,keySize:16},"AES-256":{ivSize:16,keySize:32},Blowfish:{ivSize:8,cipherKeySize:32}};e.exports=function(){var e=i(n.mark((function e(t,r,i){var c,f,h,l,p,d,v,y,b,m,g,k,w,x,S,E,_;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=u[t]){e.next=4;break}throw f=Object.keys(u).join(" / "),s(new Error("unknown cipher type '".concat(t,"'. Must be ").concat(f)),"ERR_INVALID_CIPHER_TYPE");case 4:if(r){e.next=6;break}throw s(new Error("missing hash type"),"ERR_MISSING_HASH_TYPE");case 6:return h=c.keySize,l=c.ivSize,20,p=a.from("key expansion"),d=2*(l+h+20),e.next=13,o.create(r,i);case 13:return v=e.sent,e.next=16,v.digest(p);case 16:y=e.sent,b=[],m=0;case 19:if(!(m<d)){e.next=32;break}return e.next=22,v.digest(a.concat([y,p]));case 22:return g=e.sent,k=g.length,m+k>d&&(k=d-m),b.push(g),m+=k,e.next=29,v.digest(y);case 29:y=e.sent,e.next=19;break;case 32:return w=d/2,x=a.concat(b),S=x.slice(0,w),E=x.slice(w,d),_=function(e){return{iv:e.slice(0,l),cipherKey:e.slice(l,l+h),macKey:e.slice(l+h)}},e.abrupt("return",{k1:_(S),k2:_(E)});case 38:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2276);e.exports=function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.generateEphmeralKeyPair(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(15),o=r(3).Buffer,u=r(2022),c=r(2029),f=c.bufferToBase64url,h=c.base64urlToBuffer,l=r(2277),p={"P-256":256,"P-384":384,"P-521":521};t.generateEphmeralKeyPair=function(){var e=a(i.mark((function e(t){var r,n,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l(Object.keys(p),t),e.next=3,u.get().subtle.generateKey({name:"ECDH",namedCurve:t},!0,["deriveBits"]);case 3:return r=e.sent,n=function(){var e=a(i.mark((function e(n,a){var s,c;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}return e.next=3,u.get().subtle.importKey("jwk",b(t,a),{name:"ECDH",namedCurve:t},!1,["deriveBits"]);case 3:s=e.sent,e.next=7;break;case 6:s=r.privateKey;case 7:return e.next=9,u.get().subtle.importKey("jwk",y(t,n),{name:"ECDH",namedCurve:t},!1,[]);case 9:return e.t0=e.sent,e.t1=s,c=[e.t0,e.t1],e.t2=o,e.next=15,u.get().subtle.deriveBits({name:"ECDH",namedCurve:t,public:c[0]},c[1],p[t]);case 15:return e.t3=e.sent,e.abrupt("return",e.t2.from.call(e.t2,e.t3));case 17:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.next=7,u.get().subtle.exportKey("jwk",r.publicKey);case 7:return s=e.sent,e.abrupt("return",{key:v(s),genSharedKey:n});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var d={"P-256":32,"P-384":48,"P-521":66};function v(e){var t=d[e.crv];return o.concat([o.from([4]),h(e.x,t),h(e.y,t)],1+2*t)}function y(e,t){var r=d[e];if(!t.slice(0,1).equals(o.from([4])))throw s(new Error("Cannot unmarshal public key - invalid key format"),"ERR_INVALID_KEY_FORMAT");return{kty:"EC",crv:e,x:f(t.slice(1,r+1),r),y:f(t.slice(1+r),r),ext:!0}}var b=function(e,t){return n({},y(e,t.public),{d:f(t.private)})}},function(e,t,r){"use strict";var n=r(15);e.exports=function(e,t){if(!e.includes(t)){var r=e.join(" / ");throw n(new Error("Unknown curve: ".concat(t,". Must be ").concat(r)),"ERR_INVALID_CURVE")}}},function(e,t,r){"use strict";var n=r(2072),i=r(1951),a=r(15),s={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};e.exports=function(e,t,r,o,u){var c=s[u];if(!c){var f=Object.keys(s).join(" / ");throw a(new Error("Hash '".concat(u,"' is unknown or not supported. Must be ").concat(f)),"ERR_UNSUPPORTED_HASH_TYPE")}var h=n(e,t,r,o,c);return i.encode64(h)}},function(e,t,r){"use strict";(function(t){var n=r(1),i=r(2),a=r(5),s=r(7);r(2280),r(2071);var o=r(1949),u=r(2285),c=u.certificateForKey,f=u.findAsync,h=r(15),l=function(){function e(t){if(a(this,e),!t)throw h(new Error("keychain is required"),"ERR_KEYCHAIN_REQUIRED");this.keychain=t}return s(e,[{key:"encrypt",value:function(){var e=i(n.mark((function e(r,i){var a,s,u,f,l,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isBuffer(i)){e.next=2;break}throw h(new Error("Plain data must be a Buffer"),"ERR_INVALID_PARAMS");case 2:return e.next=4,this.keychain.findKeyByName(r);case 4:return a=e.sent,e.next=7,this.keychain._getPrivateKey(r);case 7:return s=e.sent,u=o.pki.decryptRsaPrivateKey(s,this.keychain._()),e.next=11,c(a,u);case 11:return f=e.sent,(l=o.pkcs7.createEnvelopedData()).addRecipient(f),l.content=o.util.createBuffer(i),l.encrypt(),p=o.asn1.toDer(l.toAsn1()).getBytes(),e.abrupt("return",t.from(p,"binary"));case 18:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=i(n.mark((function e(r){var a,s,u,c,l,p,d,v,y,b=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.isBuffer(r)){e.next=2;break}throw h(new Error("CMS data is required"),"ERR_INVALID_PARAMS");case 2:e.prev=2,s=o.util.createBuffer(r.toString("binary")),u=o.asn1.fromDer(s),a=o.pkcs7.messageFromAsn1(u),e.next=11;break;case 8:throw e.prev=8,e.t0=e.catch(2),h(new Error("Invalid CMS: "+e.t0.message),"ERR_INVALID_CMS");case 11:return c=a.recipients.filter((function(e){return e.issuer.find((function(e){return"O"===e.shortName&&"ipfs"===e.value}))})).filter((function(e){return e.issuer.find((function(e){return"CN"===e.shortName}))})).map((function(e){return{recipient:e,keyId:e.issuer.find((function(e){return"CN"===e.shortName})).value}})),e.next=14,f(c,function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.keychain.findKeyById(t.keyId);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return",!0);case 6:e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",!1);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}());case 14:if(l=e.sent){e.next=18;break}throw p=c.map((function(e){return e.keyId})),h(new Error("Decryption needs one of the key(s): "+p.join(", ")),"ERR_MISSING_KEYS",{missingKeys:p});case 18:return e.next=20,this.keychain.findKeyById(l.keyId);case 20:return d=e.sent,e.next=23,this.keychain._getPrivateKey(d.name);case 23:return v=e.sent,y=o.pki.decryptRsaPrivateKey(v,this.keychain._()),a.decrypt(l.recipient,y),e.abrupt("return",t.from(a.content.getBytes(),"binary"));case 27:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports=l}).call(this,r(3).Buffer)},function(e,t,r){var n=r(1949);r(1977),r(1960),r(2024),r(1978),r(2026),r(2281),r(1963),r(1951),r(2075);var i=n.asn1,a=e.exports=n.pkcs7=n.pkcs7||{};function s(e){var t={},r=[];if(!i.validate(e,a.asn1.recipientInfoValidator,t,r)){var s=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw s.errors=r,s}return{version:t.version.charCodeAt(0),issuer:n.pki.RDNAttributesAsArray(t.issuer),serialNumber:n.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:i.derToOid(t.encAlgorithm),parameter:t.encParameter.value,content:t.encKey}}}function o(e){for(var t,r=[],a=0;a<e.length;++a)r.push((t=e[a],i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:t.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(t.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.encryptedContent.algorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.encryptedContent.content)])));return r}function u(e){var t=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[n.pki.distinguishedNameToAsn1({attributes:e.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,n.util.hexToBytes(e.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.digestAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.signatureAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])),t.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var r=i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[]),a=0;a<e.unauthenticatedAttributes.length;++a){var s=e.unauthenticatedAttributes[a];r.values.push(c(s))}t.value.push(r)}return t}function c(e){var t;if(e.type===n.pki.oids.contentType)t=i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.value).getBytes());else if(e.type===n.pki.oids.messageDigest)t=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===n.pki.oids.signingTime){var r=new Date("1950-01-01T00:00:00Z"),a=new Date("2050-01-01T00:00:00Z"),s=e.value;if("string"===typeof s){var o=Date.parse(s);s=isNaN(o)?13===s.length?i.utcTimeToDate(s):i.generalizedTimeToDate(s):new Date(o)}t=s>=r&&s<a?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(s)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(s))}return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[t])])}function f(e,t,r){var a={};if(!i.validate(t,r,a,[])){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw s.errors=s,s}if(i.derToOid(a.contentType)!==n.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(a.encryptedContent){var o="";if(n.util.isArray(a.encryptedContent))for(var u=0;u<a.encryptedContent.length;++u){if(a.encryptedContent[u].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");o+=a.encryptedContent[u].value}else o=a.encryptedContent;e.encryptedContent={algorithm:i.derToOid(a.encAlgorithm),parameter:n.util.createBuffer(a.encParameter.value),content:n.util.createBuffer(o)}}if(a.content){o="";if(n.util.isArray(a.content))for(u=0;u<a.content.length;++u){if(a.content[u].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");o+=a.content[u].value}else o=a.content;e.content=n.util.createBuffer(o)}return e.version=a.version.charCodeAt(0),e.rawCapture=a,a}function h(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case n.pki.oids["aes128-CBC"]:case n.pki.oids["aes192-CBC"]:case n.pki.oids["aes256-CBC"]:t=n.aes.createDecryptionCipher(e.encryptedContent.key);break;case n.pki.oids.desCBC:case n.pki.oids["des-EDE3-CBC"]:t=n.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}a.messageFromPem=function(e){var t=n.pem.decode(e)[0];if("PKCS7"!==t.type){var r=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw r.headerType=t.type,r}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var s=i.fromDer(t.body);return a.messageFromAsn1(s)},a.messageToPem=function(e,t){var r={type:"PKCS7",body:i.toDer(e.toAsn1()).getBytes()};return n.pem.encode(r,{maxline:t})},a.messageFromAsn1=function(e){var t={},r=[];if(!i.validate(e,a.asn1.contentInfoValidator,t,r)){var s=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw s.errors=r,s}var o,u=i.derToOid(t.contentType);switch(u){case n.pki.oids.envelopedData:o=a.createEnvelopedData();break;case n.pki.oids.encryptedData:o=a.createEncryptedData();break;case n.pki.oids.signedData:o=a.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+u+" is not (yet) supported.")}return o.fromAsn1(t.content.value[0]),o},a.createSignedData=function(){var e=null;return e={type:n.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(f(e,t,a.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var r=e.rawCapture.certificates.value,i=0;i<r.length;++i)e.certificates.push(n.pki.certificateFromAsn1(r[i]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],r=0;r<e.certificates.length;++r)t.push(n.pki.certificateToAsn1(e.certificates[r]));var a=[],s=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&s.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,t)),a.length>0&&s.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,a)),s.value[0].value.push(i.create(i.Class.UNIVERSAL,i.Type.SET,!0,e.signerInfos)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),s])},addSigner:function(t){var r=t.issuer,i=t.serialNumber;if(t.certificate){var a=t.certificate;"string"===typeof a&&(a=n.pki.certificateFromPem(a)),r=a.issuer.attributes,i=a.serialNumber}var s=t.key;if(!s)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"===typeof s&&(s=n.pki.privateKeyFromPem(s));var o=t.digestAlgorithm||n.pki.oids.sha1;switch(o){case n.pki.oids.sha1:case n.pki.oids.sha256:case n.pki.oids.sha384:case n.pki.oids.sha512:case n.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+o)}var u=t.authenticatedAttributes||[];if(u.length>0){for(var c=!1,f=!1,h=0;h<u.length;++h){var l=u[h];if(c||l.type!==n.pki.oids.contentType){if(f||l.type!==n.pki.oids.messageDigest);else if(f=!0,c)break}else if(c=!0,f)break}if(!c||!f)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:s,version:1,issuer:r,serialNumber:i,digestAlgorithm:o,signatureAlgorithm:n.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:u,unauthenticatedAttributes:[]})},sign:function(t){var r;(t=t||{},"object"!==typeof e.content||null===e.contentInfo)&&(e.contentInfo=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(n.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof n.util.ByteBuffer?r=e.content.bytes():"string"===typeof e.content&&(r=n.util.encodeUtf8(e.content)),t.detached?e.detachedContent=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r):e.contentInfo.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,r)]))));0!==e.signers.length&&function(t){var r;r=e.detachedContent?e.detachedContent:(r=e.contentInfo.value[1]).value[0];if(!r)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var a=i.derToOid(e.contentInfo.value[0].value),s=i.toDer(r);for(var o in s.getByte(),i.getBerValueLength(s),s=s.getBytes(),t)t[o].start().update(s);for(var f=new Date,h=0;h<e.signers.length;++h){var l=e.signers[h];if(0===l.authenticatedAttributes.length){if(a!==n.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{l.authenticatedAttributesAsn1=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var p=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[]),d=0;d<l.authenticatedAttributes.length;++d){var v=l.authenticatedAttributes[d];v.type===n.pki.oids.messageDigest?v.value=t[l.digestAlgorithm].digest():v.type===n.pki.oids.signingTime&&(v.value||(v.value=f)),p.value.push(c(v)),l.authenticatedAttributesAsn1.value.push(c(v))}s=i.toDer(p).getBytes(),l.md.start().update(s)}l.signature=l.key.sign(l.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=function(e){for(var t=[],r=0;r<e.length;++r)t.push(u(e[r]));return t}(e.signers)}(function(){for(var t={},r=0;r<e.signers.length;++r){var a=e.signers[r];(s=a.digestAlgorithm)in t||(t[s]=n.md[n.pki.oids[s]].create()),0===a.authenticatedAttributes.length?a.md=t[s]:a.md=n.md[n.pki.oids[s]].create()}for(var s in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(s).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]));return t}())},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"===typeof t&&(t=n.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}}},a.createEncryptedData=function(){var e=null;return e={type:n.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){f(e,t,a.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),h(e)}}},a.createEnvelopedData=function(){var e=null;return e={type:n.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:n.pki.oids["aes256-CBC"]},fromAsn1:function(t){var r=f(e,t,a.asn1.envelopedDataValidator);e.recipients=function(e){for(var t=[],r=0;r<e.length;++r)t.push(s(e[r]));return t}(r.recipientInfos.value)},toAsn1:function(){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,o(e.recipients)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,(t=e.encryptedContent,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(n.pki.oids.data).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.algorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.parameter.getBytes())]),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.content.getBytes())])]))])])]);var t},findRecipient:function(t){for(var r=t.issuer.attributes,n=0;n<e.recipients.length;++n){var i=e.recipients[n],a=i.issuer;if(i.serialNumber===t.serialNumber&&a.length===r.length){for(var s=!0,o=0;o<r.length;++o)if(a[o].type!==r[o].type||a[o].value!==r[o].value){s=!1;break}if(s)return i}}return null},decrypt:function(t,r){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==r)switch(t.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:case n.pki.oids.desCBC:var i=r.decrypt(t.encryptedContent.content);e.encryptedContent.key=n.util.createBuffer(i);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}h(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:n.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,r){if(void 0===e.encryptedContent.content){var i,a,s;switch(r=r||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,r){case n.pki.oids["aes128-CBC"]:i=16,a=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["aes192-CBC"]:i=24,a=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["aes256-CBC"]:i=32,a=16,s=n.aes.createEncryptionCipher;break;case n.pki.oids["des-EDE3-CBC"]:i=24,a=8,s=n.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+r)}if(void 0===t)t=n.util.createBuffer(n.random.getBytes(i));else if(t.length()!=i)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+i+".");e.encryptedContent.algorithm=r,e.encryptedContent.key=t,e.encryptedContent.parameter=n.util.createBuffer(n.random.getBytes(a));var o=s(t);if(o.start(e.encryptedContent.parameter.copy()),o.update(e.content),!o.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=o.output}for(var u=0;u<e.recipients.length;++u){var c=e.recipients[u];if(void 0===c.encryptedContent.content)switch(c.encryptedContent.algorithm){case n.pki.oids.rsaEncryption:c.encryptedContent.content=c.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+c.encryptedContent.algorithm)}}}}}},function(e,t,r){var n=r(1949);r(1960),r(1951);var i=n.asn1,a=e.exports=n.pkcs7asn1=n.pkcs7asn1||{};n.pkcs7=n.pkcs7||{},n.pkcs7.asn1=a;var s={name:"ContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};a.contentInfoValidator=s;var o={name:"EncryptedContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};a.envelopedDataValidator={name:"EnvelopedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(o)},a.encryptedDataValidator={name:"EncryptedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"}].concat(o)};var u={name:"SignerInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};a.signedDataValidator={name:"SignedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},s,{name:"SignedData.Certificates",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,capture:"signerInfos",optional:!0,value:[u]}]},a.recipientInfoValidator={name:"RecipientInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter"}]},{name:"RecipientInfo.encryptedKey",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},function(e,t,r){var n=r(1949);r(2283),e.exports=n.mgf=n.mgf||{},n.mgf.mgf1=n.mgf1},function(e,t,r){var n=r(1949);r(1951),n.mgf=n.mgf||{},(e.exports=n.mgf.mgf1=n.mgf1=n.mgf1||{}).create=function(e){return{generate:function(t,r){for(var i=new n.util.ByteBuffer,a=Math.ceil(r/e.digestLength),s=0;s<a;s++){var o=new n.util.ByteBuffer;o.putInt32(s),e.start(),e.update(t+o.getBytes()),i.putBuffer(e.digest())}return i.truncate(i.length()-r),i.getBytes()}}}},function(e,t,r){var n=r(1949);r(1963),r(1951),(e.exports=n.pss=n.pss||{}).create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,r=e.md,i=e.mgf,a=r.digestLength,s=e.salt||null;if("string"===typeof s&&(s=n.util.createBuffer(s)),"saltLength"in e)t=e.saltLength;else{if(null===s)throw new Error("Salt length not specified or specific salt not given.");t=s.length()}if(null!==s&&s.length()!==t)throw new Error("Given salt length does not match length of given salt.");var o=e.prng||n.random,u={encode:function(e,u){var c,f,h=u-1,l=Math.ceil(h/8),p=e.digest().getBytes();if(l<a+t+2)throw new Error("Message is too long to encrypt.");f=null===s?o.getBytesSync(t):s.bytes();var d=new n.util.ByteBuffer;d.fillWithByte(0,8),d.putBytes(p),d.putBytes(f),r.start(),r.update(d.getBytes());var v=r.digest().getBytes(),y=new n.util.ByteBuffer;y.fillWithByte(0,l-t-a-2),y.putByte(1),y.putBytes(f);var b=y.getBytes(),m=l-a-1,g=i.generate(v,m),k="";for(c=0;c<m;c++)k+=String.fromCharCode(b.charCodeAt(c)^g.charCodeAt(c));var w=65280>>8*l-h&255;return(k=String.fromCharCode(k.charCodeAt(0)&~w)+k.substr(1))+v+String.fromCharCode(188)},verify:function(e,s,o){var u,c=o-1,f=Math.ceil(c/8);if(s=s.substr(-f),f<a+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==s.charCodeAt(f-1))throw new Error("Encoded message does not end in 0xBC.");var h=f-a-1,l=s.substr(0,h),p=s.substr(h,a),d=65280>>8*f-c&255;if(0!==(l.charCodeAt(0)&d))throw new Error("Bits beyond keysize not zero as expected.");var v=i.generate(p,h),y="";for(u=0;u<h;u++)y+=String.fromCharCode(l.charCodeAt(u)^v.charCodeAt(u));y=String.fromCharCode(y.charCodeAt(0)&~d)+y.substr(1);var b=f-a-t-2;for(u=0;u<b;u++)if(0!==y.charCodeAt(u))throw new Error("Leftmost octets not zero as expected");if(1!==y.charCodeAt(b))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var m=y.substr(-t),g=new n.util.ByteBuffer;return g.fillWithByte(0,8),g.putBytes(e),g.putBytes(m),r.start(),r.update(g.getBytes()),p===r.digest().getBytes()}};return u}},function(e,t,r){"use strict";var n=r(1),i=r(2);r(2075);var a=r(1949).pki;function s(){return(s=i(n.mark((function e(t,r){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.map(r),e.next=3,Promise.all(i);case 3:return a=e.sent,s=a.findIndex((function(e){return e})),e.abrupt("return",t[s]);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports.certificateForKey=function(e,t){var r=a.setRsaPublicKey(t.n,t.e),n=a.createCertificate();n.publicKey=r,n.serialNumber="01",n.validity.notBefore=new Date,n.validity.notAfter=new Date,n.validity.notAfter.setFullYear(n.validity.notBefore.getFullYear()+10);var i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:e.id}];return n.setSubject(i),n.setIssuer(i),n.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),n.sign(t),n},e.exports.findAsync=function(e,t){return s.apply(this,arguments)}},function(e,t,r){"use strict";var n=r(68),i=r(5),a=r(7),s=r(103),o=r(78),u=r(2030).tap,c=r(2287),f=r(2019).METRICS,h=r(2288),l=["dataReceived","dataSent"],p={in:"dataReceived",out:"dataSent"},d=function(){function e(t){var r=this;i(this,e),this._options=s(f,t),this._globalStats=new h(l,this._options),this._peerStats=new Map,this._protocolStats=new Map,this._oldPeers=c(this._options.maxOldPeersRetention),this._running=!1,this._onMessage=this._onMessage.bind(this),this._connectionManager=t.connectionManager,this._connectionManager.on("peer:disconnect",(function(e){r.onPeerDisconnected(e.remotePeer)}))}return a(e,[{key:"start",value:function(){this._running=!0}},{key:"stop",value:function(){this._running=!1,this._globalStats.stop();var e=!0,t=!1,r=void 0;try{for(var n,i=this._peerStats.values()[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.stop()}}catch(f){t=!0,r=f}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}var a=!0,s=!1,o=void 0;try{for(var u,c=this._protocolStats.values()[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){u.value.stop()}}catch(f){s=!0,o=f}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}}},{key:"forPeer",value:function(e){var t=e.toB58String();return this._peerStats.get(t)||this._oldPeers.get(t)}},{key:"forProtocol",value:function(e){return this._protocolStats.get(e)}},{key:"onPeerDisconnected",value:function(e){var t=e.toB58String(),r=this._peerStats.get(t);r&&(r.stop(),this._peerStats.delete(t),this._oldPeers.set(t,r))}},{key:"_onMessage",value:function(e){var t=e.remotePeer,r=e.protocol,n=e.direction,i=e.dataLength;if(this._running){var a=p[n],s=this.forPeer(t);if(s||(s=new h(l,this._options),this._peerStats.set(t.toB58String(),s)),s.push(a,i),this._globalStats.push(a,i),r){var o=this.forProtocol(r);o||(o=new h(l,this._options),this._protocolStats.set(r,o)),o.push(a,i)}}}},{key:"updatePlaceholder",value:function(t,r){if(this._running){var n=this.forPeer(t),i=r.toB58String(),a=this.forPeer(r),s=n;a&&(s=e.mergeStats(a,s),this._oldPeers.delete(i)),this._peerStats.delete(t.toB58String()),this._peerStats.set(i,s),s.start()}}},{key:"trackStream",value:function(e){var t=e.stream,r=e.remotePeer,n=e.protocol,i=this,a=t.source;t.source=u((function(e){return i._onMessage({remotePeer:r,protocol:n,direction:"in",dataLength:e.length})}))(a);var s=t.sink;return t.sink=function(e){return o(e,u((function(e){return i._onMessage({remotePeer:r,protocol:n,direction:"out",dataLength:e.length})})),s)},t}},{key:"global",get:function(){return this._globalStats}},{key:"peers",get:function(){return Array.from(this._peerStats.keys())}},{key:"protocols",get:function(){return Array.from(this._protocolStats.keys())}}],[{key:"mergeStats",value:function(e,t){return e.stop(),t.stop(),e._queue=[].concat(n(e._queue),n(t._queue)),e}}]),e}();e.exports=d},function(e,t,r){"use strict";var n=r(331);e.exports=function(e){var t=n(e);return t.delete=t.remove,t}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(87),u=r(29),c=r(41),f=r(139),h=r(470),l=r(341),p=function(e){function t(e,r){var i;n(this,t),(i=a(this,s(t).call(this)))._options=r,i._queue=[],i._stats={},i._frequencyLastTime=Date.now(),i._frequencyAccumulators={},i._movingAverages={},i._update=i._update.bind(o(i));for(var u=i._options.movingAverageIntervals,c=0;c<e.length;c++){var l=e[c];i._stats[l]=f(0),i._movingAverages[l]={};for(var p=0;p<u.length;p++){var d=u[p];(i._movingAverages[l][d]=h(d)).push(i._frequencyLastTime,0)}}return i}return u(t,e),i(t,[{key:"start",value:function(){this._queue.length&&this._resetComputeTimeout()}},{key:"stop",value:function(){this._timeout&&(this._timeout.clear(),this._timeout=null)}},{key:"toJSON",value:function(){for(var e=this.snapshot,t=this.movingAverages,r={dataReceived:e.dataReceived.toString(),dataSent:e.dataSent.toString(),movingAverages:{}},n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];r.movingAverages[a]={};for(var s=0,o=Object.keys(t[a]);s<o.length;s++){var u=o[s];r.movingAverages[a][u]=t[a][u].movingAverage()}}return r}},{key:"push",value:function(e,t){this._queue.push([e,t,Date.now()]),this._resetComputeTimeout()}},{key:"_resetComputeTimeout",value:function(){this._timeout=l(this._update,this._nextTimeout())}},{key:"_nextTimeout",value:function(){var e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}},{key:"_update",value:function(){if(this._timeout=null,this._queue.length){var e,t=!0,r=!1,n=void 0;try{for(var i,a=this._queue[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)e=i.value,this._applyOp(e)}catch(s){r=!0,n=s}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}this._queue=[],this._updateFrequency(e[2]),this.emit("update",this._stats)}}},{key:"_updateFrequency",value:function(e){var t=this,r=e-this._frequencyLastTime;Object.keys(this._stats).forEach((function(n){t._updateFrequencyFor(n,r,e)})),this._frequencyLastTime=e}},{key:"_updateFrequencyFor",value:function(e,t,r){var n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;var i=n/(t||1)*1e3,a=this._movingAverages[e];a||(a=this._movingAverages[e]={});for(var s=this._options.movingAverageIntervals,o=0;o<s.length;o++){var u=s[o],c=a[u];c||(c=a[u]=h(u)),c.push(r,i)}}},{key:"_applyOp",value:function(e){var t,r=e[0],n=e[1];if("number"!==typeof n)throw new Error("invalid increment number:",n);t=Object.prototype.hasOwnProperty.call(this._stats,r)?this._stats[r]:this._stats[r]=f(0),this._stats[r]=t.plus(n),this._frequencyAccumulators[r]||(this._frequencyAccumulators[r]=0),this._frequencyAccumulators[r]+=n}},{key:"snapshot",get:function(){return Object.assign({},this._stats)}},{key:"movingAverages",get:function(){return Object.assign({},this._movingAverages)}}]),t}(c);e.exports=p},function(e,t,r){"use strict";var n=r(46),i=r(1),a=r(2),s=r(5),o=r(7),u=r(19),c=u("libp2p:upgrader");c.error=u("libp2p:upgrader:error");var f=r(803),h=r(2290).Connection,l=r(55),p=r(78),d=r(15),v=r(804),y=r(1954).codes,b=function(){function e(t){var r=t.localPeer,n=t.metrics,i=t.cryptos,a=t.muxers,o=t.onConnectionEnd,u=void 0===o?function(){}:o,c=t.onConnection,f=void 0===c?function(){}:c;s(this,e),this.localPeer=r,this.metrics=n,this.cryptos=i||new Map,this.muxers=a||new Map,this.protector=null,this.protocols=new Map,this.onConnection=f,this.onConnectionEnd=u}return o(e,[{key:"upgradeInbound",value:function(){var e=a(i.mark((function e(t){var r,n,a,s,o,u,f,h,l,p,d,y;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.metrics&&(h=v(),u=h.setTarget,f=h.proxy,l=parseInt(1e9*Math.random()).toString(36)+Date.now(),u({toB58String:function(){return l}}),t=this.metrics.trackStream({stream:t,remotePeer:f})),c("Starting the inbound connection upgrade"),p=t,!this.protector){e.next=7;break}return e.next=6,this.protector.protect(t);case 6:p=e.sent;case 7:return e.prev=7,e.next=10,this._encryptInbound(this.localPeer,p,this.cryptos);case 10:if(d=e.sent,r=d.conn,n=d.remotePeer,o=d.protocol,!this.muxers.size){e.next=22;break}return e.next=17,this._multiplexInbound(r,this.muxers);case 17:y=e.sent,a=y.stream,s=y.Muxer,e.next=23;break;case 22:a=r;case 23:e.next=31;break;case 25:return e.prev=25,e.t0=e.catch(7),c.error("Failed to upgrade inbound connection",e.t0),e.next=30,t.close(e.t0);case 30:throw e.t0;case 31:return this.metrics&&(this.metrics.updatePlaceholder(f,n),u(n)),c("Successfully upgraded inbound connection"),e.abrupt("return",this._createConnection({cryptoProtocol:o,direction:"inbound",maConn:t,upgradedConn:a,Muxer:s,remotePeer:n}));case 34:case"end":return e.stop()}}),e,this,[[7,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"upgradeOutbound",value:function(){var e=a(i.mark((function e(t){var r,n,a,s,o,u,f,h,p,d,y,b,m;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{r=l.createFromB58String(t.remoteAddr.getPeerId())}catch(i){c.error("multiaddr did not contain a valid peer id",i)}if(this.metrics&&(p=v(),f=p.setTarget,h=p.proxy,d=parseInt(1e9*Math.random()).toString(36)+Date.now(),f({toB58String:function(){return d}}),t=this.metrics.trackStream({stream:t,remotePeer:h})),c("Starting the outbound connection upgrade"),y=t,!this.protector){e.next=8;break}return e.next=7,this.protector.protect(t);case 7:y=e.sent;case 8:return e.prev=8,e.next=11,this._encryptOutbound(this.localPeer,y,r,this.cryptos);case 11:if(b=e.sent,n=b.conn,a=b.remotePeer,o=b.protocol,!this.muxers.size){e.next=23;break}return e.next=18,this._multiplexOutbound(n,this.muxers);case 18:m=e.sent,s=m.stream,u=m.Muxer,e.next=24;break;case 23:s=n;case 24:e.next=32;break;case 26:return e.prev=26,e.t0=e.catch(8),c.error("Failed to upgrade outbound connection",e.t0),e.next=31,t.close(e.t0);case 31:throw e.t0;case 32:return this.metrics&&(this.metrics.updatePlaceholder(h,a),f(a)),c("Successfully upgraded outbound connection"),e.abrupt("return",this._createConnection({cryptoProtocol:o,direction:"outbound",maConn:t,upgradedConn:s,Muxer:u,remotePeer:a}));case 35:case"end":return e.stop()}}),e,this,[[8,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_createConnection",value:function(e){var t,r,s,o=this,u=e.cryptoProtocol,l=e.direction,v=e.maConn,b=e.upgradedConn,m=e.Muxer,g=e.remotePeer;m&&(t=new m({onStream:function(){var e=a(i.mark((function e(t){var r,a,u,h;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new f.Listener(t),e.prev=1,e.next=4,r.handle(Array.from(o.protocols.keys()));case 4:a=e.sent,u=a.stream,h=a.protocol,c("%s: incoming stream opened on %s",l,h),o.metrics&&o.metrics.trackStream({stream:u,remotePeer:g,protocol:h}),s.addStream(t,{protocol:h}),o._onStream({connection:s,stream:n({},t,{},u),protocol:h}),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),c.error(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,13]])})));return function(t){return e.apply(this,arguments)}}(),onStreamEnd:function(e){s.removeStream(e.id)}}),r=function(){var e=a(i.mark((function e(r){var a,s,u,h,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c("%s: starting new stream on %s",l,r),a=t.newStream(),s=new f.Dialer(a),e.prev=3,e.next=6,s.select(r);case 6:return u=e.sent,h=u.stream,p=u.protocol,o.metrics&&o.metrics.trackStream({stream:h,remotePeer:g,protocol:p}),e.abrupt("return",{stream:n({},a,{},h),protocol:p});case 13:throw e.prev=13,e.t0=e.catch(3),c.error("could not create new stream",e.t0),d(e.t0,y.ERR_UNSUPPORTED_PROTOCOL);case 17:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t){return e.apply(this,arguments)}}(),p(b,t,b).catch(c.error));var k=v.timeline;v.timeline=new Proxy(k,{set:function(){return s&&"close"===(arguments.length<=1?void 0:arguments[1])&&(arguments.length<=2?void 0:arguments[2])&&!k.close&&(s.stat.status="closed",o.onConnectionEnd(s)),Reflect.set.apply(Reflect,arguments)}}),v.timeline.upgraded=Date.now();var w=function(){throw d(new Error("connection is not multiplexed"),"ERR_CONNECTION_NOT_MULTIPLEXED")};return s=new h({localAddr:v.localAddr,remoteAddr:v.remoteAddr,localPeer:this.localPeer,remotePeer:g,stat:{direction:l,timeline:v.timeline,multiplexer:m&&m.multicodec,encryption:u},newStream:r||w,getStreams:function(){return t?t.streams:w},close:function(e){return v.close(e)}}),this.onConnection(s),s}},{key:"_onStream",value:function(e){var t=e.connection,r=e.stream,n=e.protocol;this.protocols.get(n)({connection:t,stream:r,protocol:n})}},{key:"_encryptInbound",value:function(){var e=a(i.mark((function e(t,r,a){var s,o,u,h,l,p;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new f.Listener(r),o=Array.from(a.keys()),c("handling inbound crypto protocol selection",o),e.prev=3,e.next=6,s.handle(o);case 6:return u=e.sent,h=u.stream,l=u.protocol,p=a.get(l),c("encrypting inbound connection..."),e.t0=n,e.t1={},e.next=15,p.secureInbound(t,h);case 15:return e.t2=e.sent,e.t3={protocol:l},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 20:throw e.prev=20,e.t4=e.catch(3),d(e.t4,y.ERR_ENCRYPTION_FAILED);case 23:case"end":return e.stop()}}),e,null,[[3,20]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_encryptOutbound",value:function(){var e=a(i.mark((function e(t,r,a,s){var o,u,h,l,p,v;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new f.Dialer(r),u=Array.from(s.keys()),c("selecting outbound crypto protocol",u),e.prev=3,e.next=6,o.select(u);case 6:return h=e.sent,l=h.stream,p=h.protocol,v=s.get(p),c("encrypting outbound connection to %j",a),e.t0=n,e.t1={},e.next=15,v.secureOutbound(t,l,a);case 15:return e.t2=e.sent,e.t3={protocol:p},e.abrupt("return",(0,e.t0)(e.t1,e.t2,e.t3));case 20:throw e.prev=20,e.t4=e.catch(3),d(e.t4,y.ERR_ENCRYPTION_FAILED);case 23:case"end":return e.stop()}}),e,null,[[3,20]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_multiplexOutbound",value:function(){var e=a(i.mark((function e(t,r){var n,a,s,o,u,h;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.Dialer(t),a=Array.from(r.keys()),c("outbound selecting muxer %s",a),e.prev=3,e.next=6,n.select(a);case 6:return s=e.sent,o=s.stream,u=s.protocol,c("%s selected as muxer protocol",u),h=r.get(u),e.abrupt("return",{stream:o,Muxer:h});case 14:throw e.prev=14,e.t0=e.catch(3),d(e.t0,y.ERR_MUXER_UNAVAILABLE);case 17:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_multiplexInbound",value:function(){var e=a(i.mark((function e(t,r){var n,a,s,o,u,h;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new f.Listener(t),a=Array.from(r.keys()),c("inbound handling muxers %s",a),e.prev=3,e.next=6,n.handle(a);case 6:return s=e.sent,o=s.stream,u=s.protocol,h=r.get(u),e.abrupt("return",{stream:o,Muxer:h});case 13:throw e.prev=13,e.t0=e.catch(3),d(e.t0,y.ERR_MUXER_UNAVAILABLE);case 16:case"end":return e.stop()}}),e,null,[[3,13]])})));return function(t,r){return e.apply(this,arguments)}}()}]),e}();e.exports=b},function(e,t,r){"use strict";t.Connection=r(2291)},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(46),s=r(5),o=r(7),u=r(55),c=r(72),f=r(63),h=r(15),l=r(2292);var p=function(){function e(t){var r=t.localAddr,n=t.remoteAddr,i=t.localPeer,o=t.remotePeer,f=t.newStream,p=t.close,d=t.getStreams,v=t.stat;s(this,e),function(e,t,r,n,i,a,s){if(e&&!c.isMultiaddr(e))throw h(new Error("localAddr must be an instance of multiaddr"),"ERR_INVALID_PARAMETERS");if(!u.isPeerId(t))throw h(new Error("localPeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if(!u.isPeerId(r))throw h(new Error("remotePeer must be an instance of peer-id"),"ERR_INVALID_PARAMETERS");if("function"!==typeof n)throw h(new Error("new stream must be a function"),"ERR_INVALID_PARAMETERS");if("function"!==typeof i)throw h(new Error("close must be a function"),"ERR_INVALID_PARAMETERS");if("function"!==typeof a)throw h(new Error("getStreams must be a function"),"ERR_INVALID_PARAMETERS");if(!s)throw h(new Error("connection metadata object must be provided"),"ERR_INVALID_PARAMETERS");if("inbound"!==s.direction&&"outbound"!==s.direction)throw h(new Error('direction must be "inbound" or "outbound"'),"ERR_INVALID_PARAMETERS");if(!s.timeline)throw h(new Error("connection timeline object must be provided in the stat object"),"ERR_INVALID_PARAMETERS");if(!s.timeline.open)throw h(new Error("connection open timestamp must be provided"),"ERR_INVALID_PARAMETERS");if(!s.timeline.upgraded)throw h(new Error("connection upgraded timestamp must be provided"),"ERR_INVALID_PARAMETERS")}(r,i,o,f,p,d,v),this.id=parseInt(1e9*Math.random()).toString(36)+Date.now(),this.localAddr=r,this.remoteAddr=n,this.localPeer=i,this.remotePeer=o,this._stat=a({},v,{status:l.OPEN}),this._newStream=f,this._close=p,this._getStreams=d,this.registry=new Map,this.tags=[]}return o(e,[{key:"newStream",value:function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stat.status!==l.CLOSING){e.next=2;break}throw h(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");case 2:if(this.stat.status!==l.CLOSED){e.next=4;break}throw h(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");case 4:return Array.isArray(t)||(t=[t]),e.next=7,this._newStream(t);case 7:return r=e.sent,i=r.stream,a=r.protocol,this.addStream(i,{protocol:a}),e.abrupt("return",{stream:i,protocol:a});case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addStream",value:function(e,t){var r=t.protocol,n=t.metadata,i=void 0===n?{}:n;this.registry.set(e.id,a({protocol:r},i))}},{key:"removeStream",value:function(e){this.registry.delete(e)}},{key:"close",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.stat.status!==l.CLOSED){e.next=2;break}return e.abrupt("return");case 2:if(!this._closing){e.next=4;break}return e.abrupt("return",this._closing);case 4:return this.stat.status=l.CLOSING,e.next=7,this._close();case 7:this._closing=e.sent,this._stat.timeline.close=Date.now(),this.stat.status=l.CLOSED;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stat",get:function(){return this._stat}},{key:"streams",get:function(){return this._getStreams()}}]),e}();e.exports=f(p,{className:"Connection",symbolName:"@libp2p/interface-connection/connection"})},function(e,t,r){"use strict";e.exports={OPEN:"open",CLOSING:"closing",CLOSED:"closed"}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(15),c=r(19),f=c("libp2p:peer-store:address-book");f.error=c("libp2p:peer-store:address-book:error");var h=r(72),l=r(55),p=r(1990),d=r(1954).codes.ERR_INVALID_PARAMETERS,v=function(e){function t(e){var r;return n(this,t),(r=a(this,s(t).call(this,{peerStore:e,eventName:"change:multiaddrs",eventProperty:"multiaddrs",eventTransformer:function(e){return e.map((function(e){return e.multiaddr}))}}))).data=new Map,r}return o(t,e),i(t,[{key:"set",value:function(e,t){if(!l.isPeerId(e))throw f.error("peerId must be an instance of peer-id to store data"),u(new Error("peerId must be an instance of peer-id"),d);var r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n);if(!r.length)return this;if(i&&i.length===r.length&&i.filter((function(e){return r.some((function(t){return e.multiaddr.equals(t.multiaddr)}))})).length===i.length)return f("the addresses provided to store are equal to the already stored for ".concat(n)),this;return this._setData(e,r),f("stored provided multiaddrs for ".concat(n)),i||this._ps.emit("peer",e),this}},{key:"add",value:function(e,t){if(!l.isPeerId(e))throw f.error("peerId must be an instance of peer-id to store data"),u(new Error("peerId must be an instance of peer-id"),d);var r=this._toAddresses(t),n=e.toB58String(),i=this.data.get(n);return i&&i.forEach((function(e){r.find((function(t){return t.multiaddr.equals(e.multiaddr)}))||r.push(e)})),i&&i.length===r.length?(f("the addresses provided to store are already stored for ".concat(n)),this):(this._setData(e,r),f("added provided multiaddrs for ".concat(n)),i||this._ps.emit("peer",e),this)}},{key:"_toAddresses",value:function(e){if(!e)throw f.error("multiaddrs must be provided to store data"),u(new Error("multiaddrs must be provided"),d);var t=[];return e.forEach((function(e){if(!h.isMultiaddr(e))throw f.error("multiaddr ".concat(e," must be an instance of multiaddr")),u(new Error("multiaddr ".concat(e," must be an instance of multiaddr")),d);t.push({multiaddr:e})})),t}},{key:"getMultiaddrsForPeer",value:function(e){if(!l.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),d);var t=this.data.get(e.toB58String());if(t)return t.map((function(t){var r=t.multiaddr,n=r.getPeerId();return n&&n===e.toB58String()?r:r.encapsulate("/p2p/".concat(e.toB58String()))}))}}]),t}(p);e.exports=v},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(15),c=r(19),f=c("libp2p:peer-store:key-book");f.error=c("libp2p:peer-store:key-book:error");var h=r(55),l=r(1990),p=r(1954).codes.ERR_INVALID_PARAMETERS,d=function(e){function t(e){var r;return n(this,t),(r=a(this,s(t).call(this,{peerStore:e,eventName:"change:pubkey",eventProperty:"pubkey",eventTransformer:function(e){return e.pubKey}}))).data=new Map,r}return o(t,e),i(t,[{key:"set",value:function(e,t){if(!h.isPeerId(e))throw f.error("peerId must be an instance of peer-id to store data"),u(new Error("peerId must be an instance of peer-id"),p);var r=e.toB58String();return!this.data.get(r)&&t&&(e.pubKey=t,this._setData(e,e),f("stored provided public key for ".concat(r))),this}},{key:"get",value:function(e){if(!h.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),p);var t=this.data.get(e.toB58String());return t?t.pubKey:void 0}}]),t}(l);e.exports=d},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(15),c=r(19),f=c("libp2p:peer-store:proto-book");f.error=c("libp2p:peer-store:proto-book:error");var h=r(3).Buffer,l=r(55),p=r(1990),d=r(1954).codes.ERR_INVALID_PARAMETERS,v=function(e){function t(e){var r;return n(this,t),(r=a(this,s(t).call(this,{peerStore:e,eventName:"change:metadata",eventProperty:"metadata"}))).data=new Map,r}return o(t,e),i(t,[{key:"set",value:function(e,t,r){if(!l.isPeerId(e))throw f.error("peerId must be an instance of peer-id to store data"),u(new Error("peerId must be an instance of peer-id"),d);if("string"!==typeof t||!h.isBuffer(r))throw f.error("valid key and value must be provided to store data"),u(new Error("valid key and value must be provided"),d);return this._setValue(e,t,r),this}},{key:"_setValue",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.emit,a=void 0===i||i,s=e.toB58String(),o=this.data.get(s)||new Map,u=o.get(t);u&&r.equals(u)?f("the metadata provided to store is equal to the already stored for ".concat(s," on ").concat(t)):(o.set(t,r),this.data.set(s,o),a&&this._emit(e,t))}},{key:"get",value:function(e){if(!l.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),d);return this.data.get(e.toB58String())}},{key:"getValue",value:function(e,t){if(!l.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),d);var r=this.data.get(e.toB58String());return r&&r.get(t)}},{key:"delete",value:function(e){if(!l.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),d);return!!this.data.delete(e.toB58String())&&(this._emit(e),!0)}},{key:"deleteValue",value:function(e,t){if(!l.isPeerId(e))throw u(new Error("peerId must be an instance of peer-id"),d);var r=this.data.get(e.toB58String());return!(!r||!r.delete(t))&&(this._emit(e,t),!0)}}]),t}(p);e.exports=v},function(e,t,r){"use strict";var n=r(68),i=r(5),a=r(7),s=r(28),o=r(27),u=r(29),c=r(15),f=r(19),h=f("libp2p:peer-store:proto-book");h.error=f("libp2p:peer-store:proto-book:error");var l=r(55),p=r(1990),d=r(1954).codes.ERR_INVALID_PARAMETERS,v=function(e){function t(e){var r;return i(this,t),(r=s(this,o(t).call(this,{peerStore:e,eventName:"change:protocols",eventProperty:"protocols",eventTransformer:function(e){return Array.from(e)}}))).data=new Map,r}return u(t,e),a(t,[{key:"set",value:function(e,t){if(!l.isPeerId(e))throw h.error("peerId must be an instance of peer-id to store data"),c(new Error("peerId must be an instance of peer-id"),d);if(!t)throw h.error("protocols must be provided to store data"),c(new Error("protocols must be provided"),d);var r,i,a=e.toB58String(),s=this.data.get(a),o=new Set(t);return s&&(i=o,(r=s).size===i.size&&n(r).every((function(e){return i.has(e)})))?(h("the protocols provided to store are equal to the already stored for ".concat(a)),this):(this._setData(e,o),h("stored provided protocols for ".concat(a)),this)}},{key:"add",value:function(e,t){if(!l.isPeerId(e))throw h.error("peerId must be an instance of peer-id to store data"),c(new Error("peerId must be an instance of peer-id"),d);if(!t)throw h.error("protocols must be provided to store data"),c(new Error("protocols must be provided"),d);var r=e.toB58String(),i=this.data.get(r)||new Set,a=new Set([].concat(n(i),n(t)));return i.size===a.size?(h("the protocols provided to store are already stored for ".concat(r)),this):(t=n(a),this._setData(e,a),h("added provided protocols for ".concat(r)),this)}}]),t}(p);e.exports=v},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(28),u=r(27),c=r(87),f=r(29),h=r(18),l=r(19),p=l("libp2p:persistent-peer-store");p.error=l("libp2p:persistent-peer-store:error");var d=r(57).Key,v=r(72),y=r(55),b=r(2076),m=r(2298),g=m.NAMESPACE_ADDRESS,k=m.NAMESPACE_COMMON,w=m.NAMESPACE_KEYS,x=m.NAMESPACE_METADATA,S=m.NAMESPACE_PROTOCOL,E=r(2299),_=r(2300),I=function(e){function t(e){var r,n=e.datastore,i=e.threshold,s=void 0===i?5:i;return a(this,t),(r=o(this,u(t).call(this)))._datastore=n,r._dirtyPeers=new Set,r._dirtyMetadata=new Map,r.threshold=s,r._addDirtyPeer=r._addDirtyPeer.bind(c(r)),r}return f(t,e),s(t,[{key:"start",value:function(){var e=i(n.mark((function e(){var t,r,i,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:p("PeerStore is starting"),this.on("change:protocols",this._addDirtyPeer),this.on("change:multiaddrs",this._addDirtyPeer),this.on("change:pubkey",this._addDirtyPeer),this.on("change:metadata",this._addDirtyPeerMetadata),t=!0,r=!1,e.prev=7,a=h(this._datastore.query({prefix:k}));case 9:return e.next=11,a.next();case 11:return s=e.sent,t=s.done,e.next=15,s.value;case 15:if(o=e.sent,t){e.next=23;break}return u=o,e.next=20,this._processDatastoreEntry(u);case 20:t=!0,e.next=9;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(7),r=!0,i=e.t0;case 29:if(e.prev=29,e.prev=30,t||null==a.return){e.next=34;break}return e.next=34,a.return();case 34:if(e.prev=34,!r){e.next=37;break}throw i;case 37:return e.finish(34);case 38:return e.finish(29);case 39:p("PeerStore started");case 40:case"end":return e.stop()}}),e,this,[[7,25,29,39],[30,,34,38]])})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p("PeerStore is stopping"),this.removeAllListeners(),e.next=4,this._commitData();case 4:p("PeerStore stopped");case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_addDirtyPeer",value:function(e){var t=e.peerId.toB58String();p("add dirty peer",t),this._dirtyPeers.add(t),this._dirtyPeers.size>=this.threshold&&this._commitData().catch((function(e){p.error("error committing data",e)}))}},{key:"_addDirtyPeerMetadata",value:function(e){var t=e.peerId,r=e.metadata,n=t.toB58String();p("add dirty metadata peer",n),this._dirtyPeers.add(n);var i=this._dirtyMetadata.get(n)||new Set;i.add(r),this._dirtyMetadata.set(n,i),this._dirtyPeers.size>=this.threshold&&this._commitData().catch((function(e){p.error("error committing data",e)}))}},{key:"_commitData",value:function(){var e=i(n.mark((function e(){var t,r,i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((t=Array.from(this._dirtyPeers)).length){e.next=3;break}return e.abrupt("return");case 3:for(this._dirtyPeers.clear(),p("create batch commit"),r=this._datastore.batch(),i=0,a=t;i<a.length;i++)s=a[i],o=this.keyBook.data.get(s)||y.createFromCID(s),this._batchAddressBook(o,r),this._batchKeyBook(o,r),this._batchMetadataBook(o,r),this._batchProtoBook(o,r);return e.next=9,r.commit();case 9:p("batch committed");case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_batchAddressBook",value:function(e,t){var r=e.toString(),n=new d("".concat(g).concat(r)),i=this.addressBook.get(e);try{if(!i)return void t.delete(n);var a=E.encode({addrs:i.map((function(e){return{multiaddr:e.multiaddr.buffer}}))});t.put(n,a)}catch(s){p.error(s)}}},{key:"_batchKeyBook",value:function(e,t){var r=e.toString(),n=new d("".concat(w).concat(r));try{if(!e.pubKey)return void t.delete(n);var i=e.marshalPubKey();t.put(n,i)}catch(a){p.error(a)}}},{key:"_batchMetadataBook",value:function(e,t){var r=this,n=e.toString(),i=this._dirtyMetadata.get(e.toB58String())||[];try{i.forEach((function(i){var a=new d("".concat(x).concat(n,"/").concat(i)),s=r.metadataBook.getValue(e,i);s?t.put(a,s):t.delete(a)}))}catch(a){p.error(a)}}},{key:"_batchProtoBook",value:function(e,t){var r=e.toString(),n=new d("".concat(S).concat(r)),i=this.protoBook.get(e);try{if(!i)return void t.delete(n);var a=_.encode({protocols:i});t.put(n,a)}catch(s){p.error(s)}}},{key:"_processDatastoreEntry",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.key,i=t.value,e.prev=1,a=r.toString().split("/"),s=y.createFromCID(a[3]),e.t0=a[2],e.next="addrs"===e.t0?7:"keys"===e.t0?10:"metadata"===e.t0?15:"protos"===e.t0?17:20;break;case 7:return o=E.decode(i),this.addressBook._setData(s,o.addrs.map((function(e){return{multiaddr:v(e.multiaddr)}})),{emit:!1}),e.abrupt("break",21);case 10:return e.next=12,y.createFromPubKey(i);case 12:return o=e.sent,this.keyBook._setData(o,o,{emit:!1}),e.abrupt("break",21);case 15:return this.metadataBook._setValue(s,a[4],i,{emit:!1}),e.abrupt("break",21);case 17:return o=_.decode(i),this.protoBook._setData(s,new Set(o.protocols),{emit:!1}),e.abrupt("break",21);case 20:p("invalid data persisted for: ",r.toString());case 21:e.next=26;break;case 23:e.prev=23,e.t1=e.catch(1),p.error(e.t1);case 26:case"end":return e.stop()}}),e,this,[[1,23]])})));return function(t){return e.apply(this,arguments)}}()}]),t}(b);e.exports=I},function(e,t,r){"use strict";e.exports.NAMESPACE_COMMON="/peers/",e.exports.NAMESPACE_ADDRESS="/peers/addrs/",e.exports.NAMESPACE_KEYS="/peers/keys/",e.exports.NAMESPACE_METADATA="/peers/metadata/",e.exports.NAMESPACE_PROTOCOL="/peers/protos/"},function(e,t,r){"use strict";var n=r(73);e.exports=n("\nmessage Addresses {\n  message Address {\n    required bytes multiaddr = 1;\n  }\n\n  repeated Address addrs = 1;\n}\n").Addresses},function(e,t,r){"use strict";var n=r(73);e.exports=n("\nmessage Protocols {\n  repeated string protocols = 1;\n}\n").Protocols},function(e,t,r){"use strict";var n=r(48),i=r(5),a=r(7),s=r(19),o=r(15);s("libp2p:peer-store").error=s("libp2p:peer-store:error");var u=r(1954).ERR_INVALID_PARAMETERS,c=r(2060),f=function(){function e(t){var r=t.peerStore,n=t.connectionManager;i(this,e),this.peerStore=r,this.connectionManager=n,this.topologies=new Map,this._handle=void 0,this._onDisconnect=this._onDisconnect.bind(this),this.connectionManager.on("peer:disconnect",this._onDisconnect)}return a(e,[{key:"getConnection",value:function(e){return this.connectionManager.get(e)}},{key:"register",value:function(e){if(!c.isTopology(e))throw o(new Error("topology must be an instance of interfaces/topology"),u);var t=parseInt(1e9*Math.random()).toString(36)+Date.now();return this.topologies.set(t,e),e.registrar=this,t}},{key:"unregister",value:function(e){return this.topologies.delete(e)}},{key:"_onDisconnect",value:function(e,t){var r=!0,i=!1,a=void 0;try{for(var s,o=this.topologies[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){n(s.value,2)[1].disconnect(e.remotePeer,t)}}catch(u){i=!0,a=u}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}}},{key:"handle",get:function(){return this._handle},set:function(e){this._handle=e}}]),e}();e.exports=f},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(19),o=s("libp2p-ping");o.error=s("libp2p-ping:error");var u=r(15),c=r(2067),f=r(78),h=r(334).toBuffer,l=r(2030),p=l.collect,d=l.take,v=r(2303),y=v.PROTOCOL,b=v.PING_LENGTH;function m(){return(m=a(n.mark((function e(t,r){var a,s,l,v,m,g,k,w;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o("dialing %s to %s",y,r.toB58String?r.toB58String():r),e.next=3,t.dialProtocol(r,y);case 3:return a=e.sent,s=a.stream,l=new Date,v=c.randomBytes(b),e.next=9,f([v],s,(function(e){return d(1,e)}),h,p);case 9:if(m=e.sent,g=i(m,1),k=g[0],w=Date.now(),v.equals(k)){e.next=15;break}throw u(new Error("Received wrong ping ack"),"ERR_WRONG_PING_ACK");case 15:return e.abrupt("return",w-l);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(t=e.exports=function(e,t){return m.apply(this,arguments)}).mount=function(e){e.handle(y,(function(e){var t=e.stream;return f(t,t)}))},t.unmount=function(e){e.unhandle(y)}},function(e,t,r){"use strict";e.exports={PROTOCOL:"/ipfs/ping/1.0.0",PING_LENGTH:32}},function(e,t,r){"use strict";var n=r(48),i=r(1),a=r(2),s=r(5),o=r(7),u=r(3).Buffer,c=r(19),f=r(805),h=r(100),l=r(78),p=r(2030),d=p.collect,v=p.take,y=p.consume,b=r(55),m=r(72),g=r(334).toBuffer,k=r(2305),w=c("libp2p:identify");w.error=c("libp2p:identify:error");var x=r(2306),S=x.MULTICODEC_IDENTIFY,E=x.MULTICODEC_IDENTIFY_PUSH,_=x.AGENT_VERSION,I=x.PROTOCOL_VERSION,A=r(15),T=r(1954).codes,C=function(){function e(t){var r=this,n=t.libp2p,i=t.protocols;s(this,e),this.peerStore=n.peerStore,this.connectionManager=n.connectionManager,this.connectionManager.on("peer:connect",(function(e){var t=e.remotePeer;r.identify(e,t).catch(w.error)})),this.peerId=n.peerId,this._libp2p=n,this._protocols=i,this.handleMessage=this.handleMessage.bind(this)}return o(e,null,[{key:"getCleanMultiaddr",value:function(e){if(e&&e.length>0)try{return m(e)}catch(t){return null}return null}}]),o(e,[{key:"push",value:function(e){var t=this,r=e.map(function(){var e=a(i.mark((function e(r){var n,a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r.newStream(E);case 3:return n=e.sent,a=n.stream,e.next=7,l([{listenAddrs:t._libp2p.multiaddrs.map((function(e){return e.buffer})),protocols:Array.from(t._protocols.keys())}],f.encode(k),a,y);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),w.error("could not push identify update to peer",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}());return Promise.all(r)}},{key:"pushToPeerStore",value:function(e){var t,r=[],n=!0,i=!1,a=void 0;try{for(var s,o=e.peers.values()[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;u.protocols.includes(E)&&(t=this.connectionManager.get(u.id))&&r.push(t)}}catch(c){i=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}this.push(r)}},{key:"identify",value:function(){var t=a(i.mark((function t(r){var a,s,o,u,c,f,p,y,x,E,_,I;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.newStream(S);case 2:return a=t.sent,s=a.stream,t.next=6,l([],s,h.decode(),v(1),g,d);case 6:if(o=t.sent,u=n(o,1),c=u[0]){t.next=11;break}throw A(new Error("No data could be retrieved"),T.ERR_CONNECTION_ENDED);case 11:t.prev=11,f=k.decode(c),t.next=18;break;case 15:throw t.prev=15,t.t0=t.catch(11),A(t.t0,T.ERR_INVALID_MESSAGE);case 18:return y=(p=f).publicKey,x=p.listenAddrs,E=p.protocols,_=p.observedAddr,t.next=21,b.createFromPubKey(y);case 21:if(I=t.sent,r.remotePeer.toB58String()===I.toB58String()){t.next=24;break}throw A(new Error("identified peer does not match the expected peer"),T.ERR_INVALID_PEER);case 24:_=e.getCleanMultiaddr(_),this.peerStore.addressBook.set(I,x.map((function(e){return m(e)}))),this.peerStore.protoBook.set(I,E),w("received observed address of %s",_);case 28:case"end":return t.stop()}}),t,this,[[11,15]])})));return function(e){return t.apply(this,arguments)}}()},{key:"handleMessage",value:function(e){var t=e.connection,r=e.stream,n=e.protocol;switch(n){case S:return this._handleIdentify({connection:t,stream:r});case E:return this._handlePush({connection:t,stream:r});default:w.error("cannot handle unknown protocol %s",n)}}},{key:"_handleIdentify",value:function(){var e=a(i.mark((function e(t){var r,n,a,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,n=t.stream,a=u.alloc(0),this.peerId.pubKey&&(a=this.peerId.pubKey.bytes),s=k.encode({protocolVersion:I,agentVersion:_,publicKey:a,listenAddrs:this._libp2p.multiaddrs.map((function(e){return e.buffer})),observedAddr:r.remoteAddr.buffer,protocols:Array.from(this._protocols.keys())}),e.prev=4,e.next=7,l([s],h.encode(),n,y);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),w.error("could not respond to identify request",e.t0);case 12:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_handlePush",value:function(){var e=a(i.mark((function e(t){var r,a,s,o,u,c,f;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.connection,a=t.stream,e.prev=1,e.next=4,l([],a,h.decode(),v(1),g,d);case 4:o=e.sent,u=n(o,1),c=u[0],s=k.decode(c),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",w.error("received invalid message",e.t0));case 13:f=r.remotePeer,e.prev=14,this.peerStore.addressBook.set(f,s.listenAddrs.map((function(e){return m(e)}))),e.next=21;break;case 18:return e.prev=18,e.t1=e.catch(14),e.abrupt("return",w.error("received invalid listen addrs",e.t1));case 21:this.peerStore.protoBook.set(f,s.protocols);case 22:case"end":return e.stop()}}),e,this,[[1,10],[14,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports.IdentifyService=C,e.exports.multicodecs={IDENTIFY:S,IDENTIFY_PUSH:E},e.exports.Message=k},function(e,t,r){"use strict";var n=r(73);e.exports=n("\nmessage Identify {\n  // protocolVersion determines compatibility between peers\n  optional string protocolVersion = 5; // e.g. ipfs/1.0.0\n\n  // agentVersion is like a UserAgent string in browsers, or client version in bittorrent\n  // includes the client name and client.\n  optional string agentVersion = 6; // e.g. go-ipfs/0.1.0\n\n  // publicKey is this node's public key (which also gives its node.ID)\n  // - may not need to be sent, as secure channel implies it has been sent.\n  // - then again, if we change / disable secure channel, may still want it.\n  optional bytes publicKey = 1;\n\n  // listenAddrs are the multiaddrs the sender node listens for open connections on\n  repeated bytes listenAddrs = 2;\n\n  // oservedAddr is the multiaddr of the remote endpoint that the sender node perceives\n  // this is useful information to convey to the other side, as it helps the remote endpoint\n  // determine whether its connection to the local peer goes through NAT.\n  optional bytes observedAddr = 4;\n\n  repeated string protocols = 3;\n}\n").Identify},function(e,t,r){"use strict";e.exports.PROTOCOL_VERSION="ipfs/0.1.0",e.exports.AGENT_VERSION="js-libp2p/0.1.0",e.exports.MULTICODEC_IDENTIFY="/ipfs/id/1.0.0",e.exports.MULTICODEC_IDENTIFY_PUSH="/ipfs/id/push/1.0.0"},function(e,t,r){"use strict";var n=r(806),i=r(2308),a=r(817),s=r(2439).NOISE,o=r(818),u=r(2351),c=r(2059),f=r(2058);e.exports=function(){return{dialer:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4},modules:{transport:[n,i],streamMuxer:[a],connEncryption:[o,s],peerDiscovery:[],dht:u,pubsub:c},config:{peerDiscovery:{autoDial:!0,bootstrap:{enabled:!0},webRTCStar:{enabled:!0},websocketStar:{enabled:!0}},dht:{kBucketSize:20,enabled:!1,clientMode:!0,randomWalk:{enabled:!1},validators:{ipns:f.validator},selectors:{ipns:f.selector}},pubsub:{enabled:!0,emitSelf:!0}},metrics:{enabled:!0},peerStore:{persistence:!0,threshold:1}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(19),u=o("libp2p:webrtc-star");u.error=o("libp2p:webrtc-star:error");var c=r(41).EventEmitter,f=r(15),h=r(63),l=r(172).AbortError,p=r(2077),d=r(2309).supportsWebRTC,v=r(72),y=r(169),b=r(55),m=r(2031).CODE_CIRCUIT,g=r(2310),k=r(2084),w=r(2085).cleanMultiaddr;function x(){}var S=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(a(this,e),!r.upgrader)throw new Error("An upgrader must be provided. See https://github.com/libp2p/interface-transport#upgrader.");this._upgrader=r.upgrader,this._signallingAddr=void 0,this.sioOptions={transports:["websocket"],"force new connection":!0},r.wrtc&&(this.wrtc=r.wrtc),this.listenersRefs={},this.discovery=new c,this.discovery.tag="webRTCStar",this.discovery._isStarted=!1,this.discovery.start=function(){t.discovery._isStarted=!0},this.discovery.stop=function(){t.discovery._isStarted=!1},this._peerDiscovered=this._peerDiscovered.bind(this)}return s(e,[{key:"dial",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},e.next=3,this._connect(t,r);case 3:return i=e.sent,a=k(i,{remoteAddr:t,signal:r.signal}),u("new outbound connection %s",a.remoteAddr),e.next=8,this._upgrader.upgradeOutbound(a);case 8:return s=e.sent,u("outbound connection %s upgraded",a.remoteAddr),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_connect",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(r.signal&&r.signal.aborted)throw new l;var n={initiator:!0,trickle:!1};this.wrtc&&(n.wrtc=this.wrtc);var i=e.toOptions(),a=(~~(1e9*Math.random())).toString(36)+Date.now(),s=this.listenersRefs[Object.keys(this.listenersRefs)[0]].io;return new Promise((function(o,c){var h,d=Date.now();u("dialing %s:%s",i.host,i.port);var v=new p(n),y=function(e){if(!h){var t="connection error ".concat(i.host,":").concat(i.port,": ").concat(e.message);e.message=t,u.error(t),k(e)}},b=function(){u("connnection timeout %s:%s",i.host,i.port);var e=f(new Error("connection timeout after ".concat(Date.now()-d,"ms")),"ERR_CONNECT_TIMEOUT");v.emit("error",e)},m=function(){h=!0,u("connection opened %s:%s",i.host,i.port),k(null)},g=function(){u.error("connection aborted %s:%s",i.host,i.port),v.destroy(),k(new l)},k=function(e){v.removeListener("timeout",b),v.removeListener("connect",m),r.signal&&r.signal.removeEventListener("abort",g),e?c(e):o(v)};v.on("error",y),v.once("timeout",b),v.once("connect",m),v.on("close",(function(){v.removeListener("error",y)})),r.signal&&r.signal.addEventListener("abort",g),v.on("signal",(function(r){s.emit("ss-handshake",{intentId:a,srcMultiaddr:t._signallingAddr.toString(),dstMultiaddr:e.toString(),signal:r})})),s.on("ws-handshake",(function(e){e.intentId===a&&e.err&&c(f(e.err instanceof Error?e.err:new Error(e.err),"ERR_SIGNALLING_FAILED")),e.intentId===a&&e.answer&&!v.destroyed&&v.signal(e.signal)}))}))}},{key:"createListener",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(!d&&!this.wrtc)throw f(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");return"function"===typeof e&&(t=e,e={}),g({handler:t=t||x,upgrader:this._upgrader},this,e)}},{key:"filter",value:function(e){return(e=Array.isArray(e)?e:[e]).filter((function(e){return!e.protoCodes().includes(m)&&y.WebRTCStar.matches(e)}))}},{key:"_peerDiscovered",value:function(e){if(this.discovery._isStarted){u("Peer Discovered:",e),e=w(e);var t=v(e),r=b.createFromB58String(t.getPeerId());this.discovery.emit("peer",{id:r,multiaddrs:[t]})}}}]),e}();e.exports=h(S,{className:"WebRTCStar",symbolName:"@libp2p/js-libp2p-webrtc-star/webrtcstar"})},function(e,t,r){"use strict";var n=r(261);e.exports={supportsFileReader:"undefined"!==typeof self&&"FileReader"in self,supportsWebRTC:"RTCPeerConnection"in n&&"undefined"!==typeof navigator&&"undefined"!==typeof navigator.mediaDevices&&"getUserMedia"in navigator.mediaDevices}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(46),s=r(41),o=r(19),u=o("libp2p:webrtc-star:listener");u.error=o("libp2p:webrtc-star:listener:error");var c=r(72),f=r(2311),h=r(2077),l=r(2321),p=r(2084),d=r(2085).cleanUrlSIO,v=r(2031).CODE_P2P,y={transports:["websocket"],"force new connection":!0};function b(e,t){e.__connections.push(t);t.conn.once("close",(function(){e.__connections=e.__connections.filter((function(e){return e!==t}))}))}e.exports=function(e,t){var r,o=e.handler,m=e.upgrader,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},k=new s;return k.__connections=[],k.listen=function(e){var s=l();r=e,!e.protoCodes().includes(v)&&m.localPeer?t._signallingAddr=e.encapsulate("/p2p/".concat(m.localPeer.toB58String())):t._signallingAddr=e;var c=d(e);u("Dialing to Signalling Server on: "+c),k.io=f.connect(c,y);return k.io.once("connect_error",(function(e){return s.reject(e)})),k.io.once("error",(function(e){k.emit("error",e),k.emit("close")})),k.io.on("ws-handshake",(function(r){if(!r.answer&&!r.err){var s=a({trickle:!1},g);t.wrtc&&(s.wrtc=t.wrtc);var c=new h(s),f=function(e){u.error("incoming connectioned errored",e)};c.on("error",f),c.once("close",(function(){c.removeListener("error",f)})),c.once("signal",(function(e){r.signal=e,r.answer=!0,k.io.emit("ss-handshake",r)})),c.signal(r.signal),c.once("connect",i(n.mark((function t(){var r,i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=p(c),u("new inbound connection %s",r.remoteAddr),t.prev=2,t.next=5,m.upgradeInbound(r);case 5:i=t.sent,t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(2),u.error("inbound connection failed to upgrade",t.t0),t.abrupt("return",r.close());case 12:if(!i.remoteAddr)try{i.remoteAddr=e.decapsulateCode(v).encapsulate("/p2p/".concat(i.remotePeer.toB58String()))}catch(n){u.error("could not determine remote address",n)}u("inbound connection %s upgraded",r.remoteAddr),b(k,r),k.emit("connection",i),o(i);case 17:case"end":return t.stop()}}),t,null,[[2,8]])}))))}})),k.io.on("ws-peer",t._peerDiscovered),k.io.on("connect",(function(){k.io.emit("ss-join",t._signallingAddr.toString())})),k.io.once("connect",(function(){k.emit("listening"),s.resolve()})),s.promise},k.close=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.io&&k.io.emit("ss-leave"),e.next=3,Promise.all(k.__connections.map((function(e){return e.close()})));case 3:k.emit("close");case 4:case"end":return e.stop()}}),e)}))),k.getAddrs=function(){return[r]},t.listenersRefs[c.toString()]=k,k}},function(e,t,r){var n=r(2312),i=r(335),a=r(2078),s=r(19)("socket.io-client");e.exports=t=u;var o=t.managers={};function u(e,t){"object"===typeof e&&(t=e,e=void 0),t=t||{};var r,i=n(e),u=i.source,c=i.id,f=i.path,h=o[c]&&f in o[c].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?(s("ignoring socket cache for %s",u),r=a(u,t)):(o[c]||(s("new io instance for %s",u),o[c]=a(u,t)),r=o[c]),i.query&&!t.query&&(t.query=i.query),r.socket(i.path,t)}t.protocol=i.protocol,t.connect=u,t.Manager=r(2078),t.Socket=r(2081)},function(e,t,r){var n=r(471),i=r(19)("socket.io-client:url");e.exports=function(e,t){var r=e;t=t||"undefined"!==typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e="undefined"!==typeof t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=n(e));r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443"));r.path=r.path||"/";var a=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+a+":"+r.port,r.href=r.protocol+"://"+a+(t&&t.port===r.port?"":":"+r.port),r}},function(e,t,r){e.exports=r(2314),e.exports.parser=r(1971)},function(e,t,r){var n=r(2079),i=r(2035),a=r(19)("engine.io-client:socket"),s=r(474),o=r(1971),u=r(471),c=r(262);function f(e,t){if(!(this instanceof f))return new f(e,t);t=t||{},e&&"object"===typeof e&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"===typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.withCredentials=!1!==t.withCredentials,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=void 0===t.rejectUnauthorized||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"===typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=f,f.priorWebsocketSuccess=!1,i(f.prototype),f.protocol=o.protocol,f.Socket=f,f.Transport=r(2034),f.transports=r(2079),f.parser=r(1971),f.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}(this.query);t.EIO=o.protocol,t.transport=e;var r=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new n[e]({query:t,socket:this,agent:r.agent||this.agent,hostname:r.hostname||this.hostname,port:r.port||this.port,secure:r.secure||this.secure,path:r.path||this.path,forceJSONP:r.forceJSONP||this.forceJSONP,jsonp:r.jsonp||this.jsonp,forceBase64:r.forceBase64||this.forceBase64,enablesXDR:r.enablesXDR||this.enablesXDR,withCredentials:r.withCredentials||this.withCredentials,timestampRequests:r.timestampRequests||this.timestampRequests,timestampParam:r.timestampParam||this.timestampParam,policyPort:r.policyPort||this.policyPort,pfx:r.pfx||this.pfx,key:r.key||this.key,passphrase:r.passphrase||this.passphrase,cert:r.cert||this.cert,ca:r.ca||this.ca,ciphers:r.ciphers||this.ciphers,rejectUnauthorized:r.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:r.perMessageDeflate||this.perMessageDeflate,extraHeaders:r.extraHeaders||this.extraHeaders,forceNode:r.forceNode||this.forceNode,localAddress:r.localAddress||this.localAddress,requestTimeout:r.requestTimeout||this.requestTimeout,protocols:r.protocols||void 0,isReactNative:this.isReactNative})},f.prototype.open=function(){var e;if(this.rememberUpgrade&&f.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout((function(){t.emit("error","No transports available")}),0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(r){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},f.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",(function(){t.onDrain()})).on("packet",(function(e){t.onPacket(e)})).on("error",(function(e){t.onError(e)})).on("close",(function(){t.onClose("transport close")}))},f.prototype.probe=function(e){a('probing transport "%s"',e);var t=this.createTransport(e,{probe:1}),r=!1,n=this;function i(){if(n.onlyBinaryUpgrades){var i=!this.supportsBinary&&n.transport.supportsBinary;r=r||i}r||(a('probe transport "%s" opened',e),t.send([{type:"ping",data:"probe"}]),t.once("packet",(function(i){if(!r)if("pong"===i.type&&"probe"===i.data){if(a('probe transport "%s" pong',e),n.upgrading=!0,n.emit("upgrading",t),!t)return;f.priorWebsocketSuccess="websocket"===t.name,a('pausing current transport "%s"',n.transport.name),n.transport.pause((function(){r||"closed"!==n.readyState&&(a("changing transport and sending upgrade packet"),l(),n.setTransport(t),t.send([{type:"upgrade"}]),n.emit("upgrade",t),t=null,n.upgrading=!1,n.flush())}))}else{a('probe transport "%s" failed',e);var s=new Error("probe error");s.transport=t.name,n.emit("upgradeError",s)}})))}function s(){r||(r=!0,l(),t.close(),t=null)}function o(r){var i=new Error("probe error: "+r);i.transport=t.name,s(),a('probe transport "%s" failed because of error: %s',e,r),n.emit("upgradeError",i)}function u(){o("transport closed")}function c(){o("socket closed")}function h(e){t&&e.name!==t.name&&(a('"%s" works - aborting "%s"',e.name,t.name),s())}function l(){t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",u),n.removeListener("close",c),n.removeListener("upgrading",h)}f.priorWebsocketSuccess=!1,t.once("open",i),t.once("error",o),t.once("close",u),this.once("close",c),this.once("upgrading",h),t.open()},f.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",f.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])}},f.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},f.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},f.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout((function(){"closed"!==t.readyState&&t.onClose("ping timeout")}),e||t.pingInterval+t.pingTimeout)},f.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout((function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)}),e.pingInterval)},f.prototype.ping=function(){var e=this;this.sendPacket("ping",(function(){e.emit("ping")}))},f.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},f.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},f.prototype.write=f.prototype.send=function(e,t,r){return this.sendPacket("message",e,t,r),this},f.prototype.sendPacket=function(e,t,r,n){if("function"===typeof t&&(n=t,t=void 0),"function"===typeof r&&(n=r,r=null),"closing"!==this.readyState&&"closed"!==this.readyState){(r=r||{}).compress=!1!==r.compress;var i={type:e,data:t,options:r};this.emit("packetCreate",i),this.writeBuffer.push(i),n&&this.once("flush",n),this.flush()}},f.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",(function(){this.upgrading?n():t()})):this.upgrading?n():t()}function t(){e.onClose("forced close"),a("socket closing - telling transport to close"),e.transport.close()}function r(){e.removeListener("upgrade",r),e.removeListener("upgradeError",r),t()}function n(){e.once("upgrade",r),e.once("upgradeError",r)}return this},f.prototype.onError=function(e){a("socket error %j",e),f.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},f.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){a('socket close with reason: "%s"',e);clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},f.prototype.filterUpgrades=function(e){for(var t=[],r=0,n=e.length;r<n;r++)~s(this.transports,e[r])&&t.push(e[r]);return t}},function(e,t,r){var n=r(2032),i=r(2080),a=r(2035),s=r(263),o=r(19)("engine.io-client:polling-xhr"),u=r(2033);function c(){}function f(e){if(i.call(this,e),this.requestTimeout=e.requestTimeout,this.extraHeaders=e.extraHeaders,"undefined"!==typeof location){var t="https:"===location.protocol,r=location.port;r||(r=t?443:80),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||r!==e.port,this.xs=e.secure!==t}}function h(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.withCredentials=e.withCredentials,this.requestTimeout=e.requestTimeout,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.extraHeaders=e.extraHeaders,this.create()}if(e.exports=f,e.exports.Request=h,s(f,i),f.prototype.supportsBinary=!0,f.prototype.request=function(e){return(e=e||{}).uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.withCredentials=this.withCredentials,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,e.requestTimeout=this.requestTimeout,e.extraHeaders=this.extraHeaders,new h(e)},f.prototype.doWrite=function(e,t){var r="string"!==typeof e&&void 0!==e,n=this.request({method:"POST",data:e,isBinary:r}),i=this;n.on("success",t),n.on("error",(function(e){i.onError("xhr post error",e)})),this.sendXhr=n},f.prototype.doPoll=function(){o("xhr poll");var e=this.request(),t=this;e.on("data",(function(e){t.onData(e)})),e.on("error",(function(e){t.onError("xhr poll error",e)})),this.pollXhr=e},a(h.prototype),h.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new n(e),r=this;try{o("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async);try{if(this.extraHeaders)for(var i in t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0),this.extraHeaders)this.extraHeaders.hasOwnProperty(i)&&t.setRequestHeader(i,this.extraHeaders[i])}catch(a){}if("POST"===this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(a){}try{t.setRequestHeader("Accept","*/*")}catch(a){}"withCredentials"in t&&(t.withCredentials=this.withCredentials),this.requestTimeout&&(t.timeout=this.requestTimeout),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){if(2===t.readyState)try{var e=t.getResponseHeader("Content-Type");(r.supportsBinary&&"application/octet-stream"===e||"application/octet-stream; charset=UTF-8"===e)&&(t.responseType="arraybuffer")}catch(a){}4===t.readyState&&(200===t.status||1223===t.status?r.onLoad():setTimeout((function(){r.onError("number"===typeof t.status?t.status:0)}),0))},o("xhr data %s",this.data),t.send(this.data)}catch(a){return void setTimeout((function(){r.onError(a)}),0)}"undefined"!==typeof document&&(this.index=h.requestsCount++,h.requests[this.index]=this)},h.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},h.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},h.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},h.prototype.cleanup=function(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=c:this.xhr.onreadystatechange=c,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete h.requests[this.index],this.xhr=null}},h.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type")}catch(r){}e=("application/octet-stream"===t||"application/octet-stream; charset=UTF-8"===t)&&this.xhr.response||this.xhr.responseText}catch(r){this.onError(r)}null!=e&&this.onData(e)},h.prototype.hasXDR=function(){return"undefined"!==typeof XDomainRequest&&!this.xs&&this.enablesXDR},h.prototype.abort=function(){this.cleanup()},h.requestsCount=0,h.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",l);else if("function"===typeof addEventListener){addEventListener("onpagehide"in u?"pagehide":"unload",l,!1)}function l(){for(var e in h.requests)h.requests.hasOwnProperty(e)&&h.requests[e].abort()}},function(e,t){e.exports=Object.keys||function(e){var t=[],r=Object.prototype.hasOwnProperty;for(var n in e)r.call(e,n)&&t.push(n);return t}},function(e,t){var r,n,i,a=String.fromCharCode;function s(e){for(var t,r,n=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function o(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function u(e,t){return a(e>>t&63|128)}function c(e,t){if(0==(4294967168&e))return a(e);var r="";return 0==(4294965248&e)?r=a(e>>6&31|192):0==(4294901760&e)?(o(e,t)||(e=65533),r=a(e>>12&15|224),r+=u(e,6)):0==(4292870144&e)&&(r=a(e>>18&7|240),r+=u(e,12),r+=u(e,6)),r+=a(63&e|128)}function f(){if(i>=n)throw Error("Invalid byte index");var e=255&r[i];if(i++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function h(e){var t,a;if(i>n)throw Error("Invalid byte index");if(i==n)return!1;if(t=255&r[i],i++,0==(128&t))return t;if(192==(224&t)){if((a=(31&t)<<6|f())>=128)return a;throw Error("Invalid continuation byte")}if(224==(240&t)){if((a=(15&t)<<12|f()<<6|f())>=2048)return o(a,e)?a:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(a=(7&t)<<18|f()<<12|f()<<6|f())>=65536&&a<=1114111)return a;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var r=!1!==(t=t||{}).strict,n=s(e),i=n.length,a=-1,o="";++a<i;)o+=c(n[a],r);return o},decode:function(e,t){var o=!1!==(t=t||{}).strict;r=s(e),n=r.length,i=0;for(var u,c=[];!1!==(u=h(o));)c.push(u);return function(e){for(var t,r=e.length,n=-1,i="";++n<r;)(t=e[n])>65535&&(i+=a((t-=65536)>>>10&1023|55296),t=56320|1023&t),i+=a(t);return i}(c)}}},function(e,t,r){var n=r(2080),i=r(263),a=r(2033);e.exports=f;var s,o=/\n/g,u=/\\n/g;function c(){}function f(e){n.call(this,e),this.query=this.query||{},s||(s=a.___eio=a.___eio||[]),this.index=s.length;var t=this;s.push((function(e){t.onData(e)})),this.query.j=this.index,"function"===typeof addEventListener&&addEventListener("beforeunload",(function(){t.script&&(t.script.onerror=c)}),!1)}i(f,n),f.prototype.supportsBinary=!1,f.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),n.prototype.doClose.call(this)},f.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var r=document.getElementsByTagName("script")[0];r?r.parentNode.insertBefore(t,r):(document.head||document.body).appendChild(t),this.script=t,"undefined"!==typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout((function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)}),100)},f.prototype.doWrite=function(e,t){var r=this;if(!this.form){var n,i=document.createElement("form"),a=document.createElement("textarea"),s=this.iframeId="eio_iframe_"+this.index;i.className="socketio",i.style.position="absolute",i.style.top="-1000px",i.style.left="-1000px",i.target=s,i.method="POST",i.setAttribute("accept-charset","utf-8"),a.name="d",i.appendChild(a),document.body.appendChild(i),this.form=i,this.area=a}function c(){f(),t()}function f(){if(r.iframe)try{r.form.removeChild(r.iframe)}catch(t){r.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+r.iframeId+'">';n=document.createElement(e)}catch(t){(n=document.createElement("iframe")).name=r.iframeId,n.src="javascript:0"}n.id=r.iframeId,r.form.appendChild(n),r.iframe=n}this.form.action=this.uri(),f(),e=e.replace(u,"\\\n"),this.area.value=e.replace(o,"\\n");try{this.form.submit()}catch(h){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===r.iframe.readyState&&c()}:this.iframe.onload=c}},function(e,t,r){(function(t){var n,i,a=r(2034),s=r(1971),o=r(262),u=r(263),c=r(473),f=r(19)("engine.io-client:websocket");if("undefined"!==typeof WebSocket?n=WebSocket:"undefined"!==typeof self&&(n=self.WebSocket||self.MozWebSocket),"undefined"===typeof window)try{i=r(2320)}catch(p){}var h=n||i;function l(e){e&&e.forceBase64&&(this.supportsBinary=!1),this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=n&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(h=i),a.call(this,e)}e.exports=l,u(l,a),l.prototype.name="websocket",l.prototype.supportsBinary=!0,l.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=this.protocols,r={};this.isReactNative||(r.agent=this.agent,r.perMessageDeflate=this.perMessageDeflate,r.pfx=this.pfx,r.key=this.key,r.passphrase=this.passphrase,r.cert=this.cert,r.ca=this.ca,r.ciphers=this.ciphers,r.rejectUnauthorized=this.rejectUnauthorized),this.extraHeaders&&(r.headers=this.extraHeaders),this.localAddress&&(r.localAddress=this.localAddress);try{this.ws=this.usingBrowserWebSocket&&!this.isReactNative?t?new h(e,t):new h(e):new h(e,t,r)}catch(n){return this.emit("error",n)}void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},l.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},l.prototype.write=function(e){var r=this;this.writable=!1;for(var n=e.length,i=0,a=n;i<a;i++)!function(e){s.encodePacket(e,r.supportsBinary,(function(i){if(!r.usingBrowserWebSocket){var a={};if(e.options&&(a.compress=e.options.compress),r.perMessageDeflate)("string"===typeof i?t.byteLength(i):i.length)<r.perMessageDeflate.threshold&&(a.compress=!1)}try{r.usingBrowserWebSocket?r.ws.send(i):r.ws.send(i,a)}catch(p){f("websocket closed before onclose event")}--n||o()}))}(e[i]);function o(){r.emit("flush"),setTimeout((function(){r.writable=!0,r.emit("drain")}),0)}},l.prototype.onClose=function(){a.prototype.onClose.call(this)},l.prototype.doClose=function(){"undefined"!==typeof this.ws&&this.ws.close()},l.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",r="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(r=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=c()),this.supportsBinary||(e.b64=1),(e=o.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+r+this.path+e},l.prototype.check=function(){return!!h&&!("__initialize"in h&&this.name===l.prototype.name)}}).call(this,r(3).Buffer)},,function(e,t,r){"use strict";e.exports=function(){var e={};return e.promise=new Promise((function(t,r){e.resolve=t,e.reject=r})),e}},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=r(2323),o=r(2326),u=r(2328).padRight,c=function(){function e(t,r,i){n(this,e),a("string"===typeof t),a(!r||"string"===typeof r),this.id=t,this.type="ecdh",this.eid=r||null,this._pre=i||null,this._curve=null,this._edwards=null,this.native=0}return i(e,[{key:"privateKeyGenerate",value:function(){var e=o.randomBytes(this.curve.scalarSize);return this.curve.clamp(e)}},{key:"privateKeyVerify",value:function(e){return a(t.isBuffer(e)),e.length===this.curve.scalarSize}},{key:"privateKeyExport",value:function(e,r){var n=this.publicKeyCreate(e),i=this.publicKeyExport(n,r),a=i.x,s=i.y;return{d:t.from(e),x:a,y:s}}},{key:"privateKeyImport",value:function(e){return a(e&&"object"===typeof e),u(e.d,this.curve.scalarSize)}},{key:"publicKeyCreate",value:function(e){var t=this.curve.decodeScalar(e),r=this.curve.reduce(t);if(this.edwards&&this.edwards.g.pre){var n=this.edwards.g.mulBlind(r);return this.curve.pointFromEdwards(n).encode()}return this.curve.g.toX().mulBlind(r,o).encode()}},{key:"publicKeyConvert",value:function(e,t){if(a(null==t||"boolean"===typeof t),!this.edwards)throw new Error("No equivalent edwards curve.");var r=this.curve.decodePoint(e),n=this.edwards.pointFromMont(r);return null!=t&&n.isOdd()!==t?n.neg().encode():n.encode()}},{key:"publicKeyFromUniform",value:function(e){var t=this.curve.decodeUniform(e);return this.curve.pointFromUniform(t).encode()}},{key:"publicKeyToUniform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.randomInt(),r=this.curve.decodePoint(e),n=this.curve.pointToUniform(r,t);return this.curve.encodeUniform(n,t>>>8)}},{key:"publicKeyFromHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.curve.pointFromHash(e,t);return r.encode()}},{key:"publicKeyToHash",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.randomInt(),r=this.curve.decodePoint(e);return this.curve.pointToHash(r,t,o)}},{key:"publicKeyVerify",value:function(e){var r;a(t.isBuffer(e));try{r=this.curve.decodeX(e)}catch(n){return!1}return r.validate()}},{key:"publicKeyIsSmall",value:function(e){var r;a(t.isBuffer(e));try{r=this.curve.decodeX(e)}catch(n){return!1}return!!r.validate()&&r.isSmall()}},{key:"publicKeyHasTorsion",value:function(e){var r;a(t.isBuffer(e));try{r=this.curve.decodeX(e)}catch(n){return!1}return!!r.validate()&&r.hasTorsion()}},{key:"publicKeyExport",value:function(e,t){var r=this.curve.decodePoint(e,t),n=r.x,i=r.y;return{x:this.curve.encodeField(n.fromRed()),y:this.curve.encodeField(i.fromRed())}}},{key:"publicKeyImport",value:function(e){a(e&&"object"===typeof e);var t=u(e.x,this.curve.fieldSize),r=this.curve.decodeX(t);if(!r.validate())throw new Error("Invalid point.");return r.encode()}},{key:"derive",value:function(e,t){var r=this.curve.decodeX(e),n=this.curve.decodeScalar(t),i=this.curve.reduce(n);return r.mulConst(i,o).encode()}},{key:"curve",get:function(){return this._curve||(this._curve=s.curve(this.id)),this._curve}},{key:"edwards",get:function(){return this.eid&&!this._edwards&&(this._edwards=s.curve(this.eid,this._pre),this._edwards.precompute(o),this._pre=null),this._edwards}},{key:"size",get:function(){return this.curve.fieldSize}},{key:"bits",get:function(){return this.curve.fieldBits}}]),e}();e.exports=c}).call(this,r(3).Buffer)},function(e,t,r){"use strict";(function(e){var n=r(477),i=r(28),a=r(27),s=r(127),o=r(29),u=r(48),c=r(5),f=r(7),h=r(2086).custom,l=r(2324),p=0,d=1,v=2,y=3,b=[-3,-1,-5,-7,0,7,5,1,3],m=function(){function t(e,r,n){c(this,t),this.Point=null,this.id=null,this.ossl=null,this.type="base",this.endian="be",this.hash=null,this.prefix=null,this.context=!1,this.prime=null,this.p=null,this.red=null,this.fieldSize=0,this.fieldBits=0,this.adjustedSize=0,this.signBit=0,this.n=null,this.h=null,this.q=null,this.z=null,this.g=null,this.nh=null,this.scalarSize=0,this.scalarBits=0,this.mask=null,this.zero=null,this.one=null,this.two=null,this.three=null,this.four=null,this.i2=null,this.i3=null,this.i4=null,this.i6=null,this.torsion=null,this.endo=null,this.hi=null,this._init(e,r,n)}return f(t,[{key:"_init",value:function(t,r,n){q("function"===typeof t),q("string"===typeof r),q(n&&"object"===typeof n),q(null==n.red||n.red instanceof l.Red),q(null!=n.p,"Must pass a prime."),q(null==n.id||"string"===typeof n.id),q(null==n.ossl||"string"===typeof n.ossl),q(null==n.endian||"string"===typeof n.endian),q(null==n.hash||"string"===typeof n.hash),q(null==n.prefix||"string"===typeof n.prefix),q(null==n.context||"boolean"===typeof n.context),q(null==n.prime||"string"===typeof n.prime),q(null==n.torsion||Array.isArray(n.torsion)),this.Point=t,this.id=n.id||null,this.ossl=n.ossl||null,this.type=r,this.endian=n.endian||("short"===r?"be":"le"),this.hash=n.hash||null,this.prefix=n.prefix?e.from(n.prefix,"binary"):null,this.context=n.context||!1,this.prime=n.prime||null,this.p=l.fromJSON(n.p),n.red?this.red=n.red:(this.red=n.prime?l.red(n.prime):l.mont(this.p),this.red.precompute()),this.fieldSize=this.p.byteLength(),this.fieldBits=this.p.bitLength(),this.adjustedSize=this.fieldSize+(0===(7&this.fieldBits)),this.signBit=8*this.adjustedSize-1,this.n=l.fromJSON(n.n||"0"),this.h=l.fromJSON(n.h||"1"),this.q=this.n.mul(this.h),this.z=l.fromJSON(n.z||"0").toRed(this.red),this.g=null,this.nh=this.n.ushrn(1),this.scalarSize=this.n.byteLength(),this.scalarBits=this.n.bitLength(),this.mask=null,this.zero=new l(0).toRed(this.red),this.one=new l(1).toRed(this.red),this.two=new l(2).toRed(this.red),this.three=new l(3).toRed(this.red),this.four=new l(4).toRed(this.red),this.i2=this.two.redInvert(),this.i3=this.three.redInvert(),this.i4=this.i2.redSqr(),this.i6=this.i2.redMul(this.i3),this.torsion=new Array(this.h.word(0));for(var i=0;i<this.torsion.length;i++)this.torsion[i]=this.point();return this.endo=null,this.hi=null,this._scale=F(this._scale,this),this.isIsomorphic=F(this.isIsomorphic,this),this.isIsogenous=F(this.isIsogenous,this),q(this.p.sign()>0&&this.p.isOdd()),q(this.n.sign()>=0),q(this.h.sign()>0&&this.h.cmpn(255)<=0),q("be"===this.endian||"le"===this.endian),this}},{key:"_finalize",value:function(e){if(q(e&&"object"===typeof e),this.mask=new T(this),this.g=e.g?this.pointFromJSON(e.g):this.point(),e.torsion){q(e.torsion.length===this.torsion.length);for(var t=0;t<this.torsion.length;t++)this.torsion[t]=this.pointFromJSON(e.torsion[t])}return this}},{key:"_simpleMul",value:function(e,t){q(e instanceof g),q(t instanceof l),q(!t.red);var r=t.bitLength();t.isNeg()&&(e=e.neg());for(var n=this.jpoint(),i=r-1;i>=0;i--){var a=t.bit(i);n=n.dbl(),1===a&&(n=n.add(e))}return n}},{key:"_simpleMulAdd",value:function(e,t){q(Array.isArray(e)),q(Array.isArray(t)),q(e.length===t.length);for(var r=e.length,n=new Array(r),i=t,a=0,s=0;s<r;s++){var o=e[s],u=t[s];if(q(o instanceof g),q(u instanceof l),q(!u.red),s>0&&o.type!==e[s-1].type)throw new Error("Cannot mix points.");n[s]=u.isNeg()?o.neg():o,a=Math.max(a,u.bitLength())}for(var c=this.jpoint(),f=a-1;f>=0;f--){c=c.dbl();for(var h=0;h<r;h++){var p=n[h];1===i[h].bit(f)&&(c=c.add(p))}}return c}},{key:"_constMul",value:function(e,t,r){return q(e instanceof g),this.n.isZero()?this._simpleMul(e,t):"short"===this.type&&0===this.h.cmpn(1)?this._coZLadderMul(e,t):this._ladderMul(e,t)}},{key:"_ladderMul",value:function(e,t){q(e instanceof g),q(t instanceof l),q(!t.red);for(var r=function(e,t){q(e instanceof l),q(t instanceof l);var r=e.abs().add(t),n=r.add(t),i=r.bitLength(),a=t.bitLength();r.cinject(n,i-a-1>>>31);var s=1&e.isNeg(),o=r.bitLength(),u=r.toArray("le");return[s,o,u]}(t,this.q),n=u(r,3),i=n[0],a=n[1],s=n[2],o=e.toJ().clone(),c=this.jpoint().clone(),f=0,h=a-1;h>=0;h--){var p=s[h>>3]>>(7&h)&1;o.swap(c,f^p),o=o.uadd(c),c=c.udbl(),f=p}return o.swap(c,f),c.swap(c.neg(),i),c}},{key:"_coZLadderMul",value:function(e,t){q(e instanceof g),q(t instanceof l),q(!t.red);for(var r=e.toJ().clone(),n=function(e,t){q(e instanceof l),q(t instanceof l);var r=e.mod(t),n=t.sub(r),i=r.bitLength(),a=n.bitLength(),s=i-a>>>31;r.cinject(n,s);var o=r.bitLength(),u=r.toArray("le"),c=r.ceq(t.subn(1));return[s,o,u,c]}(t,this.n),i=u(n,4),a=i[0],s=i[1],o=i[2],c=i[3],f=r.zdblu(),h=u(f,2),p=h[0],d=h[1],v=0,y=s-2;y>=0;y--){var b=o[y>>3]>>(7&y)&1;p.swap(d,v^b);var m=d.zaddc(p),k=u(m,2);p=k[0],d=k[1];var w=p.zaddu(d),x=u(w,2);d=x[0],p=x[1],v=b}return p.swap(d,v),d.swap(r.neg(),c),d.swap(d.neg(),a),d}},{key:"_fixedMul",value:function(e,t){q(e instanceof g),q(t instanceof l),q(e.pre&&e.pre.windows);for(var r=e._getWindows(0,0),n=r.width,i=r.bits,a=r.points,s=1<<n,o=(i+n-1)/n>>>0,u=this.jpoint(),c=0;c<o;c++){var f=t.bits(c*n,n);u=u.add(a[c*s+f])}return t.isNeg()&&(u=u.neg()),u}},{key:"_fixedNafMul",value:function(e,t){q(e instanceof g),q(t instanceof l),q(e.pre&&e.pre.doubles);for(var r=e._getDoubles(0,0),n=r.step,i=r.points,a=function(e,t,r,n){q(n>>>0===n);for(var i=K(e,t,r),a=Math.ceil(i.length/n),s=new Array(a),o=0,u=0;u<i.length;u+=n){for(var c=0,f=u+n-1;f>=u;f--)c=(c<<1)+i[f];s[o++]=c}return q(o===a),s}(t,1,t.bitLength()+1,n),s=((1<<n+1)-(n%2===0?2:1))/3,o=this.jpoint(),u=this.jpoint(),c=s;c>0;c--){for(var f=0;f<a.length;f++){var h=a[f];h===c?u=u.add(i[f]):h===-c&&(u=u.sub(i[f]))}o=o.add(u)}return o}},{key:"_windowMul",value:function(e,t,r){q(e>>>0===e),q(t instanceof g),q(r instanceof l);var n=1<<e,i=(Math.max(r.bitLength(),this.n.bitLength())+e-1)/e>>>0,a=new Array(n),s=t.toJ();a[0]=this.jpoint(),a[1]=s;for(var o=2;o<n;o+=2)a[o+0]=a[o>>1].dbl(),a[o+1]=a[o].add(s);for(var u=this.jpoint(),c=i-1;c>=0;c--){var f=r.bits(c*e,e);u=c===i-1?a[f]:(u=u.dblp(e)).add(a[f])}return r.isNeg()&&(u=u.neg()),u}},{key:"_slideMul",value:function(e,t,r){q(e>>>0===e),q(t instanceof g),q(r instanceof l);var n=1<<e-1,i=new Array(n),a=t.toJ();i[0]=a.dblp(e-1),i[1]=i[0].add(a);for(var s=2;s<n;s++)i[s]=i[s-1].add(a);for(var o=r.bitLength(),u=this.jpoint();o>=e;){var c=o-e,f=r.bits(c,e);f<n?(u=u.dbl(),o-=1):(u=(u=u.dblp(e)).add(i[f&~n]),o=c)}if(o>0)for(var h=r.bits(0,o);o--;)u=u.dbl(),h>>o&1&&(u=u.add(t));return r.isNeg()&&(u=u.neg()),u}},{key:"_wnafMul",value:function(e,t,r){q(t instanceof g),q(r instanceof l);for(var n=t._safeNAF(e),i=n.width,a=n.points,s=K(r,i,r.bitLength()+1),o=this.jpoint(),u=s.length-1;u>=0;u--){var c=s[u];u!==s.length-1&&(o=o.dbl()),c>0?o=o.add(a[c-1>>1]):c<0&&(o=o.sub(a[-c-1>>1]))}return o}},{key:"_wnafMulAdd",value:function(e,t,r){q(e>>>0===e),q(Array.isArray(t)),q(Array.isArray(r)),q(t.length===r.length);for(var n=t.length,i=new Array(n),a=new Array(n),s=0,o=0;o<n;o++){var u=t[o],c=r[o];if(q(u instanceof g),q(c instanceof l),o>0&&u.type!==t[o-1].type)throw new Error("Cannot mix points.");i[o]=null,a[o]=null,s=Math.max(s,c.bitLength()+1)}for(var f=null,h=null,p=0,d=0;d<n;d++){var v=t[d],y=r[d],b=v._getNAF(0);b?(i[p]=b.points,a[p]=K(y,b.width,s),p+=1):f?(i[p]=f._getJNAF(v),a[p]=U(h,y,s),f=null,h=null,p+=1):(f=v,h=y)}if(f){var m=f._safeNAF(e);i[p]=m.points,a[p]=K(h,m.width,s),p+=1}for(var k=this.jpoint(),w=s-1;w>=0;w--){w!==s-1&&(k=k.dbl());for(var x=0;x<p;x++){var S=a[x][w];S>0?k=k.add(i[x][S-1>>1]):S<0&&(k=k.sub(i[x][-S-1>>1]))}}return k}},{key:"_endoWnafMulAdd",value:function(e,t){throw new Error("Not implemented.")}},{key:"_scale",value:function(e,r){switch(q(e instanceof t),q(e.p.eq(this.p)),e.type){case"short":return this._scaleShort(e,r);case"mont":return this._scaleMont(e,r);case"edwards":return this._scaleEdwards(e,r);default:throw new Error("Not implemented.")}}},{key:"_scaleShort",value:function(e,t){throw new Error("Not implemented.")}},{key:"_scaleMont",value:function(e,t){throw new Error("Not implemented.")}},{key:"_scaleEdwards",value:function(e,t){throw new Error("Not implemented.")}},{key:"isElliptic",value:function(){throw new Error("Not implemented.")}},{key:"jinv",value:function(){throw new Error("Not implemented.")}},{key:"isComplete",value:function(){return!1}},{key:"precompute",value:function(e){return q(!this.g.isInfinity(),"Must have base point."),q(!this.n.isZero(),"Must have order."),this.g.precompute(this.n.bitLength(),e),this}},{key:"scalar",value:function(e,t,r){var n=new l(e,t,r);return q(!n.red),this.n.isZero()?n:n.imod(this.n)}},{key:"field",value:function(e,t,r){var n=l.cast(e,t,r);return n.red?n.forceRed(this.red):n.toRed(this.red)}},{key:"point",value:function(e,t){throw new Error("Not implemented.")}},{key:"jpoint",value:function(e,t,r){throw new Error("Not implemented.")}},{key:"xpoint",value:function(e,t){throw new Error("Not implemented.")}},{key:"cpoint",value:function(e,t,r,n){if(q(e instanceof l),q(t instanceof l),q(r instanceof l),q(n instanceof l),t.isZero()||n.isZero())return this.point();var i=t.redMul(n).redInvert(),a=e.redMul(n).redMul(i),s=r.redMul(t).redMul(i);return this.point(a,s)}},{key:"solveX2",value:function(e){throw new Error("Not implemented.")}},{key:"solveX",value:function(e){return this.solveX2(e).redSqrt()}},{key:"solveY2",value:function(e){throw new Error("Not implemented.")}},{key:"solveY",value:function(e){return this.solveY2(e).redSqrt()}},{key:"validate",value:function(e){throw new Error("Not implemented.")}},{key:"pointFromX",value:function(e,t){throw new Error("Not implemented.")}},{key:"pointFromY",value:function(e,t){throw new Error("Not implemented.")}},{key:"isIsomorphic",value:function(e){throw new Error("Not implemented.")}},{key:"isIsogenous",value:function(e){throw new Error("Not implemented.")}},{key:"pointFromShort",value:function(e){throw new Error("Not implemented.")}},{key:"pointFromMont",value:function(e,t){throw new Error("Not implemented.")}},{key:"pointFromEdwards",value:function(e){throw new Error("Not implemented.")}},{key:"pointFromUniform",value:function(e){throw new Error("Not implemented.")}},{key:"pointToUniform",value:function(e){throw new Error("Not implemented.")}},{key:"pointFromHash",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q(e.isBuffer(t)),q("boolean"===typeof r),t.length!==2*this.fieldSize)throw new Error("Invalid hash size.");var n=t.slice(0,this.fieldSize),i=t.slice(this.fieldSize),a=this.decodeUniform(n),s=this.decodeUniform(i),o=this.pointFromUniform(a),u=this.pointFromUniform(s),c=o.uadd(u);return r?c.mulH():c}},{key:"pointToHash",value:function(t,r,n){q(t instanceof this.Point),q(r>>>0===r);for(var i=r%this.torsion.length,a=t.add(this.torsion[i]);;){var s=this.randomField(n),o=this.pointFromUniform(s);if(!o.neg().eq(o)){var u=a.usub(o),c=V(n),f=void 0;try{f=this.pointToUniform(u,15&c)}catch(p){if("Invalid point."===p.message)continue;throw p}var h=this.encodeUniform(s,c>>>8),l=this.encodeUniform(f,c>>>16);return e.concat([h,l])}}}},{key:"randomScalar",value:function(e){var t=this.n.isZero()?this.p:this.n;return l.random(e,1,t)}},{key:"randomField",value:function(e){return l.random(e,1,this.p).toRed(this.red)}},{key:"randomPoint",value:function(e){for(var t;;){var r=this.randomField(e),n=0!==(1&V(e));try{t=this.pointFromX(r,n)}catch(i){continue}return q(t.validate()),t.mulH()}}},{key:"mulAll",value:function(e,t){return this.jmulAll(e,t)}},{key:"mulAllSimple",value:function(e,t){return this.jmulAllSimple(e,t)}},{key:"jmulAll",value:function(e,t){return q(Array.isArray(e)),q(0===e.length||e[0]instanceof g),this.endo&&e.length>0&&e[0].type===p?this._endoWnafMulAdd(e,t):this._wnafMulAdd(4,e,t)}},{key:"jmulAllSimple",value:function(e,t){return this._simpleMulAdd(e,t)}},{key:"mulH",value:function(e){return q(e instanceof l),this.imulH(e.clone())}},{key:"imulH",value:function(e){q(e instanceof l),q(!e.red);var t=this.h.word(0);if(0===(t&t-1)){var r=this.h.bitLength();return e.iushln(r-1).imod(this.n)}return e.imuln(t).imod(this.n)}},{key:"reduce",value:function(e){return this.mask.reduce(e)}},{key:"splitHash",value:function(e){return this.mask.splitHash(e)}},{key:"clamp",value:function(e){return this.mask.clamp(e)}},{key:"encodeField",value:function(e){return q(e instanceof l),q(!e.red),e.encode(this.endian,this.fieldSize)}},{key:"decodeField",value:function(t){if(q(e.isBuffer(t)),t.length!==this.fieldSize)throw new Error("Invalid field element size.");return l.decode(t,this.endian)}},{key:"encodeAdjusted",value:function(e){return q(e instanceof l),q(!e.red),e.encode(this.endian,this.adjustedSize)}},{key:"decodeAdjusted",value:function(t){if(q(e.isBuffer(t)),t.length!==this.adjustedSize)throw new Error("Invalid field element size.");return l.decode(t,this.endian)}},{key:"encodeScalar",value:function(e){return q(e instanceof l),q(!e.red),e.encode(this.endian,this.scalarSize)}},{key:"decodeScalar",value:function(t){if(q(e.isBuffer(t)),t.length!==this.scalarSize)throw new Error("Invalid scalar size.");return l.decode(t,this.endian)}},{key:"encodeUniform",value:function(e,t){q(e instanceof l),q(t>>>0===t);var r=255;0!==(7&this.fieldBits)&&(r=(1<<(7&this.fieldBits))-1);var n=e.fromRed(),i="le"===this.endian?this.fieldSize-1:0,a=n.encode(this.endian,this.fieldSize);return a[i]|=t&~r&255,a}},{key:"decodeUniform",value:function(t){if(q(e.isBuffer(t)),t.length!==this.fieldSize)throw new Error("Invalid field size.");var r=l.decode(t,this.endian);return r.iumaskn(this.fieldBits),r.toRed(this.red)}},{key:"encodePoint",value:function(e,t){return q(e instanceof g),e.encode(t)}},{key:"decodePoint",value:function(e){throw new Error("Not implemented.")}},{key:"encodeX",value:function(e){throw new Error("Not implemented.")}},{key:"decodeX",value:function(e){throw new Error("Not implemented.")}},{key:"decodeEven",value:function(e){throw new Error("Not implemented.")}},{key:"decodeSquare",value:function(e){throw new Error("Not implemented.")}},{key:"toShort",value:function(){throw new Error("Not implemented.")}},{key:"toMont",value:function(e){throw new Error("Not implemented.")}},{key:"toEdwards",value:function(e){throw new Error("Not implemented.")}},{key:"pointToJSON",value:function(e,t){return q(e instanceof g),e.toJSON(t)}},{key:"pointFromJSON",value:function(e){throw new Error("Not implemented.")}},{key:"toJSON",value:function(e){var t,r,n,i,a;return"edwards"===this.type&&(t=this.prefix?this.prefix.toString():null,r=this.context),this.n.isZero()||(n=this.n.toJSON()),this.z.isZero()||(i=this.z.fromRed(),this.z.redIsHigh()&&i.isub(this.p),i=i.toString(16)),this.endo&&(a=this.endo.toJSON()),{id:this.id,ossl:this.ossl,type:this.type,endian:this.endian,hash:this.hash,prefix:t,context:r,prime:this.prime,p:this.p.toJSON(),a:void 0,b:void 0,d:void 0,n:n,h:this.h.toString(16),s:void 0,z:i,c:void 0,g:this.g.toJSON(e),endo:a}}}],[{key:"fromJSON",value:function(e){return new this(e)}}]),t}(),g=function(){function e(t,r){c(this,e),q(t instanceof m),q(r>>>0===r),this.curve=t,this.type=r,this.pre=null}return f(e,[{key:"_init",value:function(){throw new Error("Not implemented.")}},{key:"_getNAF",value:function(e){if(q(e>>>0===e),this.pre&&this.pre.naf)return this.pre.naf;if(0===e)return null;var t=1<<e-1,r=new Array(t),n=1===t?null:this.dbl();r[0]=this;for(var i=1;i<t;i++)r[i]=r[i-1].add(n);return new B(e,r)}},{key:"_safeNAF",value:function(e){return this._getNAF(e)}},{key:"_getWindows",value:function(e,t){if(q(e>>>0===e),q(t>>>0===t),this.pre&&this.pre.windows)return this.pre.windows;if(0===e)return null;for(var r=1<<e,n=(t+e-1)/e>>>0,i=new Array(n*r),a=this.toP(),s=0;s<n;s++){i[s*r]=this.curve.point();for(var o=1;o<r;o++)i[s*r+o]=i[s*r+o-1].add(a);a=a.dblp(e)}return new R(e,t,i)}},{key:"_getDoubles",value:function(e,t){if(q(e>>>0===e),q(t>>>0===t),this.pre&&this.pre.doubles)return this.pre.doubles;if(0===e)return null;var r=Math.ceil(t/e)+1,n=new Array(r),i=this,a=0;n[a++]=i;for(var s=0;s<t;s+=e){for(var o=0;o<e;o++)i=i.dbl();n[a++]=i}return q(a===r),new N(e,n)}},{key:"_getBeta",value:function(){return null}},{key:"_getBlinding",value:function(e){if(this.pre&&this.pre.blinding)return this.pre.blinding;if(!e)return null;if(this.curve.n.isZero())return null;var t=this.curve.randomScalar(e),r=this.mul(t);return new P(t,r)}},{key:"_hasWindows",value:function(e){return q(e instanceof l),!(!this.pre||!this.pre.windows)&&this.pre.windows.bits>=e.bitLength()}},{key:"_hasDoubles",value:function(e){if(q(e instanceof l),!this.pre||!this.pre.doubles)return!1;var t=this.pre.doubles,r=t.step,n=t.points,i=e.bitLength()+1;return n.length>=Math.ceil(i/r)+1}},{key:"_getJNAF",value:function(t){return q(t instanceof e),q(t.type===this.type),[this,this.add(t),this.sub(t),t]}},{key:"_blind",value:function(e,t){if(q(e instanceof l),q(!e.red),this.pre&&this.pre.blinding){var r=this.pre.blinding,n=r.blind,i=r.unblind;return[this,e.sub(n),i]}return t?this.pre?this.curve.n.isZero()?[this,e,null]:[this,this.curve.randomScalar(t).mul(this.curve.n).iadd(e),null]:[this.randomize(t),e,null]:[this,e,null]}},{key:"clone",value:function(){throw new Error("Not implemented.")}},{key:"swap",value:function(e,t){throw new Error("Not implemented.")}},{key:"precompute",value:function(e,t){return q(e>>>0===e),this.pre||(this.pre=new C),this.pre.naf||(this.pre.naf=this._getNAF(8)),this.pre.doubles||(this.pre.doubles=this._getDoubles(4,e+1)),this.pre.beta||(this.pre.beta=this._getBeta()),this.pre.blinding||(this.pre.blinding=this._getBlinding(t)),this}},{key:"validate",value:function(){return this.curve.validate(this)}},{key:"normalize",value:function(){return this}},{key:"scale",value:function(e){throw new Error("Not implemented.")}},{key:"randomize",value:function(e){var t=this.curve.randomField(e);return this.scale(t)}},{key:"neg",value:function(){throw new Error("Not implemented.")}},{key:"add",value:function(e){throw new Error("Not implemented.")}},{key:"sub",value:function(t){return q(t instanceof e),this.add(t.neg())}},{key:"dbl",value:function(){throw new Error("Not implemented.")}},{key:"dblp",value:function(e){q(e>>>0===e);for(var t=this,r=0;r<e;r++)t=t.dbl();return t}},{key:"uadd",value:function(e){throw new Error("Not implemented.")}},{key:"usub",value:function(t){return q(t instanceof e),this.uadd(t.neg())}},{key:"udbl",value:function(){throw new Error("Not implemented.")}},{key:"zaddu",value:function(e){throw new Error("Not implemented.")}},{key:"zaddc",value:function(e){throw new Error("Not implemented.")}},{key:"zdblu",value:function(){throw new Error("Not implemented.")}},{key:"diffAdd",value:function(e,t){throw new Error("Not implemented.")}},{key:"diffAddDbl",value:function(e,t){throw new Error("Not implemented.")}},{key:"recover",value:function(){throw new Error("Not implemented.")}},{key:"getX",value:function(){throw new Error("Not implemented.")}},{key:"getY",value:function(){throw new Error("Not implemented.")}},{key:"eq",value:function(e){throw new Error("Not implemented.")}},{key:"isInfinity",value:function(){throw new Error("Not implemented.")}},{key:"isOdd",value:function(){throw new Error("Not implemented.")}},{key:"isEven",value:function(){throw new Error("Not implemented.")}},{key:"isSquare",value:function(){throw new Error("Not implemented.")}},{key:"eqX",value:function(e){throw new Error("Not implemented.")}},{key:"eqXToP",value:function(e){throw new Error("Not implemented.")}},{key:"isSmall",value:function(){return!this.isInfinity()&&this.jmulH().isInfinity()}},{key:"hasTorsion",value:function(){return!this.isInfinity()&&!this.jmul(this.curve.n).isInfinity()}},{key:"mul",value:function(e){return this.jmul(e)}},{key:"muln",value:function(e){return this.jmuln(e)}},{key:"mulSimple",value:function(e){return this.jmulSimple(e)}},{key:"mulBlind",value:function(e,t){return this.jmulBlind(e,t)}},{key:"mulConst",value:function(e,t){return this.jmulConst(e,t)}},{key:"mulAdd",value:function(e,t,r){return this.jmulAdd(e,t,r)}},{key:"mulAddSimple",value:function(e,t,r){return this.jmulAddSimple(e,t,r)}},{key:"mulH",value:function(){return this.jmulH()}},{key:"div",value:function(e){return this.jdiv(e)}},{key:"divn",value:function(e){return this.jdivn(e)}},{key:"divH",value:function(){return this.jdivH()}},{key:"jmul",value:function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo&&this.type===p?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(4,this,e)}},{key:"jmuln",value:function(e){return q((0|e)===e),this.jmulSimple(new l(e))}},{key:"jmulSimple",value:function(e){return this.curve._simpleMul(this,e)}},{key:"jmulBlind",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._blind(e,t),n=u(r,3),i=n[0],a=n[1],s=n[2],o=i.jmul(a);return s?o.add(s):o}},{key:"jmulConst",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._blind(e,t),n=u(r,3),i=n[0],a=n[1],s=n[2],o=this.curve._constMul(i,a,t);return s?o.uadd(s):o}},{key:"jmulAdd",value:function(e,t,r){return this.curve.endo&&this.type===p?this.curve._endoWnafMulAdd([this,t],[e,r]):this.curve._wnafMulAdd(4,[this,t],[e,r])}},{key:"jmulAddSimple",value:function(e,t,r){return this.curve._simpleMulAdd([this,t],[e,r])}},{key:"jmulH",value:function(){var e=this.curve.h.word(0);if(0===(e&e-1)){var t=this.curve.h.bitLength();return this.toJ().dblp(t-1)}return this.jmulSimple(this.curve.h)}},{key:"jdiv",value:function(e){return q(e instanceof l),q(!e.red),this.jmul(e.invert(this.curve.n))}},{key:"jdivn",value:function(e){return q(!this.curve.n.isZero()),0===this.curve.h.cmpn(e)?this.jdivH():this.jdiv(new l(e))}},{key:"jdivH",value:function(){return this.curve.n.isZero()?this.toJ():0===this.curve.h.cmpn(1)?this.toJ():(null===this.curve.hi&&(this.curve.hi=this.curve.h.invert(this.curve.n)),this.jmul(this.curve.hi))}},{key:"ladder",value:function(e){throw new Error("Not implemented.")}},{key:"ladderSimple",value:function(e){throw new Error("Not implemented.")}},{key:"ladderBlind",value:function(e,t){throw new Error("Not implemented.")}},{key:"ladderConst",value:function(e,t){throw new Error("Not implemented.")}},{key:"toP",value:function(){return this.normalize()}},{key:"toJ",value:function(){return this}},{key:"toX",value:function(){return this}},{key:"encode",value:function(e){throw new Error("Not implemented.")}},{key:"encodeX",value:function(){throw new Error("Not implemented.")}},{key:"toJSON",value:function(e){throw new Error("Not implemented.")}},{key:h,value:function(){return"<Point>"}}],[{key:"decode",value:function(e,t){throw new Error("Not implemented.")}},{key:"decodeX",value:function(e,t){throw new Error("Not implemented.")}},{key:"decodeEven",value:function(e,t){throw new Error("Not implemented.")}},{key:"decodeSquare",value:function(e,t){throw new Error("Not implemented.")}},{key:"fromJSON",value:function(e,t){throw new Error("Not implemented.")}}]),e}(),k=function(e){function t(e){var r;return c(this,t),(r=i(this,a(t).call(this,w,"short",e))).a=l.fromJSON(e.a).toRed(r.red),r.b=l.fromJSON(e.b).toRed(r.red),r.c=l.fromJSON(e.c||"0").toRed(r.red),r.ai=r.a.isZero()?r.zero:r.a.redInvert(),r.zi=r.z.isZero()?r.zero:r.z.redInvert(),r.zeroA=r.a.isZero(),r.threeA=r.a.eq(r.three.redNeg()),r.redN=r.n.toRed(r.red),r.pmodn=r.p.clone(),r.highOrder=r.n.cmp(r.p)>=0,r.smallGap=!1,r._finalize(e),r}return o(t,e),f(t,[{key:"_finalize",value:function(e){return s(a(t.prototype),"_finalize",this).call(this,e),null!=e.endo?this.endo=M.fromJSON(this,e.endo):this.endo=this._getEndomorphism(),this.n.isZero()||(this.pmodn=this.p.mod(this.n),this.smallGap=this.p.div(this.n).cmpn(1)<=0),this}},{key:"_short",value:function(e,r){return t._isomorphism(this.a,this.b,e,r)}},{key:"_mont",value:function(e,t){var r=this._findRS(t),n=u(r,2),i=n[0],a=n[1].redInvert(),s=i.redMuln(3).redMul(a);return null!=e?S._isomorphism(s,a,e):[s,a]}},{key:"_edwards",value:function(e,t){var r=this._findRS(t),n=u(r,2),i=n[0],a=n[1],s=i.redMuln(3),o=a.redMuln(2),c=s.redAdd(o),f=s.redSub(o);return null!=e?I._isomorphism(c,f,e):[c,f]}},{key:"_findRS",value:function(e){q(null==e||"boolean"===typeof e),q(this.h.word(0)>=4),q(!this.n.isZero());for(var t,r=this.one.redNeg();;){r.redIAdd(this.one);try{t=this.pointFromX(r)}catch(a){continue}if(!(t=t.mul(this.n)).isInfinity()&&t.y.isZero())break}var n=t.x,i=n.redSqr().redMuln(3).redIAdd(this.a).redSqrt();return null!=e&&i.redIsOdd()!==e&&i.redINeg(),[n,i]}},{key:"_scale0",value:function(e,t){var r=this.a.redDiv(this.field(e)),n=this.b.redDiv(this.field(t)),i=r.redSqrt();r.redMul(i).eq(n)||i.redINeg(),q(r.redMul(i).eq(n));var a=i.redSqrt(),s=i.redMul(a);return q(!a.isZero()),[i,s]}},{key:"_scale1",value:function(e,t){var r=this.g.x.redDiv(this.field(e)),n=this.g.y.redDiv(this.field(t)),i=r.redSqrt();return r.redMul(i).eq(n)||i.redINeg(),q(r.redMul(i).eq(n)),q(!i.isZero()),[r,n]}},{key:"_scaleShort",value:function(e){return q(e instanceof t),this.g.isInfinity()||e.g.isInfinity()?this._scale0(e.a,e.b):this._scale1(e.g.x,e.g.y)}},{key:"_scaleMont",value:function(e){if(q(e instanceof S),this.g.isInfinity()||e.g.isInfinity()){var t=e._short(),r=u(t,2),n=r[0],i=r[1];return this._scale0(n,i)}var a=e.g,s=a.x,o=a.y,c=s.redAdd(e.a3).redMul(e.bi),f=o.redMul(e.bi);return this._scale1(c,f)}},{key:"_scaleEdwards",value:function(e){if(q(e instanceof I),this.g.isInfinity()||e.g.isInfinity()){var t=e._short(),r=u(t,2),n=r[0],i=r[1];return this._scale0(n,i)}var a=e.g,s=a.x,o=a.y,c=a.z,f=e.a.redMuln(5),h=e.d.redMuln(5),l=e.d.redSub(e.a),p=h.redSub(e.a),d=e.d.redSub(f),v=o.redAdd(c),y=o.redSub(c),b=p.redMul(o).redIAdd(d.redMul(c)),m=y.redMuln(12),g=l.redMul(v).redMul(c),k=y.redMul(s).redIMuln(4),w=m.redMul(k).redInvert(),x=b.redMul(k).redMul(w),S=g.redMul(m).redMul(w);return this._scale1(x,S)}},{key:"_getEndomorphism",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this.n.isZero()||this.g.isInfinity())return null;if(!this.zeroA||1!==this.p.modrn(3)||1!==this.n.modrn(3))return null;var t,r=this._getEndoRoots(this.p),n=u(r,2),i=n[0],a=n[1],s=[i,a][1&e].toRed(this.red),o=this._getEndoRoots(this.n),c=u(o,2),f=c[0],h=c[1],l=this.point(this.g.x.redMul(s),this.g.y);this.g.mul(f).eq(l)?t=f:(q(this.g.mul(h).eq(l)),t=h);var p=this._getEndoBasis(t),d=this._getEndoPrecomp(p);return new M(s,t,p,d)}},{key:"_getEndoRoots",value:function(e){var t=e===this.p?this.red:l.mont(e),r=new l(2).toRed(t),n=new l(3).toRed(t),i=r.redInvert(),a=n.redNeg().redSqrt().redMul(i),s=a.redNeg();return[a.redSub(i).fromRed(),s.redSub(i).fromRed()].sort(l.cmp)}},{key:"_getEndoBasis",value:function(e){var t,r,n=this._egcdSqrt(e),i=u(n,6),a=i[0],s=i[1],o=i[2],c=i[3],f=i[4],h=i[5],l=o,p=c.neg(),d=a.sqr().iadd(s.sqr()),v=f.sqr().iadd(h.sqr());return d.cmp(v)<=0?(t=a,r=s.neg()):(t=f,r=h.neg()),[new D(l,p),new D(t,r)]}},{key:"_egcdSqrt",value:function(e){q(e instanceof l),q(!e.red),q(e.sign()>0),q(this.n.sign()>0);for(var t,r,n,i,a,s=this.n.ushrn(this.n.bitLength()>>>1),o=e,u=this.n.clone(),c=new l(1),f=new l(0),h=new l(0),p=new l(1),d=0,v=0;!o.isZero()&&d<2;){var y=u.quo(o),b=u.sub(y.mul(o)),m=h.sub(y.mul(c)),g=p.sub(y.mul(f));0===v&&b.cmp(s)<0&&(t=a,r=c,n=b,i=m,v=1),a=b,u=o,o=b,h=c,c=m,p=f,f=g,d+=v}return q(0!==v,"Could not find r < sqrt(n)."),[t,r,n,i,h,c]}},{key:"_getEndoPrecomp",value:function(e){q(Array.isArray(e)),q(2===e.length),q(e[0]instanceof D),q(e[1]instanceof D);var t=u(e,2),r=t[0],n=t[1],i=r.a.mul(n.b).isub(r.b.mul(n.a)),a=i.bitLength()+16,s=l.shift(1,a),o=s.mul(n.b).divRound(i),c=s.mul(r.b).divRound(i);return q(i.eq(this.n)),[o,c]}},{key:"_endoSplit",value:function(e){q(e instanceof l),q(!e.red),q(!this.n.isZero());var t=u(this.endo.basis,2),r=t[0],n=t[1],i=n.b.mul(e).divRound(this.n),a=r.b.neg().mul(e).divRound(this.n),s=i.mul(r.a),o=a.mul(n.a),c=i.ineg().mul(r.b),f=a.mul(n.b);return[e.sub(s).isub(o),c.isub(f)]}},{key:"_endoBeta",value:function(e){return q(e instanceof w),[e,e._getBeta()]}},{key:"_endoWnafMulAdd",value:function(e,t){q(Array.isArray(e)),q(Array.isArray(t)),q(e.length===t.length),q(null!=this.endo);for(var r=e.length,n=new Array(2*r),i=new Array(2*r),a=0;a<r;a++){var s=this._endoBeta(e[a]),o=u(s,2),c=o[0],f=o[1],h=this._endoSplit(t[a]),l=u(h,2),p=l[0],d=l[1];n[2*a+0]=c,i[2*a+0]=p,n[2*a+1]=f,i[2*a+1]=d}return this._wnafMulAdd(4,n,i)}},{key:"_icart",value:function(e){var t=this.a,r=this.b,n=this.i3,i=this.one,a=n.redSqr().redMul(n),s=this.p.ushln(1).isubn(1).idivn(3),o=e.clone();o.cinject(i,o.czero());var u=o.redSqr(),c=u.redSqr(),f=c.redMul(u),h=o.redMuln(6).redFermat(),l=t.redMuln(3).redISub(c).redMul(h),p=l.redSqr(),d=f.redMul(a),v=u.redMul(n),y=p.redISub(r).redISub(d).redPow(s).redIAdd(v),b=o.redMul(y).redIAdd(l);return this.point(y,b)}},{key:"_sswu",value:function(e){var t=this.b,r=this.z,n=this.ai,i=this.zi,a=this.one,s=this.p.subn(2),o=r.redSqr(),u=t.redNeg().redMul(n),c=t.redMul(i).redMul(n),f=e.redSqr(),h=f.redSqr(),l=o.redMul(h).redIAdd(r.redMul(f)).redPow(s),p=u.redMul(a.redAdd(l));p.cinject(c,l.czero());var d=r.redMul(f).redMul(p),v=this.solveY2(p),y=this.solveY2(d),b=0|v.redIsSquare(),m=p.cinject(d,1^b),g=v.cinject(y,1^b).redSqrt();return g.cinject(g.redNeg(),g.redIsOdd()^e.redIsOdd()),this.point(m,g)}},{key:"_sswui",value:function(e,t){var r=this.a,n=this.b,i=this.z,a=e.x,s=e.y,o=3&t,c=r.redSqr().redMul(a.redSqr()),f=r.redMul(n).redMul(a).redIMuln(2),h=n.redSqr().redMuln(3),l=r.redMul(a).redIAdd(n),p=z(c.redISub(f).redISub(h)),d=u(p,2),v=d[0],y=d[1],b=l.redSub(y).redINeg(),m=l.redAdd(y).redINeg(),g=l.redMul(i).redIMuln(2),k=n.redMul(i).redIMuln(2);b.cinject(m,1&o),g.cinject(k,o>>>1);var w=j(b,g),x=u(w,2),S=x[0],E=x[1];if(E.cinject(E.redNeg(),E.redIsOdd()^s.redIsOdd()),!(v&S))throw new Error("Invalid point.");return E}},{key:"_svdwf",value:function(e){var t=this.c,r=this.z,n=this.zi,i=this.i2,a=this.i3,s=this.p.subn(2),o=this.solveY2(r),u=a.redMul(n.redSqr()),c=e.redSqr(),f=c.redSqr(),h=c.redAdd(o),l=c.redMul(h).redPow(s),p=f.redMul(l).redMul(t),d=h.redSqr().redMul(h),v=t.redSub(r).redMul(i).redISub(p),y=p.redSub(t.redAdd(r).redMul(i)),b=r.redSub(d.redMul(l).redMul(u)),m=this.solveY2(v),g=this.solveY2(y),k=this.solveY2(b),w=0|m.redIsSquare(),x=0|g.redIsSquare();return v.cinject(y,(1^w)&x),m.cinject(g,(1^w)&x),v.cinject(b,(1^w)&(1^x)),m.cinject(k,(1^w)&(1^x)),[v,m]}},{key:"_svdw",value:function(e){var t=this._svdwf(e),r=u(t,2),n=r[0],i=r[1].redSqrt();return i.cinject(i.redNeg(),i.redIsOdd()^e.redIsOdd()),this.point(n,i)}},{key:"_svdwi",value:function(e,t){var r=this.b,n=this.c,i=this.z,a=this.two,s=e.x,o=e.y,c=3&t,f=i.redSqr(),h=f.redMul(i),l=f.redSqr(),p=h.redAdd(r),d=p.redMuln(2),v=s.redSqr(),y=s.redMuln(2).redIAdd(i),b=s.redMul(f),m=n.redSub(y),g=n.redAdd(y),k=v.redMul(f).redIAdd(l).redIMuln(9),w=s.redMul(h).redIMuln(18),x=p.redMul(s.redSub(i)).redIMuln(12),S=z(k.redISub(w).redIAdd(x)),E=u(S,2),_=c-2>>>31|E[0],I=E[1].redMul(i),A=h.redISub(b).redIMuln(3).redISub(d),T=p.redMul(m),C=p.redMul(g),B=A.redAdd(I),R=A.redSub(I),N=a.clone();T.cinject(C,(1^c)-1>>>31),T.cinject(B,(2^c)-1>>>31),T.cinject(R,(3^c)-1>>>31),N.cinject(g,(0^c)-1>>>31),N.cinject(m,(1^c)-1>>>31);var P=j(T,N),M=u(P,2),D=M[0],O=M[1],L=this._svdwf(O),K=u(L,1)[0].ceq(s);if(O.cinject(O.redNeg(),O.redIsOdd()^o.redIsOdd()),!(_&D&K))throw new Error("Invalid point.");return O}},{key:"isElliptic",value:function(){var e=this.a,t=this.b,r=e.redSqr().redMul(e);return!t.redSqr().redMuln(27).redIAdd(r.redMuln(4)).isZero()}},{key:"jinv",value:function(){var e=this.a,t=this.b,r=e.redSqr().redMul(e),n=t.redSqr(),i=r.redMuln(4),a=i.redMuln(1728),s=n.redMuln(27).redIAdd(i);if(s.isZero())throw new Error("Curve is not elliptic.");return a.redDiv(s).fromRed()}},{key:"point",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new w(this,e,t,r)}},{key:"jpoint",value:function(e,t,r){return new x(this,e,t,r)}},{key:"solveY2",value:function(e){q(e instanceof l);var t=e.redSqr().redMul(e).redIAdd(this.b);return this.zeroA||(this.threeA?t.redIAdd(e.redMuln(-3)):t.redIAdd(this.a.redMul(e))),t}},{key:"validate",value:function(e){if(q(e instanceof w),e.inf)return!0;var t=e.x,r=e.y,n=this.solveY2(t);return r.redSqr().eq(n)}},{key:"pointFromX",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;q(e instanceof l),q(null==t||"boolean"===typeof t),e.red||(e=e.toRed(this.red));var r=this.solveY(e);return null!=t&&r.redIsOdd()!==t&&r.redINeg(),this.point(e,r)}},{key:"isIsomorphic",value:function(e){if(q(e instanceof m),!e.p.eq(this.p))return!1;var t,r;try{var n=this._scale(e),i=u(n,2);t=i[0],r=i[1]}catch(l){return!1}if("short"===e.type){var a=this.field(e.a).redMul(t.redSqr()),s=this.field(e.b).redMul(r.redSqr());return this.a.eq(a)&&this.b.eq(s)}if("mont"===e.type){var o=e.a3,c=e.bi,f=this.field(o.redMul(c)).redMul(t);return this.solveY2(f).isZero()}if("edwards"===e.type){var h=this.field(e.ad6).redMul(t);return this.solveY2(h).isZero()}return!1}},{key:"isIsogenous",value:function(e){return q(e instanceof m),!1}},{key:"pointFromShort",value:function(e){if(q(e instanceof w),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();var t=this._scale(e.curve),r=u(t,2),n=r[0],i=r[1],a=this.field(e.x),s=this.field(e.y),o=a.redMul(n),c=s.redMul(i);return this.point(o,c)}throw new Error("Not implemented.")}},{key:"pointFromMont",value:function(e){if(q(e instanceof E),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();var t=e.curve,r=t.a3,n=t.bi,i=this._scale(e.curve),a=u(i,2),s=a[0],o=a[1],c=e.x.redAdd(r).redMul(n),f=e.y.redMul(n);return this.point(this.field(c).redMul(s),this.field(f).redMul(o))}throw new Error("Not implemented.")}},{key:"pointFromEdwards",value:function(e){if(q(e instanceof A),this.isIsomorphic(e.curve)){var t=e.curve,r=t.a,n=t.d,i=t.ad6,a=this._scale(e.curve),s=u(a,2),o=s[0],c=s[1];if(e.isInfinity())return this.point();if(e.x.isZero()){var f=this.field(i).redMul(o);return this.point(f,this.zero)}var h=e.x,l=e.y,p=e.z,d=r.redMuln(5),v=n.redMuln(5),y=n.redSub(r),b=v.redSub(r),m=n.redSub(d),g=l.redAdd(p),k=l.redSub(p),w=b.redMul(l).redIAdd(m.redMul(p)),x=k.redMuln(12),S=y.redMul(g).redMul(p),E=k.redMul(h).redIMuln(4);return this.cpoint(this.field(w).redMul(o),this.field(x),this.field(S).redMul(c),this.field(E))}throw new Error("Not implemented.")}},{key:"pointFromUniform",value:function(e){if(q(e instanceof l),this.z.isZero()||this.b.isZero())throw new Error("Not implemented.");if(!this.a.isZero())return this._sswu(e);if(!this.c.isZero())return this._svdw(e);throw new Error("Not implemented.")}},{key:"pointToUniform",value:function(e,t){if(q(e instanceof w),q(t>>>0===t),this.z.isZero()||this.b.isZero())throw new Error("Not implemented.");if(e.isInfinity())throw new Error("Invalid point.");var r=(t>>>4&15)%this.torsion.length,n=e.add(this.torsion[r]);if(!this.a.isZero())return this._sswui(n,t);if(!this.c.isZero())return this._svdwi(n,t);throw new Error("Not implemented.")}},{key:"mulAll",value:function(e,r){return s(a(t.prototype),"mulAll",this).call(this,e,r).toP()}},{key:"mulAllSimple",value:function(e,r){return s(a(t.prototype),"mulAllSimple",this).call(this,e,r).toP()}},{key:"decodePoint",value:function(e){return w.decode(this,e)}},{key:"encodeX",value:function(e){return q(e instanceof g),e.encodeX()}},{key:"decodeEven",value:function(e){return w.decodeEven(this,e)}},{key:"decodeSquare",value:function(e){return w.decodeSquare(this,e)}},{key:"toShort",value:function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=this._short(e,r),a=u(i,2),s=a[0],o=a[1],c=new t({red:this.red,prime:this.prime,p:this.p,a:s,b:o,n:this.n,h:this.h});if(null!=n){var f=c._scale(this),h=u(f,2),l=h[1];l.redIsOdd()!==n&&l.redINeg()}this.g.isInfinity()||(c.g=c.pointFromShort(this.g));for(var p=0;p<this.h;p++)c.torsion[p]=c.pointFromShort(this.torsion[p]);return c}},{key:"toMont",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._mont(e,t),i=u(n,2),a=i[0],s=i[1],o=new S({red:this.red,prime:this.prime,p:this.p,a:a,b:s,n:this.n,h:this.h});if(null!=r){var c=this._scale(o),f=u(c,2),h=f[1];h.redIsOdd()!==r&&h.redINeg()}this.g.isInfinity()||(o.g=o.pointFromShort(this.g));for(var l=0;l<this.h;l++)o.torsion[l]=o.pointFromShort(this.torsion[l]);return o}},{key:"toEdwards",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._edwards(e,t),i=u(n,2),a=i[0],s=i[1],o=new I({red:this.red,prime:this.prime,p:this.p,a:a,d:s,n:this.n,h:this.h});if(null!=r){var c=this._scale(o),f=u(c,2),h=f[1];h.redIsOdd()!==r&&h.redINeg()}if(this.g.isInfinity()||(o.g=o.pointFromShort(this.g),o.g.normalize()),o.isComplete())for(var l=0;l<this.h;l++)o.torsion[l]=o.pointFromShort(this.torsion[l]),o.torsion[l].normalize();return o}},{key:"pointFromJSON",value:function(e){return w.fromJSON(this,e)}},{key:"toJSON",value:function(e){var r=s(a(t.prototype),"toJSON",this).call(this,e);return r.a=this.a.fromRed().toJSON(),r.b=this.b.fromRed().toJSON(),this.c.isZero()||(r.c=this.c.fromRed().toJSON()),r}}],[{key:"_isomorphism",value:function(e,t,r,n){q(e instanceof l),q(t instanceof l),q(r instanceof l),q(null==n||"boolean"===typeof n),q(!e.isZero()&&!t.isZero());var i=r.redDiv(e),a=i.redSqrt();if(null!=n?a.redIsOdd()!==n&&a.redINeg():1!==a.redJacobi()&&a.redINeg(),1!==a.redJacobi())throw new Error("Invalid `a` coefficient.");var s=i.redMul(a),o=e.redMul(i),u=t.redMul(s);return q(o.eq(r)),[o,u]}}]),t}(m),w=function(t){function r(e,t,n,s){var o;return c(this,r),q(e instanceof k),(o=i(this,a(r).call(this,e,p))).x=o.curve.zero,o.y=o.curve.zero,o.inf=1,null!=t&&o._init(t,n,s),o}return o(r,t),f(r,[{key:"_init",value:function(e,t,r){q(e instanceof l),q(t instanceof l),this.x=e,this.y=t,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=0|r}},{key:"_safeNAF",value:function(e){return q(e>>>0===e),this.pre&&this.pre.naf?this.pre.naf:e>1?this.toJ()._getNAF(e):this._getNAF(e)}},{key:"_getBeta",value:function(){var e=this;if(!this.curve.endo)return null;if(this.pre&&this.pre.beta)return this.pre.beta;var t=this.x.redMul(this.curve.endo.beta),r=this.curve.point(t,this.y);return this.pre&&(r.pre=this.pre.map((function(t){var r=t.x.redMul(e.curve.endo.beta);return e.curve.point(r,t.y)})),this.pre.beta=r),r}},{key:"_getJNAF",value:function(e){if(q(e instanceof r),this.inf|e.inf)return s(a(r.prototype),"_getJNAF",this).call(this,e);var t=[this,null,null,e];return this.y.eq(e.y)?(t[1]=this.add(e),t[2]=this.toJ().sub(e)):this.y.eq(e.y.redNeg())?(t[1]=this.toJ().add(e),t[2]=this.sub(e)):(t[1]=this.toJ().add(e),t[2]=this.toJ().sub(e)),t}},{key:"clone",value:function(){return this.curve.point(this.x.clone(),this.y.clone(),this.inf)}},{key:"swap",value:function(e,t){q(e instanceof r);var n=1&(t>>31|-t>>31),i=this.inf,a=e.inf;return this.x.cswap(e.x,t),this.y.cswap(e.y,t),this.inf=i&(1^n)|a&n,e.inf=a&(1^n)|i&n,this}},{key:"scale",value:function(e){return this.toJ().scale(e)}},{key:"neg",value:function(){return this.inf?this:this.curve.point(this.x,this.y.redNeg())}},{key:"add",value:function(e){if(q(e instanceof r),this.inf)return e;if(e.inf)return this;if(this.x.eq(e.x))return this.y.eq(e.y)?this.dbl():this.curve.point();if(this.y.eq(e.y)){var t=this.x.redNeg().redISub(e.x),n=this.y.redNeg();return this.curve.point(t,n)}var i=this.x.redSub(e.x),a=this.y.redSub(e.y).redDiv(i),s=a.redSqr().redISub(this.x).redISub(e.x),o=a.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,o)}},{key:"dbl",value:function(){if(this.inf)return this;if(this.y.isZero())return this.curve.point();var e=this.x.redSqr().redIMuln(3).redIAdd(this.curve.a),t=this.y.redMuln(2),r=e.redDiv(t),n=r.redSqr().redISub(this.x).redISub(this.x),i=r.redMul(this.x.redSub(n)).redISub(this.y);return this.curve.point(n,i)}},{key:"dblp",value:function(e){return this.toJ().dblp(e).toP()}},{key:"uadd",value:function(e){q(e instanceof r);var t=this.y.redAdd(e.y),n=this.x.redAdd(e.x).redSqr(),i=this.x.redMul(e.x),a=n.redISub(i).redIAdd(this.curve.a),s=t.czero()&a.czero();t.cinject(this.x.redSub(e.x),s),a.cinject(this.y.redSub(e.y),s);var o=t.czero()&(1^(this.inf|e.inf));t.cinject(this.curve.one,t.czero());var u=a.redMul(t.redFermat()),c=u.redSqr().redISub(this.x).redISub(e.x),f=u.redMul(this.x.redSub(c)).redISub(this.y),h=o|this.inf&e.inf;return c.cinject(e.x,this.inf),f.cinject(e.y,this.inf),c.cinject(this.x,e.inf),f.cinject(this.y,e.inf),c.cinject(this.curve.zero,h),f.cinject(this.curve.zero,h),this.curve.point(c,f,h)}},{key:"udbl",value:function(){return this.uadd(this)}},{key:"recover",value:function(e,t,r,n){if(q(e instanceof l),q(t instanceof l),q(r instanceof l),q(n instanceof l),this.inf)return this.curve.jpoint();var i=t.redMul(n),a=i.redSqr(),s=a.redMul(i),o=this.x.redMul(i),u=e.redMul(n),c=r.redMul(t),f=this.curve.b.redMul(s).redIMuln(2),h=o.redMul(u).redIAdd(this.curve.a.redMul(a)),p=o.redAdd(u),d=o.redISub(u),v=f.redIAdd(h.redMul(p)),y=c.redMul(d.redSqr()),b=v.redISub(y),m=this.y.redMul(s).redIMuln(2),g=e.redMul(m),k=b.redMul(t),w=t.redMul(m),x=g.redMul(w),S=k.redMul(w.redSqr()),E=w;return this.curve.jpoint(x,S,E)}},{key:"getX",value:function(){if(this.inf)throw new Error("Invalid point.");return this.x.fromRed()}},{key:"getY",value:function(){if(this.inf)throw new Error("Invalid point.");return this.y.fromRed()}},{key:"eq",value:function(e){return q(e instanceof r),this===e||(this.inf?0!==e.inf:!e.inf&&(this.x.eq(e.x)&&this.y.eq(e.y)))}},{key:"isInfinity",value:function(){return 0!==this.inf}},{key:"isOdd",value:function(){return!this.inf&&this.y.redIsOdd()}},{key:"isEven",value:function(){return!this.inf&&this.y.redIsEven()}},{key:"isSquare",value:function(){return!this.inf&&-1!==this.y.redJacobi()}},{key:"eqX",value:function(e){return q(e instanceof l),q(!e.red),!this.inf&&this.getX().eq(e)}},{key:"eqXToP",value:function(e){return q(e instanceof l),q(!e.red),q(!this.curve.n.isZero()),!this.inf&&this.getX().imod(this.curve.n).eq(e)}},{key:"mul",value:function(e){return s(a(r.prototype),"mul",this).call(this,e).toP()}},{key:"muln",value:function(e){return s(a(r.prototype),"muln",this).call(this,e).toP()}},{key:"mulSimple",value:function(e){return s(a(r.prototype),"mulSimple",this).call(this,e).toP()}},{key:"mulBlind",value:function(e,t){return s(a(r.prototype),"mulBlind",this).call(this,e,t).toP()}},{key:"mulConst",value:function(e,t){return s(a(r.prototype),"mulConst",this).call(this,e,t).toP()}},{key:"mulAdd",value:function(e,t,n){return s(a(r.prototype),"mulAdd",this).call(this,e,t,n).toP()}},{key:"mulAddSimple",value:function(e,t,n){return s(a(r.prototype),"mulAddSimple",this).call(this,e,t,n).toP()}},{key:"mulH",value:function(){return s(a(r.prototype),"mulH",this).call(this).toP()}},{key:"div",value:function(e){return s(a(r.prototype),"div",this).call(this,e).toP()}},{key:"divn",value:function(e){return s(a(r.prototype),"divn",this).call(this,e).toP()}},{key:"divH",value:function(){return s(a(r.prototype),"divH",this).call(this).toP()}},{key:"toP",value:function(){return this}},{key:"toJ",value:function(){return this.inf?this.curve.jpoint():this.curve.jpoint(this.x,this.y,this.curve.one)}},{key:"encode",value:function(t){null==t&&(t=!0),q("boolean"===typeof t);var r=this.curve.fieldSize;if(this.inf)throw new Error("Invalid point.");if(t){var n=e.allocUnsafe(1+r),i=this.curve.encodeField(this.getX());return n[0]=2|this.y.redIsOdd(),i.copy(n,1),n}var a=e.allocUnsafe(1+2*r),s=this.curve.encodeField(this.getX()),o=this.curve.encodeField(this.getY());return a[0]=4,s.copy(a,1),o.copy(a,1+r),a}},{key:"encodeX",value:function(){return this.curve.encodeField(this.getX())}},{key:"toJSON",value:function(e){if(this.inf)return[];var t=this.getX().toJSON(),r=this.getY().toJSON();return!0===e&&this.pre?[t,r,this.pre.toJSON()]:[t,r]}},{key:h,value:function(){return this.inf?"<ShortPoint: Infinity>":"<ShortPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+">"}}],[{key:"decode",value:function(t,r){q(t instanceof k),q(e.isBuffer(r));var n=t.fieldSize;if(r.length<1+n)throw new Error("Not a point.");var i=r[0];switch(i){case 2:case 3:if(r.length!==1+n)throw new Error("Invalid point size for compressed.");var a=t.decodeField(r.slice(1,1+n));if(a.cmp(t.p)>=0)throw new Error("Invalid point.");var s=t.pointFromX(a,3===i);return q(!s.isInfinity()),s;case 4:case 6:case 7:if(r.length!==1+2*n)throw new Error("Invalid point size for uncompressed.");var o=t.decodeField(r.slice(1,1+n)),u=t.decodeField(r.slice(1+n,1+2*n));if(o.cmp(t.p)>=0||u.cmp(t.p)>=0)throw new Error("Invalid point.");if(4!==i&&i!==(6|u.isOdd()))throw new Error("Invalid hybrid encoding.");var c=t.point(o,u);if(!c.validate())throw new Error("Invalid point.");return q(!c.isInfinity()),c;default:throw new Error("Unknown point format.")}}},{key:"decodeEven",value:function(e,t){q(e instanceof k);var r=e.decodeField(t);if(r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromX(r,!1)}},{key:"decodeSquare",value:function(e,t){q(e instanceof k);var r=e.decodeField(t);if(r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromX(r)}},{key:"fromJSON",value:function(e,t){if(q(e instanceof k),q(Array.isArray(t)),q(0===t.length||2===t.length||3===t.length),0===t.length)return e.point();var r=l.fromJSON(t[0]),n=l.fromJSON(t[1]),i=e.point(r,n);return t.length>2&&null!=t[2]&&(i.pre=C.fromJSON(i,t[2])),i}}]),r}(g),x=function(e){function t(e,r,n,s){var o;return c(this,t),q(e instanceof k),(o=i(this,a(t).call(this,e,d))).x=o.curve.one,o.y=o.curve.one,o.z=o.curve.zero,o.zOne=0,null!=r&&o._init(r,n,s),o}return o(t,e),f(t,[{key:"_init",value:function(e,t,r){q(e instanceof l),q(t instanceof l),q(null==r||r instanceof l),this.x=e,this.y=t,this.z=r||this.curve.one,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=0|this.z.eq(this.curve.one)}},{key:"clone",value:function(){return this.curve.jpoint(this.x.clone(),this.y.clone(),this.z.clone())}},{key:"swap",value:function(e,r){q(e instanceof t);var n=1&(r>>31|-r>>31),i=this.zOne,a=e.zOne;return this.x.cswap(e.x,r),this.y.cswap(e.y,r),this.z.cswap(e.z,r),this.zOne=i&(1^n)|a&n,e.zOne=a&(1^n)|i&n,this}},{key:"validate",value:function(){var e=this.curve,t=e.a,r=e.b;if(this.isInfinity())return!0;if(this.zOne)return this.curve.validate(this.toP());var n=this.y.redSqr(),i=this.x.redSqr().redMul(this.x),a=this.z.redSqr(),s=a.redSqr(),o=s.redMul(a),u=i.redIAdd(r.redMul(o));return this.curve.zeroA||(this.curve.threeA?u.redIAdd(s.redIMuln(-3).redMul(this.x)):u.redIAdd(t.redMul(s).redMul(this.x))),n.eq(u)}},{key:"normalize",value:function(){if(this.zOne)return this;if(this.isInfinity())return this;var e=this.z.redInvert(),t=e.redSqr();return this.x=this.x.redMul(t),this.y=this.y.redMul(t).redMul(e),this.z=this.curve.one,this.zOne=1,this}},{key:"scale",value:function(e){if(q(e instanceof l),this.isInfinity())return this.curve.jpoint();var t=e.redSqr(),r=this.x.redMul(t),n=this.y.redMul(t).redMul(e),i=this.z.redMul(e);return this.curve.jpoint(r,n,i)}},{key:"neg",value:function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)}},{key:"add",value:function(e){return q(e instanceof g),e.type===p?this._mixedAdd(e):this._add(e)}},{key:"_add",value:function(e){return q(e instanceof t),this.isInfinity()?e:e.isInfinity()?this:this.zOne&&e.zOne?this._addAA(e):this.zOne?e._addJA(this):e.zOne?this._addJA(e):this._addJJ(e)}},{key:"_mixedAdd",value:function(e){return q(e instanceof w),this.isInfinity()?e.toJ():e.isInfinity()?this:this.zOne?this._addAA(e):this._addJA(e)}},{key:"_addJJ",value:function(e){var t=this.z.redSqr(),r=e.z.redSqr(),n=this.x.redMul(r),i=e.x.redMul(t),a=this.y.redMul(e.z).redMul(r),s=e.y.redMul(this.z).redMul(t),o=i.redISub(n),u=s.redISub(a);if(o.isZero())return u.isZero()?this.dbl():this.curve.jpoint();var c=o.redSqr(),f=o.redMul(c),h=n.redMul(c),l=u.redSqr().redISub(f).redISub(h).redISub(h),p=u.redMul(h.redISub(l)).redISub(a.redMul(f)),d=this.z.redMul(e.z).redMul(o);return this.curve.jpoint(l,p,d)}},{key:"_addJA",value:function(e){var t=this.z.redSqr(),r=e.x.redMul(t),n=e.y.redMul(this.z).redMul(t),i=r.redISub(this.x),a=n.redISub(this.y).redIMuln(2);if(i.isZero())return a.isZero()?this.dbl():this.curve.jpoint();var s=i.redMuln(2).redSqr(),o=i.redMul(s),u=this.x.redMul(s),c=a.redSqr().redISub(o).redISub(u).redISub(u),f=a.redMul(u.redISub(c)).redISub(this.y.redMul(o).redIMuln(2)),h=this.z.redMul(i).redIMuln(2);return this.curve.jpoint(c,f,h)}},{key:"_addAA",value:function(e){var t=e.x.redSub(this.x),r=e.y.redSub(this.y).redIMuln(2);if(t.isZero())return r.isZero()?this.dbl():this.curve.jpoint();var n=t.redSqr().redIMuln(4),i=t.redMul(n),a=this.x.redMul(n),s=r.redSqr().redISub(i).redISub(a).redISub(a),o=r.redMul(a.redISub(s)).redISub(this.y.redMul(i).redIMuln(2)),u=t.redIMuln(2);return this.curve.jpoint(s,o,u)}},{key:"dbl",value:function(){return this.isInfinity()?this:this.y.isZero()?this.curve.jpoint():this.zOne?this._dblA():this.curve.zeroA?this._dbl0():this.curve.threeA?this._dbl3():this._dblJ()}},{key:"_dblJ",value:function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=this.z.redSqr(),n=this.x.redMul(t).redIMuln(4),i=e.redIMuln(3).redIAdd(this.curve.a.redMul(r.redSqr())),a=i.redSqr().redISub(n).redISub(n),s=a,o=i.redMul(n.redISub(a)).redISub(t.redSqr().redIMuln(8)),u=this.y.redMul(this.z).redIMuln(2);return this.curve.jpoint(s,o,u)}},{key:"_dblA",value:function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),n=t.redIAdd(this.x).redSqr().redISub(e).redISub(r).redIMuln(2),i=e.redIMuln(3).redIAdd(this.curve.a),a=i.redSqr().redISub(n).redISub(n),s=a,o=i.redMul(n.redISub(a)).redISub(r.redIMuln(8)),u=this.y.redMuln(2);return this.curve.jpoint(s,o,u)}},{key:"_dbl0",value:function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),n=t.redIAdd(this.x).redSqr().redISub(e).redISub(r).redIMuln(2),i=e.redIMuln(3),a=i.redSqr().redISub(n).redISub(n),s=i.redMul(n.redISub(a)).redISub(r.redIMuln(8)),o=this.y.redMul(this.z).redIMuln(2);return this.curve.jpoint(a,s,o)}},{key:"_dbl3",value:function(){var e=this.z.redSqr(),t=this.y.redSqr(),r=this.x.redMul(t),n=this.x.redSub(e),i=this.x.redAdd(e),a=n.redMul(i).redIMuln(3),s=r.redIMuln(4),o=s.redMuln(2),u=t.redSqr().redIMuln(8),c=a.redSqr().redISub(o),f=this.y.redAdd(this.z).redSqr().redISub(t).redISub(e),h=a.redMul(s.redISub(c)).redISub(u);return this.curve.jpoint(c,h,f)}},{key:"dblp",value:function(e){return q(e>>>0===e),this.curve.zeroA||this.curve.threeA?s(a(t.prototype),"dblp",this).call(this,e):0===e?this:this.isInfinity()?this:this._dblp(e)}},{key:"_dblp",value:function(e){for(var t=this.curve,r=t.a,n=t.i2,i=this.x,a=this.z,s=this.y.redMuln(2),o=a.redPown(4),u=0;u<e;u++){if(s.isZero())return this.curve.jpoint();var c=i.redSqr(),f=s.redSqr(),h=f.redSqr(),l=c.redIMuln(3).redIAdd(r.redMul(o)),p=i.redMul(f),d=l.redSqr().redISub(p).redISub(p),v=d,y=l.redMul(p.redISub(d)).redIMuln(2).redISub(h),b=s.redMul(a);u+1<e&&(o=o.redMul(h)),i=v,s=y,a=b}return this.curve.jpoint(i,s.redMul(n),a)}},{key:"uadd",value:function(e){return q(e instanceof g),e.type===p?this._uadd(e.toJ()):this._uadd(e)}},{key:"_uadd",value:function(e){q(e instanceof t);var r=this.curve,n=r.zero,i=r.one,a=this.z.redSqr(),s=e.z.redSqr(),o=this.x.redMul(s),u=e.x.redMul(a),c=this.y.redMul(s).redMul(e.z),f=e.y.redMul(a).redMul(this.z),h=this.z.redMul(e.z),l=o.redAdd(u),p=c.redAdd(f),d=l.redSqr().redISub(o.redMul(u));if(!this.curve.zeroA){var v=h.redPown(4);this.curve.threeA?d.redIAdd(v.redIMuln(-3)):d.redIAdd(this.curve.a.redMul(v))}var y=p.czero()&d.czero();p.cinject(o.redSub(u),y),d.cinject(c.redSub(f),y);var b=p.redSqr(),m=l.redMul(b),g=b.redSqr();g.cinject(n,y);var k=d.redSqr(),w=h.redMul(p),x=m.redMuln(3).redISub(k).redISub(k),S=k.redISub(m).redIMuln(4),E=d.redMul(x).redISub(g).redIMuln(4),_=w.redIMuln(2),I=this.z.czero(),A=e.z.czero(),T=_.czero()&(1^(I|A));return S.cinject(e.x,I),E.cinject(e.y,I),_.cinject(e.z,I),S.cinject(this.x,A),E.cinject(this.y,A),_.cinject(this.z,A),S.cinject(i,T),E.cinject(i,T),_.cinject(n,T),this.curve.jpoint(S,E,_)}},{key:"udbl",value:function(){var e=this._udbl(),t=this.z.czero()|this.y.czero();return e.x.cinject(this.curve.one,t),e.y.cinject(this.curve.one,t),e.z.cinject(this.curve.zero,t),e}},{key:"_udbl",value:function(){return this.curve.zeroA?this._dbl0():this.curve.threeA?this._dbl3():this._dblJ()}},{key:"zaddu",value:function(e){q(e instanceof t);var r=this.x.redSub(e.x),n=this.y.redSub(e.y),i=r.redSqr(),a=this.x.redMul(i),s=e.x.redMul(i),o=a,u=n.redSqr().redISub(a).redISub(s),c=this.y.redMul(a.redSub(s)),f=n.redMul(o.redSub(u)).redISub(c),h=this.z.redMul(r),l=h;return[this.curve.jpoint(u,f,l),this.curve.jpoint(o,c,h)]}},{key:"zaddc",value:function(e){q(e instanceof t);var r=this.x.redSub(e.x),n=this.y.redSub(e.y),i=this.y.redAdd(e.y),a=r.redSqr(),s=this.x.redMul(a),o=e.x.redMul(a),u=i.redSqr().redISub(s).redISub(o),c=n.redSqr().redISub(s).redISub(o),f=this.y.redMul(o.redISub(s)),h=e.y.redMuln(2).redIAdd(n),l=s.redISub(u),p=u.redAdd(l).redISub(c),d=h.redMul(l).redIAdd(f),v=n.redMul(p).redIAdd(f),y=this.z.redMul(r),b=y;return[this.curve.jpoint(c,v,b),this.curve.jpoint(u,d,y)]}},{key:"zdblu",value:function(){var e=this.x.redSqr(),t=this.y.redSqr(),r=t.redSqr(),n=this.x.redAdd(t).redSqr(),i=e.redMuln(3);if(!this.curve.zeroA){var a=this.z.redPown(4);this.curve.threeA?i.redIAdd(a.redIMuln(-3)):i.redIAdd(this.curve.a.redMul(a))}var s=n.redISub(e).redISub(r).redIMuln(2),o=i.redSqr().redISub(s).redISub(s),u=r.redIMuln(8),c=s.redSub(o).redMul(i).redISub(u),f=this.y.redMul(this.z).redIMuln(2),h=f;return[this.curve.jpoint(o,c,h),this.curve.jpoint(s,u,f)]}},{key:"recover",value:function(e,t,r,n){return this.toP().recover(e,t,r,n)}},{key:"getX",value:function(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.x.fromRed()}},{key:"getY",value:function(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.y.fromRed()}},{key:"eq",value:function(e){if(q(e instanceof t),this===e)return!0;if(this.isInfinity())return e.isInfinity();if(e.isInfinity())return!1;if(this.z.eq(e.z))return this.x.eq(e.x)&&this.y.eq(e.y);var r=this.z.redSqr(),n=e.z.redSqr(),i=this.x.redMul(n),a=e.x.redMul(r);if(!i.eq(a))return!1;var s=r.redMul(this.z),o=n.redMul(e.z),u=this.y.redMul(o),c=e.y.redMul(s);return u.eq(c)}},{key:"isInfinity",value:function(){return this.z.isZero()}},{key:"isOdd",value:function(){return!this.isInfinity()&&(this.normalize(),this.y.redIsOdd())}},{key:"isEven",value:function(){return!this.isInfinity()&&(this.normalize(),this.y.redIsEven())}},{key:"isSquare",value:function(){return!this.isInfinity()&&-1!==this.y.redMul(this.z).redJacobi()}},{key:"eqX",value:function(e){if(q(e instanceof l),q(!e.red),this.isInfinity())return!1;var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);return this.x.eq(r)}},{key:"eqXToP",value:function(e){if(q(e instanceof l),q(!e.red),!this.curve.smallGap)return this.toP().eqXToP(e);if(this.isInfinity())return!1;if(e.cmp(this.curve.p)>=0)return!1;var t=this.z.redSqr(),r=e.toRed(this.curve.red).redMul(t);if(this.x.eq(r))return!0;if(this.curve.highOrder)return!1;if(e.cmp(this.curve.pmodn)>=0)return!1;var n=this.curve.redN.redMul(t);return r.redIAdd(n),this.x.eq(r)}},{key:"toP",value:function(){return this.isInfinity()?this.curve.point():(this.normalize(),this.curve.point(this.x,this.y))}},{key:"toJ",value:function(){return this}},{key:"encode",value:function(e){return this.toP().encode(e)}},{key:"encodeX",value:function(){return this.toP().encodeX()}},{key:"toJSON",value:function(e){return this.toP().toJSON(e)}},{key:h,value:function(){return this.isInfinity()?"<JPoint: Infinity>":"<JPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}],[{key:"decode",value:function(e,t){return w.decode(e,t).toJ()}},{key:"decodeEven",value:function(e,t){return w.decodeEven(e,t).toJ()}},{key:"decodeSquare",value:function(e,t){return w.decodeSquare(e,t).toJ()}},{key:"fromJSON",value:function(e,t){return w.fromJSON(e,t).toJ()}}]),t}(g),S=function(e){function t(e){var r;return c(this,t),(r=i(this,a(t).call(this,E,"mont",e))).a=l.fromJSON(e.a).toRed(r.red),r.b=l.fromJSON(e.b).toRed(r.red),r.bi=r.b.redInvert(),r.a2=r.a.redAdd(r.two),r.a24=r.a2.redMul(r.i4),r.a3=r.a.redMul(r.i3),r.a0=r.a.redMul(r.bi),r.b0=r.bi.redSqr(),r._finalize(e),r}return o(t,e),f(t,[{key:"_short",value:function(e,t){var r=this.a,n=this.b,i=this.three,a=r.redSqr(),s=a.redMul(r),o=n.redSqr(),u=o.redMul(n),c=i.redSub(a),f=o.redMuln(3),h=s.redMuln(2).redISub(r.redMuln(9)),l=u.redMuln(27),p=c.redDiv(f),d=h.redDiv(l);return null!=e?k._isomorphism(p,d,e,t):[p,d]}},{key:"_mont",value:function(e){return t._isomorphism(this.a,this.b,e)}},{key:"_edwards",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q("boolean"===typeof t);var r=this.two,n=this.bi,i=this.a.redAdd(r).redMul(n),a=this.a.redSub(r).redMul(n);return t&&i.swap(a),null!=e?I._isomorphism(i,a,e):[i,a]}},{key:"_scaleShort",value:function(e){q(e instanceof k);var t=e._scale(this),r=u(t,2),n=r[0],i=r[1];return[this.field(n.redInvert()),this.field(i.redInvert())]}},{key:"_scaleMont",value:function(e){return q(e instanceof t),this.g.isInfinity()||e.g.isInfinity()?this.field(e.b).redDivSqrt(this.b):this.g.y.redDiv(this.field(e.g.y))}},{key:"_scaleEdwards",value:function(e,t){q(e instanceof I);var r=e._scale(this,t);return this.field(r)}},{key:"_solveY0",value:function(e){q(e instanceof l);var t=this.a0,r=this.b0,n=e.redSqr();return n.redMul(e).redIAdd(t.redMul(n)).redIAdd(r.redMul(e))}},{key:"_elligator2",value:function(e){var t=this.a0.redNeg(),r=this.one.redAdd(this.z.redMul(e.redSqr()));r.cinject(this.one,r.czero());var n=t.redMul(r.redFermat()),i=n.redNeg().redISub(this.a0),a=this._solveY0(n),s=this._solveY0(i),o=0|a.redIsSquare(),u=n.cinject(i,1^o),c=a.cinject(s,1^o).redSqrt();c.cinject(c.redNeg(),c.redIsOdd()^e.redIsOdd());var f=this.b.redMul(u),h=this.b.redMul(c);return this.point(f,h)}},{key:"_invert2",value:function(e,t){var r=e.x,n=e.y,i=1&t,a=r.redMul(this.bi),s=n.redMul(this.bi),o=a.redAdd(this.a0),c=a;o.cswap(c,i);var f=j(o.redINeg(),c.redMul(this.z)),h=u(f,2),l=h[0],p=h[1];if(p.cinject(p.redNeg(),p.redIsOdd()^s.redIsOdd()),!l)throw new Error("Invalid point.");return p}},{key:"_constMul",value:function(e,t,r){q(e instanceof E);var n=e.toX().ladderConst(t,r),i=u(n,2),a=i[0],s=i[1],o=e.recover(s,a);return t.isNeg()?o.neg():o}},{key:"isElliptic",value:function(){var e=this.a.redSqr();return!this.b.redMul(e.redSub(this.four)).isZero()}},{key:"jinv",value:function(){var e=this.a,t=this.three,r=this.four,n=e.redSqr(),i=n.redSub(t).redPown(3).redIMuln(256),a=n.redSub(r);if(a.isZero())throw new Error("Curve is not elliptic.");return i.redDiv(a).fromRed()}},{key:"point",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return new E(this,e,t,r)}},{key:"jpoint",value:function(e,t,r){return q(null==e&&null==t&&null==r),this.point()}},{key:"xpoint",value:function(e,t){return new _(this,e,t)}},{key:"solveY2",value:function(e){q(e instanceof l);var t=e.redSqr();return t.redMul(e).redIAdd(this.a.redMul(t)).redIAdd(e).redMul(this.bi)}},{key:"validate",value:function(e){if(q(e instanceof E),e.isInfinity())return!0;var t=e.x,r=e.y,n=this.solveY2(t);return r.redSqr().eq(n)}},{key:"pointFromX",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;q(e instanceof l),q(null==t||"boolean"===typeof t),e.red||(e=e.toRed(this.red));var r=this.solveY(e);return null!=t&&r.redIsOdd()!==t&&r.redINeg(),this.point(e,r)}},{key:"isIsomorphic",value:function(e,t){if(q(e instanceof m),!e.p.eq(this.p))return!1;if("mont"===e.type){var r=this.field(e.a),n=this.field(e.b);return!!this.a.eq(r)&&(!this.b.isZero()&&1===n.redDiv(this.b).redJacobi())}return e.isIsomorphic(this,t)}},{key:"isIsogenous",value:function(e){return q(e instanceof m),"mont"!==e.type&&e.isIsogenous(this)}},{key:"pointFromShort",value:function(e){if(q(e instanceof w),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();var t=this.a3,r=this.b,n=this._scale(e.curve),i=u(n,2),a=i[0],s=i[1],o=this.field(e.x).redMul(a),c=this.field(e.y).redMul(s),f=r.redMul(o).redISub(t),h=r.redMul(c);return this.point(f,h)}throw new Error("Not implemented.")}},{key:"pointFromMont",value:function(e){if(q(e instanceof E),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();var t=this._scale(e.curve),r=this.field(e.x),n=this.field(e.y),i=r,a=t.redMul(n);return this.point(i,a)}throw new Error("Not implemented.")}},{key:"pointFromEdwards",value:function(e){q(e instanceof A),q(e.curve.p.eq(this.p));var t=this.field(e.x),r=this.field(e.y),n=this.field(e.z);if(this.isIsogenous(e.curve)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);var i=n.redSqr().redIMuln(2),a=r.redSqr(),s=t.redSqr(),o=i.redISub(s).redISub(a).redMul(r),u=s.redMul(t);return this.cpoint(a,s,o,u)}if(this.isIsomorphic(e.curve,!0)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);var c=this._scale(e.curve,!0),f=r.redAdd(n),h=r.redSub(n),l=c.redMul(n).redMul(f),p=t.redMul(h);return this.cpoint(f,h,l,p)}if(this.isIsomorphic(e.curve,!1)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.zero);var d=this._scale(e.curve,!1),v=n.redAdd(r),y=n.redSub(r),b=d.redMul(n).redMul(v),m=t.redMul(y);return this.cpoint(v,y,b,m)}throw new Error("Not implemented.")}},{key:"pointFromUniform",value:function(e){if(q(e instanceof l),this.z.isZero()||this.a.isZero())throw new Error("Not implemented.");return this._elligator2(e)}},{key:"pointToUniform",value:function(e,t){if(q(e instanceof E),q(t>>>0===t),this.z.isZero()||this.a.isZero())throw new Error("Not implemented.");if(e.isInfinity())throw new Error("Invalid point.");var r=(t>>>4&15)%this.torsion.length,n=e.add(this.torsion[r]);return this._invert2(n,t)}},{key:"decodePoint",value:function(e,t){return E.decode(this,e,t)}},{key:"encodeX",value:function(e){return q(e instanceof _),e.encode()}},{key:"decodeX",value:function(e){return _.decode(this,e)}},{key:"toShort",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._short(e,t),i=u(n,2),a=i[0],s=i[1],o=new k({red:this.red,prime:this.prime,p:this.p,a:a,b:s,n:this.n,h:this.h});if(null!=r){var c=o._scale(this),f=u(c,2),h=f[1];h.redIsOdd()!==r&&h.redINeg()}this.g.isInfinity()||(o.g=o.pointFromMont(this.g));for(var l=0;l<this.h;l++)o.torsion[l]=o.pointFromMont(this.torsion[l]);return o}},{key:"toMont",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._mont(e),i=u(n,2),a=i[0],s=i[1],o=new t({red:this.red,prime:this.prime,p:this.p,a:a,b:s,n:this.n,h:this.h,z:this.z});if(null!=r){var c=o._scale(this);c.redIsOdd()!==r&&c.redINeg()}this.g.isInfinity()||(o.g=o.pointFromMont(this.g));for(var f=0;f<this.h;f++)o.torsion[f]=o.pointFromMont(this.torsion[f]);return o}},{key:"toEdwards",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._edwards(e,t),i=u(n,2),a=i[0],s=i[1],o=new I({red:this.red,prime:this.prime,p:this.p,a:a,d:s,n:this.n,h:this.h,z:this.z});if(null!=r){var c=o._scale(this,t);c.redIsOdd()!==r&&c.redINeg()}if(this.g.isInfinity()||(o.g=o.pointFromMont(this.g),o.g.normalize()),o.isComplete())for(var f=0;f<this.h;f++)o.torsion[f]=o.pointFromMont(this.torsion[f]),o.torsion[f].normalize();return o}},{key:"pointFromJSON",value:function(e){return E.fromJSON(this,e)}},{key:"toJSON",value:function(e){var r=s(a(t.prototype),"toJSON",this).call(this,e);return r.a=this.a.fromRed().toJSON(),r.b=this.b.fromRed().toJSON(),r}}],[{key:"_isomorphism",value:function(e,t,r){q(e instanceof l),q(t instanceof l),q(r instanceof l);var n=e.clone(),i=r.clone();if(1!==t.redDiv(r).redJacobi())throw new Error("Invalid `b` coefficient.");return[n,i]}}]),t}(m),E=function(e){function t(e,r,n,s){var o;return c(this,t),q(e instanceof S),(o=i(this,a(t).call(this,e,p))).x=o.curve.zero,o.y=o.curve.zero,o.inf=1,null!=r&&o._init(r,n,s),o}return o(t,e),f(t,[{key:"_init",value:function(e,t,r){q(e instanceof l),q(t instanceof l),this.x=e,this.y=t,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=0|r}},{key:"clone",value:function(){return this.curve.point(this.x.clone(),this.y.clone(),this.inf)}},{key:"swap",value:function(e,r){q(e instanceof t);var n=1&(r>>31|-r>>31),i=this.inf,a=e.inf;return this.x.cswap(e.x,r),this.y.cswap(e.y,r),this.inf=i&(1^n)|a&n,e.inf=a&(1^n)|i&n,this}},{key:"scale",value:function(e){return this.clone()}},{key:"randomize",value:function(e){return this.clone()}},{key:"neg",value:function(){return this.inf?this:this.curve.point(this.x,this.y.redNeg())}},{key:"add",value:function(e){if(q(e instanceof t),this.inf)return e;if(e.inf)return this;if(this.x.eq(e.x))return this.y.eq(e.y)?this.dbl():this.curve.point();var r=e.x.redSub(this.x),n=e.y.redSub(this.y).redDiv(r),i=this.curve.b.redMul(n.redSqr()).redISub(this.curve.a).redISub(this.x).redISub(e.x),a=n.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,a)}},{key:"dbl",value:function(){if(this.inf)return this;if(this.y.isZero())return this.curve.point();var e=this.x.redSqr().redIMuln(3),t=this.curve.a.redMul(this.x).redIMuln(2),r=e.redIAdd(t).redIAdd(this.curve.one),n=this.curve.b.redMul(this.y).redIMuln(2),i=r.redDiv(n),a=this.curve.b.redMul(i.redSqr()).redISub(this.curve.a).redISub(this.x).redISub(this.x),s=i.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,s)}},{key:"uadd",value:function(e){q(e instanceof t);var r=e.x.redSub(this.x),n=e.y.redSub(this.y),i=this.x.redSqr().redIMuln(3),a=this.curve.a.redMul(this.x).redIMuln(2),s=i.redIAdd(a).redIAdd(this.curve.one),o=this.curve.b.redMul(this.y).redIMuln(2),u=r.czero()&n.czero();n.cinject(s,u),r.cinject(o,u);var c=r.czero()&(1^(this.inf|e.inf));r.cinject(this.curve.one,r.czero());var f=n.redMul(r.redFermat()),h=this.curve.b.redMul(f.redSqr()).redISub(this.curve.a).redISub(this.x).redISub(e.x),l=f.redMul(this.x.redSub(h)).redISub(this.y),p=c|this.inf&e.inf;return h.cinject(e.x,this.inf),l.cinject(e.y,this.inf),h.cinject(this.x,e.inf),l.cinject(this.y,e.inf),h.cinject(this.curve.zero,p),l.cinject(this.curve.zero,p),this.curve.point(h,l,p)}},{key:"udbl",value:function(){return this.uadd(this)}},{key:"recover",value:function(e,t){if(q(e instanceof _),q(t instanceof _),this.inf)return this.curve.point();var r=this.x.redMul(e.z),n=e.x.redAdd(r),i=e.x.redSub(r).redSqr().redMul(t.x),a=this.curve.a.redMul(e.z).redIMuln(2),s=n.redIAdd(a),o=this.x.redMul(e.x).redIAdd(e.z),u=s.redMul(o),c=a.redMul(e.z),f=u.redISub(c).redMul(t.z),h=this.curve.b.redMul(this.y).redIMuln(2).redMul(e.z).redMul(t.z),l=h.redMul(e.x),p=f.redISub(i),d=h.redMul(e.z);if(d.isZero())return this.curve.point();var v=d.redInvert(),y=l.redMul(v),b=p.redMul(v);return this.curve.point(y,b)}},{key:"getX",value:function(){if(this.inf)throw new Error("Invalid point.");return this.x.fromRed()}},{key:"getY",value:function(){if(this.inf)throw new Error("Invalid point.");return this.y.fromRed()}},{key:"eq",value:function(e){return q(e instanceof t),this===e||(this.inf?0!==e.inf:!e.inf&&(this.x.eq(e.x)&&this.y.eq(e.y)))}},{key:"isInfinity",value:function(){return 0!==this.inf}},{key:"isOdd",value:function(){return!this.inf&&this.y.redIsOdd()}},{key:"isEven",value:function(){return!this.inf&&this.y.redIsEven()}},{key:"toP",value:function(){return this}},{key:"toJ",value:function(){return this}},{key:"toX",value:function(){return this.inf?this.curve.xpoint():this.curve.xpoint(this.x,this.curve.one)}},{key:"encode",value:function(){return this.toX().encode()}},{key:"toJSON",value:function(e){return this.inf?[]:[this.getX().toJSON(),this.getY().toJSON()]}},{key:h,value:function(){return this.inf?"<MontPoint: Infinity>":"<MontPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+">"}}],[{key:"decode",value:function(e,t,r){return q(e instanceof S),e.decodeX(t).toP(r)}},{key:"fromJSON",value:function(e,t){if(q(e instanceof S),q(Array.isArray(t)),q(0===t.length||2===t.length||3===t.length),0===t.length)return e.point();var r=l.fromJSON(t[0]),n=l.fromJSON(t[1]);return e.point(r,n)}}]),t}(g),_=function(e){function t(e,r,n){var s;return c(this,t),q(e instanceof S),(s=i(this,a(t).call(this,e,v))).x=s.curve.one,s.z=s.curve.zero,null!=r&&s._init(r,n),s}return o(t,e),f(t,[{key:"_init",value:function(e,t){q(e instanceof l),q(null==t||t instanceof l),this.x=e,this.z=t||this.curve.one,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red))}},{key:"clone",value:function(){return this.curve.xpoint(this.x.clone(),this.z.clone())}},{key:"swap",value:function(e,r){return q(e instanceof t),this.x.cswap(e.x,r),this.z.cswap(e.z,r),this}},{key:"precompute",value:function(e,t){return this}},{key:"validate",value:function(){if(this.isInfinity())return!0;var e=this.x,t=this.z,r=e.redSqr(),n=r.redMul(e),i=t.redSqr(),a=this.curve.a.redMul(r).redMul(t);return-1!==n.redIAdd(a).redIAdd(e.redMul(i)).redMul(this.curve.bi).redMul(t).redJacobi()}},{key:"normalize",value:function(){return this.isInfinity()?this:this.z.eq(this.curve.one)?this:(this.x=this.x.redDiv(this.z),this.z=this.curve.one,this)}},{key:"scale",value:function(e){if(q(e instanceof l),this.isInfinity())return this.curve.xpoint();var t=this.x.redMul(e),r=this.z.redMul(e);return this.curve.xpoint(t,r)}},{key:"neg",value:function(){return this}},{key:"dbl",value:function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),r=e.redSub(t),n=e.redMul(t),i=r.redMul(t.redIAdd(this.curve.a24.redMul(r)));return this.curve.xpoint(n,i)}},{key:"diffAdd",value:function(e,r){q(e instanceof t),q(r instanceof t);var n=e.x.redAdd(e.z),i=e.x.redSub(e.z),a=r.x.redAdd(r.z),s=r.x.redSub(r.z).redMul(n),o=a.redMul(i),u=this.z.redMul(s.redAdd(o).redSqr()),c=this.x.redMul(s.redISub(o).redSqr());return this.curve.xpoint(u,c)}},{key:"diffAddDbl",value:function(e,r){q(e instanceof t),q(r instanceof t);var n=r.x.redAdd(r.z),i=n.redSqr(),a=r.x.redSub(r.z),s=a.redSqr(),o=i.redSub(s),u=e.x.redAdd(e.z),c=e.x.redSub(e.z).redMul(n),f=u.redMul(a),h=this.z.redMul(c.redAdd(f).redSqr()),l=this.x.redMul(c.redISub(f).redSqr()),p=i.redMul(s),d=o.redMul(s.redIAdd(this.curve.a24.redMul(o)));return[this.curve.xpoint(h,l),this.curve.xpoint(p,d)]}},{key:"getX",value:function(){if(this.isInfinity())throw new Error("Invalid point.");return this.normalize(),this.x.fromRed()}},{key:"getY",value:function(e){return this.toP(e).getY()}},{key:"eq",value:function(e){if(q(e instanceof t),this===e)return!0;if(this.isInfinity())return e.isInfinity();if(e.isInfinity())return!1;if(this.z.eq(e.z))return this.x.eq(e.x);var r=this.x.redMul(e.z),n=e.x.redMul(this.z);return r.eq(n)}},{key:"isInfinity",value:function(){return this.z.isZero()}},{key:"isOdd",value:function(){return!1}},{key:"isEven",value:function(){return!1}},{key:"hasTorsion",value:function(){return!this.isInfinity()&&(!!this.x.isZero()||s(a(t.prototype),"hasTorsion",this).call(this))}},{key:"jmul",value:function(e){return this.ladder(e)[1]}},{key:"jmulSimple",value:function(e){return this.ladderSimple(e)[1]}},{key:"jmulBlind",value:function(e,t){return this.ladderBlind(e,t)[1]}},{key:"jmulConst",value:function(e,t){return this.ladderConst(e,t)[1]}},{key:"jmulAdd",value:function(e,t,r){throw new Error("Not implemented.")}},{key:"jmulAddSimple",value:function(e,t,r){throw new Error("Not implemented.")}},{key:"ladder",value:function(e){q(e instanceof l),q(!e.red);for(var t=e.bitLength(),r=this,n=this.curve.xpoint(),i=t-1;i>=0;i--){if(0===e.bit(i)){var a=this.diffAddDbl(r,n),s=u(a,2);r=s[0],n=s[1]}else{var o=this.diffAddDbl(n,r),c=u(o,2);n=c[0],r=c[1]}}return[r,n]}},{key:"ladderSimple",value:function(e){q(e instanceof l),q(!e.red);for(var t=e.bitLength(),r=this,n=this.curve.xpoint(),i=t-1;i>=0;i--){0===e.bit(i)?(r=this.diffAdd(r,n),n=n.dbl()):(n=this.diffAdd(n,r),r=r.dbl())}return[r,n]}},{key:"ladderBlind",value:function(e,t){return t?this.randomize(t).ladder(e):this.ladder(e)}},{key:"ladderConst",value:function(e,t){q(e instanceof l),q(!e.red);for(var r=Math.max(e.bitLength(),this.curve.fieldBits),n=r+7>>>3,i=e.toArray("le",n),a=t?this.randomize(t):this,s=a.clone(),o=this.curve.xpoint().clone(),c=0,f=r-1;f>=0;f--){var h=i[f>>3]>>(7&f)&1;s.swap(o,c^h);var p=a.diffAddDbl(s,o),d=u(p,2);s=d[0],o=d[1],c=h}return s.swap(o,c),[s,o]}},{key:"toP",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q(null==e||"boolean"===typeof e),this.isInfinity()?this.curve.point():(this.normalize(),this.curve.pointFromX(this.x,e))}},{key:"toJ",value:function(){return this}},{key:"toX",value:function(){return this}},{key:"encode",value:function(){return this.curve.encodeField(this.getX())}},{key:"toJSON",value:function(e){return this.toP().toJSON(e)}},{key:h,value:function(){return this.isInfinity()?"<XPoint: Infinity>":"<XPoint: x="+this.x.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}],[{key:"decode",value:function(e,t){q(e instanceof S);var r=e.decodeField(t);r.iumaskn(e.fieldBits);var n=e.xpoint(r,e.one);return q(!n.isInfinity()),n}},{key:"fromJSON",value:function(e,t){return E.fromJSON(e,t).toX()}}]),t}(g),I=function(e){function t(e){var r;return c(this,t),(r=i(this,a(t).call(this,A,"edwards",e))).a=l.fromJSON(e.a).toRed(r.red),r.d=l.fromJSON(e.d).toRed(r.red),r.s=l.fromJSON(e.s||"0").toRed(r.red),r.si=r.s.isZero()?r.zero:r.s.redInvert(),r.k=r.d.redMuln(2),r.smi=-r.d.redNeg().word(0),r.ad6=r.a.redAdd(r.d).redMul(r.i6),r.twisted=!r.a.eq(r.one),r.oneA=r.a.eq(r.one),r.mOneA=r.a.eq(r.one.redNeg()),r.smallD=null!=r.prime&&1===r.d.redNeg().length,r.alt=null,r._finalize(e),r}return o(t,e),f(t,[{key:"_short",value:function(e,t){var r=this.a,n=this.d,i=r.redSqr(),a=i.redMul(r),s=n.redSqr(),o=s.redMul(n),u=r.redMul(n).redIMuln(14),c=i.redMul(n),f=r.redMul(s),h=c.redIAdd(f).redIMuln(33),l=i.redAdd(u).redIAdd(s).redDivn(-48),p=h.redISub(a).redISub(o).redDivn(864);return null!=e?k._isomorphism(l,p,e,t):[l,p]}},{key:"_mont",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q("boolean"===typeof n),n?(t=this.d.redAdd(this.a),r=this.d.redSub(this.a)):(t=this.a.redAdd(this.d),r=this.a.redSub(this.d));var i=r.redInvert(),a=t.redMuln(2).redMul(i),s=i.redMuln(4);return null!=e?S._isomorphism(a,s,e):[a,s]}},{key:"_edwards",value:function(e){return t._isomorphism(this.a,this.d,e)}},{key:"_scaleShort",value:function(e){q(e instanceof k);var t=e._scale(this),r=u(t,2),n=r[0],i=r[1];return[this.field(n.redInvert()),this.field(i.redInvert())]}},{key:"_scaleMont",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q(e instanceof S),q("boolean"===typeof t),this.g.isInfinity()||e.g.isInfinity()){var r=e._edwards(null,t),n=u(r,1),i=n[0];return this.field(i).redDivSqrt(this.a)}var a=e.g.x.redDiv(e.g.y);return this.g.x.redDiv(this.field(a))}},{key:"_scaleEdwards",value:function(e){return q(e instanceof t),this.g.isInfinity()||e.g.isInfinity()?this.field(e.a).redDivSqrt(this.a):this.g.x.redDiv(this.field(e.g.x))}},{key:"_mulA",value:function(e){return q(e instanceof l),this.oneA?e.clone():this.mOneA?e.redNeg():this.a.redMul(e)}},{key:"_mulD",value:function(e){return q(e instanceof l),this.smallD?e.redMuln(this.smi):this.d.redMul(e)}},{key:"_elligator1",value:function(e){var t=this.s,r=this.si,n=this.i2,i=this.one,a=this.two,s=r.redSqr().redIMuln(2),o=t.redSqr().redMul(n),u=o.redSqr(),c=s.redAdd(o),f=c.redSqr().redISub(a),h=s.redSub(i),l=this.p.subn(2),p=this.p.subn(1).iushrn(1),d=this.p.addn(1).iushrn(2),v=i.redSub(e),y=i.redAdd(e),b=v.redMul(y.redPow(l)),m=b.redSqr(),g=m.redMul(b),k=g.redMul(m).redAdd(f.redMul(g)).redIAdd(b),w=k.redPow(p),x=m.redAdd(u).redPow(p),S=w.redMul(x),E=w.redMul(b),_=w.redMul(k).redPow(d).redMul(S),I=i.redAdd(E),A=c.redMul(E),T=I.redSqr(),C=h.redMul(t).redMul(E).redMul(I),B=_.cinject(this.one,b.czero()),R=A.redSub(T),N=A.redAdd(T);return this.cpoint(C,B,R,N)}},{key:"_invert1",value:function(e,t){var r=this.s,n=this.si,i=this.i2,a=this.one,s=e.x,o=e.y,u=e.z,c=1&t,f=n.redSqr().redIMuln(2),h=r.redSqr().redMul(i),l=h.redSqr(),p=f.redAdd(h),d=f.redSub(a),v=this.p.subn(2),y=this.p.subn(1).iushrn(1),b=this.p.addn(1).iushrn(2),m=o.redSub(u),g=o.redAdd(u).redIMuln(2),k=m.redMul(g.redPow(v)),w=a.redAdd(k.redMul(p)),x=w.redSqr().redISub(a),S=x.redPow(b),E=S.redSqr().ceq(x),_=S.redSub(w),I=a.redAdd(_),A=d.redMul(r).redMul(_).redMul(I).redMul(s.redMul(u)),T=_.redSqr().redIAdd(l),C=A.redMul(T).redPow(y).redMul(_),B=a.redSub(C),R=a.redAdd(C),N=B.redMul(R.redPow(v));if(N.cinject(N.redNeg(),N.redIsOdd()^c),!E)throw new Error("Invalid point.");return N}},{key:"_alt",value:function(){return this.alt||(this.alt=this.toMont()),this.alt}},{key:"isElliptic",value:function(){var e=this.a.redMul(this.d),t=this.a.redSub(this.d);return!e.redMul(t).isZero()}},{key:"jinv",value:function(){var e=this.a,t=this.d,r=e.redMul(t),n=e.redSub(t).redPown(4),i=e.redSqr(),a=t.redSqr(),s=i.redAdd(r.redMuln(14)).redIAdd(a).redPown(3).redIMuln(16),o=r.redMul(n);if(o.isZero())throw new Error("Curve is not elliptic.");return s.redDiv(o).fromRed()}},{key:"isComplete",value:function(){return 1===this.a.redJacobi()&&-1===this.d.redJacobi()}},{key:"point",value:function(e,t,r,n){return new A(this,e,t,r,n)}},{key:"jpoint",value:function(e,t,r){return q(null==e&&null==t&&null==r),this.point()}},{key:"cpoint",value:function(e,t,r,n){q(e instanceof l),q(t instanceof l),q(r instanceof l),q(n instanceof l);var i=e.redMul(n),a=r.redMul(t),s=t.redMul(n),o=e.redMul(r);return this.point(i,a,s,o)}},{key:"solveX2",value:function(e){q(e instanceof l);var t=e.redSqr(),r=this._mulD(t).redISub(this.a);return t.redISub(this.one).redDiv(r)}},{key:"solveX",value:function(e){var t=e.redSqr(),r=this._mulD(t).redISub(this.a);return t.redISub(this.one).redDivSqrt(r)}},{key:"solveY2",value:function(e){q(e instanceof l);var t=e.redSqr(),r=this._mulA(t).redISub(this.one),n=this._mulD(t).redISub(this.one);return r.redDiv(n)}},{key:"solveY",value:function(e){var t=e.redSqr(),r=this._mulA(t).redISub(this.one),n=this._mulD(t).redISub(this.one);return r.redDivSqrt(n)}},{key:"validate",value:function(e){if(q(e instanceof A),e.zOne){var t=e.x.redSqr(),r=e.y.redSqr(),n=this._mulD(t).redMul(r),i=this._mulA(t).redIAdd(r),a=this.one.redAdd(n),s=e.t,o=e.x.redMul(e.y);return i.eq(a)&&s.eq(o)}var u=e.x.redSqr(),c=e.y.redSqr(),f=e.z.redSqr(),h=f.redSqr(),l=this._mulD(u).redMul(c),p=this._mulA(u).redIAdd(c).redMul(f),d=h.redIAdd(l),v=e.t.redMul(e.z),y=e.x.redMul(e.y);return p.eq(d)&&v.eq(y)}},{key:"pointFromX",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;q(e instanceof l),q(null==t||"boolean"===typeof t),e.red||(e=e.toRed(this.red));var r=this.solveY(e);if(null!=t){if(r.isZero()&&t)throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(e,r)}},{key:"pointFromY",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;q(e instanceof l),q(null==t||"boolean"===typeof t),e.red||(e=e.toRed(this.red));var r=this.solveX(e);if(null!=t){if(r.isZero()&&t)throw new Error("Invalid point.");r.redIsOdd()!==t&&r.redINeg()}return this.point(r,e)}},{key:"isIsomorphic",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(q(e instanceof m),q("boolean"===typeof t),!e.p.eq(this.p))return!1;if("short"===e.type)return e.isIsomorphic(this);if("mont"===e.type){var r,n,i=this.field(e.a);return t?(r=this.d.redAdd(this.a),n=this.d.redSub(this.a)):(r=this.a.redAdd(this.d),n=this.a.redSub(this.d)),i.redMul(n).eq(r.redIMuln(2))}if("edwards"===e.type){var a=this.field(e.a),s=this.field(e.d);return this.a.redMul(s).eq(a.redMul(this.d))}return!1}},{key:"isIsogenous",value:function(e){if(q(e instanceof m),!e.p.eq(this.p))return!1;if("mont"===e.type){if(!this.a.eq(this.one))return!1;var t=this.field(e.a),r=this.field(e.b),n=this.two.redSub(this.d.redMuln(4));return t.eq(n)&&r.eq(this.one)}if("edwards"===e.type){var i=this.field(e.a),a=this.field(e.d);return i.eq(this.a.redNeg())&&a.eq(this.d.redSub(this.a))}return!1}},{key:"pointFromShort",value:function(e){if(q(e instanceof w),this.isIsomorphic(e.curve)){if(e.isInfinity())return this.point();if(e.y.isZero())return this.point(this.zero,this.one.redNeg());var t=this.a,r=this.d,n=this._scale(e.curve),i=u(n,2),a=i[0],s=i[1],o=t.redMuln(5),c=r.redMuln(5),f=this.field(e.x).redMul(a),h=this.field(e.y).redMul(s),l=f.redMuln(6),p=f.redMuln(12),d=l.redSub(t).redISub(r),v=h.redMuln(6),y=p.redSub(o).redIAdd(r),b=p.redAdd(t).redISub(c);return this.cpoint(d,v,y,b)}throw new Error("Not implemented.")}},{key:"pointFromMont",value:function(e){q(e instanceof E),q(e.curve.p.eq(this.p));var t=this.field(e.x),r=this.field(e.y);if(this.isIsogenous(e.curve)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point();var n=t.redSqr(),i=n.redMul(t),a=i.redMul(t),s=a.redMul(t),o=r.redSqr(),u=r.redMuln(4),c=n.redSub(this.one),f=n.redMuln(2),h=o.redMuln(4),l=i.redIMuln(2),p=t.redMul(o).redIMuln(4),d=n.redMul(o).redIMuln(2),v=o.redIMuln(2),y=u.redMul(c),b=a.redISub(f).redIAdd(h).redIAdd(this.one),m=s.redSub(l).redISub(p).redIAdd(t).redINeg(),g=s.redISub(d).redISub(l).redISub(v).redIAdd(t);return this.cpoint(y,b,m,g).divn(4)}if(this.isIsomorphic(e.curve,!0)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.one.redNeg());var k=this._scale(e.curve,!0).redMul(t),w=r,x=t.redAdd(this.one),S=t.redSub(this.one);return this.cpoint(k,w,x,S)}if(this.isIsomorphic(e.curve,!1)){if(e.isInfinity())return this.point();if(e.x.isZero())return this.point(this.zero,this.one.redNeg());var _=this._scale(e.curve,!1).redMul(t),I=r,A=t.redSub(this.one),T=t.redAdd(this.one);return this.cpoint(_,I,A,T)}throw new Error("Not implemented.")}},{key:"pointFromEdwards",value:function(e){q(e instanceof A),q(e.curve.p.eq(this.p));var t=this.field(e.curve.a),r=this.field(e.x),n=this.field(e.y),i=this.field(e.z),a=this.field(e.t);if(this.isIsogenous(e.curve)){var s=r.redMul(n),o=r.redSqr(),u=n.redSqr(),c=i.redSqr(),f=t.redMul(o),h=s.redIMuln(2),l=u.redSub(f),p=u.redAdd(f),d=c.redIMuln(2).redISub(p),v=this.cpoint(h,l,p,d);return this.twisted?v:v.divn(4)}if(this.isIsomorphic(e.curve)){var y=this._scale(e.curve),b=y.redMul(r),m=n,g=i,k=y.redMul(a);return this.point(b,m,g,k)}throw new Error("Not implemented.")}},{key:"pointFromUniform",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;q(e instanceof l),q(e.red===this.red),q(null==t||t instanceof S),t||(t=this._alt());var r=t.field(e),n=t.pointFromUniform(r);return this.pointFromMont(n)}},{key:"pointToUniform",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q(e instanceof A),q(t>>>0===t),q(null==r||r instanceof S),r||(r=this._alt());var n=(t>>4&15)%this.torsion.length,i=e.add(this.torsion[n]),a=r.pointFromEdwards(i),s=r.pointToUniform(a,15&t);return this.field(s)}},{key:"pointFromHash",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;q(null==r||r instanceof S),r||(r=this._alt());var n=r.pointFromHash(e,t);return this.pointFromMont(n)}},{key:"pointToHash",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;q(e instanceof A),q(t>>>0===t),q(null==n||n instanceof S),n||(n=this._alt());var i=t%this.torsion.length,a=e.add(this.torsion[i]),s=n.pointFromEdwards(a);return n.pointToHash(s,0,r)}},{key:"decodePoint",value:function(e){return A.decode(this,e)}},{key:"toShort",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._short(e,t),i=u(n,2),a=i[0],s=i[1],o=new k({red:this.red,prime:this.prime,p:this.p,a:a,b:s,n:this.n,h:this.h});if(null!=r){var c=o._scale(this),f=u(c,2),h=f[1];h.redIsOdd()!==r&&h.redINeg()}this.g.isInfinity()||(o.g=o.pointFromEdwards(this.g));for(var l=0;l<this.h;l++)o.torsion[l]=o.pointFromEdwards(this.torsion[l]);return o}},{key:"toMont",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=this._mont(e,t),i=u(n,2),a=i[0],s=i[1],o=new S({red:this.red,prime:this.prime,p:this.p,a:a,b:s,n:this.n,h:this.h,z:this.z});if(null!=r){var c=this._scale(o,t);c.redIsOdd()!==r&&c.redINeg()}this.g.isInfinity()||(o.g=o.pointFromEdwards(this.g));for(var f=0;f<this.h;f++)o.torsion[f]=o.pointFromEdwards(this.torsion[f]);return o}},{key:"toEdwards",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this._edwards(e),i=u(n,2),a=i[0],s=i[1],o=new t({red:this.red,prime:this.prime,p:this.p,a:a,d:s,n:this.n,h:this.h,z:this.z});if(null!=r){var c=o._scale(this);c.redIsOdd()!==r&&c.redINeg()}if(this.g.isInfinity()||(o.g=o.pointFromEdwards(this.g),o.g.normalize()),o.isComplete())for(var f=0;f<this.h;f++)o.torsion[f]=o.pointFromEdwards(this.torsion[f]),o.torsion[f].normalize();return o}},{key:"pointFromJSON",value:function(e){return A.fromJSON(this,e)}},{key:"toJSON",value:function(e){var r=s(a(t.prototype),"toJSON",this).call(this,e);return r.a=this.a.fromRed().toJSON(),r.d=this.d.fromRed().toJSON(),this.s.isZero()||(r.s=this.s.fromRed().toJSON()),r}}],[{key:"_isomorphism",value:function(e,t,r){q(e instanceof l),q(t instanceof l),q(r instanceof l);var n=r.clone(),i=r.redMul(t).redDiv(e);if(1!==e.redDiv(r).redJacobi())throw new Error("Invalid `a` coefficient.");return[n,i]}}]),t}(m),A=function(e){function t(e,r,n,s,o){var u;return c(this,t),q(e instanceof I),(u=i(this,a(t).call(this,e,y))).x=u.curve.zero,u.y=u.curve.one,u.z=u.curve.one,u.t=u.curve.zero,u.zOne=1,null!=r&&u._init(r,n,s,o),u}return o(t,e),f(t,[{key:"_init",value:function(e,t,r,n){q(e instanceof l),q(t instanceof l),q(null==r||r instanceof l),q(null==n||n instanceof l),this.x=e,this.y=t,this.z=r||this.curve.one,this.t=n||null,this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=0|this.z.eq(this.curve.one),this._check(),this.t||(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redDiv(this.z)))}},{key:"_check",value:function(){if(this.z.isZero())throw new Error("Invalid point.")}},{key:"clone",value:function(){return this.curve.point(this.x.clone(),this.y.clone(),this.z.clone(),this.t.clone())}},{key:"swap",value:function(e,r){q(e instanceof t);var n=1&(r>>31|-r>>31),i=this.zOne,a=e.zOne;return this.x.cswap(e.x,r),this.y.cswap(e.y,r),this.z.cswap(e.z,r),this.t.cswap(e.t,r),this.zOne=i&(1^n)|a&n,e.zOne=a&(1^n)|i&n,this}},{key:"normalize",value:function(){if(this.zOne)return this;var e=this.z.redInvert();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t=this.t.redMul(e),this.z=this.curve.one,this.zOne=1,this}},{key:"scale",value:function(e){q(e instanceof l);var t=this.x.redMul(e),r=this.y.redMul(e),n=this.z.redMul(e),i=this.t.redMul(e);return this.curve.point(t,r,n,i)}},{key:"neg",value:function(){var e=this.x.redNeg(),t=this.y,r=this.z,n=this.t.redNeg();return this.curve.point(e,t,r,n)}},{key:"add",value:function(e){return q(e instanceof t),this.isInfinity()?e:e.isInfinity()?this:this.zOne?e._add(this,0):this._add(e,0)}},{key:"_add",value:function(e,t){return this.curve.mOneA?this._addM1(e,t):this._addA(e,t)}},{key:"_addM1",value:function(e,t){var r=e.zOne&(1^t),n=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),a=this.t.redMul(this.curve.k).redMul(e.t),s=r?this.z.redAdd(this.z):this.z.redMul(e.z).redIMuln(2),o=i.redSub(n),u=s.redSub(a),c=s.redIAdd(a),f=i.redIAdd(n),h=o.redMul(u),l=c.redMul(f),p=o.redMul(f),d=u.redMul(c);return this.curve.point(h,l,d,p)}},{key:"_addA",value:function(e,t){var r=e.zOne&(1^t),n=this.x.redMul(e.x),i=this.y.redMul(e.y),a=this.curve._mulD(this.t).redMul(e.t),s=r?this.z.clone():this.z.redMul(e.z),o=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(n).redISub(i),u=s.redSub(a),c=s.redIAdd(a),f=i.redISub(this.curve._mulA(n)),h=o.redMul(u),l=c.redMul(f),p=o.redMul(f),d=u.redMul(c);return this.curve.point(h,l,d,p)}},{key:"dbl",value:function(){return this.isInfinity()?this:this._dbl(0)}},{key:"_dbl",value:function(e){var t=this.zOne&(1^e),r=this.x.redSqr(),n=this.y.redSqr(),i=t?this.curve.two:this.z.redSqr().redIMuln(2),a=this.curve._mulA(r),s=this.x.redAdd(this.y).redSqr().redISub(r).redISub(n),o=a.redAdd(n),u=o.redSub(i),c=a.redISub(n),f=s.redMul(u),h=o.redMul(c),l=s.redMul(c),p=u.redMul(o);return this.curve.point(f,h,p,l)}},{key:"uadd",value:function(e){return q(e instanceof t),this._add(e,1)}},{key:"udbl",value:function(){return this._dbl(1)}},{key:"getX",value:function(){return this.normalize(),this.x.fromRed()}},{key:"getY",value:function(){return this.normalize(),this.y.fromRed()}},{key:"eq",value:function(e){if(q(e instanceof t),q(!this.z.isZero()),q(!e.z.isZero()),this===e)return!0;if(this.z.eq(e.z))return this.x.eq(e.x)&&this.y.eq(e.y);var r=this.x.redMul(e.z),n=e.x.redMul(this.z);if(!r.eq(n))return!1;var i=this.y.redMul(e.z),a=e.y.redMul(this.z);return i.eq(a)}},{key:"isInfinity",value:function(){return q(!this.z.isZero()),!!this.x.isZero()&&this.y.eq(this.z)}},{key:"isOdd",value:function(){return this.normalize(),this.x.redIsOdd()}},{key:"isEven",value:function(){return this.normalize(),this.x.redIsEven()}},{key:"toP",value:function(){return this.normalize()}},{key:"toJ",value:function(){return this}},{key:"encode",value:function(){var e=this.getY();return e.setn(this.curve.signBit,this.x.redIsOdd()),this.curve.encodeAdjusted(e)}},{key:"toJSON",value:function(e){if(this.isInfinity())return[];var t=this.getX().toJSON(),r=this.getY().toJSON();return!0===e&&this.pre?[t,r,this.pre.toJSON()]:[t,r]}},{key:h,value:function(){return this.isInfinity()?"<EdwardsPoint: Infinity>":"<EdwardsPoint: x="+this.x.fromRed().toString(16,2)+" y="+this.y.fromRed().toString(16,2)+" z="+this.z.fromRed().toString(16,2)+">"}}],[{key:"decode",value:function(e,t){q(e instanceof I);var r=e.decodeAdjusted(t),n=0!==r.testn(e.signBit);if(r.setn(e.signBit,0),r.cmp(e.p)>=0)throw new Error("Invalid point.");return e.pointFromY(r,n)}},{key:"fromJSON",value:function(e,t){if(q(e instanceof I),q(Array.isArray(t)),q(0===t.length||2===t.length||3===t.length),0===t.length)return e.point();var r=l.fromJSON(t[0]),n=l.fromJSON(t[1]),i=e.point(r,n);return t.length>2&&null!=t[2]&&(i.pre=C.fromJSON(i,t[2])),i}}]),t}(g),T=function(){function t(e){c(this,t),q(e instanceof m);var r=e.fieldBits,n=7&r;0===n&&(n=8),e.scalarSize<e.fieldSize&&(r=8*e.scalarSize,n=8),this.curve=e,this.h=255&-e.h.word(0),this.n=(1<<n)-1,this.b=1<<n-1,this.and=l.mask(r).iuxorn(255^this.h),this.or=l.shift(1,r-1)}return f(t,[{key:"reduce",value:function(e){return q(e instanceof l),q(!e.red),e.iuand(this.and),e.iuor(this.or),e}},{key:"clamp",value:function(t){q(e.isBuffer(t)),q(t.length===this.curve.scalarSize);var r=0,n=this.curve.scalarSize-1;if("be"===this.curve.endian){var i=[n,r];r=i[0],n=i[1]}return this.curve.scalarSize>this.curve.fieldSize&&("be"===this.curve.endian?t[n++]=0:t[n--]=0),t[r]&=this.h,t[n]&=this.n,t[n]|=this.b,t}},{key:"splitHash",value:function(t){q(e.isBuffer(t)),q(t.length===2*this.curve.adjustedSize);var r=0;"be"===this.curve.endian&&(r=this.curve.adjustedSize-this.curve.scalarSize);var n=t.slice(r,r+this.curve.scalarSize),i=t.slice(this.curve.adjustedSize);return this.clamp(n),[n,i]}}]),t}(),C=function(){function e(){c(this,e),this.naf=null,this.windows=null,this.doubles=null,this.blinding=null,this.beta=null}return f(e,[{key:"map",value:function(e){q("function"===typeof e);var t=new this.constructor;return this.naf&&(t.naf=this.naf.map(e)),this.doubles&&(t.doubles=this.doubles.map(e)),t}},{key:"toJSON",value:function(){return{naf:this.naf?this.naf.toJSON():null,windows:this.windows?this.windows.toJSON():null,doubles:this.doubles?this.doubles.toJSON():null,blinding:this.blinding?this.blinding.toJSON():void 0}}},{key:"fromJSON",value:function(e,t){return q(e instanceof g),q(t&&"object"===typeof t),null!=t.naf&&(this.naf=B.fromJSON(e,t.naf)),null!=t.windows&&(this.windows=R.fromJSON(e,t.windows)),null!=t.doubles&&(this.doubles=N.fromJSON(e,t.doubles)),null!=t.blinding&&(this.blinding=P.fromJSON(e,t.blinding)),this}}],[{key:"fromJSON",value:function(e,t){return(new this).fromJSON(e,t)}}]),e}(),B=function(){function e(t,r){c(this,e),this.width=t,this.points=r}return f(e,[{key:"map",value:function(e){q("function"===typeof e);var t=this.width,r=[],n=!0,i=!1,a=void 0;try{for(var s,o=this.points[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;r.push(e(u))}}catch(c){i=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return new this.constructor(t,r)}},{key:"toJSON",value:function(){return{width:this.width,points:this.points.slice(1).map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(e,t){q(e instanceof g),q(t&&"object"===typeof t),q(t.width>>>0===t.width),q(Array.isArray(t.points));var r=e.curve,n=t.width,i=[e],a=!0,s=!1,o=void 0;try{for(var u,c=t.points[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=u.value;i.push(r.pointFromJSON(f))}}catch(h){s=!0,o=h}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return new this(n,i)}}]),e}(),R=function(){function e(t,r,n){c(this,e),this.width=t,this.bits=r,this.points=n}return f(e,[{key:"toJSON",value:function(){return{width:this.width,bits:this.bits,points:this.points.slice(1).map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(e,t){q(e instanceof g),q(t&&"object"===typeof t),q(t.width>>>0===t.width),q(t.bits>>>0===t.bits),q(Array.isArray(t.points));var r=e.curve,n=t.width,i=t.bits,a=[e],s=!0,o=!1,u=void 0;try{for(var c,f=t.points[Symbol.iterator]();!(s=(c=f.next()).done);s=!0){var h=c.value;a.push(r.pointFromJSON(h))}}catch(l){o=!0,u=l}finally{try{s||null==f.return||f.return()}finally{if(o)throw u}}return new this(n,i,a)}}]),e}(),N=function(){function e(t,r){c(this,e),this.step=t,this.points=r}return f(e,[{key:"map",value:function(e){q("function"===typeof e);var t=this.step,r=[],n=!0,i=!1,a=void 0;try{for(var s,o=this.points[Symbol.iterator]();!(n=(s=o.next()).done);n=!0){var u=s.value;r.push(e(u))}}catch(c){i=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}return new this.constructor(t,r)}},{key:"toJSON",value:function(){return{step:this.step,points:this.points.slice(1).map((function(e){return e.toJSON()}))}}}],[{key:"fromJSON",value:function(e,t){q(e instanceof g),q(t&&"object"===typeof t),q(t.step>>>0===t.step),q(Array.isArray(t.points));var r=e.curve,n=t.step,i=[e],a=!0,s=!1,o=void 0;try{for(var u,c=t.points[Symbol.iterator]();!(a=(u=c.next()).done);a=!0){var f=u.value;i.push(r.pointFromJSON(f))}}catch(h){s=!0,o=h}finally{try{a||null==c.return||c.return()}finally{if(s)throw o}}return new this(n,i)}}]),e}(),P=function(){function e(t,r){c(this,e),this.blind=t,this.unblind=r}return f(e,[{key:"toJSON",value:function(){return{blind:this.blind.toJSON(),unblind:this.unblind.toJSON()}}}],[{key:"fromJSON",value:function(e,t){q(e instanceof g),q(t&&"object"===typeof t);var r=e.curve;return new this(l.fromJSON(t.blind),r.pointFromJSON(t.unblind))}}]),e}(),M=function(){function e(t,r,n,i){c(this,e),this.beta=t,this.lambda=r,this.basis=n,this.pre=i}return f(e,[{key:"toJSON",value:function(){return{beta:this.beta.fromRed().toJSON(),lambda:this.lambda.toJSON(),basis:[this.basis[0].toJSON(),this.basis[1].toJSON()],pre:[this.pre[0].toJSON(),this.pre[1].toJSON()]}}}],[{key:"fromJSON",value:function(e,t){return q(e instanceof m),q(t&&"object"===typeof t),q(Array.isArray(t.basis)),q(Array.isArray(t.pre)),q(2===t.basis.length),q(2===t.pre.length),new this(l.fromJSON(t.beta).toRed(e.red),l.fromJSON(t.lambda),[D.fromJSON(t.basis[0]),D.fromJSON(t.basis[1])],[l.fromJSON(t.pre[0]),l.fromJSON(t.pre[1])])}}]),e}(),D=function(){function e(t,r){c(this,e),this.a=t,this.b=r}return f(e,[{key:"toJSON",value:function(){return{a:this.a.toJSON(),b:this.b.toJSON()}}}],[{key:"fromJSON",value:function(e){return q(e&&"object"===typeof e),new this(l.fromJSON(e.a),l.fromJSON(e.b))}}]),e}(),O={__proto__:null,P192:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"P192",ossl:"prime192v1",type:"short",endian:"be",hash:"SHA256",prime:"p192",p:["ffffffff ffffffff ffffffff fffffffe","ffffffff ffffffff"],a:["ffffffff ffffffff ffffffff fffffffe","ffffffff fffffffc"],b:["64210519 e59c80e7 0fa7e9ab 72243049","feb8deec c146b9b1"],n:["ffffffff ffffffff ffffffff 99def836","146bc9b1 b4d22831"],h:"1",z:"-5",g:[["188da80e b03090f6 7cbf20eb 43a18800","f4ff0afd 82ff1012"],["07192b95 ffc8da78 631011ed 6b24cdd5","73f977a1 1e794811"],e]}))}return o(t,e),t}(k),P224:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"P224",ossl:"secp224r1",type:"short",endian:"be",hash:"SHA256",prime:"p224",p:["ffffffff ffffffff ffffffff ffffffff","00000000 00000000 00000001"],a:["ffffffff ffffffff ffffffff fffffffe","ffffffff ffffffff fffffffe"],b:["b4050a85 0c04b3ab f5413256 5044b0b7","d7bfd8ba 270b3943 2355ffb4"],n:["ffffffff ffffffff ffffffff ffff16a2","e0b8f03e 13dd2945 5c5c2a3d"],h:"1",z:"1f",g:[["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3","56c21122 343280d6 115c1d21"],["bd376388 b5f723fb 4c22dfe6 cd4375a0","5a074764 44d58199 85007e34"],e]}))}return o(t,e),t}(k),P256:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"P256",ossl:"prime256v1",type:"short",endian:"be",hash:"SHA256",prime:null,p:["ffffffff 00000001 00000000 00000000","00000000 ffffffff ffffffff ffffffff"],a:["ffffffff 00000001 00000000 00000000","00000000 ffffffff ffffffff fffffffc"],b:["5ac635d8 aa3a93e7 b3ebbd55 769886bc","651d06b0 cc53b0f6 3bce3c3e 27d2604b"],n:["ffffffff 00000000 ffffffff ffffffff","bce6faad a7179e84 f3b9cac2 fc632551"],h:"1",z:"-a",g:[["6b17d1f2 e12c4247 f8bce6e5 63a440f2","77037d81 2deb33a0 f4a13945 d898c296"],["4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16","2bce3357 6b315ece cbb64068 37bf51f5"],e]}))}return o(t,e),t}(k),P384:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"P384",ossl:"secp384r1",type:"short",endian:"be",hash:"SHA384",prime:null,p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff fffffffe","ffffffff 00000000 00000000 ffffffff"],a:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff fffffffe","ffffffff 00000000 00000000 fffffffc"],b:["b3312fa7 e23ee7e4 988e056b e3f82d19","181d9c6e fe814112 0314088f 5013875a","c656398d 8a2ed19d 2a85c8ed d3ec2aef"],n:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff c7634d81 f4372ddf","581a0db2 48b0a77a ecec196a ccc52973"],h:"1",z:"-c",g:[["aa87ca22 be8b0537 8eb1c71e f320ad74","6e1d3b62 8ba79b98 59f741e0 82542a38","5502f25d bf55296c 3a545e38 72760ab7"],["3617de4a 96262c6f 5d9e98bf 9292dc29","f8f41dbd 289a147c e9da3113 b5f0b8c0","0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"],e]}))}return o(t,e),t}(k),P521:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"P521",ossl:"secp521r1",type:"short",endian:"be",hash:"SHA512",prime:"p521",p:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff"],a:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","fffffffc"],b:["00000051 953eb961 8e1c9a1f 929a21a0","b68540ee a2da725b 99b315f3 b8b48991","8ef109e1 56193951 ec7e937b 1652c0bd","3bb1bf07 3573df88 3d2c34f1 ef451fd4","6b503f00"],n:["000001ff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffff","fffffffa 51868783 bf2f966b 7fcc0148","f709a5d0 3bb5c9b8 899c47ae bb6fb71e","91386409"],h:"1",z:"-4",g:[["000000c6 858e06b7 0404e9cd 9e3ecb66","2395b442 9c648139 053fb521 f828af60","6b4d3dba a14b5e77 efe75928 fe1dc127","a2ffa8de 3348b3c1 856a429b f97e7e31","c2e5bd66"],["00000118 39296a78 9a3bc004 5c8a5fb4","2c7d1bd9 98f54449 579b4468 17afbd17","273e662c 97ee7299 5ef42640 c550b901","3fad0761 353c7086 a272c240 88be9476","9fd16650"],e]}))}return o(t,e),t}(k),SECP256K1:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"SECP256K1",ossl:"secp256k1",type:"short",endian:"be",hash:"SHA256",prime:"k256",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe fffffc2f"],a:"0",b:"7",n:["ffffffff ffffffff ffffffff fffffffe","baaedce6 af48a03b bfd25e8c d0364141"],h:"1",z:"1",c:["0a2d2ba9 3507f1df 233770c2 a797962c","c61f6d15 da14ecd4 7d8d27ae 1cd5f852"],g:[["79be667e f9dcbbac 55a06295 ce870b07","029bfcdb 2dce28d9 59f2815b 16f81798"],["483ada77 26a3c465 5da4fbfc 0e1108a8","fd17b448 a6855419 9c47d08f fb10d4b8"],e],endo:{beta:["7ae96a2b 657c0710 6e64479e ac3434e9","9cf04975 12f58995 c1396c28 719501ee"],lambda:["5363ad4c c05c30e0 a5261c02 8812645a","122e22ea 20816678 df02967c 1b23bd72"],basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],pre:["3086d221a7d46bcde86c90e49284eb153dab","-e4437ed6010e88286f547fa90abfe4c42212"]}}))}return o(t,e),t}(k),BRAINPOOLP256:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"BRAINPOOLP256",ossl:"brainpoolP256r1",type:"short",endian:"be",hash:"SHA256",prime:null,p:["a9fb57db a1eea9bc 3e660a90 9d838d72","6e3bf623 d5262028 2013481d 1f6e5377"],a:["7d5a0975 fc2c3057 eef67530 417affe7","fb8055c1 26dc5c6c e94a4b44 f330b5d9"],b:["26dc5c6c e94a4b44 f330b5d9 bbd77cbf","95841629 5cf7e1ce 6bccdc18 ff8c07b6"],n:["a9fb57db a1eea9bc 3e660a90 9d838d71","8c397aa3 b561a6f7 901e0e82 974856a7"],h:"1",z:"-2",g:[["8bd2aeb9 cb7e57cb 2c4b482f fc81b7af","b9de27e1 e3bd23c2 3a4453bd 9ace3262"],["547ef835 c3dac4fd 97f8461a 14611dc9","c2774513 2ded8e54 5c1d54c7 2f046997"],e]}))}return o(t,e),t}(k),BRAINPOOLP384:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"BRAINPOOLP384",ossl:"brainpoolP384r1",type:"short",endian:"be",hash:"SHA384",prime:null,p:["8cb91e82 a3386d28 0f5d6f7e 50e641df","152f7109 ed5456b4 12b1da19 7fb71123","acd3a729 901d1a71 87470013 3107ec53"],a:["7bc382c6 3d8c150c 3c72080a ce05afa0","c2bea28e 4fb22787 139165ef ba91f90f","8aa5814a 503ad4eb 04a8c7dd 22ce2826"],b:["04a8c7dd 22ce2826 8b39b554 16f0447c","2fb77de1 07dcd2a6 2e880ea5 3eeb62d5","7cb43902 95dbc994 3ab78696 fa504c11"],n:["8cb91e82 a3386d28 0f5d6f7e 50e641df","152f7109 ed5456b3 1f166e6c ac0425a7","cf3ab6af 6b7fc310 3b883202 e9046565"],h:"1",z:"-5",g:[["1d1c64f0 68cf45ff a2a63a81 b7c13f6b","8847a3e7 7ef14fe3 db7fcafe 0cbd10e8","e826e034 36d646aa ef87b2e2 47d4af1e"],["8abe1d75 20f9c2a4 5cb1eb8e 95cfd552","62b70b29 feec5864 e19c054f f9912928","0e464621 77918111 42820341 263c5315"],e]}))}return o(t,e),t}(k),BRAINPOOLP512:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"BRAINPOOLP512",ossl:"brainpoolP512r1",type:"short",endian:"be",hash:"SHA512",prime:null,p:["aadd9db8 dbe9c48b 3fd4e6ae 33c9fc07","cb308db3 b3c9d20e d6639cca 70330871","7d4d9b00 9bc66842 aecda12a e6a380e6","2881ff2f 2d82c685 28aa6056 583a48f3"],a:["7830a331 8b603b89 e2327145 ac234cc5","94cbdd8d 3df91610 a83441ca ea9863bc","2ded5d5a a8253aa1 0a2ef1c9 8b9ac8b5","7f1117a7 2bf2c7b9 e7c1ac4d 77fc94ca"],b:["3df91610 a83441ca ea9863bc 2ded5d5a","a8253aa1 0a2ef1c9 8b9ac8b5 7f1117a7","2bf2c7b9 e7c1ac4d 77fc94ca dc083e67","984050b7 5ebae5dd 2809bd63 8016f723"],n:["aadd9db8 dbe9c48b 3fd4e6ae 33c9fc07","cb308db3 b3c9d20e d6639cca 70330870","553e5c41 4ca92619 41866119 7fac1047","1db1d381 085ddadd b5879682 9ca90069"],h:"1",z:"7",g:[["81aee4bd d82ed964 5a21322e 9c4c6a93","85ed9f70 b5d916c1 b43b62ee f4d0098e","ff3b1f78 e2d0d48d 50d1687b 93b97d5f","7c6d5047 406a5e68 8b352209 bcb9f822"],["7dde385d 566332ec c0eabfa9 cf7822fd","f209f700 24a57b1a a000c55b 881f8111","b2dcde49 4a5f485e 5bca4bd8 8a2763ae","d1ca2b2f a8f05406 78cd1e0f 3ad80892"],e]}))}return o(t,e),t}(k),X25519:function(e){function t(){return c(this,t),i(this,a(t).call(this,{id:"X25519",ossl:"X25519",type:"mont",endian:"le",hash:"SHA512",prime:"p25519",p:["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffed"],a:"76d06",b:"1",n:["10000000 00000000 00000000 00000000","14def9de a2f79cd6 5812631a 5cf5d3ed"],h:"8",z:"2",g:[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000009"],["5f51e65e 475f794b 1fe122d3 88b72eb3","6dc2b281 92839e4d d6163a5d 81312c14"]],torsion:[[],["0000000000000000000000000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000000000000000000000"],["0000000000000000000000000000000000000000000000000000000000000001","141b0b6806563d503de05885280b59109ca5ee38d7b56c9c165db7106377bbd8"],["0000000000000000000000000000000000000000000000000000000000000001","6be4f497f9a9c2afc21fa77ad7f4a6ef635a11c7284a9363e9a248ef9c884415"],["00b8495f16056286fdb1329ceb8d09da6ac49ff1fae35616aeb8413b7c7aebe0","46ce3ed6a9617c5ad6b7d3eb19d74ba86cc403d6127fe4b29778eb7c6daf84d3"],["00b8495f16056286fdb1329ceb8d09da6ac49ff1fae35616aeb8413b7c7aebe0","3931c129569e83a529482c14e628b457933bfc29ed801b4d6887148392507b1a"],["57119fd0dd4e22d8868e1c58c45c44045bef839c55b1d0b1248c50a3bc959c5f","173a6c76c2ba719bce3935ffba04afeadf5bbcb971559722f0efc7bdfb7f9a36"],["57119fd0dd4e22d8868e1c58c45c44045bef839c55b1d0b1248c50a3bc959c5f","68c593893d458e6431c6ca0045fb501520a443468eaa68dd0f103842048065b7"]]}))}return o(t,e),t}(S),X448:function(e){function t(){return c(this,t),i(this,a(t).call(this,{id:"X448",ossl:"X448",type:"mont",endian:"le",hash:"SHAKE256",prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"262a6",b:"1",n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000000 00000000 00000000","00000000 00000005"],["7d235d12 95f5b1f6 6c98ab6e 58326fce","cbae5d34 f55545d0 60f75dc2 8df3f6ed","b8027e23 46430d21 1312c4b1 50677af7","6fd7223d 457b5b1a"]],torsion:[[],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["ba4d3a0829b6112f8812e51ba0bb2abebc1cb08eb48e556936ba50fd","d2e7d68af8cb32160522425b3f990812abbe635ad37a21e17551b193"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["45b2c5f7d649eed077ed1ae45f44d54143e34f714b71aa96c945af01","2d1829750734cde9faddbda4c066f7ed54419ca52c85de1e8aae4e6c"]]]}))}return o(t,e),t}(S),MONT448:function(e){function t(){return c(this,t),i(this,a(t).call(this,{id:"MONT448",ossl:null,type:"mont",endian:"le",hash:"SHAKE256",prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:["b2cf97d2 d43459a9 31ed36b1 fc4e3cb5","5d93f8d2 22746997 60ccffc6 49961ed6","c5b05fca c24864ed 6fb59697 931b78da","84ddecd8 ca2b5cfb"],b:"1",n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["ac0d24cc c6c75cb0 eb71f81e 7a6edf51","48e88aee 009a2a24 e795687e c28e125a","3e6730a6 0d46367b aa7fe99d 152128dc","41321bc7 7817f059"],["5a4437f6 80c0d0db 9b061276 d5d0ffcc","e786ff33 b6a53d30 98746425 82e66f09","4433dae7 7244a6e2 6b11e905 7228f483","556c41a5 913f55fe"]],torsion:[[],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["bec92fd06da2acf2b4e261e87cef0d3422e75c183c589857b71924e5","73c2f9cee18da5f2466e2f393c2eedf0f105a60ab40c717d4f1e1fd7"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["4136d02f925d530d4b1d9e178310f2cbdd18a3e7c3a767a848e6db19","8c3d06311e725a0db991d0c6c3d1120f0efa59f54bf38e82b0e1e028"]]]}))}return o(t,e),t}(S),ED25519:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"ED25519",ossl:"ED25519",type:"edwards",endian:"le",hash:"SHA512",prefix:"SigEd25519 no Ed25519 collisions",context:!1,prime:"p25519",p:["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff ffffffed"],a:"-1",d:["52036cee 2b6ffe73 8cc74079 7779e898","00700a4d 4141d8ab 75eb4dca 135978a3"],n:["10000000 00000000 00000000 00000000","14def9de a2f79cd6 5812631a 5cf5d3ed"],h:"8",z:"2",g:[["216936d3 cd6e53fe c0a4e231 fdd6dc5c","692cc760 9525a7b2 c9562d60 8f25d51a"],["66666666 66666666 66666666 66666666","66666666 66666666 66666666 66666658"],e],torsion:[["0000000000000000000000000000000000000000000000000000000000000000","0000000000000000000000000000000000000000000000000000000000000001"],["0000000000000000000000000000000000000000000000000000000000000000","7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"],["547cdb7fb03e20f4d4b2ff66c2042858d0bce7f952d01b873b11e4d8b5f15f3d","0000000000000000000000000000000000000000000000000000000000000000"],["2b8324804fc1df0b2b4d00993dfbd7a72f431806ad2fe478c4ee1b274a0ea0b0","0000000000000000000000000000000000000000000000000000000000000000"],["602a465ff9c6b5d716cc66cdc721b544a3e6c38fec1a1dc7215eb9b93aba2ea3","7a03ac9277fdc74ec6cc392cfa53202a0f67100d760b3cba4fd84d3d706a17c7"],["1fd5b9a006394a28e933993238de4abb5c193c7013e5e238dea14646c545d14a","7a03ac9277fdc74ec6cc392cfa53202a0f67100d760b3cba4fd84d3d706a17c7"],["602a465ff9c6b5d716cc66cdc721b544a3e6c38fec1a1dc7215eb9b93aba2ea3","05fc536d880238b13933c6d305acdfd5f098eff289f4c345b027b2c28f95e826"],["1fd5b9a006394a28e933993238de4abb5c193c7013e5e238dea14646c545d14a","05fc536d880238b13933c6d305acdfd5f098eff289f4c345b027b2c28f95e826"]]}))}return o(t,e),t}(I),ISO448:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"ISO448",ossl:null,type:"edwards",endian:"le",hash:"SHAKE256",prefix:"SigEd448",context:!0,prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"1",d:["d78b4bdc 7f0daf19 f24f38c2 9373a2cc","ad461572 42a50f37 809b1da3 412a12e7","9ccc9c81 264cfe9a d0809970 58fb61c4","243cc32d baa156b9"],n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["79a70b2b 70400553 ae7c9df4 16c792c6","1128751a c9296924 0c25a07d 728bdc93","e21f7787 ed697224 9de732f3 8496cd11","69871309 3e9c04fc"],["7fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 80000000","00000000 00000000 00000000 00000000","00000000 00000001"],e],torsion:[[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000001"]],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"]],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000001"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]]]}))}return o(t,e),t}(I),ED448:function(e){function t(e){return c(this,t),i(this,a(t).call(this,{id:"ED448",ossl:"ED448",type:"edwards",endian:"le",hash:"SHAKE256",prefix:"SigEd448",context:!0,prime:"p448",p:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff"],a:"1",d:["ffffffff ffffffff ffffffff ffffffff","ffffffff ffffffff fffffffe ffffffff","ffffffff ffffffff ffffffff ffffffff","ffffffff ffff6756"],n:["3fffffff ffffffff ffffffff ffffffff","ffffffff ffffffff ffffffff 7cca23e9","c44edb49 aed63690 216cc272 8dc58f55","2378c292 ab5844f3"],h:"4",z:"-1",g:[["4f1970c6 6bed0ded 221d15a6 22bf36da","9e146570 470f1767 ea6de324 a3d3a464","12ae1af7 2ab66511 433b80e1 8b00938e","2626a82b c70cc05e"],["693f4671 6eb6bc24 88762037 56c9c762","4bea7373 6ca39840 87789c1e 05a0c2d7","3ad3ff1c e67c39c4 fdbd132c 4ed7c8ad","9808795b f230fa14"],e],torsion:[[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000001"]],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"],["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"]],[["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000001"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]],[["fffffffffffffffffffffffffffffffffffffffffffffffffffffffe","fffffffffffffffffffffffffffffffffffffffffffffffffffffffe"],["00000000000000000000000000000000000000000000000000000000","00000000000000000000000000000000000000000000000000000000"]]]}))}return o(t,e),t}(I)},L={__proto__:null,P192:null,P224:null,P256:null,P384:null,P521:null,SECP256K1:null,BRAINPOOLP256:null,BRAINPOOLP384:null,BRAINPOOLP512:null,X25519:null,X448:null,MONT448:null,ED25519:null,ISO448:null,ED448:null};function K(e,t,r){q(e instanceof l),q(!e.red),q(t>>>0===t),q(r>>>0===r);for(var n=new Array(r),i=1<<t+1,a=e.abs(),s=1|e.sign(),o=0;!a.isZero();){var u=0;a.isOdd()&&((u=a.andln(i-1))&i>>>1&&(u-=i),a.isubn(u)),n[o++]=u*s;var c=1;a.isZero()||0!==a.andln(i-1)||(c=t+1);for(var f=1;f<c;f++)n[o++]=0;a.iushrn(c)}for(q(o<=r);o<r;o++)n[o]=0;return n}function U(e,t,r){for(var n=function(e,t,r){q(e instanceof l),q(t instanceof l),q(!e.red),q(!t.red),q(r>>>0===r);for(var n=[new Array(r),new Array(r)],i=e.abs(),a=t.abs(),s=1|e.sign(),o=1|t.sign(),u=0,c=0,f=0;i.cmpn(-c)>0||a.cmpn(-f)>0;){var h=i.andln(3)+c&3,p=a.andln(3)+f&3,d=0,v=0;if(3===h&&(h=-1),3===p&&(p=-1),1&h){var y=i.andln(7)+c&7;d=3!==y&&5!==y||2!==p?h:-h}if(1&p){var b=a.andln(7)+f&7;v=3!==b&&5!==b||2!==h?p:-p}n[0][u]=d*s,n[1][u]=v*o,2*c===d+1&&(c=1-c),2*f===v+1&&(f=1-f),i.iushrn(1),a.iushrn(1),u+=1}for(q(u<=r);u<r;u++)n[0][u]=0,n[1][u]=0;return n}(e,t,r),i=new Array(r),a=0;a<r;a++){var s=n[0][a],o=n[1][a];i[a]=b[3*(s+1)+(o+1)]}return i}function q(e,t){if(!e){var r=new Error(t||"Assertion failed");throw Error.captureStackTrace&&Error.captureStackTrace(r,q),r}}function z(e){q(e instanceof l);try{return[1,e.redSqrt()]}catch(t){if("X is not a square mod P."===t.message)return[0,e.clone()];throw t}}function j(e,t){q(e instanceof l),q(t instanceof l);try{return[1,e.redDivSqrt(t)]}catch(r){if("Not invertible."===r.message||"X is not a square mod P."===r.message)return[0,e.clone()];throw r}}function V(e){return l.randomBits(e,32).toNumber()}function F(e,t){var r=new WeakMap;return function(n,i){var a=1&i,s=r.get(n);if(s&&null!==s[a])return s[a];var o=e.call(t,n,i);return r.has(n)||r.set(n,[null,null]),r.get(n)[a]=o,o}}t.Curve=m,t.Point=g,t.ShortCurve=k,t.ShortPoint=w,t.JPoint=x,t.MontCurve=S,t.MontPoint=E,t.XPoint=_,t.EdwardsCurve=I,t.EdwardsPoint=A,t.curves=O,t.curve=function(e){q("string"===typeof e);var t=e.toUpperCase(),r=L[t];if(!r){var i=O[t];if(!i)throw new Error('Curve not found: "'.concat(e,'".'));for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];r=n(i,s),L[t]=r}return r},t.register=function(e,t){q("string"===typeof e),q("function"===typeof t);var r=e.toUpperCase();if(O[r])throw new Error('Curve already registered: "'.concat(e,'".'));O[r]=t,L[r]=null}}).call(this,r(3).Buffer)},function(e,t,r){"use strict";e.exports=r(2325)},function(e,t,r){"use strict";(function(t){var n=r(127),i=r(28),a=r(27),s=r(29),o=r(48),u=r(5),c=r(7),f=r(2086).custom,h=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],p=[0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176],d={p192:null,p224:null,p521:null,k256:null,p25519:null,p448:null},v=0,y=1,b=2,m=3,g=4,k=7,w="function"===typeof BigInt,x=function(){function e(t,r,n){u(this,e),this.words=[0],this.length=1,this.negative=0,this.red=null,this.from(t,r,n)}return c(e,[{key:"_iadd",value:function(e,t){var r=0,n=0;if(e.length<t.length){var i=[t,e];e=i[0],t=i[1]}for(e!==this&&this._alloc(e.length);n<t.length;n++){var a=(0|e.words[n])+(0|t.words[n])+r;this.words[n]=67108863&a,r=a>>>26}for(;0!==r&&n<e.length;n++){var s=(0|e.words[n])+r;this.words[n]=67108863&s,r=s>>>26}if(this.length=e.length,0!==r)this._alloc(this.length+1),this.words[this.length++]=r;else if(e!==this)for(;n<e.length;n++)this.words[n]=e.words[n];return this}},{key:"_iaddn",value:function(e){if(this.words[0]+=e,this.words[0]<67108864)return this;var t=0;for(this._alloc(this.length+1),this.words[this.length]=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,this.words[t+1]+=1;return this.length=Math.max(this.length,t+1),this}},{key:"iadd",value:function(t){if(D(e.isBN(t),"num","bignum"),this.negative===t.negative)this._iadd(this,t);else{var r=this.ucmp(t);if(0===r)return this.words[0]=0,this.length=1,this.negative=0,this;r<0?(this._isub(t,this),this.negative^=1):this._isub(this,t)}return this}},{key:"iaddn",value:function(e){D(z(e),"num","smi");var t=e<0|0;return t&&(e=-e),this.negative===t?this._iaddn(e):1===this.length&&this.words[0]<e?(this.words[0]=e-this.words[0],this.negative^=1):this._isubn(e),this}},{key:"add",value:function(t){return D(e.isBN(t),"num","bignum"),t.length>this.length?t.clone().iadd(this):this.clone().iadd(t)}},{key:"addn",value:function(e){return this.clone().iaddn(e)}},{key:"_isub",value:function(e,t){var r=0,n=0;for(M(e.length>=t.length),e!==this&&this._alloc(e.length);n<t.length;n++){var i=(0|e.words[n])-(0|t.words[n])+r;r=i>>26,this.words[n]=67108863&i}for(;0!==r&&n<e.length;n++){var a=(0|e.words[n])+r;r=a>>26,this.words[n]=67108863&a}if(M(0===r),e!==this)for(;n<e.length;n++)this.words[n]=e.words[n];return this.length=Math.max(this.length,n),this._strip()}},{key:"_isubn",value:function(e){if(this.words[0]-=e,this.words[0]>=0)return this._normalize();M(1!==this.length),this._alloc(this.length+1);for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.words[this.length]=0,this._strip()}},{key:"isub",value:function(t){if(D(e.isBN(t),"num","bignum"),this.negative!==t.negative)this._iadd(this,t);else{var r=this.ucmp(t);if(0===r)return this.words[0]=0,this.length=1,this.negative=0,this;r<0?(this._isub(t,this),this.negative^=1):this._isub(this,t)}return this}},{key:"isubn",value:function(e){D(z(e),"num","smi");var t=e<0|0;return t&&(e=-e),this.negative!==t?this._iaddn(e):1===this.length&&this.words[0]<e?(this.words[0]=e-this.words[0],this.negative^=1):this._isubn(e),this}},{key:"sub",value:function(e){return this.clone().isub(e)}},{key:"subn",value:function(e){return this.clone().isubn(e)}},{key:"_mul",value:function(t,r){if(D(e.isBN(t),"num","bignum"),D(e.isBN(r),"out","bignum"),10===this.length&&10===t.length)return Q(this,t,r);var n=this.length+t.length;return n<63?W(this,t,r):n<1024?J(this,t,r):function(e,t,r){if(!w||e.length+t.length>82595519)return J(e,t,r);var n=BigInt(0),i=BigInt(67108863),a=BigInt(26),s=e.toBigInt()*t.toBigInt(),o=s<n|0;o&&(s=-s);var u=0;for(;s>n;)r.words[u++]=Number(s&i),s>>=a;0===u&&(r.words[u++]=0);return r.length=u,r.negative=o,r}(this,t,r)}},{key:"imul",value:function(e){return this.mul(e)._move(this)}},{key:"imuln",value:function(e){D(z(e),"num","smi");var t=e<0|0;t&&(e=-e);for(var r=0,n=0;n<this.length;n++){var i=this.words[n]*e,a=(67108863&i)+(67108863&r);r>>=26,r+=i/67108864|0,r+=a>>>26,this.words[n]=67108863&a}return this.negative^=t,0!==r?(this._alloc(this.length+1),this.words[this.length++]=r):this._strip(),this}},{key:"mul",value:function(t){D(e.isBN(t),"num","bignum");var r=this.length+t.length,n=new e;n.words=new Array(r);for(var i=0;i<r;i++)n.words[i]=0;return this._mul(t,n)}},{key:"muln",value:function(e){return this.clone().imuln(e)}},{key:"mulShift",value:function(t,r){D(e.isBN(t),"num","bignum"),D(r>>>0===r,"bits","uint32");var n=this.mul(t),i=n.utestn(r-1);return n.iushrn(r),this.negative^t.negative?n.isubn(i):n.iaddn(i)}},{key:"_div",value:function(t,r){D(e.isBN(t),"num","bignum"),M((r&k)===r),M(r!==v);var n=this,i=t;if(U(!i.isZero()),n.isZero())return[new e(0),new e(0)];var a=n.negative,s=i.negative;n.negative=0,i.negative=0;var u=null,c=null;if(n.ucmp(i)<0)r&y&&(u=new e(0)),r&b&&(c=n.clone());else if(1===i.length)r&y&&(u=n.quon(i.words[0])),r&b&&(c=n.remn(i.words[0]));else{var f=n._wordDiv(i,r),h=o(f,2);u=h[0],c=h[1]}return n.negative=a,i.negative=s,r&y&&(u.negative=n.negative^i.negative,u._normalize()),r&b&&(c.negative=n.negative,c._normalize()),r&g&&(r&y&&(M(0!==(r&b)),0!==c.negative&&(0!==i.negative?u.iaddn(1):u.isubn(1))),r&b&&0!==c.negative&&(0!==i.negative?c.isub(i):c.iadd(i))),[u,c]}},{key:"_wordDiv",value:function(t,r){var n,i=this.clone(),a=t,s=null,o=0|a.words[a.length-1],u=26-V(o);0!==u?(a=a.clone(),i.iushln(u),a.iushln(u),n=0|a.words[a.length-1]):n=o;var c=i.length-a.length;if(M(c>=0),r&y){(s=new e(0)).length=c+1,s.words=new Array(s.length);for(var f=0;f<s.length;f++)s.words[f]=0}var h=i.clone();h._ishlnsubmul(a,1,c),0===h.negative&&(s&&(s.words[c]=1),i=h);for(var l=c-1;l>=0;l--){var p=(67108864*i.words[a.length+l]+i.words[a.length+l-1])/n|0,d=Math.min(p,67108863);for(i._ishlnsubmul(a,d,l);0!==i.negative;)d-=1,i.negative=0,i._ishlnsubmul(a,1,l),i.ineg();s&&(s.words[l]=d)}return s&&s._strip(),r&b&&0!==u&&i.iushrn(u),[s,i]}},{key:"_ishlnsubmul",value:function(e,t,r){var n=0,i=0;for(this._expand(e.length+r);i<e.length;i++){var a=(0|this.words[i+r])+n,s=e.words[i]*t,o=a-(67108863&s);n=(o>>26)-(s/67108864|0),this.words[i+r]=67108863&o}for(;i<this.length-r;i++){var u=(0|this.words[i+r])+n;n=u>>26,this.words[i+r]=67108863&u}if(0===n)return this._strip();M(-1===n),n=0;for(var c=0;c<this.length;c++){var f=-(0|this.words[c])+n;n=f>>26,this.words[c]=67108863&f}return this.negative=1,this._strip()}},{key:"quorem",value:function(e){return this._div(e,m)}},{key:"iquo",value:function(e){return this.quo(e)._move(this)}},{key:"iquon",value:function(e){D(z(e),"num","smi"),U(0!==e);var t=e<0|0;t&&(e=-e);for(var r=0,n=this.length-1;n>=0;n--){var i=(0|this.words[n])+67108864*r;this.words[n]=i/e|0,r=i%e}return this.negative^=t,this._strip()}},{key:"quo",value:function(e){return this._div(e,y)[0]}},{key:"quon",value:function(e){return this.clone().iquon(e)}},{key:"irem",value:function(e){return this.rem(e)._move(this)}},{key:"iremn",value:function(e){var t=this.remrn(e);return t<0&&(t=-t),this.words[0]=t,this.length=1,this._normalize()}},{key:"rem",value:function(e){return this._div(e,b)[1]}},{key:"remn",value:function(e){return this.clone().iremn(e)}},{key:"remrn",value:function(e){D(z(e),"num","smi"),U(0!==e),e<0&&(e=-e);for(var t=(1<<26)%e,r=0,n=this.length-1;n>=0;n--)r=(t*r+(0|this.words[n]))%e;return 0!==this.negative?0|-r:r}},{key:"divmod",value:function(e){return this._div(e,m|g)}},{key:"idiv",value:function(e){return this.div(e)._move(this)}},{key:"idivn",value:function(e){if(0===this.negative)return this.iquon(e);var t=this.remrn(e);return this.iquon(e),t<0&&(e<0?this.iaddn(1):this.isubn(1)),this}},{key:"div",value:function(e){return this._div(e,m|g)[0]}},{key:"divn",value:function(e){return this.clone().idivn(e)}},{key:"imod",value:function(e){return this.ucmp(e)<0?(0!==this.negative&&(this._isub(e,this),this.negative=0),this):this.mod(e)._move(this)}},{key:"imodn",value:function(e){return this.words[0]=this.modrn(e),this.length=1,this.negative=0,this}},{key:"mod",value:function(e){return this._div(e,b|g)[1]}},{key:"modn",value:function(e){return this.clone().imodn(e)}},{key:"modrn",value:function(e){D(z(e),"num","smi");var t=this.remrn(e);return t<0&&(e<0?t-=e:t+=e),t}},{key:"divRound",value:function(e){var t=this.quorem(e),r=o(t,2),n=r[0],i=r[1];if(i.isZero())return n;var a=1&e.words[0];e.iushrn(1);var s=i.ucmp(e);return e.iushln(1),e.words[0]|=a,s<0||e.isOdd()&&0===s?n:this.negative^e.negative?n.isubn(1):n.iaddn(1)}},{key:"ipow",value:function(e){return this.pow(e)._move(this)}},{key:"ipown",value:function(e){return this.pown(e)._move(this)}},{key:"pow",value:function(t){D(e.isBN(t),"num","bignum");for(var r=V(t.words[t.length-1]),n=new e(1),i=t.length-1;i>=0;i--){for(var a=t.words[i],s=r-1;s>=0;s--)n=n.sqr(),a>>s&1&&(n=n.mul(this));r=26}return n}},{key:"pown",value:function(t){if(D(z(t),"num","smi"),t<0&&(t=-t),0===t)return new e(1);if(1===t)return this.clone();for(var r=this,n=V(t)-2;n>=0;n--)r=r.sqr(),t>>n&1&&(r=r.mul(this));return r}},{key:"isqr",value:function(){return this.imul(this)}},{key:"sqr",value:function(){return this.mul(this)}},{key:"_rootrem",value:function(t,r){if(D(t>>>0===t,"num","uint32"),0===t)throw new RangeError("Zeroth root.");if(~t&this.negative)throw new RangeError("Negative with even root.");if(this.ucmpn(1)<=0)return[this.clone(),new e(0)];var n,i,a=new e(0),s=e.shift(1,this.bitLength()/t+1|0);if(0!==this.negative&&s.ineg(),2===t)do{a=s,(s=this.quo(a)).iadd(a),s.iushrn(1)}while(s.ucmp(a)<0);else do{s=(a=s).pown(t-1),s=this.quo(s),n=a.muln(t-1),s.iadd(n),s=s.quon(t)}while(s.ucmp(a)<0);return r&&(s=a.pown(t),i=this.sub(s)),[a,i]}},{key:"rootrem",value:function(e){return this._rootrem(e,1)}},{key:"iroot",value:function(e){return this.root(e)._move(this)}},{key:"root",value:function(e){return this._rootrem(e,0)[0]}},{key:"isPower",value:function(e){if(D(e>>>0===e,"num","uint32"),0===e||~e&this.negative)return!1;var t=this.rootrem(e);return 0===o(t,2)[1].sign()}},{key:"sqrtrem",value:function(){return this.rootrem(2)}},{key:"isqrt",value:function(){return this.sqrt()._move(this)}},{key:"sqrt",value:function(){return this.root(2)}},{key:"isSquare",value:function(){return this.isPower(2)}},{key:"iand",value:function(t){D(e.isBN(t),"num","bignum");var r=this,n=t;if(r===n)return r;if(0===(r.negative|n.negative))return r.iuand(n);if(1===(r.negative&n.negative))return r.iaddn(1),n.iaddn(1),r.iuor(n),r.isubn(1),n.isubn(1),r;if(0!==r.negative){var i=[n.clone(),r];r=i[0],n=i[1]}var a=r.bitLength();return n.iaddn(1),n.inotn(a),r.iuand(n),n.inotn(a),n.isubn(1),r._move(this)}},{key:"iandn",value:function(t){return D(z(t),"num","smi"),0!==(this.negative|t<0)?this.iand(new e(t)):(this.words[0]&=t,this.length=1,this)}},{key:"and",value:function(e){return this.clone().iand(e)}},{key:"andn",value:function(e){return this.clone().iandn(e)}},{key:"andrn",value:function(t){if(D(z(t),"num","smi"),0!==(this.negative|t<0)){var r=this.iand(new e(t));if(r.length>1)throw new RangeError("Number exceeds 26 bits.");return 0!==r.negative?-r.words[0]:r.words[0]}return this.words[0]&t}},{key:"iuand",value:function(t){D(e.isBN(t),"num","bignum"),this.length=Math.min(this.length,t.length);for(var r=0;r<this.length;r++)this.words[r]&=t.words[r];return this._strip()}},{key:"iuandn",value:function(e){return D(z(e),"num","smi"),this.words[0]&=Math.abs(e),this.length=1,this._normalize()}},{key:"uand",value:function(e){return this.clone().iuand(e)}},{key:"uandn",value:function(e){return this.clone().iuandn(e)}},{key:"uandrn",value:function(e){D(z(e),"num","smi");var t=this.words[0]&Math.abs(e);return 0!==this.negative?0|-t:t}},{key:"ior",value:function(t){D(e.isBN(t),"num","bignum");var r=this,n=t;if(r===n)return r;if(0===(r.negative|n.negative))return r.iuor(n);if(1===(r.negative&n.negative))return r.iaddn(1),n.iaddn(1),r.iuand(n),r.isubn(1),n.isubn(1),r;if(n=n.clone(),0!==r.negative){var i=[n,r];r=i[0],n=i[1]}return n.iaddn(1),r.inotn(n.bitLength()),n.iuand(r),n.isubn(1),n._move(this)}},{key:"iorn",value:function(t){return D(z(t),"num","smi"),0!==(this.negative|t<0)?this.ior(new e(t)):(this.words[0]|=t,this)}},{key:"or",value:function(e){return this.clone().ior(e)}},{key:"orn",value:function(e){return this.clone().iorn(e)}},{key:"iuor",value:function(t){D(e.isBN(t),"num","bignum"),this._expand(t.length);for(var r=0;r<t.length;r++)this.words[r]|=t.words[r];return this}},{key:"iuorn",value:function(e){return D(z(e),"num","smi"),this.words[0]|=Math.abs(e),this}},{key:"uor",value:function(e){return this.clone().iuor(e)}},{key:"uorn",value:function(e){return this.clone().iuorn(e)}},{key:"ixor",value:function(t){D(e.isBN(t),"num","bignum");var r=this,n=t;if(r===n)return r.words[0]=0,r.length=1,r.negative=0,r;if(0===(r.negative|n.negative))return r.iuxor(n);if(1===(r.negative&n.negative))return r.iaddn(1),n.iaddn(1),r.iuxor(n),r.ineg(),n.isubn(1),r;if(0!==r.negative){var i=[n.clone(),r];r=i[0],n=i[1]}return n.iaddn(1),r.iuxor(n),r.iaddn(1),r.ineg(),n.isubn(1),r._move(this)}},{key:"ixorn",value:function(t){return D(z(t),"num","smi"),0!==(this.negative|t<0)?this.ixor(new e(t)):(this.words[0]^=t,this)}},{key:"xor",value:function(e){return this.clone().ixor(e)}},{key:"xorn",value:function(e){return this.clone().ixorn(e)}},{key:"iuxor",value:function(t){D(e.isBN(t),"num","bignum");var r=this,n=t;if(r.length<n.length){var i=[n,r];r=i[0],n=i[1]}for(var a=0;a<n.length;a++)this.words[a]=r.words[a]^n.words[a];if(r!==this)for(this._alloc(r.length);a<r.length;a++)this.words[a]=r.words[a];return this.length=r.length,this._strip()}},{key:"iuxorn",value:function(e){return D(z(e),"num","smi"),this.words[0]^=Math.abs(e),this._normalize()}},{key:"uxor",value:function(e){return this.clone().iuxor(e)}},{key:"uxorn",value:function(e){return this.clone().iuxorn(e)}},{key:"inot",value:function(){return 0!==this.negative?this.ineg().isubn(1):this.iaddn(1).ineg(),this}},{key:"not",value:function(){return this.clone().inot()}},{key:"inotn",value:function(e){D(e>>>0===e,"width","uint32");var t=e%26,r=Math.ceil(e/26),n=0;for(this._expand(r),t>0&&(r-=1);n<r;n++)this.words[n]^=67108863;return t>0&&(this.words[n]^=(1<<t)-1),this._strip()}},{key:"notn",value:function(e){return this.clone().inotn(e)}},{key:"ishl",value:function(t){return D(e.isBN(t),"bits","bignum"),D(t.bitLength()<=32,"bits","uint32"),this.ishln(t.toNumber())}},{key:"ishln",value:function(e){return this.iushln(e)}},{key:"shl",value:function(e){return this.clone().ishl(e)}},{key:"shln",value:function(e){return this.clone().ishln(e)}},{key:"iushl",value:function(t){return D(e.isBN(t),"bits","bignum"),D(t.bitLength()<=32,"bits","uint32"),this.iushln(t.toNumber())}},{key:"iushln",value:function(e){D(e>>>0===e,"bits","uint32");var t=e%26,r=(e-t)/26,n=(1<<t)-1<<26-t;if(0!==t){for(var i=0,a=0;a<this.length;a++){var s=this.words[a]&n,o=(0|this.words[a])-s<<t;this.words[a]=o|i,i=s>>>26-t}0!==i&&(this._alloc(this.length+1),this.words[this.length++]=i)}if(0!==r){this._alloc(this.length+r);for(var u=this.length-1;u>=0;u--)this.words[u+r]=this.words[u];for(var c=0;c<r;c++)this.words[c]=0;this.length+=r}return this._strip()}},{key:"ushl",value:function(e){return this.clone().iushl(e)}},{key:"ushln",value:function(e){return this.clone().iushln(e)}},{key:"_split",value:function(e,t){var r=e%26,n=Math.min((e-r)/26,this.length),i=(1<<r)-1;if(t){t._alloc(n);for(var a=0;a<n;a++)t.words[a]=this.words[a];t.length=n}if(0===n);else if(this.length>n){this.length-=n;for(var s=0;s<this.length;s++)this.words[s]=this.words[s+n]}else this.words[0]=0,this.length=1;var o=0;if(0!==r)for(var u=this.length-1;u>=0;u--){var c=0|this.words[u];this.words[u]=o<<26-r|c>>>r,o=c&i}return t&&(0!==o?(t._alloc(t.length+1),t.words[t.length++]=o):(0===t.length&&(t.words[t.length++]=0),t._strip())),this._strip()}},{key:"ishr",value:function(t){return D(e.isBN(t),"bits","bignum"),D(t.bitLength()<=32,"bits","uint32"),this.ishrn(t.toNumber())}},{key:"ishrn",value:function(e){return D(e>>>0===e,"bits","uint32"),0!==this.negative?(this.iaddn(1),this.iushrn(e),this.isubn(1),this):this.iushrn(e)}},{key:"shr",value:function(e){return this.clone().ishr(e)}},{key:"shrn",value:function(e){return this.clone().ishrn(e)}},{key:"iushr",value:function(t){return D(e.isBN(t),"bits","bignum"),D(t.bitLength()<=32,"bits","uint32"),this.iushrn(t.toNumber())}},{key:"iushrn",value:function(e){return D(e>>>0===e,"bits","uint32"),this._split(e,null)}},{key:"ushr",value:function(e){return this.clone().iushr(e)}},{key:"ushrn",value:function(e){return this.clone().iushrn(e)}},{key:"setn",value:function(e,t){return D(e>>>0===e,"bit","uint32"),0!==this.negative?(this.iaddn(1),this.usetn(e,!t),this.isubn(1),this):this.usetn(e,t)}},{key:"usetn",value:function(e,t){D(e>>>0===e,"bit","uint32");var r=e%26,n=(e-r)/26;return this._expand(n+1),t?this.words[n]|=1<<r:this.words[n]&=~(1<<r),this._strip()}},{key:"testn",value:function(e){D(e>>>0===e,"bit","uint32");var t=e%26,r=(e-t)/26;if(this.length<=r)return this.negative;var n=this.words[r],i=n>>t&1;if(0!==this.negative){if(t>0&&n&(1<<t)-1)return 1^i;for(var a=r;a--;)if(this.words[a]>0)return 1^i}return i}},{key:"utestn",value:function(e){D(e>>>0===e,"bit","uint32");var t=e%26,r=(e-t)/26;return this.length<=r?0:this.words[r]>>t&1}},{key:"imaskn",value:function(e){return D(e>>>0===e,"bits","uint32"),0!==this.negative&&(this.iaddn(1),this.inotn(e+1),this.ineg()),this.iumaskn(e)}},{key:"maskn",value:function(e){return this.clone().imaskn(e)}},{key:"iumaskn",value:function(e){D(e>>>0===e,"bits","uint32");var t=e%26,r=(e-t)/26;return this.length<=r?this:(0!==t&&(r+=1),this.length=Math.min(r,this.length),0!==t&&(this.words[this.length-1]&=(1<<t)-1),0===this.length&&(this.words[this.length++]=0),this._strip())}},{key:"umaskn",value:function(e){return this.clone().iumaskn(e)}},{key:"andln",value:function(e){return this.words[0]&e}},{key:"bit",value:function(e){return this.utestn(e)}},{key:"bits",value:function(e,t){D(e>>>0===e,"pos","uint32"),D(t>>>0===t,"width","uint32"),D(t<=26,"width","width");var r=e%26,n=(e-r)/26;if(n>=this.length)return 0;var i=this.words[n]>>r&(1<<t)-1;if(r+t>26&&n+1<this.length){var a=r+t-26;i|=(this.words[n+1]&(1<<a)-1)<<26-r}return i}},{key:"ineg",value:function(){return this.isZero()||(this.negative^=1),this}},{key:"neg",value:function(){return this.clone().ineg()}},{key:"iabs",value:function(){return this.negative=0,this}},{key:"abs",value:function(){return this.clone().iabs()}},{key:"cmp",value:function(t){if(D(e.isBN(t),"num","bignum"),this.negative!==t.negative)return t.negative-this.negative;var r=this.ucmp(t);return 0!==this.negative?0|-r:r}},{key:"cmpn",value:function(e){D(z(e),"num","smi");var t=e<0|0;if(this.negative!==t)return t-this.negative;var r=this.ucmpn(e);return 0!==this.negative?0|-r:r}},{key:"eq",value:function(e){return 0===this.cmp(e)}},{key:"eqn",value:function(e){return 0===this.cmpn(e)}},{key:"gt",value:function(e){return this.cmp(e)>0}},{key:"gtn",value:function(e){return this.cmpn(e)>0}},{key:"gte",value:function(e){return this.cmp(e)>=0}},{key:"gten",value:function(e){return this.cmpn(e)>=0}},{key:"lt",value:function(e){return this.cmp(e)<0}},{key:"ltn",value:function(e){return this.cmpn(e)<0}},{key:"lte",value:function(e){return this.cmp(e)<=0}},{key:"lten",value:function(e){return this.cmpn(e)<=0}},{key:"sign",value:function(){return 0!==this.negative?-1:1===this.length&&0===this.words[0]?0:1}},{key:"isZero",value:function(){return 1===this.length&&0===this.words[0]}},{key:"isNeg",value:function(){return 0!==this.negative}},{key:"isPos",value:function(){return 0===this.negative}},{key:"isOdd",value:function(){return 1===(1&this.words[0])}},{key:"isEven",value:function(){return 0===(1&this.words[0])}},{key:"ucmp",value:function(t){if(D(e.isBN(t),"num","bignum"),this.length<t.length)return-1;if(this.length>t.length)return 1;for(var r=this.length-1;r>=0;r--){var n=0|this.words[r],i=0|t.words[r];if(n!==i)return(n>i)-(n<i)}return 0}},{key:"ucmpn",value:function(e){if(D(z(e),"num","smi"),this.length>1)return 1;var t=0|this.words[0];return e<0&&(e=-e),(t>e)-(t<e)}},{key:"legendre",value:function(t){var r=w?e.red(t):e.mont(t);return this.toRed(r).redLegendre()}},{key:"jacobi",value:function(t){if(D(e.isBN(t),"num","bignum"),t.isZero()||t.isEven())throw new Error("jacobi: `num` must be odd.");var r=this._cloneNormal(),n=t.clone(),i=1;for(n.isNeg()&&(r.isNeg()&&(i=-1),n.ineg());;){if(0===n.cmpn(1))return i;if(r.isZero())return 0;if(r.imod(n),r.isZero())return 0;var a=r.zeroBits();if(1&a){var s=n.andln(7);3!==s&&5!==s||(i=-i)}var o=r.iushrn(a);3===n.andln(3)&&3===o.andln(3)&&(i=-i),r=n,n=o}}},{key:"kronecker",value:function(t){D(e.isBN(t),"num","bignum");var r=[0,1,0,-1,0,-1,0,1],n=this._cloneNormal(),i=t.clone(),a=1;if(i.isZero())return 0===n.ucmpn(1)?a:0;if(!n.isOdd()&&!i.isOdd())return 0;var s=i.zeroBits();for(i.iushrn(s),1&s&&(a=r[n.andln(7)]),i.isNeg()&&(n.isNeg()&&(a=-a),i.ineg());;){if(n.isZero())return 0===i.cmpn(1)?a:0;var o=n.zeroBits();n.iushrn(o),1&o&&(a*=r[i.andln(7)]),(n.words[0]^67108863*n.negative)&i.words[0]&2&&(a=-a),i.imod(n);var u=[i,n];n=u[0],(i=u[1]).negative=0}}},{key:"igcd",value:function(e){return this.gcd(e)._move(this)}},{key:"gcd",value:function(t){if(D(e.isBN(t),"num","bignum"),this.isZero())return t.abs();if(t.isZero())return this.abs();var r=this.clone(),n=t.clone();r.negative=0,n.negative=0;var i=r._factor2(n);for(0!==i&&(r.iushrn(i),n.iushrn(i));;){var a=r.zeroBits(),s=n.zeroBits();0!==a&&r.iushrn(a),0!==s&&n.iushrn(s);var o=r.ucmp(n);if(o<0){var u=[n,r];r=u[0],n=u[1]}else if(0===o||0===n.ucmpn(1))break;r._isub(r,n)}return n.iushln(i)}},{key:"ilcm",value:function(e){return this.lcm(e)._move(this)}},{key:"lcm",value:function(t){return D(e.isBN(t),"num","bignum"),this.isZero()||t.isZero()?new e(0):this.quo(this.gcd(t)).mul(t).iabs()}},{key:"egcd",value:function(t){if(D(e.isBN(t),"num","bignum"),this.isZero())return[new e(0),new e(t.sign()),t.abs()];if(t.isZero())return[new e(this.sign()),new e(0),this.abs()];var r=this.clone(),n=t.clone();r.negative=0,n.negative=0;var i=new e(1),a=new e(0),s=new e(0),o=new e(1),u=r._factor2(n);0!==u&&(r.iushrn(u),n.iushrn(u));for(var c=n.clone(),f=r.clone();!r.isZero();){for(var h=0,l=1;0===(r.words[0]&l)&&h<26;l<<=1)h+=1;if(h>0)for(r.iushrn(h);h>0;)(i.isOdd()||a.isOdd())&&(i.iadd(c),a.isub(f)),i.iushrn(1),a.iushrn(1),h-=1;for(var p=0,d=1;0===(n.words[0]&d)&&p<26;d<<=1)p+=1;if(p>0)for(n.iushrn(p);p>0;)(s.isOdd()||o.isOdd())&&(s.iadd(c),o.isub(f)),s.iushrn(1),o.iushrn(1),p-=1;r.cmp(n)>=0?(r.isub(n),i.isub(s),a.isub(o)):(n.isub(r),s.isub(i),o.isub(a))}return 0!==this.negative&&s.ineg(),0!==t.negative&&o.ineg(),[s,o,n.iushln(u)]}},{key:"iinvert",value:function(e){return this.invert(e)._move(this)}},{key:"invert",value:function(t){if(D(e.isBN(t),"num","bignum"),O(t.sign()>0,"invert"),0===t.cmpn(1))throw new RangeError("Not invertible.");var r=this.egcd(t),n=o(r,3),i=n[0];if(0!==n[2].cmpn(1))throw new RangeError("Not invertible.");return i.imod(t)}},{key:"ifermat",value:function(e){return this.fermat(e)._move(this)}},{key:"fermat",value:function(t){var r=w?e.red(t):e.mont(t);return this.toRed(r).redFermat().fromRed()}},{key:"ipowm",value:function(e,t,r){return this.powm(e,t,r)._move(this)}},{key:"powm",value:function(t,r,n){var i=!w&&n?e.mont(r):e.red(r);return this.toRed(i).redPow(t).fromRed()}},{key:"ipowmn",value:function(e,t,r){return this.powmn(e,t,r)._move(this)}},{key:"powmn",value:function(t,r,n){var i=n?e.mont(r):e.red(r);return this.toRed(i).redPown(t).fromRed()}},{key:"isqrtm",value:function(e){return this.sqrtm(e)._move(this)}},{key:"sqrtm",value:function(t){var r;return D(e.isBN(t),"p","bignum"),r=3===t.andln(3)||5===t.andln(7)?e.red(t):e.mont(t),this.toRed(r).redSqrt().fromRed()}},{key:"isqrtpq",value:function(e,t){return this.sqrtpq(e,t)._move(this)}},{key:"sqrtpq",value:function(e,t){var r=this.sqrtm(e),n=this.sqrtm(t),i=e.egcd(t),a=o(i,2),s=a[0],u=a[1],c=n.mul(s).mul(e),f=r.mul(u).mul(t),h=e.mul(t);return c.iadd(f).imod(h)}},{key:"isPrime",value:function(e,t,r){return D(t>>>0===t,"reps","uint32"),!!this.isPrimeMR(e,t+1,!0)&&!!this.isPrimeLucas(r)}},{key:"isPrimeMR",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];D(r>>>0===r,"reps","uint32"),D(r>0,"reps","integer"),D("boolean"===typeof n,"force2","boolean");var i=this;if(i.cmpn(7)<0)return 0===i.cmpn(2)||0===i.cmpn(3)||0===i.cmpn(5);if(i.isEven())return!1;var a=i.subn(1),s=a.subn(2),o=a.zeroBits(),u=a.ushrn(o),c=e.red(i),f=a.toRed(c),h=new e(1).toRed(c);e:for(var l=0;l<r;l++){var p=void 0;l===r-1&&n?p=new e(2):(p=e.random(t,0,s)).iaddn(2);var d=p.toRed(c).redPow(u);if(0!==d.cmp(h)&&0!==d.cmp(f)){for(var v=1;v<o;v++){if(0===(d=d.redSqr()).cmp(f))continue e;if(0===d.cmp(h))return!1}return!1}}return!0}},{key:"isPrimeLucas",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;D(t>>>0===t,"limit","uint32");var r=this;if(r.cmpn(1)<=0)return!1;if(r.isEven())return 0===r.cmpn(2);for(var n=3;;){if(n>1e4)throw new Error("Cannot find (D/n) = -1 for ".concat(r.toString(10),"."));if(0!==t&&n>t)return!1;var i=new e(n*n-4),a=i.jacobi(r);if(-1===a)break;if(0===a)return 0===r.cmpn(n+2);if(40===n&&r.isSquare())return!1;n+=1}var s=r.addn(1),o=s.zeroBits(),u=r.subn(2),c=new e(2),f=new e(n);s.iushrn(o);for(var h=s.bitLength();h>=0;h--)s.utestn(h)?(c=c.mul(f).iadd(r).isubn(n).imod(r),f=f.sqr().iadd(u).imod(r)):(f=f.mul(c).iadd(r).isubn(n).imod(r),c=c.sqr().iadd(u).imod(r));if(0===c.cmpn(2)||0===c.cmp(u)){var l=c.muln(n),p=f.ushln(1);if(l.cmp(p)<0){var d=[p,l];l=d[0],p=d[1]}if(l.isub(p).imod(r).isZero())return!0}for(var v=0;v<o-1;v++){if(c.isZero())return!0;if(0===c.cmpn(2))return!1;c=c.sqr().isubn(2).imod(r)}return!1}},{key:"toTwos",value:function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()}},{key:"fromTwos",value:function(e){return D(e>>>0===e,"width","uint32"),O(e>0,"width"),this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()}},{key:"toRed",value:function(e){if(D(e instanceof B,"ctx","reduction context"),this.red)throw new Error("Already in reduction context.");return e.convertTo(this)}},{key:"fromRed",value:function(){return L(this.red,"fromRed"),this.red.convertFrom(this)}},{key:"forceRed",value:function(e){if(D(e instanceof B,"ctx","reduction context"),this.red){if(!e.m.eq(this.red.m)||e.mont!==this.red.mont)throw new Error("Already in reduction context.")}else O(0===this.negative,"red"),O(this.ucmp(e.m)<0,"red");return this.clone()._forceRed(e)}},{key:"redIAdd",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redIAdd"),this.red.iadd(this,t)}},{key:"redAdd",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redAdd"),this.red.add(this,t)}},{key:"redIAddn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redIAddn"),this.red.iaddn(this,e)}},{key:"redAddn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redAddn"),this.red.addn(this,e)}},{key:"redISub",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redISub"),this.red.isub(this,t)}},{key:"redSub",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redSub"),this.red.sub(this,t)}},{key:"redISubn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redISubn"),this.red.isubn(this,e)}},{key:"redSubn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redSubn"),this.red.subn(this,e)}},{key:"redIMul",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redIMul"),this.red.imul(this,t)}},{key:"redMul",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redMul"),this.red.mul(this,t)}},{key:"redIMuln",value:function(e){return D(z(e),"num","smi"),L(this.red,"redIMuln"),this.red.imuln(this,e)}},{key:"redMuln",value:function(e){return D(z(e),"num","smi"),L(this.red,"redMuln"),this.red.muln(this,e)}},{key:"redIDiv",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redIDiv"),this.red.idiv(this,t)}},{key:"redDiv",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redDiv"),this.red.div(this,t)}},{key:"redIDivn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redIDivn"),this.red.idivn(this,e)}},{key:"redDivn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redDivn"),this.red.divn(this,e)}},{key:"redIPow",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redIPow"),K(!t.red,"redIPow"),this.red.ipow(this,t)}},{key:"redPow",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redPow"),K(!t.red,"redPow"),this.red.pow(this,t)}},{key:"redIPown",value:function(e){return D(z(e),"num","smi"),L(this.red,"redIPown"),this.red.ipown(this,e)}},{key:"redPown",value:function(e){return D(z(e),"num","smi"),L(this.red,"redPown"),this.red.pown(this,e)}},{key:"redISqr",value:function(){return L(this.red,"redISqr"),this.red.isqr(this)}},{key:"redSqr",value:function(){return L(this.red,"redSqr"),this.red.sqr(this)}},{key:"redISqrt",value:function(){return L(this.red,"redISqrt"),this.red.isqrt(this)}},{key:"redSqrt",value:function(){return L(this.red,"redSqrt"),this.red.sqrt(this)}},{key:"redIDivSqrt",value:function(e){return L(this.red,"redIDivSqrt"),this.red.idivsqrt(this,e)}},{key:"redDivSqrt",value:function(e){return L(this.red,"redDivSqrt"),this.red.divsqrt(this,e)}},{key:"redIsSquare",value:function(){return L(this.red,"redIsSquare"),this.red.isSquare(this)}},{key:"redIShl",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redIShl"),K(!t.red,"redIShl"),this.red.ishl(this,t)}},{key:"redShl",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redShl"),K(!t.red,"redShl"),this.red.shl(this,t)}},{key:"redIShln",value:function(e){return D(e>>>0===e,"num","uint32"),L(this.red,"redIShln"),this.red.ishln(this,e)}},{key:"redShln",value:function(e){return D(e>>>0===e,"num","uint32"),L(this.red,"redShln"),this.red.shln(this,e)}},{key:"redINeg",value:function(){return L(this.red,"redINeg"),this.red.ineg(this)}},{key:"redNeg",value:function(){return L(this.red,"redNeg"),this.red.neg(this)}},{key:"redEq",value:function(t){return D(e.isBN(t),"num","bignum"),L(this.red,"redEq"),this.red.eq(this,t)}},{key:"redEqn",value:function(e){return D(z(e),"num","smi"),L(this.red,"redEqn"),this.red.eqn(this,e)}},{key:"redIsHigh",value:function(){return L(this.red,"redIsHigh"),this.red.isHigh(this)}},{key:"redIsLow",value:function(){return L(this.red,"redIsLow"),this.red.isLow(this)}},{key:"redIsOdd",value:function(){return L(this.red,"redIsOdd"),this.red.isOdd(this)}},{key:"redIsEven",value:function(){return L(this.red,"redIsEven"),this.red.isEven(this)}},{key:"redLegendre",value:function(){return L(this.red,"redLegendre"),this.red.legendre(this)}},{key:"redJacobi",value:function(){return L(this.red,"redJacobi"),this.red.jacobi(this)}},{key:"redKronecker",value:function(){return L(this.red,"redKronecker"),this.red.kronecker(this)}},{key:"redIInvert",value:function(){return L(this.red,"redIInvert"),this.red.iinvert(this)}},{key:"redInvert",value:function(){return L(this.red,"redInvert"),this.red.invert(this)}},{key:"redIFermat",value:function(){return L(this.red,"redIFermat"),this.red.ifermat(this)}},{key:"redFermat",value:function(){return L(this.red,"redFermat"),this.red.fermat(this)}},{key:"_move",value:function(e){return e.words=this.words,e.length=this.length,e.negative=this.negative,e.red=this.red,e}},{key:"_alloc",value:function(e){for(;this.words.length<e;)this.words.push(0);return this}},{key:"_expand",value:function(e){for(this._alloc(e);this.length<e;)this.words[this.length++]=0;return this}},{key:"_strip",value:function(){for(;this.length>1&&0===this.words[this.length-1];)this.length-=1;return this._normalize()}},{key:"_normalize",value:function(){return M(this.length>0),1===this.length&&0===this.words[0]&&(this.negative=0),this}},{key:"_check",value:function(){return M(this.length>0),M(this.length<=this.words.length),1===this.length?(0===this.words[0]&&M(0===this.negative),this):(M(0!==this.words[this.length-1]),this)}},{key:"_invertp",value:function(t){if(D(e.isBN(t),"p","bignum"),M(0===this.negative),M(t.sign()>0),this.isZero()||0===t.cmpn(1))throw new RangeError("Not invertible.");for(var r=this.clone(),n=t.clone(),i=new e(1),a=new e(0),s=n.clone();r.cmpn(1)>0&&n.cmpn(1)>0;){for(var o=0,u=1;0===(r.words[0]&u)&&o<26;u<<=1)o+=1;if(o>0)for(r.iushrn(o);o>0;)i.isOdd()&&i.iadd(s),i.iushrn(1),o-=1;for(var c=0,f=1;0===(n.words[0]&f)&&c<26;f<<=1)c+=1;if(c>0)for(n.iushrn(c);c>0;)a.isOdd()&&a.iadd(s),a.iushrn(1),c-=1;r.cmp(n)>=0?(r.isub(n),i.isub(a)):(n.isub(r),a.isub(i))}var h=0===r.cmpn(1)?i:a;return h.ucmp(t)>=0&&(h._isub(h,t),h.ucmp(t)>=0&&h._isub(h,t)),h.isNeg()&&h.iadd(t),h}},{key:"_factor2",value:function(e){if(1&(this.words[0]|e.words[0]))return 0;for(var t=Math.min(this.length,e.length),r=0,n=0;n<t;n++){var i=F(this.words[n]|e.words[n]);if(r+=i,26!==i)break}return r}},{key:"_cloneNormal",value:function(){return this.red?this.fromRed():this.clone()}},{key:"_forceRed",value:function(e){return this.red=e,this}},{key:"clone",value:function(){var t=new e;t.words=new Array(this.length);for(var r=0;r<this.length;r++)t.words[r]=this.words[r];return t.length=this.length,t.negative=this.negative,t.red=this.red,t}},{key:"inject",value:function(t){D(e.isBN(t),"num","bignum"),this._alloc(t.length);for(var r=0;r<t.length;r++)this.words[r]=t.words[r];return this.length=t.length,this.negative=t.negative,this.red=t.red,this}},{key:"set",value:function(e,t){return this.fromNumber(e,t)}},{key:"swap",value:function(t){D(e.isBN(t),"num","bignum");var r=this,n=t,i=[n.words,r.words];r.words=i[0],n.words=i[1];var a=[n.length,r.length];r.length=a[0],n.length=a[1];var s=[n.negative,r.negative];r.negative=s[0],n.negative=s[1];var o=[n.red,r.red];return r.red=o[0],n.red=o[1],r}},{key:"reverse",value:function(){var e=this.negative;return this.fromBuffer(this.toBuffer("be"),"le"),this.negative=e,this}},{key:"byteLength",value:function(){return Math.ceil(this.bitLength()/8)}},{key:"bitLength",value:function(){var e=V(this.words[this.length-1]);return 26*(this.length-1)+e}},{key:"zeroBits",value:function(){if(this.isZero())return 0;if(this.isOdd())return 0;for(var e=0,t=0;t<this.length;t++){var r=F(this.words[t]);if(e+=r,26!==r)break}return e}},{key:"isSafe",value:function(){return this.length<=2||3===this.length&&1===this.words[2]}},{key:"word",value:function(e){return D(e>>>0===e,"pos","uint32"),e>=this.length?0:this.words[e]}},{key:f,value:function(){var e="BN";return this.red&&(e="BN-R"),"<".concat(e,": ").concat(this.toString(10),">")}},{key:"csign",value:function(){return-2*this.negative+1-this.czero()}},{key:"czero",value:function(){var e=this.words[0]-1>>>31;return this.length-2>>>31&e}},{key:"cneg",value:function(){return this.negative}},{key:"cpos",value:function(){return 1^this.negative}},{key:"ceq",value:function(t){D(e.isBN(t),"num","bignum");for(var r=0,n=0;n<t.length;n++)r|=this.words[n%this.length]^t.words[n];return r|=this.length^t.length,(r|=this.negative^t.negative)-1>>>31}},{key:"ceqn",value:function(e){var t=e>>31&1,r=(0|e)*(1|-t)&67108863,n=0;return n|=this.words[0]^r,n|=1^this.length,(n|=this.negative^t)-1>>>31}},{key:"cswap",value:function(t,r){D(e.isBN(t),"num","bignum");var n=this,i=t,a=67108863&-(1&(r>>31|-r>>31));n._alloc(i.words.length),i._alloc(n.words.length);for(var s=0;s<n.words.length;s++){var o=(n.words[s]^i.words[s])&a;n.words[s]^=o,i.words[s]^=o}var u=(n.length^i.length)&a,c=(n.negative^i.negative)&a;return n.length^=u,i.length^=u,n.negative^=c,i.negative^=c,this}},{key:"cinject",value:function(t,r){D(e.isBN(t),"num","bignum");var n=this,i=t,a=1&(r>>31|-r>>31),s=a-1&67108863,o=67108863&~(a-1);n._alloc(i.length);for(var u=0;u<i.length;u++)n.words[u]=n.words[u]&s|i.words[u]&o;return n.length=n.length&s|i.length&o,n.negative=n.negative&s|i.negative&o,this}},{key:"cset",value:function(e,t){var r=1&(t>>31|-t>>31),n=r-1&67108863,i=67108863&~(r-1),a=e>>31&1,s=(0|e)*(1|-a)&67108863;return this.words[0]=this.words[0]&n|s&i,this.length=this.length&n|1&i,this.negative=this.negative&n|a&i,this}},{key:"toNumber",value:function(){var e=this.words[0];if(2===this.length)e+=67108864*this.words[1];else if(3===this.length&&1===this.words[2])e+=4503599627370496+67108864*this.words[1];else if(this.length>2)throw new RangeError("Number can only safely store up to 53 bits.");return 0!==this.negative?-e:e}},{key:"toDouble",value:function(){for(var e=0,t=this.length-1;t>=0;t--)e=67108864*e+this.words[t];return 0!==this.negative?-e:e}},{key:"valueOf",value:function(){return this.toDouble()}},{key:"toBigInt",value:function(){if(!w)throw new Error("BigInt is not supported!");for(var e=BigInt(52),t=BigInt(26),r=this.length-1,n=BigInt(0);r>=1;r-=2){var i=67108864*this.words[r],a=this.words[r-1];n=n<<e|BigInt(i+a)}return r>=0&&(n=n<<t|BigInt(this.words[0])),0!==this.negative?-n:n}},{key:"toBool",value:function(){return!this.isZero()}},{key:"toString",value:function(e,t){if(null==t&&(t=0),0===t&&(t=1),D((e=j(e))>>>0===e,"base","uint32"),D(t>>>0===t,"padding","uint32"),e<2||e>36)throw new RangeError("Base ranges between 2 and 36.");if(this._check(),16===e){for(var r="",n=0,i=0,a=0;a<this.length;a++){var s=this.words[a],o=(16777215&(s<<n|i)).toString(16);r=0!==(i=s>>>24-n&16777215)||a!==this.length-1?h[6-o.length]+o+r:o+r,(n+=2)>=26&&(n-=26,a-=1)}for(0!==i&&(r=i.toString(16)+r);r.length%t!==0;)r="0"+r;return 0!==this.negative&&(r="-"+r),r}var u=l[e-1],c=p[e-1],f=this.clone(),d="";for(f.negative=0;!f.isZero();){var v=f.remrn(c).toString(e);f.iquon(c),d=f.isZero()?v+d:h[u-v.length]+v+d}for(this.isZero()&&(d="0");d.length%t!==0;)d="0"+d;return 0!==this.negative&&(d="-"+d),d}},{key:"toJSON",value:function(){return this.toString(16,2)}},{key:"toArray",value:function(e,t){return this.toArrayLike(Array,e,t)}},{key:"toBuffer",value:function(e,r){return this.toArrayLike(t,e,r)}},{key:"toArrayLike",value:function(e,t,r){null==t&&(t="be"),null==r&&(r=0),D("function"===typeof e,"ArrayType","function"),D("be"===t||"le"===t,"endian","endianness"),D(r>>>0===r,"length","uint32"),this._check();var n=this.byteLength(),i=r||Math.max(1,n);if(n>i)throw new RangeError("Byte array longer than desired length.");var a=function(e,t){return e.allocUnsafeSlow?e.allocUnsafeSlow(t):new e(t)}(e,i);if("be"===t){for(var s=a.length-1,o=0,u=0;u<this.length;u++){var c=(3&u)<<1,f=this.words[u]<<c|o;a[s--]=255&f,s>=0&&(a[s--]=f>>>8&255),s>=0&&(a[s--]=f>>>16&255),6===c?(s>=0&&(a[s--]=f>>>24&255),o=0):o=f>>>24}if(s>=0){for(a[s--]=o;s>=0;)a[s--]=0;o=0}M(0===o)}else{for(var h=0,l=0,p=0;p<this.length;p++){var d=(3&p)<<1,v=this.words[p]<<d|l;a[h++]=255&v,h<a.length&&(a[h++]=v>>>8&255),h<a.length&&(a[h++]=v>>>16&255),6===d?(h<a.length&&(a[h++]=v>>>24&255),l=0):l=v>>>24}if(h<a.length){for(a[h++]=l;h<a.length;)a[h++]=0;l=0}M(0===l)}return a}},{key:"encode",value:function(e,t){return this.toBuffer(e,t)}},{key:"of",value:function(e,t){return this.fromNumber(e,t)}},{key:"fromNumber",value:function(e,t){null==t&&(t="be"),D(q(e),"num","integer"),D("be"===t||"le"===t,"endian","endianness");var r=e<0|0;return r&&(e=-e),e<67108864?(this.words[0]=67108863&e,this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(this.words=[67108863&e,e/67108864&67108863,1],this.length=3),this.negative=r,"le"===t&&this.reverse(),this}},{key:"fromDouble",value:function(e,t){null==t&&(t="be"),D("number"===typeof e,"num","double"),D("be"===t||"le"===t,"endian","endianness"),isFinite(e)||(e=0);var r=e<=-1|0;for(e<0&&(e=-e),e=Math.floor(e),this.words=[];e>0;){var n=e%67108864,i=(e-n)/67108864;this.words.push(n),e=i}return 0===this.words.length&&this.words.push(0),this.length=this.words.length,this.negative=r,"le"===t&&this.reverse(),this}},{key:"fromBigInt",value:function(e,t){if(null==t&&(t="be"),D("bigint"===typeof e,"num","bigint"),D("be"===t||"le"===t,"endian","endianness"),!w)throw new Error("BigInt is not supported!");var r=e<BigInt(0)|0;return this._fromHex(e.toString(16),r),this.negative=r,"le"===t&&this.reverse(),this}},{key:"fromBool",value:function(e){return D("boolean"===typeof e,"value","boolean"),this.words[0]=0|e,this.length=1,this.negative=0,this}},{key:"fromString",value:function(e,t,r){if("le"===t||"be"===t){var n=[r,t];t=n[0],r=n[1]}if(t=j(t),null==r&&(r="be"),D("string"===typeof e,"string","string"),D(t>>>0===t,"base","uint32"),D("be"===r||"le"===r,"endian","endianness"),t<2||t>36)throw new Error("Base ranges between 2 and 36.");var i=0;return(e=e.replace(/\s+/g,"")).length>0&&45===e.charCodeAt(0)&&(i=1),16===t?this._fromHex(e,i):this._fromBase(e,t,i),this.negative=i,this._normalize(),"le"===r&&this.reverse(),this}},{key:"_fromHex",value:function(e,t){this.length=Math.max(2,Math.ceil((e.length-t)/6)),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;for(var n=0,i=e.length-6,a=0;i>=t;i-=6){var s=H(e,i,i+6);this.words[a]|=s<<n&67108863,this.words[a+1]|=s>>>26-n&4194303,(n+=24)>=26&&(n-=26,a+=1)}if(i+6!==t){var o=H(e,t,i+6);this.words[a]|=o<<n&67108863,this.words[a+1]|=o>>>26-n&4194303}return this._strip()}},{key:"_fromBase",value:function(e,t,r){this.words[0]=0,this.length=1,this.negative=0;for(var n=0,i=1;i<=67108863;i*=t)n+=1;n-=1,i=i/t|0;for(var a=e.length-r,s=a%n,o=Math.min(a,a-s)+r,u=r;u<o;u+=n){var c=G(e,u,u+n,t);this.imuln(i),this._iaddn(c)}if(0!==s){var f=Math.pow(t,s),h=G(e,u,e.length,t);this.imuln(f),this._iaddn(h)}return this}},{key:"fromJSON",value:function(t){if(e.isBN(t))return t.red?t.fromRed():t.clone();if(Array.isArray(t)){var r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){D("string"===typeof a.value,"chunk","string")}}catch(o){n=!0,i=o}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}t=t.join("")}return this.fromString(t,16)}},{key:"fromBN",value:function(e){return this.inject(e)}},{key:"fromArray",value:function(e,t){return D(Array.isArray(e),"data","array"),this.fromArrayLike(e,t)}},{key:"fromBuffer",value:function(e,r){return D(t.isBuffer(e),"data","buffer"),this.fromArrayLike(e,r)}},{key:"fromArrayLike",value:function(e,t){if(null==t&&(t="be"),D(e&&e.length>>>0===e.length,"data","array-like"),D("be"===t||"le"===t,"endian","endianness"),0===e.length)return this.words[0]=0,this.length=1,this.negative=0,this;this.length=Math.max(2,Math.ceil(e.length/3)),this.words=new Array(this.length),this.negative=0;for(var r=0;r<this.length;r++)this.words[r]=0;var n=e.length%3,i=0,a=0,s=0;if("be"===t){for(var o=e.length-1;o>=2;o-=3){var u=e[o]|e[o-1]<<8|e[o-2]<<16;this.words[a]|=u<<i&67108863,this.words[a+1]=u>>>26-i&67108863,(i+=24)>=26&&(i-=26,a+=1)}switch(n){case 2:s=e[1]|e[0]<<8;break;case 1:s=e[0]}}else{for(var c=e.length-n,f=0;f<c;f+=3){var h=e[f]|e[f+1]<<8|e[f+2]<<16;this.words[a]|=h<<i&67108863,this.words[a+1]=h>>>26-i&67108863,(i+=24)>=26&&(i-=26,a+=1)}switch(n){case 2:s=e[c]|e[c+1]<<8;break;case 1:s=e[c]}}return n>0&&(this.words[a]|=s<<i&67108863,this.words[a+1]=s>>>26-i&67108863),this._strip()}},{key:"decode",value:function(e,t){return this.fromBuffer(e,t)}},{key:"from",value:function(t,r,n){if(null==t)return this;if("le"===r||"be"===r){var i=[n,r];r=i[0],n=i[1]}if("number"===typeof t)return this.fromNumber(t,n);if("bigint"===typeof t)return this.fromBigInt(t,n);if("string"===typeof t)return this.fromString(t,r,n);if("object"===typeof t){if(e.isBN(t))return this.fromBN(t,n);if(t.length>>>0===t.length)return this.fromArrayLike(t,n)}if("boolean"===typeof t)return this.fromBool(t);throw new TypeError("Non-numeric object passed to BN.")}}],[{key:"min",value:function(){for(var t=null,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,s=n;a<s.length;a++){var o=s[a];D(e.isBN(o),"num","bignum"),(!t||o.cmp(t)<0)&&(t=o)}return t||new e(0)}},{key:"max",value:function(){for(var t=null,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];for(var a=0,s=n;a<s.length;a++){var o=s[a];D(e.isBN(o),"num","bignum"),(!t||o.cmp(t)>0)&&(t=o)}return t||new e(0)}},{key:"cmp",value:function(t,r){return D(e.isBN(t),"a","bignum"),t.cmp(r)}},{key:"ucmp",value:function(t,r){return D(e.isBN(t),"a","bignum"),t.ucmp(r)}},{key:"red",value:function(e){return new B(e)}},{key:"barrett",value:function(e){return new R(e)}},{key:"mont",value:function(e){return new N(e)}},{key:"_prime",value:function(e){if(d[e])return d[e];var t;if("p192"===e)t=new E;else if("p224"===e)t=new _;else if("p521"===e)t=new I;else if("k256"===e)t=new A;else if("p25519"===e)t=new T;else{if("p448"!==e)throw new Error('Unknown prime: "'.concat(e,'".'));t=new C}return d[e]=t,t}},{key:"prime",value:function(t){return e._prime(t).p.clone()}},{key:"pow",value:function(t,r){return 2===t?e.shift(1,r):(new e).fromNumber(t).pown(r)}},{key:"shift",value:function(t,r){return 1===t?new e(0).usetn(r,1):(new e).fromNumber(t).ishln(r)}},{key:"mask",value:function(t){return e.shift(1,t).isubn(1)}},{key:"randomBits",value:function(r,n){if(D(null!=r,"rng","rng"),D(n>>>0===n,"bits","uint32"),"object"===typeof r){D("function"===typeof r.randomBytes,"rng","rng");var i=n+7>>>3,a=8*i,s=r.randomBytes(i);if(D(t.isBuffer(s),"bytes","buffer"),s.length!==i)throw new RangeError("Invalid number of bytes returned from RNG.");var o=e.fromBuffer(s);return a>n&&o.iushrn(a-n),o}D("function"===typeof r,"rng","rng");var u=r(n);if(D(e.isBN(u),"num","bignum"),O(0===u.negative,"RNG"),K(!u.red,"RNG"),u.bitLength()>n)throw new RangeError("Invalid number of bits returned from RNG.");return u}},{key:"random",value:function(t,r,n){if(r=e.cast(r,16),n=e.cast(n,16),r.cmp(n)>0)throw new RangeError("Minimum cannot be greater than maximum.");var i=n.sub(r).iabs(),a=i.bitLength();if(0===a)return r.clone();for(;;){var s=e.randomBits(t,a);if(!(s.cmp(i)>=0))return s.iadd(r),s}}},{key:"of",value:function(t,r){return(new e).of(t,r)}},{key:"fromNumber",value:function(t,r){return(new e).fromNumber(t,r)}},{key:"fromDouble",value:function(t,r){return(new e).fromDouble(t,r)}},{key:"fromBigInt",value:function(t,r){return(new e).fromBigInt(t,r)}},{key:"fromBool",value:function(t){return(new e).fromBool(t)}},{key:"fromString",value:function(t,r,n){return(new e).fromString(t,r,n)}},{key:"fromJSON",value:function(t){return(new e).fromJSON(t)}},{key:"fromBN",value:function(t){return(new e).fromBN(t)}},{key:"fromArray",value:function(t,r){return(new e).fromArray(t,r)}},{key:"fromBuffer",value:function(t,r){return(new e).fromBuffer(t,r)}},{key:"fromArrayLike",value:function(t,r){return(new e).fromArrayLike(t,r)}},{key:"decode",value:function(t,r){return(new e).decode(t,r)}},{key:"from",value:function(t,r,n){return(new e).from(t,r,n)}},{key:"cast",value:function(t,r,n){return e.isBN(t)?t:new e(t,r,n)}},{key:"isBN",value:function(t){return t instanceof e}}]),e}();x.BN=x,x.wordSize=26,x.native=0;var S=function(){function e(t,r){u(this,e),this.name=t,this.p=new x(r,16),this.n=this.p.bitLength(),this.k=x.shift(1,this.n).isub(this.p),this.lo=this.p.clone(),this.one=this.p.clone()}return c(e,[{key:"ireduce",value:function(e){var t=0!==e.negative,r=e.bitLength();for(M(r<=2*this.n),e.negative=0;r>this.n;)this.split(e,this.lo),this.imulK(e),e._iadd(e,this.lo),r=e.bitLength();var n=r<this.n?-1:e.ucmp(this.p);return 0===n?(e.words[0]=0,e.length=1):n>0&&e._isub(e,this.p),t&&!e.isZero()&&e._isub(this.p,e),e}},{key:"split",value:function(e,t){e._split(this.n,t)}},{key:"imulK",value:function(e){return e.imul(this.k)}}]),e}(),E=function(e){function t(){return u(this,t),i(this,a(t).call(this,"p192","ffffffff ffffffff ffffffff fffffffeffffffff ffffffff"))}return s(t,e),c(t,[{key:"imulK",value:function(e){var t=this.one.inject(e);return e.iushln(64)._iadd(e,t)}}]),t}(S),_=function(e){function t(){return u(this,t),i(this,a(t).call(this,"p224","ffffffff ffffffff ffffffff ffffffff00000000 00000000 00000001"))}return s(t,e),c(t,[{key:"imulK",value:function(e){var t=this.one.inject(e);return e.iushln(96)._isub(e,t)}}]),t}(S),I=function(e){function t(){return u(this,t),i(this,a(t).call(this,"p521","000001ff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffffffffffff"))}return s(t,e),c(t,[{key:"imulK",value:function(e){return e}}]),t}(S),A=function(e){function t(){return u(this,t),i(this,a(t).call(this,"k256","ffffffff ffffffff ffffffff ffffffffffffffff ffffffff fffffffe fffffc2f"))}return s(t,e),c(t,[{key:"split",value:function(e,t){var r=Math.min(e.length,9);t._alloc(r+1);for(var n=0;n<r;n++)t.words[n]=e.words[n];if(t.length=r,e.length<=9)return t._strip(),e.words[0]=0,void(e.length=1);var i=e.words[9],a=10;for(t.words[t.length++]=4194303&i,t._strip();a<e.length;a++){var s=0|e.words[a];e.words[a-10]=(4194303&s)<<4|i>>>22,i=s}i>>>=22,e.words[a-10]=i,0===i&&e.length>10?e.length-=10:e.length-=9,e._strip()}},{key:"imulK",value:function(e){e._expand(e.length+2);for(var t=0,r=0;r<e.length;r++){var n=e.words[r];t+=977*n,e.words[r]=67108863&t,t=64*n+Math.floor(t/67108864)}return 0===e.words[e.length-1]&&(e.length-=1,0===e.words[e.length-1]&&(e.length-=1)),e}}]),t}(S),T=function(e){function t(){return u(this,t),i(this,a(t).call(this,"p25519","7fffffff ffffffff ffffffff ffffffffffffffff ffffffff ffffffff ffffffed"))}return s(t,e),c(t,[{key:"imulK",value:function(e){for(var t=0,r=0;r<e.length;r++){var n=19*e.words[r]+t;t=n>>>26,e.words[r]=67108863&n}return 0!==t&&(e._alloc(e.length+1),e.words[e.length++]=t),e}}]),t}(S),C=function(e){function t(){return u(this,t),i(this,a(t).call(this,"p448","ffffffff ffffffff ffffffff ffffffffffffffff ffffffff fffffffe ffffffffffffffff ffffffff ffffffff ffffffffffffffff ffffffff"))}return s(t,e),c(t,[{key:"imulK",value:function(e){var t=this.one.inject(e);return e.iushln(224)._iadd(e,t)}}]),t}(S),B=function(){function e(t){u(this,e);var r=null;"string"===typeof t&&(t=(r=x._prime(t)).p),D(x.isBN(t),"m","bignum"),K(!t.red,"reduction"),O(t.sign()>0,"reduction"),this.m=t,this.prime=r,this.mb=null,this.sm1=null}return c(e,[{key:"_verify1",value:function(e){O(0===e.negative,"red"),L(null!=e.red,"red")}},{key:"_verify2",value:function(e,t){O(0===(e.negative|t.negative),"red"),L(null!=e.red&&e.red===t.red,"red")}},{key:"precompute",value:function(){if(null===this.sm1&&5===this.m.andln(7)){var e=new x(2).toRed(this),t=this.m.subn(1).iushrn(2);this.sm1=this.pow(e,t)}return this}},{key:"convertTo",value:function(e){var t=e.mod(this.m);return t.red=this,t}},{key:"convertFrom",value:function(e){var t=e.clone();return t.red=null,t}},{key:"intTo",value:function(e){return e}},{key:"intFrom",value:function(e){return e}},{key:"imod",value:function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.imod(this.m)._forceRed(this)}},{key:"iadd",value:function(e,t){return this._verify2(e,t),e._iadd(e,t),e.ucmp(this.m)>=0&&e._isub(e,this.m),e}},{key:"add",value:function(e,t){return e.length<t.length?this.iadd(t.clone(),e):this.iadd(e.clone(),t)}},{key:"iaddn",value:function(e,t){return this._verify1(e),t<0?this.isubn(e,-t):(1===this.m.length&&(t%=this.m.words[0]),e._iaddn(t),e.ucmp(this.m)>=0&&e._isub(e,this.m),e)}},{key:"addn",value:function(e,t){return this.iaddn(e.clone(),t)}},{key:"isub",value:function(e,t){this._verify2(e,t);var r=e.ucmp(t);return 0===r?(e.words[0]=0,e.length=1,e):(r<0?(e._isub(t,e),e._isub(this.m,e)):e._isub(e,t),e)}},{key:"sub",value:function(e,t){return this.isub(e.clone(),t)}},{key:"isubn",value:function(e,t){return this._verify1(e),t<0?this.iaddn(e,-t):(1===this.m.length&&(t%=this.m.words[0]),1===e.length&&e.words[0]<t?(e.words[0]=t-e.words[0],e._isub(this.m,e)):e._isubn(t),e)}},{key:"subn",value:function(e,t){return this.isubn(e.clone(),t)}},{key:"imul",value:function(e,t){return this._verify2(e,t),this.imod(e.imul(t))}},{key:"mul",value:function(e,t){return this._verify2(e,t),this.imod(e.mul(t))}},{key:"imuln",value:function(e,t){if(this._verify1(e),e.isZero())return e;if(0===t)return e.words[0]=0,e.length=1,e;var r=t<0;if(r&&(t=-t),1===this.m.length&&(t%=this.m.words[0]),e.imuln(t),t<=16)for(;e.ucmp(this.m)>=0;)e._isub(e,this.m);else this.imod(e);return r&&this.ineg(e),e}},{key:"muln",value:function(e,t){return this.imuln(e.clone(),t)}},{key:"idiv",value:function(e,t){return this.div(e,t)._move(e)}},{key:"div",value:function(e,t){return this.mul(e,this.invert(t))}},{key:"idivn",value:function(e,t){return this.divn(e,t)._move(e)}},{key:"divn",value:function(e,t){return this.div(e,this.convertTo(new x(t)))}},{key:"ipow",value:function(e,t){return this.pow(e,t)._move(e)}},{key:"pow",value:function(e,t){return this._verify1(e),t.isNeg()&&(e=this.invert(e)),1===t.length?this.pown(e,t.words[0]):w&&!this.prime?this.powInt(e,t):this.powNum(e,t)}},{key:"powNum",value:function(e,t){var r=new Array(8);r[0]=this.sqrn(e,3),r[1]=this.mul(r[0],e);for(var n=2;n<8;n++)r[n]=this.mul(r[n-1],e);for(var i=t.bitLength(),a=new x(1).toRed(this);i>=4;){var s=i-4,o=t.bits(s,4);o<8?(a=this.sqr(a),i-=1):(a=this.sqrn(a,4),a=this.mul(a,r[-9&o]),i=s)}if(i>0)for(var u=t.bits(0,i);i--;)a=this.sqr(a),u>>i&1&&(a=this.mul(a,e));return a}},{key:"powInt",value:function(e,t){null===this.mb&&(this.mb=this.m.toBigInt());var r=function(e,t,r){var n=new Array(8);n[0]=Y(e,3,r),n[1]=n[0]*e;for(var i=2;i<8;i++)n[i]=n[i-1]*e%r;var a=t.bitLength(),s=BigInt(1);for(;a>=4;){var o=a-4,u=t.bits(o,4);u<8?(s=s*s%r,a-=1):(s=(s=Y(s,4,r))*n[-9&u]%r,a=o)}if(a>0)for(var c=t.bits(0,a);a--;)s=s*s%r,c>>a&1&&(s=s*e%r);return s}(this.intFrom(e.toBigInt()),t,this.mb),n=this.intTo(r);return x.fromBigInt(n)._forceRed(this)}},{key:"sqrn",value:function(e,t){for(var r=0;r<t;r++)e=this.sqr(e);return e}},{key:"ipown",value:function(e,t){return this.pown(e,t)._move(e)}},{key:"pown",value:function(e,t){if(this._verify1(e),t<0&&(e=this.invert(e),t=-t),0===t)return new x(1).toRed(this);if(1===t)return e.clone();for(var r=e,n=V(t)-2;n>=0;n--)r=this.sqr(r),t>>n&1&&(r=this.mul(r,e));return r}},{key:"isqr",value:function(e){return this.imul(e,e)}},{key:"sqr",value:function(e){return this.mul(e,e)}},{key:"isqrt",value:function(e){return this.sqrt(e)._move(e)}},{key:"sqrt",value:function(e){return this._verify1(e),3===this.m.andln(3)?this.sqrt3mod4(e):5===this.m.andln(7)?null!=this.sm1?this.sqrt5mod8sm1(e):this.sqrt5mod8(e):this.sqrt0(e)}},{key:"sqrt3mod4",value:function(e){var t=this.m.addn(1).iushrn(2),r=this.pow(e,t);if(!this.sqr(r).eq(e))throw new Error("X is not a square mod P.");return r}},{key:"sqrt5mod8",value:function(e){var t=new x(1).toRed(this),r=this.m.ushrn(3),n=this.add(e,e),i=this.pow(n,r),a=this.mul(n,this.sqr(i)),s=this.mul(this.mul(i,e),this.isub(a,t));if(!this.sqr(s).eq(e))throw new Error("X is not a square mod P.");return s}},{key:"sqrt5mod8sm1",value:function(e){var t=this.m.addn(3).iushrn(3),r=this.pow(e,t);if(this.sqr(r).eq(e))return r;var n=this.mul(r,this.sm1);if(this.sqr(n).eq(e))return n;throw new Error("X is not a square mod P.")}},{key:"sqrt0",value:function(e){if(0===this.m.cmpn(1)||!this.m.isOdd())throw new Error("Invalid prime.");switch(this.jacobi(e)){case-1:throw new Error("X is not a square mod P.");case 0:return new x(0)._forceRed(this)}var t=new x(1).toRed(this),r=this.m.subn(1),n=r.zeroBits();r.iushrn(n);for(var i=new x(2).toRed(this);-1!==this.jacobi(i);)this.iadd(i,t);for(var a=this.pow(e,r),s=this.pow(i,r),o=this.pow(e,r.iaddn(1).iushrn(1)),u=n;;){for(var c=a,f=0;0!==c.cmp(t)&&f<u;)c=this.sqr(c),f+=1;if(0===f)break;M(f<u),c=this.sqrn(s,u-f-1),s=this.sqr(c),o=this.mul(o,c),a=this.mul(a,s),u=f}return o}},{key:"idivsqrt",value:function(e,t){return this.divsqrt(e,t)._move(e)}},{key:"divsqrt",value:function(e,t){if(this._verify2(e,t),t.isZero())throw new RangeError("Not invertible.");return 3===this.m.andln(3)?this.divsqrt3mod4(e,t):null!=this.sm1&&5===this.m.andln(7)?this.divsqrt5mod8(e,t):this.sqrt(this.div(e,t))}},{key:"divsqrt3mod4",value:function(e,t){var r=this.m.subn(3).iushrn(2),n=this.sqr(e),i=this.mul(n,e),a=this.mul(i,n),s=this.mul(this.sqr(t),t),o=this.pow(this.mul(a,s),r),u=this.mul(this.mul(i,t),o);if(0===this.mul(t,this.sqr(u)).cmp(e))return u;throw new Error("X is not a square mod P.")}},{key:"divsqrt5mod8",value:function(e,t){var r=this.m.subn(5).iushrn(3),n=this.mul(this.sqr(t),t),i=this.mul(this.sqr(n),t),a=this.pow(this.mul(e,i),r),s=this.mul(this.mul(e,n),a),o=this.mul(t,this.sqr(s));if(0===o.cmp(e))return s;if(0===this.ineg(o).cmp(e))return this.mul(s,this.sm1);throw new Error("X is not a square mod P.")}},{key:"isSquare",value:function(e){var t;return t=this.prime||this.coprime?this.legendre(e):this.m.isOdd()?this.jacobi(e):this.kronecker(e),Boolean(~t>>>31)}},{key:"ishl",value:function(e,t){return this._verify1(e),this.imod(e.iushl(t))}},{key:"shl",value:function(e,t){return this.ishl(e.clone(),t)}},{key:"ishln",value:function(e,t){if(this._verify1(e),e.iushln(t),t<=4)for(;e.ucmp(this.m)>=0;)e._isub(e,this.m);else this.imod(e);return e}},{key:"shln",value:function(e,t){return this.ishln(e.clone(),t)}},{key:"ineg",value:function(e){return this._verify1(e),e.isZero()||e._isub(this.m,e),e}},{key:"neg",value:function(e){return this.ineg(e.clone())}},{key:"eq",value:function(e,t){return this._verify2(e,t),0===e.ucmp(t)}},{key:"eqn",value:function(e,t){if(this._verify1(e),1===this.m.length)return(t%=this.m.words[0])<0&&(t+=this.m.words[0]),0===e.ucmpn(t);if(t<0){this.m._isubn(-t);var r=e.ucmp(this.m);return this.m._iaddn(-t),0===r}return 0===e.ucmpn(t)}},{key:"isHigh",value:function(e){return!this.isLow(e)}},{key:"isLow",value:function(e){return this._verify1(e),e.ucmp(this.m.ushrn(1))<=0}},{key:"isOdd",value:function(e){return this._verify1(e),e.isOdd()}},{key:"isEven",value:function(e){return this._verify1(e),e.isEven()}},{key:"legendre",value:function(e){if(this._verify1(e),this.m.isEven())throw new Error("legendre: `num` must be odd.");var t=this.m.subn(1).iushrn(1),r=this.pow(e,t),n=new x(1).toRed(this),i=r.czero(),a=r.ceq(n),s=r.ceq(this.ineg(n));if(0===(i|a|s))throw new Error("Invalid prime.");return M(i+a+s===1),a-s}},{key:"jacobi",value:function(e){return this._verify1(e),e.jacobi(this.m)}},{key:"kronecker",value:function(e){return this._verify1(e),e.kronecker(this.m)}},{key:"iinvert",value:function(e){return this.invert(e)._move(e)}},{key:"invert",value:function(e){return this._verify1(e),this.prime?this.imod(e._invertp(this.m)):e.invert(this.m)._forceRed(this)}},{key:"ifermat",value:function(e){return this.fermat(e)._move(e)}},{key:"fermat",value:function(e){if(this._verify1(e),e.isZero()||0===this.m.cmpn(1))throw new RangeError("Not invertible.");return this.pow(e,this.m.subn(2))}},{key:f,value:function(){return this.prime?"<Red: ".concat(this.prime.name,">"):"<Red: ".concat(this.m.toString(10),">")}},{key:"mont",get:function(){return!1}},{key:"coprime",get:function(){return!1}}]),e}(),R=function(e){function t(e){var r;return u(this,t),(r=i(this,a(t).call(this,e))).prime=null,r.n=r.m.bitLength(),r.n%26!==0&&(r.n+=26-r.n%26),r.k=2*r.n,r.w=r.k/26,r.b=x.shift(1,r.k).div(r.m),r}return s(t,e),c(t,[{key:"convertTo",value:function(e){return e.length>this.w?n(a(t.prototype),"convertTo",this).call(this,e):this.imod(e.clone())}},{key:"_shift",value:function(e){for(var t=0,r=this.w;r<e.length;)e.words[t++]=e.words[r++];0===t&&(e.words[t++]=0),e.length=t}},{key:"imod",value:function(e){var t=e.negative;M(e.length<=this.w),e.negative=0;var r=e.mul(this.b);return this._shift(r),e._isub(e,r.mul(this.m)),e.ucmp(this.m)>=0&&e._isub(e,this.m),t&&!e.isZero()&&e._isub(this.m,e),e.red=this,e}}]),t}(B),N=function(e){function t(e){var r;return u(this,t),(r=i(this,a(t).call(this,e))).prime=null,r.n=r.m.bitLength(),r.n%26!==0&&(r.n+=26-r.n%26),r.r=x.shift(1,r.n),r.r2=x.shift(1,2*r.n).imod(r.m),r.ri=r.r._invertp(r.m).imod(r.m),r.mi=r.r.mul(r.ri).isubn(1).div(r.m),r.rib=null,r}return s(t,e),c(t,[{key:"convertTo",value:function(e){return this.imod(e.ushln(this.n))}},{key:"convertFrom",value:function(e){var t=this.imod(e.mul(this.ri));return t.red=null,t}},{key:"intTo",value:function(e){return(e<<BigInt(this.n))%this.mb}},{key:"intFrom",value:function(e){return null===this.rib&&(this.rib=this.ri.toBigInt()),e*this.rib%this.mb}},{key:"iaddn",value:function(e,t){return this.iadd(e,this.convertTo(new x(t)))}},{key:"isubn",value:function(e,t){return this.isub(e,this.convertTo(new x(t)))}},{key:"imul",value:function(e,t){return this.mul(e,t)._move(e)}},{key:"mul",value:function(e,t){if(this._verify2(e,t),e.isZero()||t.isZero())return new x(0)._forceRed(this);var r=e.mul(t),n=r.umaskn(this.n).mul(this.mi).iumaskn(this.n),i=r.iadd(n.mul(this.m)).iushrn(this.n);return i.ucmp(this.m)>=0&&i._isub(i,this.m),i._forceRed(this)}},{key:"imuln",value:function(e,t){if(this._verify1(e),e.isZero())return e;if(0===t)return e.words[0]=0,e.length=1,e;var r=t<0;r&&(t=-t),1===this.m.length&&(t%=this.m.words[0]);var n=V(t);if(n>5)this.imul(e,this.convertTo(new x(t)));else if(0===(t&t-1))for(var i=0;i<n-1;i++)this.iadd(e,e);else for(var a=e.clone(),s=n-2;s>=0;s--)this.iadd(e,e),t>>s&1&&this.iadd(e,a);return r&&this.ineg(e),e}},{key:"eqn",value:function(e,t){return this._verify1(e),0===t?e.isZero():0===e.ucmp(this.convertTo(new x(t)))}},{key:"isLow",value:function(e){return this._verify1(e),this.convertFrom(e).ucmp(this.m.ushrn(1))<=0}},{key:"isOdd",value:function(e){return this._verify1(e),this.convertFrom(e).isOdd()}},{key:"isEven",value:function(e){return this._verify1(e),this.convertFrom(e).isEven()}},{key:"invert",value:function(e){return this._verify1(e),this.imod(e._invertp(this.m).mul(this.r2))}},{key:"mont",get:function(){return!0}},{key:"coprime",get:function(){return!0}}]),t}(B);function P(e,t,r){var n=new e(t);return e.captureStackTrace&&e.captureStackTrace(n,r),n}function M(e,t){if(!e)throw P(Error,t||"Assertion failed.",M)}function D(e,t,r){if(!e){var n='"'.concat(t,'" must be a(n) ').concat(r,".");throw P(TypeError,n,D)}}function O(e,t){if(!e){var r='"'.concat(t,'" only works with positive numbers.');throw P(RangeError,r,O)}}function L(e,t){if(!e){var r='"'.concat(t,'" only works with red numbers.');throw P(TypeError,r,L)}}function K(e,t){if(!e){var r='"'.concat(t,'" only works with normal numbers.');throw P(TypeError,r,K)}}function U(e){if(!e){throw P(RangeError,"Cannot divide by zero.",U)}}function q(e){return Number.isSafeInteger(e)}function z(e){return q(e)&&e>=-67108863&&e<=67108863}function j(e){if(null==e)return 10;if("number"===typeof e)return e;switch(e){case"bin":return 2;case"oct":return 8;case"dec":return 10;case"hex":return 16}return 0}function V(e){if(Math.clz32)return 32-Math.clz32(e);var t=e,r=0;return t>=4096&&(r+=13,t>>>=13),t>=64&&(r+=7,t>>>=7),t>=8&&(r+=4,t>>>=4),t>=2&&(r+=2,t>>>=2),r+t}function F(e){if(0===e)return 26;var t=e,r=0;return 0===(8191&t)&&(r+=13,t>>>=13),0===(127&t)&&(r+=7,t>>>=7),0===(15&t)&&(r+=4,t>>>=4),0===(3&t)&&(r+=2,t>>>=2),0===(1&t)&&(r+=1),r}function H(e,t,r){for(var n=Math.min(e.length,r),i=0,a=0,s=t;s<n;s++){var o=e.charCodeAt(s)-48;i<<=4;var u=void 0;i|=u=o>=49&&o<=54?o-49+10:o>=17&&o<=22?o-17+10:o,a|=u}if(-16&a)throw new Error("Invalid string.");return i}function G(e,t,r,n){for(var i=Math.min(e.length,r),a=0,s=t;s<i;s++){var o=e.charCodeAt(s)-48;a*=n;var u=void 0;if(u=o>=49?o-49+10:o>=17?o-17+10:o,o<0||o>207||u>=n)throw new Error("Invalid string.");a+=u}return a}function Y(e,t,r){for(var n=0;n<t;n++)e=e*e%r;return e}function W(e,t,r){var n=e.length+t.length;r.negative=e.negative^t.negative,r._alloc(n),r.length=n;var i=e.words[0]*t.words[0],a=67108863&i,s=i/67108864|0,o=1;for(r.words[0]=a;o<r.length-1;o++){for(var u=s>>>26,c=67108863&s,f=Math.max(0,o-e.length+1),h=Math.min(o,t.length-1),l=f;l<=h;l++){var p=o-l,d=e.words[p]*t.words[l]+c;u+=d/67108864|0,c=67108863&d}r.words[o]=0|c,s=0|u}return 0!==s?r.words[o]=0|s:r.length-=1,r._strip()}function J(e,t,r){var n=e.length+t.length;r.negative=e.negative^t.negative,r._alloc(n),r.length=n;for(var i=0,a=0,s=0;s<r.length-1;s++){var o=a;a=0;for(var u=67108863&i,c=Math.max(0,s-e.length+1),f=Math.min(s,t.length-1),h=c;h<=f;h++){var l=s-h,p=e.words[l]*t.words[h],d=67108863&p;u=67108863&(d=d+u|0),a+=(o=(o=o+(p/67108864|0)|0)+(d>>>26)|0)>>>26,o&=67108863}r.words[s]=u,i=o,o=a}return 0!==i?r.words[s]=i:r.length-=1,r._strip()}function Q(e,t,r){var n,i,a,s=e.words,o=t.words,u=r.words,c=0|s[0],f=8191&c,h=c>>>13,l=0|s[1],p=8191&l,d=l>>>13,v=0|s[2],y=8191&v,b=v>>>13,m=0|s[3],g=8191&m,k=m>>>13,w=0|s[4],x=8191&w,S=w>>>13,E=0|s[5],_=8191&E,I=E>>>13,A=0|s[6],T=8191&A,C=A>>>13,B=0|s[7],R=8191&B,N=B>>>13,P=0|s[8],M=8191&P,D=P>>>13,O=0|s[9],L=8191&O,K=O>>>13,U=0|o[0],q=8191&U,z=U>>>13,j=0|o[1],V=8191&j,F=j>>>13,H=0|o[2],G=8191&H,Y=H>>>13,W=0|o[3],J=8191&W,Q=W>>>13,X=0|o[4],Z=8191&X,$=X>>>13,ee=0|o[5],te=8191&ee,re=ee>>>13,ne=0|o[6],ie=8191&ne,ae=ne>>>13,se=0|o[7],oe=8191&se,ue=se>>>13,ce=0|o[8],fe=8191&ce,he=ce>>>13,le=0|o[9],pe=8191&le,de=le>>>13,ve=0;r.negative=e.negative^t.negative,r._alloc(20),r.length=19;var ye=(ve+(n=Math.imul(f,q))|0)+((8191&(i=(i=Math.imul(f,z))+Math.imul(h,q)|0))<<13)|0;ve=((a=Math.imul(h,z))+(i>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(p,q),i=(i=Math.imul(p,z))+Math.imul(d,q)|0,a=Math.imul(d,z);var be=(ve+(n=n+Math.imul(f,V)|0)|0)+((8191&(i=(i=i+Math.imul(f,F)|0)+Math.imul(h,V)|0))<<13)|0;ve=((a=a+Math.imul(h,F)|0)+(i>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(y,q),i=(i=Math.imul(y,z))+Math.imul(b,q)|0,a=Math.imul(b,z),n=n+Math.imul(p,V)|0,i=(i=i+Math.imul(p,F)|0)+Math.imul(d,V)|0,a=a+Math.imul(d,F)|0;var me=(ve+(n=n+Math.imul(f,G)|0)|0)+((8191&(i=(i=i+Math.imul(f,Y)|0)+Math.imul(h,G)|0))<<13)|0;ve=((a=a+Math.imul(h,Y)|0)+(i>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(g,q),i=(i=Math.imul(g,z))+Math.imul(k,q)|0,a=Math.imul(k,z),n=n+Math.imul(y,V)|0,i=(i=i+Math.imul(y,F)|0)+Math.imul(b,V)|0,a=a+Math.imul(b,F)|0,n=n+Math.imul(p,G)|0,i=(i=i+Math.imul(p,Y)|0)+Math.imul(d,G)|0,a=a+Math.imul(d,Y)|0;var ge=(ve+(n=n+Math.imul(f,J)|0)|0)+((8191&(i=(i=i+Math.imul(f,Q)|0)+Math.imul(h,J)|0))<<13)|0;ve=((a=a+Math.imul(h,Q)|0)+(i>>>13)|0)+(ge>>>26)|0,ge&=67108863,n=Math.imul(x,q),i=(i=Math.imul(x,z))+Math.imul(S,q)|0,a=Math.imul(S,z),n=n+Math.imul(g,V)|0,i=(i=i+Math.imul(g,F)|0)+Math.imul(k,V)|0,a=a+Math.imul(k,F)|0,n=n+Math.imul(y,G)|0,i=(i=i+Math.imul(y,Y)|0)+Math.imul(b,G)|0,a=a+Math.imul(b,Y)|0,n=n+Math.imul(p,J)|0,i=(i=i+Math.imul(p,Q)|0)+Math.imul(d,J)|0,a=a+Math.imul(d,Q)|0;var ke=(ve+(n=n+Math.imul(f,Z)|0)|0)+((8191&(i=(i=i+Math.imul(f,$)|0)+Math.imul(h,Z)|0))<<13)|0;ve=((a=a+Math.imul(h,$)|0)+(i>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(_,q),i=(i=Math.imul(_,z))+Math.imul(I,q)|0,a=Math.imul(I,z),n=n+Math.imul(x,V)|0,i=(i=i+Math.imul(x,F)|0)+Math.imul(S,V)|0,a=a+Math.imul(S,F)|0,n=n+Math.imul(g,G)|0,i=(i=i+Math.imul(g,Y)|0)+Math.imul(k,G)|0,a=a+Math.imul(k,Y)|0,n=n+Math.imul(y,J)|0,i=(i=i+Math.imul(y,Q)|0)+Math.imul(b,J)|0,a=a+Math.imul(b,Q)|0,n=n+Math.imul(p,Z)|0,i=(i=i+Math.imul(p,$)|0)+Math.imul(d,Z)|0,a=a+Math.imul(d,$)|0;var we=(ve+(n=n+Math.imul(f,te)|0)|0)+((8191&(i=(i=i+Math.imul(f,re)|0)+Math.imul(h,te)|0))<<13)|0;ve=((a=a+Math.imul(h,re)|0)+(i>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(T,q),i=(i=Math.imul(T,z))+Math.imul(C,q)|0,a=Math.imul(C,z),n=n+Math.imul(_,V)|0,i=(i=i+Math.imul(_,F)|0)+Math.imul(I,V)|0,a=a+Math.imul(I,F)|0,n=n+Math.imul(x,G)|0,i=(i=i+Math.imul(x,Y)|0)+Math.imul(S,G)|0,a=a+Math.imul(S,Y)|0,n=n+Math.imul(g,J)|0,i=(i=i+Math.imul(g,Q)|0)+Math.imul(k,J)|0,a=a+Math.imul(k,Q)|0,n=n+Math.imul(y,Z)|0,i=(i=i+Math.imul(y,$)|0)+Math.imul(b,Z)|0,a=a+Math.imul(b,$)|0,n=n+Math.imul(p,te)|0,i=(i=i+Math.imul(p,re)|0)+Math.imul(d,te)|0,a=a+Math.imul(d,re)|0;var xe=(ve+(n=n+Math.imul(f,ie)|0)|0)+((8191&(i=(i=i+Math.imul(f,ae)|0)+Math.imul(h,ie)|0))<<13)|0;ve=((a=a+Math.imul(h,ae)|0)+(i>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(R,q),i=(i=Math.imul(R,z))+Math.imul(N,q)|0,a=Math.imul(N,z),n=n+Math.imul(T,V)|0,i=(i=i+Math.imul(T,F)|0)+Math.imul(C,V)|0,a=a+Math.imul(C,F)|0,n=n+Math.imul(_,G)|0,i=(i=i+Math.imul(_,Y)|0)+Math.imul(I,G)|0,a=a+Math.imul(I,Y)|0,n=n+Math.imul(x,J)|0,i=(i=i+Math.imul(x,Q)|0)+Math.imul(S,J)|0,a=a+Math.imul(S,Q)|0,n=n+Math.imul(g,Z)|0,i=(i=i+Math.imul(g,$)|0)+Math.imul(k,Z)|0,a=a+Math.imul(k,$)|0,n=n+Math.imul(y,te)|0,i=(i=i+Math.imul(y,re)|0)+Math.imul(b,te)|0,a=a+Math.imul(b,re)|0,n=n+Math.imul(p,ie)|0,i=(i=i+Math.imul(p,ae)|0)+Math.imul(d,ie)|0,a=a+Math.imul(d,ae)|0;var Se=(ve+(n=n+Math.imul(f,oe)|0)|0)+((8191&(i=(i=i+Math.imul(f,ue)|0)+Math.imul(h,oe)|0))<<13)|0;ve=((a=a+Math.imul(h,ue)|0)+(i>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(M,q),i=(i=Math.imul(M,z))+Math.imul(D,q)|0,a=Math.imul(D,z),n=n+Math.imul(R,V)|0,i=(i=i+Math.imul(R,F)|0)+Math.imul(N,V)|0,a=a+Math.imul(N,F)|0,n=n+Math.imul(T,G)|0,i=(i=i+Math.imul(T,Y)|0)+Math.imul(C,G)|0,a=a+Math.imul(C,Y)|0,n=n+Math.imul(_,J)|0,i=(i=i+Math.imul(_,Q)|0)+Math.imul(I,J)|0,a=a+Math.imul(I,Q)|0,n=n+Math.imul(x,Z)|0,i=(i=i+Math.imul(x,$)|0)+Math.imul(S,Z)|0,a=a+Math.imul(S,$)|0,n=n+Math.imul(g,te)|0,i=(i=i+Math.imul(g,re)|0)+Math.imul(k,te)|0,a=a+Math.imul(k,re)|0,n=n+Math.imul(y,ie)|0,i=(i=i+Math.imul(y,ae)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,ae)|0,n=n+Math.imul(p,oe)|0,i=(i=i+Math.imul(p,ue)|0)+Math.imul(d,oe)|0,a=a+Math.imul(d,ue)|0;var Ee=(ve+(n=n+Math.imul(f,fe)|0)|0)+((8191&(i=(i=i+Math.imul(f,he)|0)+Math.imul(h,fe)|0))<<13)|0;ve=((a=a+Math.imul(h,he)|0)+(i>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(L,q),i=(i=Math.imul(L,z))+Math.imul(K,q)|0,a=Math.imul(K,z),n=n+Math.imul(M,V)|0,i=(i=i+Math.imul(M,F)|0)+Math.imul(D,V)|0,a=a+Math.imul(D,F)|0,n=n+Math.imul(R,G)|0,i=(i=i+Math.imul(R,Y)|0)+Math.imul(N,G)|0,a=a+Math.imul(N,Y)|0,n=n+Math.imul(T,J)|0,i=(i=i+Math.imul(T,Q)|0)+Math.imul(C,J)|0,a=a+Math.imul(C,Q)|0,n=n+Math.imul(_,Z)|0,i=(i=i+Math.imul(_,$)|0)+Math.imul(I,Z)|0,a=a+Math.imul(I,$)|0,n=n+Math.imul(x,te)|0,i=(i=i+Math.imul(x,re)|0)+Math.imul(S,te)|0,a=a+Math.imul(S,re)|0,n=n+Math.imul(g,ie)|0,i=(i=i+Math.imul(g,ae)|0)+Math.imul(k,ie)|0,a=a+Math.imul(k,ae)|0,n=n+Math.imul(y,oe)|0,i=(i=i+Math.imul(y,ue)|0)+Math.imul(b,oe)|0,a=a+Math.imul(b,ue)|0,n=n+Math.imul(p,fe)|0,i=(i=i+Math.imul(p,he)|0)+Math.imul(d,fe)|0,a=a+Math.imul(d,he)|0;var _e=(ve+(n=n+Math.imul(f,pe)|0)|0)+((8191&(i=(i=i+Math.imul(f,de)|0)+Math.imul(h,pe)|0))<<13)|0;ve=((a=a+Math.imul(h,de)|0)+(i>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(L,V),i=(i=Math.imul(L,F))+Math.imul(K,V)|0,a=Math.imul(K,F),n=n+Math.imul(M,G)|0,i=(i=i+Math.imul(M,Y)|0)+Math.imul(D,G)|0,a=a+Math.imul(D,Y)|0,n=n+Math.imul(R,J)|0,i=(i=i+Math.imul(R,Q)|0)+Math.imul(N,J)|0,a=a+Math.imul(N,Q)|0,n=n+Math.imul(T,Z)|0,i=(i=i+Math.imul(T,$)|0)+Math.imul(C,Z)|0,a=a+Math.imul(C,$)|0,n=n+Math.imul(_,te)|0,i=(i=i+Math.imul(_,re)|0)+Math.imul(I,te)|0,a=a+Math.imul(I,re)|0,n=n+Math.imul(x,ie)|0,i=(i=i+Math.imul(x,ae)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,ae)|0,n=n+Math.imul(g,oe)|0,i=(i=i+Math.imul(g,ue)|0)+Math.imul(k,oe)|0,a=a+Math.imul(k,ue)|0,n=n+Math.imul(y,fe)|0,i=(i=i+Math.imul(y,he)|0)+Math.imul(b,fe)|0,a=a+Math.imul(b,he)|0;var Ie=(ve+(n=n+Math.imul(p,pe)|0)|0)+((8191&(i=(i=i+Math.imul(p,de)|0)+Math.imul(d,pe)|0))<<13)|0;ve=((a=a+Math.imul(d,de)|0)+(i>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(L,G),i=(i=Math.imul(L,Y))+Math.imul(K,G)|0,a=Math.imul(K,Y),n=n+Math.imul(M,J)|0,i=(i=i+Math.imul(M,Q)|0)+Math.imul(D,J)|0,a=a+Math.imul(D,Q)|0,n=n+Math.imul(R,Z)|0,i=(i=i+Math.imul(R,$)|0)+Math.imul(N,Z)|0,a=a+Math.imul(N,$)|0,n=n+Math.imul(T,te)|0,i=(i=i+Math.imul(T,re)|0)+Math.imul(C,te)|0,a=a+Math.imul(C,re)|0,n=n+Math.imul(_,ie)|0,i=(i=i+Math.imul(_,ae)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,ae)|0,n=n+Math.imul(x,oe)|0,i=(i=i+Math.imul(x,ue)|0)+Math.imul(S,oe)|0,a=a+Math.imul(S,ue)|0,n=n+Math.imul(g,fe)|0,i=(i=i+Math.imul(g,he)|0)+Math.imul(k,fe)|0,a=a+Math.imul(k,he)|0;var Ae=(ve+(n=n+Math.imul(y,pe)|0)|0)+((8191&(i=(i=i+Math.imul(y,de)|0)+Math.imul(b,pe)|0))<<13)|0;ve=((a=a+Math.imul(b,de)|0)+(i>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(L,J),i=(i=Math.imul(L,Q))+Math.imul(K,J)|0,a=Math.imul(K,Q),n=n+Math.imul(M,Z)|0,i=(i=i+Math.imul(M,$)|0)+Math.imul(D,Z)|0,a=a+Math.imul(D,$)|0,n=n+Math.imul(R,te)|0,i=(i=i+Math.imul(R,re)|0)+Math.imul(N,te)|0,a=a+Math.imul(N,re)|0,n=n+Math.imul(T,ie)|0,i=(i=i+Math.imul(T,ae)|0)+Math.imul(C,ie)|0,a=a+Math.imul(C,ae)|0,n=n+Math.imul(_,oe)|0,i=(i=i+Math.imul(_,ue)|0)+Math.imul(I,oe)|0,a=a+Math.imul(I,ue)|0,n=n+Math.imul(x,fe)|0,i=(i=i+Math.imul(x,he)|0)+Math.imul(S,fe)|0,a=a+Math.imul(S,he)|0;var Te=(ve+(n=n+Math.imul(g,pe)|0)|0)+((8191&(i=(i=i+Math.imul(g,de)|0)+Math.imul(k,pe)|0))<<13)|0;ve=((a=a+Math.imul(k,de)|0)+(i>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(L,Z),i=(i=Math.imul(L,$))+Math.imul(K,Z)|0,a=Math.imul(K,$),n=n+Math.imul(M,te)|0,i=(i=i+Math.imul(M,re)|0)+Math.imul(D,te)|0,a=a+Math.imul(D,re)|0,n=n+Math.imul(R,ie)|0,i=(i=i+Math.imul(R,ae)|0)+Math.imul(N,ie)|0,a=a+Math.imul(N,ae)|0,n=n+Math.imul(T,oe)|0,i=(i=i+Math.imul(T,ue)|0)+Math.imul(C,oe)|0,a=a+Math.imul(C,ue)|0,n=n+Math.imul(_,fe)|0,i=(i=i+Math.imul(_,he)|0)+Math.imul(I,fe)|0,a=a+Math.imul(I,he)|0;var Ce=(ve+(n=n+Math.imul(x,pe)|0)|0)+((8191&(i=(i=i+Math.imul(x,de)|0)+Math.imul(S,pe)|0))<<13)|0;ve=((a=a+Math.imul(S,de)|0)+(i>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(L,te),i=(i=Math.imul(L,re))+Math.imul(K,te)|0,a=Math.imul(K,re),n=n+Math.imul(M,ie)|0,i=(i=i+Math.imul(M,ae)|0)+Math.imul(D,ie)|0,a=a+Math.imul(D,ae)|0,n=n+Math.imul(R,oe)|0,i=(i=i+Math.imul(R,ue)|0)+Math.imul(N,oe)|0,a=a+Math.imul(N,ue)|0,n=n+Math.imul(T,fe)|0,i=(i=i+Math.imul(T,he)|0)+Math.imul(C,fe)|0,a=a+Math.imul(C,he)|0;var Be=(ve+(n=n+Math.imul(_,pe)|0)|0)+((8191&(i=(i=i+Math.imul(_,de)|0)+Math.imul(I,pe)|0))<<13)|0;ve=((a=a+Math.imul(I,de)|0)+(i>>>13)|0)+(Be>>>26)|0,Be&=67108863,n=Math.imul(L,ie),i=(i=Math.imul(L,ae))+Math.imul(K,ie)|0,a=Math.imul(K,ae),n=n+Math.imul(M,oe)|0,i=(i=i+Math.imul(M,ue)|0)+Math.imul(D,oe)|0,a=a+Math.imul(D,ue)|0,n=n+Math.imul(R,fe)|0,i=(i=i+Math.imul(R,he)|0)+Math.imul(N,fe)|0,a=a+Math.imul(N,he)|0;var Re=(ve+(n=n+Math.imul(T,pe)|0)|0)+((8191&(i=(i=i+Math.imul(T,de)|0)+Math.imul(C,pe)|0))<<13)|0;ve=((a=a+Math.imul(C,de)|0)+(i>>>13)|0)+(Re>>>26)|0,Re&=67108863,n=Math.imul(L,oe),i=(i=Math.imul(L,ue))+Math.imul(K,oe)|0,a=Math.imul(K,ue),n=n+Math.imul(M,fe)|0,i=(i=i+Math.imul(M,he)|0)+Math.imul(D,fe)|0,a=a+Math.imul(D,he)|0;var Ne=(ve+(n=n+Math.imul(R,pe)|0)|0)+((8191&(i=(i=i+Math.imul(R,de)|0)+Math.imul(N,pe)|0))<<13)|0;ve=((a=a+Math.imul(N,de)|0)+(i>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,n=Math.imul(L,fe),i=(i=Math.imul(L,he))+Math.imul(K,fe)|0,a=Math.imul(K,he);var Pe=(ve+(n=n+Math.imul(M,pe)|0)|0)+((8191&(i=(i=i+Math.imul(M,de)|0)+Math.imul(D,pe)|0))<<13)|0;ve=((a=a+Math.imul(D,de)|0)+(i>>>13)|0)+(Pe>>>26)|0,Pe&=67108863;var Me=(ve+(n=Math.imul(L,pe))|0)+((8191&(i=(i=Math.imul(L,de))+Math.imul(K,pe)|0))<<13)|0;return ve=((a=Math.imul(K,de))+(i>>>13)|0)+(Me>>>26)|0,Me&=67108863,u[0]=ye,u[1]=be,u[2]=me,u[3]=ge,u[4]=ke,u[5]=we,u[6]=xe,u[7]=Se,u[8]=Ee,u[9]=_e,u[10]=Ie,u[11]=Ae,u[12]=Te,u[13]=Ce,u[14]=Be,u[15]=Re,u[16]=Ne,u[17]=Pe,u[18]=Me,0!==ve&&(u[19]=ve,r.length+=1),r}Math.imul||(Q=W),x.Red=B,e.exports=x}).call(this,r(3).Buffer)},function(e,t,r){"use strict";e.exports=r(2327)},function(e,t,r){"use strict";(function(e,n){var i=r(1957),a=e.crypto||e.msCrypto,s=a&&"function"===typeof a.getRandomValues,o=s?a.getRandomValues.bind(a):null,u=new Uint32Array(1);function c(){f(u);var e=u[0];return u[0]=0,e}function f(e){if(!s)throw new Error("Entropy source not available.");return o(e)}function h(e,t,r){if(i(n.isBuffer(e)),i(e.buffer instanceof ArrayBuffer),i(e.byteOffset>>>0===e.byteOffset),i(e.byteLength>>>0===e.byteLength),i(t>>>0===t),i(r>>>0===r),i(t+r<=e.byteLength),r>Math.pow(2,31)-1)throw new RangeError('The value "size" is out of range.');var a=e.byteOffset+t,s=new Uint8Array(e.buffer,a,r);if(s.length>65536)for(var o=0;o<s.length;o+=65536){var u=o+65536;u>s.length&&(u=s.length),f(s.subarray(o,u))}else s.length>0&&f(s)}t.native=0,t.randomBytes=function(e){i(e>>>0===e);var t=n.alloc(e);return h(t,0,e),t},t.randomFill=function(e,t,r){return i(n.isBuffer(e)),null==t&&(t=0),i(t>>>0===t),null==r&&(r=e.length-t),i(r>>>0===r),i(t+r<=e.length),e.fill(0,t,t+r),h(e,t,r),e},t.randomInt=c,t.randomRange=function(e,t){i(e>>>0===e),i(t>>>0===t),i(t>=e);var r=t-e;if(0===r)return e;var n,a,s=-r>>>0;do{a=(n=c())%r}while(n-a>s);return a+e}}).call(this,r(38),r(3).Buffer)},function(e,t,r){"use strict";(function(e){var n=r(1957);function i(t){n(e.isBuffer(t));for(var r=0;r<t.length&&0===t[r];)r+=1;return t.slice(r)}function a(t){n(e.isBuffer(t));for(var r=t.length;r>0&&0===t[r-1];)r-=1;return t.slice(0,r)}t.countLeft=function(t){n(e.isBuffer(t));for(var r=0;r<t.length&&0===t[r];)r+=1;var i=8*(t.length-r);if(0===i)return 0;i-=8;for(var a=t[r];a;)i+=1,a>>>=1;return i},t.countRight=function(t){n(e.isBuffer(t));for(var r=t.length;r>0&&0===t[r-1];)r-=1;var i=8*r;if(0===i)return 0;i-=8;for(var a=t[r-1];a;)i+=1,a>>>=1;return i},t.compareLeft=function(t,r){n(e.isBuffer(t)),n(e.isBuffer(r));for(var i=0,a=t.length,s=0,o=r.length;a>0&&0===t[i];)i+=1,a-=1;for(;o>0&&0===r[s];)s+=1,o-=1;if(a<o)return-1;if(a>o)return 1;for(var u=0;u<a;u++){if(t[i+u]<r[s+u])return-1;if(t[i+u]>r[s+u])return 1}return 0},t.compareRight=function(t,r){n(e.isBuffer(t)),n(e.isBuffer(r));for(var i=t.length,a=r.length;i>0&&0===t[i-1];)i-=1;for(;a>0&&0===r[a-1];)a-=1;if(i<a)return-1;if(i>a)return 1;for(var s=i-1;s>=0;s--){if(t[s]<r[s])return-1;if(t[s]>r[s])return 1}return 0},t.trimLeft=i,t.trimRight=a,t.padLeft=function(t,r){if(n(e.isBuffer(t)),n(r>>>0===r),t.length>r&&(t=i(t)),t.length>r)throw new RangeError("Buffer expected to be ".concat(r," bytes in size."));var a=e.allocUnsafe(r),s=r-t.length;return a.fill(0,0,s),t.copy(a,s),a},t.padRight=function(t,r){if(n(e.isBuffer(t)),n(r>>>0===r),t.length>r&&(t=a(t)),t.length>r)throw new RangeError("Buffer expected to be ".concat(r," bytes in size."));var i=e.allocUnsafe(r);return t.copy(i,0),i.fill(0,t.length,r),i}}).call(this,r(3).Buffer)},function(e){e.exports=JSON.parse('{"naf":{"width":8,"points":[["67ae9c4a22928f491ff4ae743edac83a6343981981624886ac62485fd3f8e25c","1267b1d177ee69aba126a18e60269ef79f16ec176724030402c3684878f5b4d4"],["49fda73eade3587bfcef7cf7d12da5de5c2819f93e1be1a591409cc0322ef233","5f4825b298feae6fe02c6e148992466631282eca89430b5d10d21f83d676c8ed"],["14568685fcf4bd4ee9e3ee194b1d810783e809f3bbf1ce955855981af50e4107","31c563e32b47d52f87ce6468dd36ad41f0882b46f7abf23d12c4c4b59f4062b8"],["357cc970c80071651bf336e06f9422b886d80e5c2e4e0294d3e023065185715c","7f3d23c2c2dd0df4b2befce956f2d2fd1f789013236e4430c74e44845522f1c0"],["14e528b1154be417b6cf078dd6712438d381a5b2c593d552ff2fd2c1207cf3cb","2d9082313f21ab975a6f7ce340ff0fce1258591c3c9c58d4308f2dc36a033713"],["107427e0d5f366ccdb33adf0282d304f8843e3e88d22b7b83780e073b7c05fed","12dbb00ded538b7478466022d2da89b83740cfb2289a272387efe1aeea401f80"],["4f162deaec2ec435dc5ac6f95d20419ed9631374770189cb90617f3e66a18dc1","12cbfb2d04ff22f55162f70164d29331ace5af18a19a9aa1946d4cc4ad2e5cdf"],["7dc52d5a7db816e9b850741ea2fd72918d94985b85a20b4dc5597853a876df6a","6f6d2bca60003ef9f24ac245cc919fb717b188723b34f901cd6cfe9bec97be04"],["1d81f74a5ba45c7022e8c140d763b9c1b0e281a5304696e74f791a3a04a94472","3f185a93d95a4347227c5bb6ddd65cf42e1830823f435f3083fe6102691d55b9"],["6f0ac78e5eb90e87958588f9d47541edf252cb1dde3d073cc45e3e7ef9365716","6628d116b7975ae5f323e5ddf4f8cc35ae06d5c5c7d8a56effc66051336d289e"],["2188ac423c67db5625915e05222a391bcaf91f05d9b7cc2cab5798b2d2e14d95","23240c559c57b79a4df69a23fc46e50504277b1fa49369ab663d79782b33c0ee"],["794241471ed9ceb009384b370cb8790fca98552ecb822dc06b19362c36353455","71e918c03cdfca7207772e8d18ee8f9d92d79a0a83f378912362bc68d311dcd0"],["163bc180c22dfc5da23c5c052107bba93a88b4360aa1d4e729611d8f5a7f8079","631107a6ba83f7458194b9766a0a54f638ca20daf800384dbae1498677501939"],["39a32a30f3eb1da0eb7e3903b8ace3da3890b24b61a3a9e79db663b5db0f7a5d","4d4c54675dc1f1c9a1af9ca0010045dc803c16af345823136dd203715d67c491"],["38085391a0e2831f59c33fcce7591515784d359925f11ff958e0e4658efac0e9","42918001a829f49b5634e34ab7fac21b30e24660669ed91955cc31944a19e62a"],["5e3573b049d6135ffbbbbd9a480617434f2455b4a591f719e91153eeb75a32a1","54bc665420c789da1105d53983c1a0fc33bcc2690cd9b37d6566e21a85892871"],["7ed068b25b82c05fdc0e46bd80a357f3acd2f5c3b9330bc8d474e5b28270f6eb","01da83a187da8ccca704d46557a462551d70df7f943a681c3b97b1db6a21b7d3"],["05ca3370e7516f6686111b72650aab4c5484407f14b515ade03951c6a14a0aa3","6f407fc537b95277966e7f0f5e64b86904bf7baee091cee6011a3611834c6903"],["624cb312b698bbd6dbca79b8d2b53cb5d8b3ab33c19306e87c18211f095ab9c3","5b3336b2751e97c793731ac9b9a2243b6229f6d0bbea6b619395d0e5200bd8a3"],["1ddf6ece608fe2901b34b7e4f47cfcb75e947e293c704d8121b11a31a051b5f9","5e2dc58e9a48a749ce5296d229cfb34f96a147a8246d2e9844d52b52112ea94e"],["396b384f3d61cfc060308fbb1c941ebc9418e2d9abd81316e08d625f48c0e101","7223e5f7b66d1ca24962bac273a7aa6618cc60cb8a64a8837e0261107e7ad644"],["53cc3dca3410277fb38d75e4ac0dde8e77a99c817170dbc9696cffe7890fbd50","2592a3aafce64d7c69f4de468d5d5aa19845f5ca08f64a0a40e37d23ececbbe1"],["34705fe600f5aed77b29d3eacdffcd45d886904156d43dc550bb7fc889cc1368","299153c141a8950ffbcc8e9352993e642fa39a476200dd4acf42e158dbe3b01e"],["5969255bd089181b991fce96b1792ba330a14f8a0b061f8118c9c336b8504618","680a805fa0ae93c2a12b193517fb1147d355547e4ab18a9d6ca21575bbb4d7a4"],["27d1d57fa8808d3d452df14bda4248b37902752163b1fd499a92456c59918ecb","0a42f1c0f4c5d7de9e82904f0b4ff63988d31fedb8aad9d8ae009c7a1dff09c3"],["0811d14bfdfdcf2144edd9cf55bce584a9ba17aec3eac8aaa82987ad703d9b8a","42bea70d46f3ee0df0ec77d24c5495ea56ada2e0415920470c4746b68306376e"],["4de090761b863cb0f0650297f154a8e66d00c5119c38e5dd05303d905d527a4a","5eef0efd105361ce198a30e09e7e7edffbe3d70189e63ca68cf6057b9772baa8"],["1d45517858ce45556aaee056ebab7e0ef3dc9ae3740aed570f3e76bfb4fc4817","0b5a9d8fe8b7ccb04c0a5ef77798a3ec6e1bc1138604eb05e83844f0d4c5c699"],["4285edbe9117f30aae1ef5ee419eb1d472106c6b3d7f3ce3701e39324b0eeafc","503aa6104a682bcf2c0a60c84f4c22b50b0caa0fed8db87dedc7173eae04bdbd"],["3ef830cbeff9b79039b1b6bd9bb52bbcfa56d008d91b9703ea1c80351f8687d6","62349ff5d8dbd216a874769eec152ef9734bea9240eed623992c7553dc8ee4c8"],["649a996e6d4d3b60ccb526939ed8929134107e03e2fd4648eaa2fa9830822c1a","1648311b942fe95d492a1ace5e5235c1aea860d036d2475cc8964cd1acedee9c"],["3a95596d97770d050d1ecc075d58a74f5fe6b4b8222740534ba22c8be73f9d56","15a80cdcc03317a830fa4a7461de6bac136993e0a797f83b405c161a34c98fd7"],["2d265d3fe1c88903ca93685209418deec5af886bf0d9fdb3f499d831cbb76ce1","08376fb0663d3aa220948612b519af4a6a1f956622b15a305fb2e60a84210b3c"],["642cb15498d8c6b25803f3e56b98e2ea185ac808cbeab5eb0a610ed5babb9385","21b5ca5020a9e5a2334c0bee15193ea16c909963ffa6e1d93df4b239abeaeb3e"],["38e576301ff6cdd0822a19c6d610d445d3967e2bada903abb6220f68c6e79bef","458fe689e31a24952d2817dda4349109c1b26ef31699fa36c4f8389eeb60eac0"],["372bec78d75011a0ef2233cd08790a7f15c1ec1e3a78cac8d6652678641780db","32e9e47cf2f48612ed3e2c2006ea0c0c8476d3562aa88cefb67ec97abdb538e8"],["1aa3756aabcc3eb65afee34e0a15dd67bfb9fb199eb131f4cc6a3ca9ec4d1c77","42333e27831add6eb49af80e17347c63c26dd684758096ee3dbdbe03a49159ae"],["38db16447d79d3590c4a36e20286beadfbae91a4eed2e5e7dd4f975ac0537dc5","1c48ccaed60ec12ce862ea71165bba7df1739845df2a857f4ef0a0f714f96daa"],["176b78984cddfddef90bae619c6a98e951d9a7ac7d6af218ae7e76b273212fb7","7b5b93eda77443f366e2a127abe12212aad8536767ec1c5861143f777db85852"],["042d154bf7b4a7bd73897ae528c6bc552ea58d74f8109e8e4052d3e9d38bb0f6","42d1831323e279f9f7ee9e3470ba20ca7edc3245eca5d8ffa182de120a71fc90"],["1f8d28dd4f286a8d0687b626b01204434bf5874a9550d6e375116490c154e108","1ce82e2360367e06f41757fd45239f9bc2c61609139446b09b55a9c43da98bb8"],["613eb914c015076e9ae8356bf508c289e50b1c87d9e2546f6e406362e248e5e5","3edbaafcd8c41ef4aa18b254137d201a2ef0ca4ca28807156bc949e920b97353"],["27bf43826bf0310b4b3e3a405eff790a1d77a8d48b04891246cff8e193cb03a9","16a24d749cc1d234fbe8af9cfd782c3aaa5869d6db0afa7b4d4c67037514f2ea"],["769a6a59746d7bead417bdd9c3b5f5ae1dbd924083ffd9e88df7714f57a675c2","22dc1267cfb2b41c590abb7dc3df45619af688d0421f2bdfb50748335ec5da25"],["795734ee4fcc24194219d25d41a2889cdb942f765848e9df63bff0b158c7224d","756420ab5c71127d39d2e79907634a177af0e483e08484ea4d7b76f7100669b5"],["644d12fc5e7fcac5aeb5911d8240971a99fc59fdd2903f46958e6896aefbcf46","173450789fcd40172e8124fea56f7aedad2ee13fa8fc5209cc8cb572175216dc"],["5deca767ef17b9e8d4f351f5c8ad1fcc50e97a2ed687516bf5210679fd6c1110","4ddf2207da12f700708089989da016f3307ce5721c9e27c952599d67898aa396"],["296dcb24cb3185d037a94bef93c97cacd09fc7050ba8472da59d4a689d9d2848","0b17dc85a4acf73833fab728f15abccac97cd09e57975bd996d3e1dd8b060f7b"],["408a3f1af2e77dfe94f8e225b40dfc146abb1002db7bcf15fde61c1a6cf1b93f","4f01ec38854c15a879e7c7924f048e2ec951dcdf04a614088b68fbcc0954e1c8"],["07d2d9234970cdc9483e0a7c5ec52c49077c440e0a993a1e624f90b8fafbbf07","6ac2190030c210ae3e07b9239f6ee7affba263866ee7831a564c511f703f2295"],["2982d553002082320aa899b9b6887e40dedf11868fa931689795d93d58452873","215e16ca447978624cad0ea6bf45aada4eca914425ee275db2a26e980dc349b6"],["1d8649515cb49e136d2895b6276569e5c711fe1a343eeb5a3daaa8d0e7b42d1a","5b21e2f2978f343a3e9ec3316cdc111af3b55f34afa5fc3fcbf6c26c1bb7fb6c"],["5460df4d607147939cdbc04dbdcbdffd37c5eafdd501b50a67213a23ee724a97","69dfc7004263ccb52487d34ab134b80bb3030273999739cb9cdc16d71b9abcd8"],["24623476f0af9f42ca15a0697ad23abeaf5ed9dc4d2b44f7e8175486598125bb","6aebe4a1a22d9e31194dcde6d33ff3af77dda15c22b2ecba9329849b8c042687"],["64e507a02bfd8a8413117bac253b17f94b2911681ebc07c92da0de6a651dd538","513ac992d72b463da110afb612fbae36590248a0507d845ee95fab2d1caa03a4"],["47f3bd11324f6bee230a22a5bb06a3ccddbc0473b810689efaeef894a654bf0e","7e05db9b3ff886bf32608dfc8d14eaa91e2e2ef230e7c75618060e4285c492be"],["4a6d22703a7045d02d656015ea2d168385d42963a739a895e4fd87b3e55c5e0f","4c58d7a8c6ded0451798e51f16ffa5b637a87aa5defb119ba868d8cccf61776d"],["3e22af70a548097244d7798964598172a90391f84c59b04cea7af283ba368eb5","689d8b7cda23b8dea197c5119fbbbd81dd4b59a36cc283dbe292b5b6519a2968"],["61a6ba2ca42d9d557b3a2ff0867c1b8bb8fc40192d31ff637431a302bc065a10","63d805f5a79f845ea2915a25cf0a8cab2e0255212a1bd3c8852b25579b63721d"],["03d963eeae48556e88305f91c478efcfd2168c346b9ba185884ec8621e8cb414","74b75cc839a944ad8c639719d20fd9d48d2099ef24c8633eabec7a9ec1e7e183"],["0f04da69e0202f7b44c58b103c88de09a0599951fedb17e7f2152d6b93a58ae9","1fbc1c9cd03c4cfd46e8e90019debf86e8036587eade038346f91070c800b8c4"],["797899e488353ed0c6666aff11913b33be0190833766e809b2a68cbc671a9cfe","5dd70a33ff94a84b3fe660f7070e6179e86b5c846689265bf985ce424b8909cc"],["735b64bb872606510e4e7d57833eb7ffdc4aa0dbaa242439806be68379f77cdd","384aaaee3ca7ba2436fcb65910859ca5ec30c10af11df7d777d287bc1a2bce2c"],["6f6ea532a62cf4766f55a0a72a86b55e73fe9d3328ee94bfc271e122f99dc1ac","61d8203ef6da5d0b584541c02331c7f58617cf8d4f26d11776236ce8b113ac10"],["5d99a2a3d4aed730b827b68ed836a9910dce4e7b93faf456981ad6cd85748773","7eeacf5680fb6108a8b7edb45f7134644111b08e17c236469685af5a79474b9e"],["31d0b4bb57bd7b69363c064a49bf3c3b9d7635bcc287e7b3059d3d99fd8382e8","1592e581034e13d47d02b8966f5359097e652391be8fb1e803f4219a22aba2c0"],["424cf5c498bbbe8fa7e5c3247049cc3f45946d0e5f38c44a36a6c84b60a84aa0","34acd712d334a2315dc8fd00c5c9b7c5c9f29bca27380a018882a5ab4a0fcb43"],["33a6ae0522936ba774837aa7959972f9804e3ef02ae84c8039be6595598be247","37022798cc08be9b4ded34c1c5062ab3a26081d375cadf517972fb48135a6602"],["5939635b72aeba595b5f6e376d11a3e07d4b1153ab4d0a7ab267b8bcc47cc3cb","382162eb33db2322cbe01a38fa4d13720b6d8edfaf8116a628725ef4293a6c27"],["3649e78d2ae9fb0ee86b691c27386efce4f3e383790e3cfee2bd59c2e85c4036","09b0d9e0dd82e697b9be9d61ce0d1410e281122b483125c48f7942b22f5d5be4"],["62c7585d1677b7619d8200175346ec99118416d8fdf0103730d165934e96a973","5fef7955ee07304429995433a468d68dec4ecf6b08bbe8cd06869080094044de"],["0c94537d311e17f5b0c58989b5be7e40c88b978a8c074a1e9bb07a713f77f6d3","6deaaa5001bcbbbe9ae436fe42f7042ce74fbf83c14058427fad4587ed33c4e2"],["6f5c6894a8d3877312e608c11809c15dffec3df551711095c8cfc810533e1b3e","74eadab9389b40d6ac6cc0d6e333d628ced60a9ef7617751c20630d23477af7b"],["4e16e88e171f9a07e11f97bba65c0fe5483501f255343afb3335ed47fbcee08f","41bcd7dd328871247cb7995bc6bd2e1961e94b0fb12e5fb2f264f9ad2cf47d4c"],["65d8484cef146e6c232fb262c2ac8200a52c63ccec26ff6f038aa5c74982c741","67283346bbae9391952b141e57ca8e3a36f0363d3b81b1c0f2b3c30a92c74235"],["1c588485b64be8cb99bf97f065e75a82138ea2e035ba90b63745354e9cf729f8","7c9a18d6ebf5465a197989cfb9b5b2a66a5402f46c4708ac04187c6b157a0d77"],["2c80c4ad0aebcafab7e9d2519a329f8a1c7df21cb6b1acec7403c0204d6dce71","7f8e62983160756e35356df95d44467e621c7274372997ca74a9fb760b4db36f"],["1e1e5fc87fa2c49e2c44d5718e3d73c73a91a64ac1374652080bd9004291b9c6","153828e90ed8d94c0f86e0eb54ccb31073cd29ed62c34cd9f2dbc5d98872e597"],["0ce0488a30ed446d445efb1bd21ba32ec3d05d538e6393bc0e58e0849ad57129","7278074ac66ac779136f4d6a334b27633645dea0fc98d137e3dbd4015d12b5a1"],["01a6b81f7285f293f19ba019b009aed8280ce285af42fab91e87fb0bbfa6dea4","60f910dc7c9a82e7836f36acfe7ec26b9babfa8bf26b2945b3c1a43b0c19b4dc"],["79b4ce3c6990023859646690c9ea800174902acfa1aad7ff34eca032dbde7150","53a1053d3fc6c749bf8a928854f392d09fa851ba963ca661bffbe74f012ba45b"],["220ee355b5c39c1901ed34c0f50f7778ad1bedcd7259ae167c16514ffe333498","05fd9374986e1e06035dbfada0117035b96b159354262f2b2695af1256d6aa2a"],["1e2f97d2cb4a19ca40403b364253da71f65d2d4665894267e3c6a9db8b4a3a18","22804fb035acb519210ff99ed7a974a725d896a77933789b4dd45a37dea3466d"],["35b8699fa20987876ac3b3086965b05f8cc809d71cab45e017c68ac96e24ed5b","155079de21981778dc438353bf2c6a65967a1a33ebb74c866fb42f4e3cce3e39"],["3cb40c55f5f19c52958e8c4ecd9c459b1d3268b3971b2286d3e58d1fc6b6a6bd","379e1f1f59df05c74485615b87441ba6203f0cdddc6873a883d4cc6dd1b75921"],["6ad916290e0d003ce5c961679f77704dcd768589d7cb728c60f56852031803bf","1e602b4a6725832a56944234f84c4f85f79911b55beef903549089925f2ccbea"],["7c0162492ae668160aa56a60e8bd43ec088555f750d2223cc37362dead5de123","34e60b446eae100d4c3abc6cb02e4ca559457fb5a9030a290a2568fa4cbf118f"],["354c25bf7b3e83dd0c5e1f39b82e3567edeb5337634056c1091cd6a016caacdf","7abb271ef121630f85a9a1049b3ad78d5b889f533b37a713b8801de46770fc3a"],["1e581a4bcf7504f33f4342b2097504d13f9b5a27f4790a6cdde1242209862850","2164d56564360fd2b5dba2f2c6ef1045ab448c3b60b2f2196c2f74625fc39e07"],["533b56f18283ee79b9a180b887c298961bd9aaa6fa3ef97fcb0d5688e694bc3d","6011366753812df2bce83634a92dbac18dd1cffdbf9a97fa1b1d5b49e0026764"],["4b508b94e6e2e6cd260a20664ea7d727ad20587b63ebe826032e0d20cdc6627b","1e8ecd6ff5aabae78172a0214d07a5013992d133af58afa74049de726df2a6c4"],["3398c0c0219f5ac87a8c73fcd17b89311d120a53f5231cb761030c194fed4265","025b234a1dc8662c068c4ba903939c2f79f3f7a3ae64e5edbf667b13599142d9"],["5941a17b04cd3465031cb6745cb94eed24e1ff8d38a6e832f1637ae8e89c78e6","5309792c546b6cda458be331957763b5adb5d535d54a4a61023678faa2ee02ee"],["2cb490d2c0047fcbaffe1df26640bee73c158af6fec91343d606ce9d124a20c9","2e2952ebf089200aebfa3947f241e2fe85797afebdc1ea06d9d26de1b446a964"],["79305236b583232a91c63c7d9ca3750be7ee21711e4d6d257c39ae398212bde1","6f9ecdfa953e302c2014fd8512405e4be0d48302acd15e93936e8dba7d01053b"],["57d9fcb884b94664f35387fa6665cd9bc8136f90d804d77416ea99c3c653ee63","14197e65f0a3599c0b9fcef75b5fbb93580d1b2457b59fb70ce7b9bac88d0fbc"],["6d99df2c28c9fa1e38acddefd3e0931109143d873f3330377a9926bdacdd6523","2f21987905f397f092fc56c5ccd301a1e6afa3c4611627e25017b2e68d07c150"],["749d19591f1755bd481fa12a288166aac42911654c8c551395b265116269ceb9","7ec145aa7558d0342cd87b1750933cb6f3717e727a86a1cc1f2b0c274213688d"],["340f7f5ae19292957902635a5786d14fa38036b324ae759da501e32b8c4073f1","64e231a413f1379a26f4e8223ff91fe2ccd865549571d3c6c28871964b40a0ea"],["4aa33e00bf6e92cac4e84384e5dde0727394233afd5d24d357a8afeb94b08109","3385bb4fbc441937ee01b671d506227a654fd6c1c532cf5221710c6c56ec7e21"],["34b2ffca05f01088de266306c5cc122661e9308eab16929774e58565afc0e4eb","7662faf0f70e82c062c2b835fc6da3353d3cb20b80611ffa6ef2982cf62fa605"],["820fcb51326f1536ddb8dc1052aa198406c7e48f2c81e7664d15f8f9d3715e","756574c23bb01170b97d9fa1663a8ff2f5b97eaa5cd53f34140c1bcec8c262d9"],["0861d7e84cec6d6e33641ff6c85202fc0e9160797809ddc2193802499caf05d3","34936e0a5dc7e2a6217d475fbb8c1c607fb8b3565908a04fd5948abdd399c59f"],["5b4a1dc887ef684d7b4b165b70acb70842a2fa105935af15ecb4a097e33b8f2b","54d21511c05805e5298a72372b8289e9d59c46dc8b5c368bbfda620b68aa652c"],["755493ed60b13f03f9c019362a5af73fb49842dd6916e2572b1b6a312cd20cfc","0750bcbf7e449cec422b93ace1489e1b177d4dbbaa781d315c74d54bb444e9a9"],["5f1c341065b6a81ed2edb6bc38ba81b4c2e3fe2058e5baa13e1406eb2c5b4b4b","6179ebfa7f8086f26820fc99ca2f94c1be19bca672d79cea5b02a836119e06ba"],["1915024ee86acfba3f61ced9707521197195166fb1c4639bf3b3fcf0bf0ded46","5f2e0547032221d2b00937cf524590e3d90901ef0286ea0b032c1a81461b6d92"],["4e942d95930f38c8786ff4a8e576e7a29fb7627afe1fff91cda5006ba0624f5d","45902f695d512d70ce4c1e0520c0060896b94e14d2960b2fcf2ed5e138e0217b"],["63e45f3d91ab915d412bbaa17d1d249e1a1445077fbfaa6be7d35041c5116a91","46dad5a4ec2ad0b86938f5e09f1c03b53b660fc5137648b08527cd20708003da"],["5e2ddd2175417f72c9962c503ac5adf94ed11f28b9d41fccb6a4512886f3cc87","3523b218478911145af1dc431feb7db0a04066eb6e2ade3c7b67d11bc55323aa"],["62ff30a6b179a26e7247a8312cb3af3289e5d722f76a29f203aa623889aa05ec","562beb7999019346beaa80dfd5b95d614e1ff96c1cb1037f65c44997b797d066"],["14988b5d62084fb8335c2f261cdeddc1b634b09cedfce713ff5f0a0bb588a556","447068731fb98e821b8e413b3b48f2d1c8bea308f05aac877006b0f4c3b0cab3"],["1ac777f708a5942cc434236920e82ccc6af920c0a0676712255aa7082b37a5b6","52a6f88d92af1887c781501c6e3a88169a2831b74aefd416f22b47e8335ce317"],["5959792833b71bd5042b78e42212af671f5f87a08eafd8cdde2dcec8140e4bb3","41ce94633eabb8a1b08fac66f762997ed8c9e2af3558e1f6586ad6a5bf5b7b64"],["4464a7962e6722b457336fe98c91765b1ff178f9e892e90129e65fa7688a0607","3d1510b92fd33c501f058a7a86bddedf1b83f9b6e4f04829d321117013f891fe"],["62906d81e7f800e662519f4324ab4c8aac197661c729eed3e744d09efe721c08","4b68efb5b1b709ab86e3253d70bee87ba07875c04a64ecf7e35cd8cdc6c0f7d8"],["4300ff025ac78ef36e58ee7d0d732cf76cd0929fe265b3a093a57f23fc326757","2f92880570846ff2e90d91f16bce3705c9c3ca8011cc543091463b623e4b3c01"],["5427ba28d94652527a9b0c76f57a451e46bdc06cbc8a2481df17f66ffb1524e3","547a97c4afc8d1f74a5d51f7e524f68472f589cc0b396b21368628721537d722"],["424c4493810bfd5e3ffa21776326d8ff62bf8fe74504d7a2db5d3f74e5ce1015","74d0daa832d40405d01551a58b330ffc5abd5356230d6d7cabeb5b1a55046f32"],["54e10980d81b4ae8778896684295fa5c5475e8d68ec2a26e1b0a65383507b3cd","6b1eb48da6886c4d88cea720e9dc8b0d8c51a8f0e1943afa31a40eeb553c0676"],["732eb9e9ebb556e9f024c5574166738f4707b0fd005f568212ab575c1db71ddb","1fc6b00c89e48114d6b13d9920a0c78093994f2b08df147bdbb56bead2cea165"],["74029c04b34b7f314855fee42a04d0ddfdeb92ef3bf7cff629928a97733d96fb","501f63a252dfbc090733b5a208bfe08f81c91419ce3d2d6c0de8cdc5a5625014"],["04524402ebb71a60bf1055001000203a6d4917f112e50dd766cdd7b718a6edd7","71c9e2d15cdc47c565a696ffbe55277570930ed7ade13b9a254059365d5bf338"],["2555c620a50f2bbeeacac66228a96941fa733aa6070855331613578ed7c12794","2b3c1bc5cda7f93242561dbf7572237ac43bf013553230633a5e18b7e71597e5"],["555ea607b0ad18afaf70d7450543d7ffb5b883a3cad3e2778826ca97bf3211a6","6df903158f51aa530d411720a760f8ad0ce9904d54955fda74a349be58eddf5f"],["4db3cfa284207a250a9c83e1fec07e804d70065da586ff2c2a7d2bcb92e6fca6","2a4fbf1c51dc0b2a7783db2be3bd35c2d6462470c88c8b73ae3ce8503fa07154"],["5174e33ffdf28a87184a4d6427d821cbaa3b88ac293a90ca7e1eeae8c5050b16","315ca6bc8e35e4a3d06f89e1db1575b16197963ee8e64746fa998ccd403561cc"]]},"doubles":{"step":4,"points":[["23a4860627e53aeeb8e22b1508249c9109578d33e7bf237459b2596d6c28f9f8","709696f2827fc3729f980f2e3aad6e78b06a11ff8e079c27d87aab37c16727eb"],["5e7e07ed4e1decbfe6e9cbc126905449d4b578fbb561576d20b8bcdd0cc2a556","0f55755c51f102796bf5ebaa81d3260e7d1b3d9ac127d9a80e142031566cf6c7"],["7d13c0248b891b47eb524f2692008e2f97b199bac426cb5902b9003a29ded6ea","59a976ab2c01a81a91f1a56c75ccc77a9e1e9e878e9fe9c3952080a6805b20d5"],["5de7faa2ee4e70132f541f79ca07cd54a39fe1347a6844d19e9d678a8411a565","2c9f23641e1c2e0aab8ea9926b432d92c0e8bc08901d6ff6df85e4cef854ec36"],["06b349eebfed4dad4a805b63a6ed2231a565cda752d9477ff427dd9a8c9ab5ed","07a09289ff3e1f9aab68aa374c48df65f550c2323607b97744dee990608b64f8"],["0af367956af630266b1cc760154256ed79da960dddca9d72a1e8cf27d8d43a77","21108d900134d3b3708dd28ace96b0b23dda9100e4b6a62a8131bd2f2ba408c5"],["1e45a60140a3b2dee9b8dc6ff307154a1b410bcd38e0e38fb10b2f6da1afbe2b","0e730da473dffd60d2f3241a85e68acb47d26e5043ad047d893f072c8dda0a76"],["4d1e116d136158c5ddabd4276832800f2c081c1072de6f2d931797a46abc0cbb","6d415be49d4e35b65cc51354b5008f8c43e84b7b5e8a4b84f44e1efb10c9b91a"],["2b6b892ae94b454b2c2d92bb947fc4d506d173d281779c2c153c001ded42d3d0","7f1cf64e0e180fc4d6e12c1b5c5285f376e979616a52c94a0dea4d48c5880cd2"],["0f6c3a96e0032a9394337a02ffb2c83ba70efb8f566feab530fc90fa3b4710e5","3d4e97e286378675038a4b58e84224ee515e1d6697ac79389f78479be167635a"],["52ee53b981dfbc41ddaa5ddc2754c4175f4811aa45f8e2b19a425657c238a83e","7eb0a1be3400dec87b388cad51613957643cdf0595b891cc6f925fb36da7f1c3"],["52a837bc7a7bc9459bcc2ecf80f74d9ed99def0342e18cfbe8e799fbc504fd52","50d6460185d8924e5485f23f36a98c86053514d163547adab6fe91478a411196"],["6b2bd5d00fab38ceca21a27d6aaec82626b14b555d859527718f8ca404eba4","727340c27a15f6ab3d80547f0827c56ab1ba33bc30d1ef3909ea9a3af10c67e5"],["71dd75fe35761c01a48597ec730bc33237902fd4ad8612cbed1031eebdf40de4","39674a4532078e34378667beae5cb55f814ead9bbaf7e01b3b69533e9f88a411"],["57426aefc21be9ccf162e23d25ac3002ba8534351e65613f870f690f2fd46cf5","6b45b002fb4e8a6f59a6ffb006ed71f75434217333b266325204c7d1ac2e1f34"],["6222bd88bf2df9d5d44b60cfb4a08a960078db7ed51a35eb3e0b6b8ff4eda202","0325bb42ea4ed025dd6bdaed261b7c4f5410b608ba902b068f1efa5782e45313"],["71ac99647b61b9eca6f0c23432a518f738aee708d5932d4ef0f172240250a226","3a96c2c028ebe5f48913be30147e41bc5e1cab9595d5404138a9aa1b5574cf25"],["1f6a1fd8cc0e05b2742ba0fc0369b5247670543637dd033e64dbce90b2f23e9f","779964401ee869a9b31c0ef874a86440ba85d25c2ce932bd31a0865869605e19"],["22e2c039067920c42980dcb3a905fc91601c2b34e819ce1532ada4a5fc39d5cc","631cf9945a09bf26d7e595b3f8e3390696870512820df63c5418577089e1a8bb"],["608de273a9f6a534219d7aaede3cf65a81e4dc03d7a2765eced1d2b7be4610f4","3b31d0113f98d81ab1312fb2837aa9c8dcc7960f84eb371358c6d841f67144fa"],["3f748617ca63ab3e44c6e34f63e7328ea56a2a146da34368a57dca181254fe02","0fed89e6420fc47b3938a2891ba9acee4cbb2899ee4e9ca15a13dc527dc1641e"],["69d98b5ecc35d56c97c0bf312955d199befe116b417d70f5f57e2dfd0af81ce5","3e26d487fbfe36ab44e0ca3b248fe94bce92a69b8154d50e2d5481f8259f4e8e"],["1e34443347f9e627b3531157faab6eaca1bc3114df4a1423cc12bf8417b5d622","295955a5ed061eca7f87b9485666ba9489ec20a9c484224dc920350bb4a6fc79"],["51f4ff8c599b1c96da82941520a9f5abf4a31eb8b84fc95056145ceb3b5775d0","35ac9588d46e41f3f6f99aee3852eeb4b12e807807d4bd1b7f8406b0d7863ac1"],["3faa2a093a19a02424f65a10955101f4dc015c43b2dfce8e001507abd741b845","7a1de10dacfda389ca663b15574bdc8ae8c5b6e7cee647e77b11ddbfc6eb8edc"],["1924416956ea2c1269062588569b18178011ea7cba1a3266284f48aa01d5a90f","0c8e28127b7dcdd206fb6fee96eb88cfc7db7319826ac8cdb8b1fb8adaf021de"],["49761c57ce3c8c4f1435d495903e2f536f3be3712e76af8d0b5a8b7d1ebc8fac","3225035e1065094ef32d7f3e7a6f8ff2748025f96e0c0b44eb35576b61e150a8"],["4339fa86a23242851a16afc3ab05b352a7b4bf53599a49dd7e29d364fc3a757b","6d07cc3462bae9160bbebb997510817040767faa9dbd13f158a5fe8a63a34b0e"],["6bda13918dcbaf8529d6326ae7a9c278b72417c2188c5ea4f062fc50639295fb","2c3fa803b162ee887d0d97a6734866f992f846625f314117075da54bb6c20a36"],["4da4821314574d4fed4dcf692c8b15b99b73f13633210333ce7871359b6e6424","314016034673d2d20529bc93a2dab6e462bcb5f66e1f4a6bf2170759a40a6e65"],["0b2cea0029ee963c0034b61bf19e384435f14554a7d297b5144838c38e375586","47ea95da28d39aaade5edb8ed941c687603cfdd1508776e96d6683199e99daea"],["4c27afff3c45f32c952d3984e14e29a098e685c9c2e723e5fc8047ae60b7e824","5f2c99e6526dc87d95f11eb626c29c3a90d0be1e51a4c49e5bbabd114bf5a66b"],["53e2a4ed1bbb48bd016c524a02f797654cfc969849f867681da94e341f377534","5a2334fdda642732a3c9520ce06581aa7f0f082882554c37b8d390a25a9bd559"],["7b8d2c823baafe0d878a55e8af1db150dec85b1424a4901f9beffd3a6196e3d6","1c45a557b3624f9b89ed15b3c3e1a065f1b453d948f7cf45d9494483f8af0c85"],["78877b5d8777410997dacaeea59400fc9db4421fac02c4282301c67d35fb7ffe","0341b46c328333e4484ce8607619014d41775c408c88856d2f9e19812d90fbf5"],["2b556bbc070b5c4bae9e575836d1d68ee9fbe800448c0d2c233f78185eed3f91","7ba01332807ebd892e00ddb368c0fa1b3f19b5b32efd90b178d984e1d7174d6f"],["0f72556998b0044799f0fd03210ded3d984e3843bbaf3c1d5d692bc94d43c4e7","16c19c5037c103d447caef4efe6bd81a490e7c668f6870f1b080863b5315df5e"],["1cd96ef237b213cd446f13b3ec40d32ecc593bc6ea71e77efc284341a5f3da1a","7a626aeb91efcb5f9777264f5e17ced8b411f68c713673ef0f184a5ccd60dbe3"],["31a75b21cb532622a7caf9e29e652ac4e47b1450edf6655acaf3797b55a7ca46","77006e7cf104982f8865081a2ff8a6911546755e31c3586353b0bd0826c5d790"],["543d84cb04fb2bf787b7aa382eaab5cd8d050ad8ee52aa8a285b945652014031","0358fdc5b63ed49e693d838f182b275846f42dd49a42ec2e6e932ba4de59ef20"],["0a2818f5f5d8937800c30ac6b847db2cdef655b864126302249144a5a15b205a","187c76a49af10851bb049ba97c0fbbb14b2621522a4e8d9670ea46e56c9a1bd6"],["7efb45d3a2851109d7a8d50ddb08fe308bbf674c019b965cdad4570a141e648a","0fe1198b11a1bf56867091c69d71f8b7792257dda321d43652e818acd0c28cda"],["472e960dd122a534f52377235350549df4a1dd7a08cfc580bff5fb4b0a70aa7b","10585d04fc529fef4c0c0776154fc7ebbaedbae8a99937e47598d0578932b7cc"],["04892cfff7f94ff7f07c1241e3ac4945bc46ea9d6a3c1c3adbce109a9afceb6a","3ae2aa25e2555135a7a3251c11a3f8eebe81758bc1c3e2cbc6e6ca461a543130"],["2401d311a3abfd2583f1c6aa519c1f18ff730a0abf730ddcc9c9739b04d8a85e","653224f3488cae1ae19a414a9932035a2bf2c46803b5532bbb645e62387ee34d"],["0ea2c846a535a115972161612a192588d92d68a3c9050eae91b2817b94e68325","3b82a8337b05f11bbac176a113be183a50a0331f3d3116f24b971b5a8b0d031b"],["0fb3f87c2c6c89c65b74299b77f3736546a8b9e41b19197476bff27354e1c128","1034d42c15a2bfe3e682fad49dbc2812caadf0c584bc30b51625b85d74e9d5f7"],["1bc7af1e38185e7c2d8d04371c7e177d7a9ddee1b81d7d26db7ad644c7dad28d","61d909d855661f2f7a5eef87795dc0491d027e12631b270fcaf2f65900314833"],["469d0960dbd0ef9c91c4597ccf7c209549b187ff63bd378b7dac577198d74a4d","0b5f21c7f86832241f2157c288bdc9394f83f8d57457f6d9f6b345e4909478cb"],["5e9ac4ab2f4a3c3526e1317f913d69e3826fe862efd0c80d9310319170c5cbeb","505f00fa8aee03ccbd2f33529ae1e4e4bcf2644fe673d0b0290ec32be5b51bab"],["11cd80e1fdcbc565efed81d17f3f54643ffeed1cff38f3825e115adbd82759f1","43f11943f7ef3fa68b980fee45e98134f1df22263b2d14419d61ffe62822dbe0"],["3328bc121616a9477165ed282053d203c24f4826076c638a2c6723d42c9bfadb","2bbf3f26c21b5cb273e5f4f0114c6718c5eb7291939b7697c74333cdfafac039"],["0ba774bb605dd804cae6887e81f6bd2c59e024fac8bf5f5c48a841a037c28398","54ba013ad2d04dcdfb5a151b7347ee9a10067ddd0a3907e9bc337a77bf911321"],["1074ff0267662dc2b4ce65aaa0229c375a3d0d843ce9349233949581c869b64c","299be0decb680ec28923da4d049770107d42c180b460da13a7b1efc7e6d5b022"],["25ed76d78c87c3bd64b4331902c5a853734283e25f19f320295667b80a340d35","179b5f92f545c7b326b3a63fb0b32a0f52b4159988436d5af50c1d0d76373947"],["75d942c04210dcde5d1bd4fabfc732d3f95568e399382c0423c83c41cb05dc3f","696cc14856cdc13c8fd7e2c5771731cbf38e3fad47a424679765c4874e35ab2d"],["5d9324f56975477d5945599eeeccec67708c996cd3f3f2818bf2591507e3502a","10985a3cfd573205281aec24e2c8b41f5cd8cdfc9d7be34675cf306bbe1b4f6a"],["7511066c0e12105a7b937c7ecef367d5afe6e621e5cabf4e490b09b7ada7ee07","604df365b8391cbca8848f88daa700b770da5bb136f70bfb0a3ea33ba386fcd5"],["2596e5b3cf5494e60d2a750d03c66abc2e0183af53620b893f9cf9fc3b76dc26","68a0a7ac9a0cc093884a6b84f45a2cde595194e0f48dbd566fa78a3174b182fe"],["28bd38d44030dd9ca028b2a2f31a795f4c7a5e85a785df7847e3d525e99d4787","552dd7405c4183733ad3c4e7ccb999b4fed81b7a4444aab499d41d6d78d5bbfc"],["59233a3346f61135f431f96cf0197e24ad38240b222c010a6ce538cf4c24347b","3cce55908611d2b93f221613f09cfc4dbcd2e2b609233eea5439ad1908a10b20"],["5830f025f1078d408948f73096af97de1e9e70b3be85890acb21132c34ff961f","67d451752c2433ffe66e47242e301e56db2b2f8203553cab9de717e25793d41e"],["6a0c8b194571e874b82d904da36d43096bbe36d512e24ff8dcb2b00b57ffd3ec","5f85adb7749cc735ec838bcccfe7d4b52902c6132998d7ac8e032cad031c42b8"],["53b3f967bff8760948dec5e9282f35d1434a5503790b9012e17faefbe7c4d699","404462283c8664a17daa5b4059dcd10e2699fd86d0140de9f3e8ad0566098ae5"]]}}')},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=function(){function e(t,r,i,s){n(this,e),a(t&&"string"===typeof t.id),this.hash=t,this.size=t.size,this.prk=null,this.state=null,this.slab=null,this.save=0,(r||i||s)&&this.init(r,i,s)}return i(e,[{key:"init",value:function(e,r,n){return null==e&&(e=t.alloc(0)),null==r&&(r=t.alloc(this.size,0)),this.prk=this.hash.mac(e,r),this.reset(n),this}},{key:"set",value:function(e,r){return a(t.isBuffer(e)),a(e.length===this.size),this.prk=e,this.reset(r),this}},{key:"reset",value:function(e){null==e&&(e=t.alloc(0)),a(t.isBuffer(e));var r=t.alloc(this.size+e.length+1);return r.fill(0,0,this.size),e.copy(r,this.size),r[r.length-1]=0,this.state=r,this.slab=t.alloc(this.size),this.save=0,this}},{key:"generate",value:function(e){if(a(e>>>0===e),!this.prk||!this.state||!this.slab)throw new Error("HKDF is not initialized.");var r=(255-this.state[this.state.length-1])*this.size;if(e>this.save+r)throw new Error("Too many bytes requested.");var n=Math.ceil(Math.max(0,e-this.save)/this.size),i=t.alloc(this.save+n*this.size);this.slab.copy(i,0,0,this.save);for(var s=0;s<n;s++){var o=this.state;0===o[o.length-1]&&(o=o.slice(this.size)),a(255!==o[o.length-1]),o[o.length-1]+=1;var u=this.hash.mac(o,this.prk);u.copy(this.state,0),u.copy(i,this.save+s*this.size)}return this.save=i.copy(this.slab,0,e),i.slice(0,e)}},{key:"randomBytes",value:function(e){return this.generate(e)}}],[{key:"extract",value:function(e,r,n){return a(e&&"string"===typeof e.id),null==r&&(r=t.alloc(0)),null==n&&(n=t.alloc(e.size,0)),e.mac(r,n)}},{key:"expand",value:function(t,r,n,i){return new e(t).set(r,n).generate(i)}},{key:"derive",value:function(t,r,n,i,a){return new e(t).init(r,n,i).generate(a)}}]),e}();s.native=0,e.exports=s}).call(this,r(3).Buffer)},function(e,t,r){"use strict";(function(t){var n=r(68),i=r(5),a=r(7),s=r(1957),o=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];i(this,e),s("function"===typeof t),s(r>>>0===r),s(Array.isArray(n)),s(Array.isArray(a)),this.hash=t,this.size=r,this.x=n,this.y=a,this.inner=new t,this.outer=new t}return a(e,[{key:"init",value:function(e){var r,i;if(s(t.isBuffer(e)),e.length>this.size){var a=new(0,this.hash);a.init.apply(a,n(this.x)),a.update(e),e=a.final.apply(a,n(this.y)),s(e.length<=this.size)}for(var o=t.allocUnsafe(this.size),u=0;u<e.length;u++)o[u]=54^e[u];for(var c=e.length;c<o.length;c++)o[c]=54;(r=this.inner).init.apply(r,n(this.x)),this.inner.update(o);for(var f=0;f<e.length;f++)o[f]=92^e[f];for(var h=e.length;h<o.length;h++)o[h]=92;return(i=this.outer).init.apply(i,n(this.x)),this.outer.update(o),this}},{key:"update",value:function(e){return this.inner.update(e),this}},{key:"final",value:function(){var e,t;return this.outer.update((e=this.inner).final.apply(e,n(this.y))),(t=this.outer).final.apply(t,n(this.y))}}]),e}();e.exports=o}).call(this,r(3).Buffer)},function(e,t,r){var n,i,a;i=[r(2333)],void 0===(a="function"===typeof(n=function(e){"use strict";var t=e.Reader,r=e.Writer,n=e.util,i=e.roots.default||(e.roots.default={});return i.pb=function(){var a={};return a.NoiseHandshakePayload=function(){function a(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return a.prototype.identityKey=n.newBuffer([]),a.prototype.identitySig=n.newBuffer([]),a.prototype.data=n.newBuffer([]),a.create=function(e){return new a(e)},a.encode=function(e,t){return t||(t=r.create()),null!=e.identityKey&&e.hasOwnProperty("identityKey")&&t.uint32(10).bytes(e.identityKey),null!=e.identitySig&&e.hasOwnProperty("identitySig")&&t.uint32(18).bytes(e.identitySig),null!=e.data&&e.hasOwnProperty("data")&&t.uint32(26).bytes(e.data),t},a.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},a.decode=function(e,r){e instanceof t||(e=t.create(e));for(var n=void 0===r?e.len:e.pos+r,a=new i.pb.NoiseHandshakePayload;e.pos<n;){var s=e.uint32();switch(s>>>3){case 1:a.identityKey=e.bytes();break;case 2:a.identitySig=e.bytes();break;case 3:a.data=e.bytes();break;default:e.skipType(7&s)}}return a},a.decodeDelimited=function(e){return e instanceof t||(e=new t(e)),this.decode(e,e.uint32())},a.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.identityKey&&e.hasOwnProperty("identityKey")&&!(e.identityKey&&"number"===typeof e.identityKey.length||n.isString(e.identityKey))?"identityKey: buffer expected":null!=e.identitySig&&e.hasOwnProperty("identitySig")&&!(e.identitySig&&"number"===typeof e.identitySig.length||n.isString(e.identitySig))?"identitySig: buffer expected":null!=e.data&&e.hasOwnProperty("data")&&!(e.data&&"number"===typeof e.data.length||n.isString(e.data))?"data: buffer expected":null},a.fromObject=function(e){if(e instanceof i.pb.NoiseHandshakePayload)return e;var t=new i.pb.NoiseHandshakePayload;return null!=e.identityKey&&("string"===typeof e.identityKey?n.base64.decode(e.identityKey,t.identityKey=n.newBuffer(n.base64.length(e.identityKey)),0):e.identityKey.length&&(t.identityKey=e.identityKey)),null!=e.identitySig&&("string"===typeof e.identitySig?n.base64.decode(e.identitySig,t.identitySig=n.newBuffer(n.base64.length(e.identitySig)),0):e.identitySig.length&&(t.identitySig=e.identitySig)),null!=e.data&&("string"===typeof e.data?n.base64.decode(e.data,t.data=n.newBuffer(n.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),t},a.toObject=function(e,t){t||(t={});var r={};return t.defaults&&(t.bytes===String?r.identityKey="":(r.identityKey=[],t.bytes!==Array&&(r.identityKey=n.newBuffer(r.identityKey))),t.bytes===String?r.identitySig="":(r.identitySig=[],t.bytes!==Array&&(r.identitySig=n.newBuffer(r.identitySig))),t.bytes===String?r.data="":(r.data=[],t.bytes!==Array&&(r.data=n.newBuffer(r.data)))),null!=e.identityKey&&e.hasOwnProperty("identityKey")&&(r.identityKey=t.bytes===String?n.base64.encode(e.identityKey,0,e.identityKey.length):t.bytes===Array?Array.prototype.slice.call(e.identityKey):e.identityKey),null!=e.identitySig&&e.hasOwnProperty("identitySig")&&(r.identitySig=t.bytes===String?n.base64.encode(e.identitySig,0,e.identitySig.length):t.bytes===Array?Array.prototype.slice.call(e.identitySig):e.identitySig),null!=e.data&&e.hasOwnProperty("data")&&(r.data=t.bytes===String?n.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),r},a.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},a}(),a}(),i})?n.apply(t,i):n)||(e.exports=a)},function(e,t,r){"use strict";e.exports=r(2334)},function(e,t,r){"use strict";var n=t;function i(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=r(2088),n.BufferWriter=r(2343),n.Reader=r(2089),n.BufferReader=r(2344),n.util=r(1964),n.rpc=r(2345),n.roots=r(2347),n.configure=i,n.Writer._configure(n.BufferWriter),i()},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,a=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,s){r[n]=function(e){if(a)if(a=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(o){a&&(a=!1,s(o))}}))}},function(e,t,r){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),a=new Array(123),s=0;s<64;)a[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,r){for(var n,a=null,s=[],o=0,u=0;t<r;){var c=e[t++];switch(u){case 0:s[o++]=i[c>>2],n=(3&c)<<4,u=1;break;case 1:s[o++]=i[n|c>>4],n=(15&c)<<2,u=2;break;case 2:s[o++]=i[n|c>>6],s[o++]=i[63&c],u=0}o>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,s)),o=0)}return u&&(s[o++]=i[n],s[o++]=61,1===u&&(s[o++]=61)),a?(o&&a.push(String.fromCharCode.apply(String,s.slice(0,o))),a.join("")):String.fromCharCode.apply(String,s.slice(0,o))};n.decode=function(e,t,r){for(var n,i=r,s=0,o=0;o<e.length;){var u=e.charCodeAt(o++);if(61===u&&s>1)break;if(void 0===(u=a[u]))throw Error("invalid encoding");switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){"use strict";function n(e){return"undefined"!==typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function a(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:a,e.writeFloatBE=n?a:i,e.readFloatLE=n?s:o,e.readFloatBE=n?o:s}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var a=Math.floor(Math.log(t)/Math.LN2);e((i<<31|a+127<<23|8388607&Math.round(t*Math.pow(2,-a)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,a=n>>>23&255,s=8388607&n;return 255===a?s?NaN:i*(1/0):0===a?1401298464324817e-60*i*s:i*Math.pow(2,a-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,a),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,o)}(),"undefined"!==typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function a(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:a,e.writeDoubleBE=n?a:i,e.readDoubleLE=n?s:o,e.readDoubleBE=n?o:s}():function(){function t(e,t,r,n,i,a){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,a+t),e(1/n>0?0:2147483648,i,a+r);else if(isNaN(n))e(0,i,a+t),e(2146959360,i,a+r);else if(n>17976931348623157e292)e(0,i,a+t),e((s<<31|2146435072)>>>0,i,a+r);else{var o;if(n<22250738585072014e-324)e((o=n/5e-324)>>>0,i,a+t),e((s<<31|o/4294967296)>>>0,i,a+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(o=n*Math.pow(2,-u))>>>0,i,a+t),e((s<<31|u+1023<<20|1048576*o&1048575)>>>0,i,a+r)}}}function r(e,t,r,n,i){var a=e(n,i+t),s=e(n,i+r),o=2*(s>>31)+1,u=s>>>20&2047,c=4294967296*(1048575&s)+a;return 2047===u?c?NaN:o*(1/0):0===u?5e-324*o*c:o*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,a,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,o,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function a(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function o(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296===(64512&r)&&56320===(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,a=[],s=0;t<r;)(n=e[t++])<128?a[s++]=n:n>191&&n<224?a[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,a[s++]=55296+(n>>10),a[s++]=56320+(1023&n)):a[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,a)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,a.slice(0,s))),i.join("")):String.fromCharCode.apply(String,a.slice(0,s))},n.write=function(e,t,r){for(var n,i,a=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296===(64512&n)&&56320===(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-a}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=r||8192,i=n>>>1,a=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(a=e(n),s=0);var o=t.call(a,s,s+=r);return 7&s&&(s=1+(7|s)),o}}},function(e,t,r){"use strict";e.exports=i;var n=r(1964);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var a=i.zero=new i(0,0);a.toNumber=function(){return 0},a.zzEncode=a.zzDecode=function(){return this},a.length=function(){return 1};var s=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return a;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"===typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):a},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?a:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=s;var n=r(2088);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(1964),a=i.Buffer;function s(){n.call(this)}s.alloc=function(e){return(s.alloc=i._Buffer_allocUnsafe)(e)};var o=a&&a.prototype instanceof Uint8Array&&"set"===a.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function u(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write(e,r)}s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(o,t,e),this},s.prototype.string=function(e){var t=a.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},function(e,t,r){"use strict";e.exports=a;var n=r(2089);(a.prototype=Object.create(n.prototype)).constructor=a;var i=r(1964);function a(e){n.call(this,e)}i.Buffer&&(a.prototype._slice=i.Buffer.prototype.slice),a.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,r){"use strict";t.Service=r(2346)},function(e,t,r){"use strict";e.exports=i;var n=r(1964);function i(e,t,r){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,a,s){if(!a)throw TypeError("request must be specified");var o=this;if(!s)return n.asPromise(e,o,t,r,i,a);if(o.rpcImpl)try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](a).finish(),(function(e,r){if(e)return o.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),s(e)}return o.emit("data",r,t),s(null,r)}o.end(!0)}))}catch(u){return o.emit("error",u,t),void setTimeout((function(){s(u)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=r(2349),o=r(2350),u=function(){function e(){n(this,e),this.chacha=new s,this.poly=new o,this.key=t.alloc(64),this.mode=-1,this.aadLen=0,this.cipherLen=0}return i(e,[{key:"init",value:function(e,r){return a(t.isBuffer(e)),a(t.isBuffer(r)),this.key.fill(0),this.chacha.init(e,r,0),this.chacha.encrypt(this.key),this.poly.init(this.key),this.mode=0,this.aadLen=0,this.cipherLen=0,this}},{key:"aad",value:function(e){if(-1===this.mode)throw new Error("Context is not initialized.");if(0!==this.mode)throw new Error("Invalid state for aad.");return this.poly.update(e),this.aadLen+=e.length,this}},{key:"encrypt",value:function(e){if(-1===this.mode)throw new Error("Context is not initialized.");if(0!==this.mode&&1!==this.mode)throw new Error("Invalid state for encrypt.");return 0===this.mode&&(this._pad16(this.aadLen),this.mode=1),this.chacha.encrypt(e),this.poly.update(e),this.cipherLen+=e.length,e}},{key:"decrypt",value:function(e){if(a(t.isBuffer(e)),-1===this.mode)throw new Error("Context is not initialized.");if(0!==this.mode&&2!==this.mode)throw new Error("Invalid state for decrypt.");return 0===this.mode&&(this._pad16(this.aadLen),this.mode=2),this.cipherLen+=e.length,this.poly.update(e),this.chacha.encrypt(e),e}},{key:"auth",value:function(e){if(a(t.isBuffer(e)),-1===this.mode)throw new Error("Context is not initialized.");if(0!==this.mode&&3!==this.mode)throw new Error("Invalid state for auth.");return 0===this.mode&&(this._pad16(this.aadLen),this.mode=3),this.cipherLen+=e.length,this.poly.update(e),e}},{key:"final",value:function(){if(-1===this.mode)throw new Error("Context is not initialized.");var e=t.allocUnsafe(16);f(e,this.aadLen,0),f(e,this.cipherLen,8),0===this.mode&&this._pad16(this.aadLen),this._pad16(this.cipherLen),this.poly.update(e);var r=this.poly.final();return this.destroy(),r}},{key:"destroy",value:function(){this.chacha.destroy(),this.poly.destroy();for(var e=0;e<64;e++)this.key[e]=0;return this.mode=-1,this.aadLen=0,this.cipherLen=0,this}},{key:"verify",value:function(e){a(t.isBuffer(e)),a(16===e.length);for(var r=this.final(),n=0,i=0;i<16;i++)n|=r[i]^e[i];return n-1>>>31!==0}},{key:"_pad16",value:function(e){var r=15&e;if(0!==r){var n=t.allocUnsafe(16-r);n.fill(0),this.poly.update(n)}}}],[{key:"encrypt",value:function(t,r,n,i){var a=new e;return a.init(t,r),i&&a.aad(i),a.encrypt(n),a.final()}},{key:"decrypt",value:function(t,r,n,i,a){var s=new e;return s.init(t,r),a&&s.aad(a),s.decrypt(n),s.verify(i)}},{key:"auth",value:function(t,r,n,i,a){var s=new e;return s.init(t,r),a&&s.aad(a),s.auth(n),s.verify(i)}}]),e}();function c(e,t,r){return e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,r}function f(e,t,r){var n=t*(1/4294967296)>>>0;return c(e,t>>>0,r+0),c(e,n,r+4),r+8}u.native=s.native,e.exports=u}).call(this,r(3).Buffer)},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=0===new Int8Array(new Int16Array([1]).buffer)[0],o=function(){function e(){n(this,e),this.state=new Uint32Array(16),this.stream=new Uint32Array(16),this.bytes=new Uint8Array(this.stream.buffer),this.pos=-1,s&&(this.bytes=t.alloc(64))}return i(e,[{key:"init",value:function(r,n,i){if(null==i&&(i=0),a(t.isBuffer(r)),a(t.isBuffer(n)),a(Number.isSafeInteger(i)),16!==r.length&&32!==r.length)throw new RangeError("Invalid key size.");if(n.length>=24&&(r=e.derive(r,n.slice(0,16)),n=n.slice(16)),this.state[0]=1634760805,this.state[1]=r.length<32?824206446:857760878,this.state[2]=r.length<32?2036477238:2036477234,this.state[3]=1797285236,this.state[4]=f(r,0),this.state[5]=f(r,4),this.state[6]=f(r,8),this.state[7]=f(r,12),this.state[8]=f(r,16%r.length),this.state[9]=f(r,20%r.length),this.state[10]=f(r,24%r.length),this.state[11]=f(r,28%r.length),this.state[12]=i>>>0,8===n.length)this.state[13]=i/4294967296>>>0,this.state[14]=f(n,0),this.state[15]=f(n,4);else if(12===n.length)this.state[13]=f(n,0),this.state[14]=f(n,4),this.state[15]=f(n,8);else{if(16!==n.length)throw new RangeError("Invalid nonce size.");this.state[12]=f(n,0),this.state[13]=f(n,4),this.state[14]=f(n,8),this.state[15]=f(n,12)}return this.pos=0,this}},{key:"encrypt",value:function(e){if(a(t.isBuffer(e)),-1===this.pos)throw new Error("Context is not initialized.");for(var r=0;r<e.length;r++)0===(63&this.pos)&&(this._block(),this.pos=0),e[r]^=this.bytes[this.pos++];return e}},{key:"_block",value:function(){for(var e=0;e<16;e++)this.stream[e]=this.state[e];for(var t=0;t<10;t++)u(this.stream,0,4,8,12),u(this.stream,1,5,9,13),u(this.stream,2,6,10,14),u(this.stream,3,7,11,15),u(this.stream,0,5,10,15),u(this.stream,1,6,11,12),u(this.stream,2,7,8,13),u(this.stream,3,4,9,14);for(var r=0;r<16;r++)this.stream[r]+=this.state[r];if(s)for(var n=0;n<16;n++)h(this.bytes,this.stream[n],4*n);this.state[12]+=1,0===this.state[12]&&(this.state[13]+=1)}},{key:"destroy",value:function(){for(var e=0;e<16;e++)this.state[e]=0,this.stream[e]=0;if(s)for(var t=0;t<64;t++)this.bytes[t]=0;return this.pos=-1,this}}],[{key:"derive",value:function(e,r){if(a(t.isBuffer(e)),a(t.isBuffer(r)),16!==e.length&&32!==e.length)throw new RangeError("Invalid key size.");if(16!==r.length)throw new RangeError("Invalid nonce size.");var n=new Uint32Array(16);n[0]=1634760805,n[1]=e.length<32?824206446:857760878,n[2]=e.length<32?2036477238:2036477234,n[3]=1797285236,n[4]=f(e,0),n[5]=f(e,4),n[6]=f(e,8),n[7]=f(e,12),n[8]=f(e,16%e.length),n[9]=f(e,20%e.length),n[10]=f(e,24%e.length),n[11]=f(e,28%e.length),n[12]=f(r,0),n[13]=f(r,4),n[14]=f(r,8),n[15]=f(r,12);for(var i=0;i<10;i++)u(n,0,4,8,12),u(n,1,5,9,13),u(n,2,6,10,14),u(n,3,7,11,15),u(n,0,5,10,15),u(n,1,6,11,12),u(n,2,7,8,13),u(n,3,4,9,14);var s=t.alloc(32);return h(s,n[0],0),h(s,n[1],4),h(s,n[2],8),h(s,n[3],12),h(s,n[12],16),h(s,n[13],20),h(s,n[14],24),h(s,n[15],28),s}}]),e}();function u(e,t,r,n,i){e[t]+=e[r],e[i]=c(e[i]^e[t],16),e[n]+=e[i],e[r]=c(e[r]^e[n],12),e[t]+=e[r],e[i]=c(e[i]^e[t],8),e[n]+=e[i],e[r]=c(e[r]^e[n],7)}function c(e,t){return e<<t|e>>>32-t}function f(e,t){return e[t++]+256*e[t++]+65536*e[t++]+16777216*e[t]}function h(e,t,r){return e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,t>>>=8,e[r++]=t,r}o.native=0,e.exports=o}).call(this,r(3).Buffer)},function(e,t,r){"use strict";(function(t){var n=r(5),i=r(7),a=r(1957),s=function(){function e(){n(this,e),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.buffer=t.alloc(16),this.fin=-1,this.leftover=0}return i(e,[{key:"init",value:function(e){a(t.isBuffer(e)&&e.length>=32);var r=o(e,0),n=o(e,2),i=o(e,4),s=o(e,6),u=o(e,8),c=o(e,10),f=o(e,12),h=o(e,14);this.r[0]=8191&r,this.r[1]=8191&(r>>>13|n<<3),this.r[2]=7939&(n>>>10|i<<6),this.r[3]=8191&(i>>>7|s<<9),this.r[4]=255&(s>>>4|u<<12),this.r[5]=u>>>1&8190,this.r[6]=8191&(u>>>14|c<<2),this.r[7]=8065&(c>>>11|f<<5),this.r[8]=8191&(f>>>8|h<<8),this.r[9]=h>>>5&127;for(var l=0;l<10;l++)this.h[l]=0;for(var p=0;p<8;p++)this.pad[p]=o(e,16+2*p);return this.fin=0,this.leftover=0,this}},{key:"_blocks",value:function(e,t,r){for(var n=this.fin?0:2048,i=new Uint32Array(10);t>=16;){var a=o(e,r+0),s=o(e,r+2),u=o(e,r+4),c=o(e,r+6),f=o(e,r+8),h=o(e,r+10),l=o(e,r+12),p=o(e,r+14);this.h[0]+=8191&a,this.h[1]+=8191&(a>>>13|s<<3),this.h[2]+=8191&(s>>>10|u<<6),this.h[3]+=8191&(u>>>7|c<<9),this.h[4]+=8191&(c>>>4|f<<12),this.h[5]+=f>>>1&8191,this.h[6]+=8191&(f>>>14|h<<2),this.h[7]+=8191&(h>>>11|l<<5),this.h[8]+=8191&(l>>>8|p<<8),this.h[9]+=p>>>5|n;for(var d=0,v=0;v<10;v++){i[v]=d;for(var y=0;y<10;y++){var b=this.h[y];b*=y<=v?this.r[v-y]:5*this.r[v+10-y],i[v]+=b,4===y&&(d=i[v]>>>13,i[v]&=8191)}d+=i[v]>>>13,i[v]&=8191}d=(d<<2)+d,d+=i[0],i[0]=8191&d,d>>>=13,i[1]+=d;for(var m=0;m<10;m++)this.h[m]=i[m];r+=16,t-=16}}},{key:"update",value:function(e){if(a(t.isBuffer(e)),-1===this.fin)throw new Error("Context is not initialized.");var r=e.length,n=0;if(this.leftover){var i=16-this.leftover;i>r&&(i=r);for(var s=0;s<i;s++)this.buffer[this.leftover+s]=e[n+s];if(r-=i,n+=i,this.leftover+=i,this.leftover<16)return this;this._blocks(this.buffer,16,0),this.leftover=0}if(r>=16){var o=-16&r;this._blocks(e,o,n),n+=o,r-=o}if(r){for(var u=0;u<r;u++)this.buffer[this.leftover+u]=e[n+u];this.leftover+=r}return this}},{key:"final",value:function(){if(-1===this.fin)throw new Error("Context is not initialized.");var e=t.alloc(16),r=new Uint16Array(10);if(this.leftover){var n=this.leftover;for(this.buffer[n++]=1;n<16;n++)this.buffer[n]=0;this.fin=1,this._blocks(this.buffer,16,0)}var i=this.h[1]>>>13;this.h[1]&=8191;for(var a=2;a<10;a++)this.h[a]+=i,i=this.h[a]>>>13,this.h[a]&=8191;this.h[0]+=5*i,i=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=i,i=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=i,r[0]=this.h[0]+5,i=r[0]>>>13,r[0]&=8191;for(var s=1;s<10;s++)r[s]=this.h[s]+i,i=r[s]>>>13,r[s]&=8191;for(var o=(1^i)-1,c=0;c<10;c++)r[c]&=o;o=~o;for(var f=0;f<10;f++)this.h[f]=this.h[f]&o|r[f];this.h[0]=65535&(this.h[0]|this.h[1]<<13),this.h[1]=65535&(this.h[1]>>>3|this.h[2]<<10),this.h[2]=65535&(this.h[2]>>>6|this.h[3]<<7),this.h[3]=65535&(this.h[3]>>>9|this.h[4]<<4),this.h[4]=65535&(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14),this.h[5]=65535&(this.h[6]>>>2|this.h[7]<<11),this.h[6]=65535&(this.h[7]>>>5|this.h[8]<<8),this.h[7]=65535&(this.h[8]>>>8|this.h[9]<<5);var h=this.h[0]+this.pad[0];this.h[0]=h;for(var l=1;l<8;l++)h=this.h[l]+this.pad[l]+(h>>>16),this.h[l]=h;for(var p=0;p<8;p++)u(e,this.h[p],2*p);return this.destroy(),e}},{key:"destroy",value:function(){for(var e=0;e<10;e++)this.r[e]=0,this.h[e]=0;for(var t=0;t<8;t++)this.pad[t]=0;for(var r=0;r<16;r++)this.buffer[r]=0;this.fin=-1,this.leftover=0}},{key:"verify",value:function(e){a(t.isBuffer(e)),a(16===e.length);for(var r=this.final(),n=0,i=0;i<16;i++)n|=r[i]^e[i];return n-1>>>31!==0}}]),e}();function o(e,t){return e[t++]+256*e[t]}function u(e,t,r){return e[r++]=t,e[r++]=t>>>8,r}s.native=0,e.exports=s}).call(this,r(3).Buffer)},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(46),s=r(5),o=r(7),u=r(28),c=r(27),f=r(87),h=r(29),l=r(25),p=r(26),d=r(18),v=r(41).EventEmitter,y=r(15),b=r(191),m=r(57).MemoryDatastore,g=r(2352),k=r(1953),w=r(1965),x=r(2353),S=r(2364),E=r(2370),_=r(2373),I=r(1958),A=r(2374),T=r(2375),C=r(2378),B=b.Record,R=function(e){function t(e){var r,n=e.libp2p,i=e.dialer,o=e.peerId,h=e.peerStore,l=e.registrar,p=e.datastore,d=void 0===p?new m:p,v=e.kBucketSize,y=void 0===v?w.K:v,I=e.clientMode,B=void 0!==I&&I,R=e.concurrency,N=void 0===R?w.ALPHA:R,P=e.validators,M=void 0===P?{}:P,D=e.selectors,O=void 0===D?{}:D,L=e.randomWalk,K=void 0===L?{}:L;if(s(this,t),r=u(this,c(t).call(this)),!i)throw new Error("libp2p-kad-dht requires an instance of Dialer");return r.libp2p=n,r.dialer=i,r.peerId=o,r.peerStore=h,r.registrar=l,r.kBucketSize=y,r._clientMode=B,r.concurrency=N,r.disjointPaths=Math.ceil(r.kBucketSize/2),r.routingTable=new g(r.peerId,r.kBucketSize),r.datastore=d,r.providers=new A(r.datastore,r.peerId),r.validators=a({pk:b.validator.validators.pk},M),r.selectors=a({pk:b.selection.selectors.pk},O),r.network=new x(f(r)),r._log=k.logger(r.peerId),r.randomWalk=new T(f(r),K),r._queryManager=new C,r._running=!1,r.contentFetching=S(f(r)),r.contentRouting=E(f(r)),r.peerRouting=_(f(r)),r}return h(t,e),o(t,[{key:"start",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._running=!0,this.providers.start(),this._queryManager.start(),e.next=5,this.network.start();case 5:this.randomWalk.start();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){return this._running=!1,this.randomWalk.stop(),this.providers.stop(),this._queryManager.stop(),this.network.stop()}},{key:"put",value:function(){var e=i(n.mark((function e(t,r){var i,a=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.contentFetching.put(t,r,i));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=i(n.mark((function e(t){var r,i=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.abrupt("return",this.contentFetching.get(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMany",value:function(){var e=i(n.mark((function e(t,r){var i,a=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.contentFetching.getMany(t,r,i));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"provide",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.contentRouting.provide(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"findProviders",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(n.mark((function i(){var a,s,o,u,c,f,h;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!0,s=!1,n.prev=2,u=d(t.contentRouting.findProviders(e,r));case 4:return n.next=6,l(u.next());case 6:return c=n.sent,a=c.done,n.next=10,l(c.value);case 10:if(f=n.sent,a){n.next=18;break}return h=f,n.next=15,h;case 15:a=!0,n.next=4;break;case 18:n.next=24;break;case 20:n.prev=20,n.t0=n.catch(2),s=!0,o=n.t0;case 24:if(n.prev=24,n.prev=25,a||null==u.return){n.next=29;break}return n.next=29,l(u.return());case 29:if(n.prev=29,!s){n.next=32;break}throw o;case 32:return n.finish(29);case 33:return n.finish(24);case 34:case"end":return n.stop()}}),i,null,[[2,20,24,34],[25,,29,33]])})))()}},{key:"findPeer",value:function(){var e=i(n.mark((function e(t){var r,i=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>1&&void 0!==i[1]?i[1]:{},e.abrupt("return",this.peerRouting.findPeer(t,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getClosestPeers",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shallow:!1};return p(n.mark((function i(){var a,s,o,u,c,f,h;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!0,s=!1,n.prev=2,u=d(t.peerRouting.getClosestPeers(e,r));case 4:return n.next=6,l(u.next());case 6:return c=n.sent,a=c.done,n.next=10,l(c.value);case 10:if(f=n.sent,a){n.next=18;break}return h=f,n.next=15,h;case 15:a=!0,n.next=4;break;case 18:n.next=24;break;case 20:n.prev=20,n.t0=n.catch(2),s=!0,o=n.t0;case 24:if(n.prev=24,n.prev=25,a||null==u.return){n.next=29;break}return n.next=29,l(u.return());case 29:if(n.prev=29,!s){n.next=32;break}throw o;case 32:return n.finish(29);case 33:return n.finish(24);case 34:case"end":return n.stop()}}),i,null,[[2,20,24,34],[25,,29,33]])})))()}},{key:"getPublicKey",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.peerRouting.getPublicKey(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_peerDiscovered",value:function(e,t){this.emit("peer",{id:e,multiaddrs:t})}},{key:"_nearestPeersToQuery",value:function(){var e=i(n.mark((function e(t){var r,i,a=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.convertBuffer(t.key);case 2:return r=e.sent,i=this.routingTable.closestPeers(r,this.kBucketSize),e.abrupt("return",i.map((function(e){var t=a.peerStore.get(e);return{id:e,multiaddrs:t?t.addresses.map((function(e){return e.multiaddr})):[]}})));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_betterPeersToQuery",value:function(){var e=i(n.mark((function e(t,r){var i,a=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._log("betterPeersToQuery"),e.next=3,this._nearestPeersToQuery(t);case 3:return i=e.sent,e.abrupt("return",i.filter((function(e){return a._isSelf(e.id)?(a._log.error("trying to return self as closer"),!1):!e.id.isEqual(r)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkLocalDatastore",value:function(){var e=i(n.mark((function e(t){var r,i,a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._log("checkLocalDatastore: %b",t),r=k.bufferToKey(t),e.prev=2,e.next=5,this.datastore.get(r);case 5:i=e.sent,e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(2),"ERR_NOT_FOUND"!==e.t0.code){e.next=12;break}return e.abrupt("return",void 0);case 12:throw e.t0;case 13:if(a=B.deserialize(i)){e.next=16;break}throw y("Invalid record","ERR_INVALID_RECORD");case 16:if(!(null==a.timeReceived||k.now()-a.timeReceived>w.MAX_RECORD_AGE)){e.next=20;break}return e.next=19,this.datastore.delete(r);case 19:return e.abrupt("return",void 0);case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_add",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.routingTable.add(t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyRecordLocally",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._log("verifyRecordLocally"),e.next=3,b.validator.verifyRecord(this.validators,t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isSelf",value:function(e){return e&&this.peerId.id.equals(e.id)}},{key:"_putValueToPeer",value:function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new I(I.TYPES.PUT_VALUE,t,0)).record=r,e.next=4,this.network.sendRequest(i,a);case 4:if(e.sent.record.value.equals(B.deserialize(r).value)){e.next=7;break}throw y(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID");case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getValueOrPeers",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getValueSingle(t,r);case 2:if(i=e.sent,a=i.closerPeers,!(s=i.record)){e.next=17;break}return e.prev=6,e.next=9,this._verifyRecordOnline(s);case 9:e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(6),o="invalid record received, discarded",this._log(o),y(new Error(o),"ERR_INVALID_RECORD");case 16:return e.abrupt("return",{record:s,peers:a});case 17:if(!(a.length>0)){e.next=19;break}return e.abrupt("return",{peers:a});case 19:throw y(new Error("Not found"),"ERR_NOT_FOUND");case 20:case"end":return e.stop()}}),e,this,[[6,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getValueSingle",value:function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new I(I.TYPES.GET_VALUE,r,0),e.abrupt("return",this.network.sendRequest(t,i));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_verifyRecordOnline",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.validator.verifyRecord(this.validators,t);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"isStarted",get:function(){return this._running}}]),t}(v);e.exports=R,e.exports.multicodec=w.PROTOCOL_DHT},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(820),u=r(1953),c=function(){function e(t,r){a(this,e),this.self=t,this._onPing=this._onPing.bind(this),this._onInit(r)}return s(e,[{key:"_onInit",value:function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.convertPeerId(this.self);case 2:r=e.sent,this.kb=new o({localNodeId:r,numberOfNodesPerKBucket:t,numberOfNodesToPing:1}),this.kb.on("ping",this._onPing);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onPing",value:function(e,t){var r=e[0];this.kb.remove(r.id),this.kb.add(t)}},{key:"find",value:function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.convertPeerId(t);case 2:if(r=e.sent,!(i=this.closestPeer(r))||!i.isEqual(t)){e.next=6;break}return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"closestPeer",value:function(e){var t=this.closestPeers(e,1);if(t.length>0)return t[0]}},{key:"closestPeers",value:function(e,t){return this.kb.closest(e,t).map((function(e){return e.peer}))}},{key:"add",value:function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.convertPeerId(t);case 2:r=e.sent,this.kb.add({id:r,peer:t});case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.convertPeerId(t);case 2:r=e.sent,this.kb.remove(r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"size",get:function(){return this.kb.count()}}]),e}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(18),u=r(15),c=r(78),f=r(100),h=r(170),l=r(2354).consume,p=r(2015),d=r(2355),v=r(1965),y=r(1958),b=r(1953),m=function(){function e(t){a(this,e),this.dht=t,this.readMessageTimeout=v.READ_MESSAGE_TIMEOUT,this._log=b.logger(this.dht.peerId,"net"),this._rpc=d(this.dht),this._onPeerConnected=this._onPeerConnected.bind(this),this._running=!1}return s(e,[{key:"start",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._running){e.next=2;break}return e.abrupt("return");case 2:if(this.dht.isStarted){e.next=4;break}throw u(new Error("Can not start network"),"ERR_CANNOT_START_NETWORK");case 4:return this._running=!0,!1===this.dht._clientMode&&this.dht.registrar.handle(v.PROTOCOL_DHT,this._rpc),t=new p({multicodecs:[v.PROTOCOL_DHT],handlers:{onConnect:this._onPeerConnected,onDisconnect:function(){}}}),e.next=9,this.dht.registrar.register(t);case 9:this._registrarId=e.sent;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dht.isStarted||this.isStarted){e.next=2;break}return e.abrupt("return");case 2:return this._running=!1,e.next=5,this.dht.registrar.unregister(this._registrarId);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_onPeerConnected",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dht._add(t);case 2:this._log("added to the routing table: %s",t.toB58String());case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRequest",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}throw u(new Error("Network is offline"),"ERR_NETWORK_OFFLINE");case 2:if(i=t.toB58String(),this._log("sending to: %s",i),a=this.dht.registrar.connectionManager.get(t)){e.next=9;break}return e.next=8,this.dht.dialer.connectToPeer(t);case 8:a=e.sent;case 9:return e.next=11,a.newStream(v.PROTOCOL_DHT);case 11:return s=e.sent,o=s.stream,e.abrupt("return",this._writeReadMessage(o,r.serialize()));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isConnected){e.next=2;break}throw u(new Error("Network is offline"),"ERR_NETWORK_OFFLINE");case 2:if(i=t.toB58String(),this._log("sending to: %s",i),a=this.dht.registrar.connectionManager.get(t)){e.next=9;break}return e.next=8,this.dht.dialer.connectToPeer(t);case 8:a=e.sent;case 9:return e.next=11,a.newStream(v.PROTOCOL_DHT);case 11:return s=e.sent,o=s.stream,e.abrupt("return",this._writeMessage(o,r.serialize()));case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_writeReadMessage",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",h(g(t,r),this.readMessageTimeout));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_writeMessage",value:function(e,t){return c([t],f.encode(),e,l)}},{key:"isStarted",get:function(){return this._running}},{key:"isConnected",get:function(){return this.dht.isStarted&&this.isStarted}}]),e}();function g(e,t){return k.apply(this,arguments)}function k(){return(k=i(n.mark((function e(t,r){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c([r],f.encode(),t,f.decode(),function(){var e=i(n.mark((function e(t){var r,i,a,s,u,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,i=!1,e.prev=2,s=o(t);case 4:return e.next=6,s.next();case 6:return u=e.sent,r=u.done,e.next=10,u.value;case 10:if(c=e.sent,r){e.next=17;break}return f=c,e.abrupt("return",f.slice());case 14:r=!0,e.next=4;break;case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(2),i=!0,a=e.t0;case 23:if(e.prev=23,e.prev=24,r||null==s.return){e.next=28;break}return e.next=28,s.return();case 28:if(e.prev=28,!i){e.next=31;break}throw a;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[2,19,23,33],[24,,28,32]])})));return function(t){return e.apply(this,arguments)}}());case 2:if(0!==(a=e.sent).length){e.next=5;break}throw u(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED");case 5:return e.abrupt("return",y.deserialize(a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports=m},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"batch",(function(){return g})),r.d(t,"buffer",(function(){return S})),r.d(t,"collect",(function(){return _})),r.d(t,"concat",(function(){return T})),r.d(t,"consume",(function(){return B})),r.d(t,"filter",(function(){return N})),r.d(t,"flatMap",(function(){return O})),r.d(t,"flatten",(function(){return P})),r.d(t,"flatTransform",(function(){return L})),r.d(t,"fromStream",(function(){return q})),r.d(t,"getIterator",(function(){return k})),r.d(t,"map",(function(){return D})),r.d(t,"merge",(function(){return z})),r.d(t,"parallelFlatMap",(function(){return F})),r.d(t,"parallelMap",(function(){return V})),r.d(t,"parallelMerge",(function(){return H})),r.d(t,"pipeline",(function(){return j})),r.d(t,"reduce",(function(){return Y})),r.d(t,"take",(function(){return J})),r.d(t,"tap",(function(){return X})),r.d(t,"time",(function(){return te})),r.d(t,"transform",(function(){return re})),r.d(t,"writeToStream",(function(){return ae}));var n=r(83),i=r(59),a=r(23),s=r(1),o=r.n(s),u=o.a.mark(m),c=o.a.mark(x),f=o.a.mark(A),h=o.a.mark(W),l=o.a.mark(ee);function p(e){var t="function"===typeof Symbol&&e[Symbol.iterator],r=0;return t?t.call(e):{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}function d(e){return this instanceof d?(this.v=e,this):new d(e)}function v(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof d?Promise.resolve(r.value.v).then(u,c):f(a[0][2],r)}catch(n){f(a[0][3],n)}var r}function u(e){o("next",e)}function c(e){o("throw",e)}function f(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}function y(e){var t,r;return t={},n("next"),n("throw",(function(e){throw e})),n("return"),t[Symbol.iterator]=function(){return this},t;function n(n,i){t[n]=e[n]?function(t){return(r=!r)?{value:d(e[n](t)),done:"return"===n}:i?i(t):t}:i}}function b(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=p(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){(function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)})(n,i,(t=e[r](t)).done,t.value)}))}}}function m(e,t){var r,n,i,a,s,c,f;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=[],n=!0,i=!1,a=void 0,o.prev=4,s=t[Symbol.iterator]();case 6:if(n=(c=s.next()).done){o.next=16;break}if(f=c.value,r.push(f),r.length!==e){o.next=13;break}return o.next=12,r;case 12:r=[];case 13:n=!0,o.next=6;break;case 16:o.next=22;break;case 18:o.prev=18,o.t0=o.catch(4),i=!0,a=o.t0;case 22:o.prev=22,o.prev=23,n||null==s.return||s.return();case 25:if(o.prev=25,!i){o.next=28;break}throw a;case 28:return o.finish(25);case 29:return o.finish(22);case 30:if(!(r.length>0)){o.next=33;break}return o.next=33,r;case 33:case"end":return o.stop()}}),u,null,[[4,18,22,30],[23,,25,29]])}function g(e,t){return void 0===t?function(t){return g(e,t)}:t[Symbol.asyncIterator]?function(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=[],r.prev=1,s=b(t);case 3:return r.next=5,d(s.next());case 5:if((u=r.sent).done){r.next=17;break}if(c=u.value,a.push(c),a.length!==e){r.next=15;break}return r.next=12,d(a);case 12:return r.next=14,r.sent;case 14:a=[];case 15:r.next=3;break;case 17:r.next=22;break;case 19:r.prev=19,r.t0=r.catch(1),n={error:r.t0};case 22:if(r.prev=22,r.prev=23,!u||u.done||!(i=s.return)){r.next=27;break}return r.next=27,d(i.call(s));case 27:if(r.prev=27,!n){r.next=30;break}throw n.error;case 30:return r.finish(27);case 31:return r.finish(22);case 32:if(!(a.length>0)){r.next=37;break}return r.next=35,d(a);case 35:return r.next=37,r.sent;case 37:case"end":return r.stop()}}),r,null,[[1,19,22,32],[23,,27,31]])})))}(e,t):m(e,t)}function k(e){if("function"===typeof e.next)return e;if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function w(){var e,t;return{promise:new Promise((function(r,n){t=r,e=n})),reject:e,resolve:t}}function x(e,t){var r,n,i,a,s,u,f,h,l,p,d;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=[],o.prev=1,i=!0,a=!1,s=void 0,o.prev=5,u=t[Symbol.iterator]();case 7:if(i=(f=u.next()).done){o.next=17;break}if(h=f.value,r.push(h),!(r.length<=e)){o.next=12;break}return o.abrupt("continue",14);case 12:return o.next=14,r.shift();case 14:i=!0,o.next=7;break;case 17:o.next=23;break;case 19:o.prev=19,o.t0=o.catch(5),a=!0,s=o.t0;case 23:o.prev=23,o.prev=24,i||null==u.return||u.return();case 26:if(o.prev=26,!a){o.next=29;break}throw s;case 29:return o.finish(26);case 30:return o.finish(23);case 31:o.next=36;break;case 33:o.prev=33,o.t1=o.catch(1),n=o.t1;case 36:l=0,p=r;case 37:if(!(l<p.length)){o.next=44;break}return d=p[l],o.next=41,d;case 41:l++,o.next=37;break;case 44:if(!n){o.next=46;break}throw n;case 46:case"end":return o.stop()}}),c,null,[[1,33],[5,19,23,31],[24,,26,30]])}function S(e,t){return void 0===t?function(t){return S(e,t)}:t[Symbol.asyncIterator]?function(e,t){var r=k(t),n=[],s=[],u=!1,c=!1;function f(){for(;s.length>0&&n.length>0;){var e=s.shift(),t=n.shift(),r=t.error,i=t.value;r?e.reject(r):e.resolve({done:!1,value:i})}for(;s.length>0&&c;){(0,s.shift().resolve)({done:!0,value:void 0})}}function h(){return l.apply(this,arguments)}function l(){return(l=Object(a.a)(o.a.mark((function t(){var i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=2;break}return t.abrupt("return");case 2:if(!u){t.next=4;break}return t.abrupt("return");case 4:if(!(n.length>=e)){t.next=6;break}return t.abrupt("return");case 6:return u=!0,t.prev=7,t.next=10,r.next();case 10:i=t.sent,a=i.done,s=i.value,a?c=!0:n.push({value:s}),t.next=20;break;case 16:t.prev=16,t.t0=t.catch(7),c=!0,n.push({error:t.t0});case 20:f(),u=!1,h();case 23:case"end":return t.stop()}}),t,null,[[7,16]])})))).apply(this,arguments)}function p(){return(p=Object(a.a)(o.a.mark((function e(){var t,r,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length>0)){e.next=6;break}if(t=n.shift(),r=t.error,i=t.value,!r){e.next=4;break}throw r;case 4:return h(),e.abrupt("return",{done:!1,value:i});case 6:if(!c){e.next=8;break}return e.abrupt("return",{done:!0,value:void 0});case 8:return a=w(),s.push(a),h(),e.abrupt("return",a.promise);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var d=Object(i.a)({next:function(){return p.apply(this,arguments)}},Symbol.asyncIterator,(function(){return d}));return d}(e,t):x(e,t)}function E(){return(E=Object(a.a)(o.a.mark((function e(t){var r,n,i,a,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],e.prev=1,a=b(t);case 3:return e.next=5,a.next();case 5:if((s=e.sent).done){e.next=11;break}u=s.value,i.push(u);case 9:e.next=3;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r={error:e.t0};case 16:if(e.prev=16,e.prev=17,!s||s.done||!(n=a.return)){e.next=21;break}return e.next=21,n.call(a);case 21:if(e.prev=21,!r){e.next=24;break}throw r.error;case 24:return e.finish(21);case 25:return e.finish(16);case 26:return e.abrupt("return",i);case 27:case"end":return e.stop()}}),e,null,[[1,13,16,26],[17,,21,25]])})))).apply(this,arguments)}function _(e){return e[Symbol.asyncIterator]?function(e){return E.apply(this,arguments)}(e):Array.from(e)}function I(e){return v(this,arguments,o.a.mark((function t(){var r,n,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=b(e);case 2:return t.next=4,d(i.next());case 4:if((a=t.sent).done){t.next=14;break}return s=a.value,t.t0=d,t.delegateYield(y(b(s)),"t1",9);case 9:return t.t2=t.t1,t.next=12,(0,t.t0)(t.t2);case 12:t.next=2;break;case 14:t.next=19;break;case 16:t.prev=16,t.t3=t.catch(0),r={error:t.t3};case 19:if(t.prev=19,t.prev=20,!a||a.done||!(n=i.return)){t.next=24;break}return t.next=24,d(n.call(i));case 24:if(t.prev=24,!r){t.next=27;break}throw r.error;case 27:return t.finish(24);case 28:return t.finish(19);case 29:case"end":return t.stop()}}),t,null,[[0,16,19,29],[20,,24,28]])})))}function A(e){var t,r,n,i,a,s;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:t=!0,r=!1,n=void 0,o.prev=3,i=e[Symbol.iterator]();case 5:if(t=(a=i.next()).done){o.next=11;break}return s=a.value,o.delegateYield(s,"t0",8);case 8:t=!0,o.next=5;break;case 11:o.next=17;break;case 13:o.prev=13,o.t1=o.catch(3),r=!0,n=o.t1;case 17:o.prev=17,o.prev=18,t||null==i.return||i.return();case 20:if(o.prev=20,!r){o.next=23;break}throw n;case 23:return o.finish(20);case 24:return o.finish(17);case 25:case"end":return o.stop()}}),f,null,[[3,13,17,25],[18,,20,24]])}function T(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.find((function(e){return void 0!==e[Symbol.asyncIterator]}));return n?I(t):A(t)}function C(){return(C=Object(a.a)(o.a.mark((function e(t){var r,n,i,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,i=b(t);case 2:return e.next=4,i.next();case 4:if((a=e.sent).done){e.next=9;break}a.value;case 7:e.next=2;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r={error:e.t0};case 14:if(e.prev=14,e.prev=15,!a||a.done||!(n=i.return)){e.next=19;break}return e.next=19,n.call(i);case 19:if(e.prev=19,!r){e.next=22;break}throw r.error;case 22:return e.finish(19);case 23:return e.finish(14);case 24:case"end":return e.stop()}}),e,null,[[0,11,14,24],[15,,19,23]])})))).apply(this,arguments)}function B(e){if(e[Symbol.asyncIterator])return function(e){return C.apply(this,arguments)}(e)}function R(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=16;break}return u=s.value,r.next=9,d(e(u));case 9:if(!r.sent){r.next=14;break}return r.next=12,d(u);case 12:return r.next=14,r.sent;case 14:r.next=2;break;case 16:r.next=21;break;case 18:r.prev=18,r.t0=r.catch(0),n={error:r.t0};case 21:if(r.prev=21,r.prev=22,!s||s.done||!(i=a.return)){r.next=26;break}return r.next=26,d(i.call(a));case 26:if(r.prev=26,!n){r.next=29;break}throw n.error;case 29:return r.finish(26);case 30:return r.finish(21);case 31:case"end":return r.stop()}}),r,null,[[0,18,21,31],[22,,26,30]])})))}function N(e,t){return void 0===t?function(t){return R(e,t)}:R(e,t)}function P(e){return v(this,arguments,o.a.mark((function t(){var r,n,i,a,s;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,i=b(e);case 2:return t.next=4,d(i.next());case 4:if((a=t.sent).done){t.next=21;break}if(!(s=a.value)||"string"===typeof s||!s[Symbol.iterator]&&!s[Symbol.asyncIterator]){t.next=15;break}return t.t0=d,t.delegateYield(y(b(P(s))),"t1",10);case 10:return t.t2=t.t1,t.next=13,(0,t.t0)(t.t2);case 13:t.next=19;break;case 15:return t.next=17,d(s);case 17:return t.next=19,t.sent;case 19:t.next=2;break;case 21:t.next=26;break;case 23:t.prev=23,t.t3=t.catch(0),r={error:t.t3};case 26:if(t.prev=26,t.prev=27,!a||a.done||!(n=i.return)){t.next=31;break}return t.next=31,d(n.call(i));case 31:if(t.prev=31,!r){t.next=34;break}throw r.error;case 34:return t.finish(31);case 35:return t.finish(26);case 36:case"end":return t.stop()}}),t,null,[[0,23,26,36],[27,,31,35]])})))}function M(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=17;break}return u=s.value,r.t0=d,r.next=10,d(e(u));case 10:return r.t1=r.sent,r.next=13,(0,r.t0)(r.t1);case 13:return r.next=15,r.sent;case 15:r.next=2;break;case 17:r.next=22;break;case 19:r.prev=19,r.t2=r.catch(0),n={error:r.t2};case 22:if(r.prev=22,r.prev=23,!s||s.done||!(i=a.return)){r.next=27;break}return r.next=27,d(i.call(a));case 27:if(r.prev=27,!n){r.next=30;break}throw n.error;case 30:return r.finish(27);case 31:return r.finish(22);case 32:case"end":return r.stop()}}),r,null,[[0,19,22,32],[23,,27,31]])})))}function D(e,t){return void 0===t?function(t){return M(e,t)}:M(e,t)}function O(e,t){return void 0===t?function(t){return O(e,t)}:N((function(e){return void 0!==e&&null!==e}),P(D(e,t)))}function L(e,t,r){return void 0===t?function(t,r){return r?L(e,t,r):L(e,t)}:void 0===r?function(r){return L(e,t,r)}:N((function(e){return void 0!==e&&null!==e}),P(function(e,t,r){var n=k(r),s=[],u=[],c=!1,f=!1,h=0,l=null;function p(){for(;u.length>0&&s.length>0;){(0,u.shift().resolve)({done:!1,value:s.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;l?(r(l),l=null):t({done:!0,value:void 0})}}function d(){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(o.a.mark((function t(){var r,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return p(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+s.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,p()):y(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,l=t.t0,p();case 24:f=!1,d();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function y(e){return m.apply(this,arguments)}function m(){return(m=Object(a.a)(o.a.mark((function e(r){var n,i,a,u,f,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:if(!(a=e.sent)||!a[Symbol.asyncIterator]){e.next=32;break}e.prev=5,u=b(a);case 7:return e.next=9,u.next();case 9:if((f=e.sent).done){e.next=15;break}v=f.value,s.push(v);case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),n={error:e.t0};case 20:if(e.prev=20,e.prev=21,!f||f.done||!(i=u.return)){e.next=25;break}return e.next=25,i.call(u);case 25:if(e.prev=25,!n){e.next=28;break}throw n.error;case 28:return e.finish(25);case 29:return e.finish(20);case 30:e.next=33;break;case 32:s.push(a);case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(0),c=!0,l=e.t1;case 39:h--,p(),d();case 42:case"end":return e.stop()}}),e,null,[[0,35],[5,17,20,30],[21,,25,29]])})))).apply(this,arguments)}function g(){return(g=Object(a.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==s.length){e.next=5;break}return t=w(),u.push(t),d(),e.abrupt("return",t.promise);case 5:return r=s.shift(),d(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var x=Object(i.a)({next:function(){return g.apply(this,arguments)}},Symbol.asyncIterator,(function(){return x}));return x}(e,t,r)))}function K(e){return U.apply(this,arguments)}function U(){return(U=Object(a.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.once("readable",(function(){e()}))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return"function"===typeof e[Symbol.asyncIterator]?e:function(e){return v(this,arguments,o.a.mark((function t(){var r;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(r=e.read())){t.next=8;break}return t.next=5,d(r);case 5:return t.next=7,t.sent;case 7:return t.abrupt("continue",0);case 8:if(!e._readableState.ended){t.next=12;break}return t.next=11,d(void 0);case 11:return t.abrupt("return",t.sent);case 12:return t.next=14,d(K(e));case 14:t.next=0;break;case 16:case"end":return t.stop()}}),t)})))}(e)}function z(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return v(this,arguments,o.a.mark((function e(){var r,n,i,a,s,u,c,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Set(t.map(k));case 1:if(!(r.size>0)){e.next=39;break}n=!0,i=!1,a=void 0,e.prev=5,s=r[Symbol.iterator]();case 7:if(n=(u=s.next()).done){e.next=23;break}return c=u.value,e.next=11,d(c.next());case 11:if(!(f=e.sent).done){e.next=16;break}r.delete(c),e.next=20;break;case 16:return e.next=18,d(f.value);case 18:return e.next=20,e.sent;case 20:n=!0,e.next=7;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(5),i=!0,a=e.t0;case 29:e.prev=29,e.prev=30,n||null==s.return||s.return();case 32:if(e.prev=32,!i){e.next=35;break}throw a;case 35:return e.finish(32);case 36:return e.finish(29);case 37:e.next=1;break;case 39:case"end":return e.stop()}}),e,null,[[5,25,29,37],[30,,32,36]])})))}function j(e){for(var t=e(),r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0,s=n;a<s.length;a++){var o=s[a];t=o(t)}return t}function V(e,t,r){return void 0===t?function(t,r){return V(e,t,r)}:void 0===r?function(r){return V(e,t,r)}:function(e,t,r){return v(this,arguments,o.a.mark((function n(){var i,a,s,u,c,f,h,l;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=null,a=function(e){return{value:t(e)}},s=function(e){return v(this,arguments,o.a.mark((function t(){var r,n,a,s,u;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,a=b(e);case 2:return t.next=4,d(a.next());case 4:if((s=t.sent).done){t.next=17;break}if(u=s.value,!i){t.next=11;break}return t.next=10,d(void 0);case 10:return t.abrupt("return",t.sent);case 11:return t.next=13,d(u);case 13:return t.next=15,t.sent;case 15:t.next=2;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),r={error:t.t0};case 22:if(t.prev=22,t.prev=23,!s||s.done||!(n=a.return)){t.next=27;break}return t.next=27,d(n.call(a));case 27:if(t.prev=27,!r){t.next=30;break}throw r.error;case 30:return t.finish(27);case 31:return t.finish(22);case 32:case"end":return t.stop()}}),t,null,[[0,19,22,32],[23,,27,31]])})))},u=j((function(){return r}),S(1),s,D(a),S(e)),c=k(u);case 5:return n.next=8,d(c.next());case 8:if(f=n.sent,h=f.value,!f.done){n.next=13;break}return n.abrupt("break",29);case 13:return n.prev=13,n.next=16,d(h.value);case 16:if(l=n.sent,i){n.next=22;break}return n.next=20,d(l);case 20:return n.next=22,n.sent;case 22:n.next=27;break;case 24:n.prev=24,n.t0=n.catch(13),i=n.t0;case 27:n.next=5;break;case 29:if(!i){n.next=31;break}throw i;case 31:case"end":return n.stop()}}),n,null,[[13,24]])})))}(e,t,r)}function F(e,t,r){return void 0===t?function(t,r){return r?F(e,t,r):F(e,t)}:void 0===r?function(r){return F(e,t,r)}:N((function(e){return void 0!==e&&null!==e}),P(V(e,t,r)))}function H(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return v(this,arguments,o.a.mark((function e(){var r,i,s,u,c,f,h,l,p,v,y,b,m,g,w,x,S,E,_,I,A,T,C,B;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=t.map(k),i=new Set,s=new Map,u=null,c=null,f=null,h=function(e){u=e,c&&c(e)},l=function(e){f&&f(e)},p=function(){return new Promise((function(e,t){if(u&&t(u),s.size>0)return e();f=e,c=t}))},v=function(e){var t=Promise.resolve(e.next()).then(function(){var r=Object(a.a)(o.a.mark((function r(n){var a,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=n.done,u=n.value,a||s.set(e,u),i.delete(t);case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}());i.add(t),t.then(l,h)},y=!0,b=!1,m=void 0,e.prev=13,g=r[Symbol.iterator]();!(y=(w=g.next()).done);y=!0)x=w.value,v(x);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),b=!0,m=e.t0;case 21:e.prev=21,e.prev=22,y||null==g.return||g.return();case 24:if(e.prev=24,!b){e.next=27;break}throw m;case 27:return e.finish(24);case 28:return e.finish(21);case 29:if(0!==i.size||0!==s.size){e.next=34;break}return e.next=33,d(void 0);case 33:return e.abrupt("return",e.sent);case 34:return e.next=36,d(p());case 36:S=!0,E=!1,_=void 0,e.prev=39,I=s[Symbol.iterator]();case 41:if(S=(A=I.next()).done){e.next=52;break}return T=Object(n.a)(A.value,2),C=T[0],B=T[1],s.delete(C),e.next=46,d(B);case 46:return e.next=48,e.sent;case 48:v(C);case 49:S=!0,e.next=41;break;case 52:e.next=58;break;case 54:e.prev=54,e.t1=e.catch(39),E=!0,_=e.t1;case 58:e.prev=58,e.prev=59,S||null==I.return||I.return();case 61:if(e.prev=61,!E){e.next=64;break}throw _;case 64:return e.finish(61);case 65:return e.finish(58);case 66:e.next=29;break;case 68:case"end":return e.stop()}}),e,null,[[13,17,21,29],[22,,24,28],[39,54,58,66],[59,,61,65]])})))}function G(){return(G=Object(a.a)(o.a.mark((function e(t,r,n){var i,a,s,u,c,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=r,e.prev=1,u=b(n);case 3:return e.next=5,u.next();case 5:if((c=e.sent).done){e.next=13;break}return f=c.value,e.next=10,t(s,f);case 10:s=e.sent;case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),i={error:e.t0};case 18:if(e.prev=18,e.prev=19,!c||c.done||!(a=u.return)){e.next=23;break}return e.next=23,a.call(u);case 23:if(e.prev=23,!i){e.next=26;break}throw i.error;case 26:return e.finish(23);case 27:return e.finish(18);case 28:return e.abrupt("return",s);case 29:case"end":return e.stop()}}),e,null,[[1,15,18,28],[19,,23,27]])})))).apply(this,arguments)}function Y(e,t,r){return void 0===t?function(t,r){return r?Y(e,t,r):Y(e,t)}:void 0===r?function(r){return Y(e,t,r)}:function(e,t,r){return G.apply(this,arguments)}(e,t,r)}function W(e,t){var r,n,i,a,s,u,c;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:r=0,n=!0,i=!1,a=void 0,o.prev=4,s=t[Symbol.iterator]();case 6:if(n=(u=s.next()).done){o.next=16;break}return c=u.value,o.next=10,c;case 10:if(!(++r>=e)){o.next=13;break}return o.abrupt("return");case 13:n=!0,o.next=6;break;case 16:o.next=22;break;case 18:o.prev=18,o.t0=o.catch(4),i=!0,a=o.t0;case 22:o.prev=22,o.prev=23,n||null==s.return||s.return();case 25:if(o.prev=25,!i){o.next=28;break}throw a;case 28:return o.finish(25);case 29:return o.finish(22);case 30:case"end":return o.stop()}}),h,null,[[4,18,22,30],[23,,25,29]])}function J(e,t){return void 0===t?function(t){return J(e,t)}:t[Symbol.asyncIterator]?function(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u,c;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=0,r.prev=1,s=b(t);case 3:return r.next=5,d(s.next());case 5:if((u=r.sent).done){r.next=23;break}return c=u.value,r.t0=d,r.next=11,d(c);case 11:return r.t1=r.sent,r.next=14,(0,r.t0)(r.t1);case 14:return r.next=16,r.sent;case 16:if(!(++a>=e)){r.next=21;break}return r.next=20,d(void 0);case 20:return r.abrupt("return",r.sent);case 21:r.next=3;break;case 23:r.next=28;break;case 25:r.prev=25,r.t2=r.catch(1),n={error:r.t2};case 28:if(r.prev=28,r.prev=29,!u||u.done||!(i=s.return)){r.next=33;break}return r.next=33,d(i.call(s));case 33:if(r.prev=33,!n){r.next=36;break}throw n.error;case 36:return r.finish(33);case 37:return r.finish(28);case 38:case"end":return r.stop()}}),r,null,[[1,25,28,38],[29,,33,37]])})))}(e,t):W(e,t)}function Q(e,t){return v(this,arguments,o.a.mark((function r(){var n,i,a,s,u;return o.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,a=b(t);case 2:return r.next=4,d(a.next());case 4:if((s=r.sent).done){r.next=15;break}return u=s.value,r.next=9,d(e(u));case 9:return r.next=11,d(u);case 11:return r.next=13,r.sent;case 13:r.next=2;break;case 15:r.next=20;break;case 17:r.prev=17,r.t0=r.catch(0),n={error:r.t0};case 20:if(r.prev=20,r.prev=21,!s||s.done||!(i=a.return)){r.next=25;break}return r.next=25,d(i.call(a));case 25:if(r.prev=25,!n){r.next=28;break}throw n.error;case 28:return r.finish(25);case 29:return r.finish(20);case 30:case"end":return r.stop()}}),r,null,[[0,17,20,30],[21,,25,29]])})))}function X(e,t){return void 0===t?function(t){return Q(e,t)}:Q(e,t)}function Z(e,t){var r=e[0]+t[0],n=e[1]+t[1];if(n>=1e9){var i=n%1e9;r+=(n-i)/1e9,n=i}return[r,n]}function $(t,r){return v(this,arguments,o.a.mark((function n(){var i,a,s,u,c,f,h;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:i=r[Symbol.asyncIterator](),a=[0,0];case 2:return s=e.hrtime(),n.next=6,d(i.next());case 6:if(u=n.sent,c=u.value,f=u.done,h=e.hrtime(s),a=Z(a,h),t.progress&&t.progress(h,a),!f){n.next=17;break}return t.total&&t.total(a),n.next=16,d(c);case 16:return n.abrupt("return",n.sent);case 17:return n.next=19,d(c);case 19:return n.next=21,n.sent;case 21:n.next=2;break;case 23:case"end":return n.stop()}}),n)})))}function ee(t,r){var n,i,a,s,u,c,f;return o.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=r[Symbol.iterator](),i=[0,0];case 2:if(a=e.hrtime(),s=n.next(),u=s.value,c=s.done,f=e.hrtime(a),i=Z(i,f),t.progress&&t.progress(f,i),!c){o.next=11;break}return t.total&&t.total(i),o.abrupt("return",u);case 11:return o.next=13,u;case 13:o.next=2;break;case 15:case"end":return o.stop()}}),l)}function te(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return void 0===t?function(t){return te(e,t)}:void 0!==t[Symbol.asyncIterator]?$(e,t):ee(e,t)}function re(e,t,r){return void 0===t?function(t,r){return r?re(e,t,r):re(e,t)}:void 0===r?function(r){return re(e,t,r)}:function(e,t,r){var n=k(r),s=[],u=[],c=!1,f=!1,h=0,l=null;function p(){for(;u.length>0&&s.length>0;){(0,u.shift().resolve)({done:!1,value:s.shift()})}for(;u.length>0&&0===h&&c;){var e=u.shift(),t=e.resolve,r=e.reject;l?(r(l),l=null):t({done:!0,value:void 0})}}function d(){return v.apply(this,arguments)}function v(){return(v=Object(a.a)(o.a.mark((function t(){var r,i,a;return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!c){t.next=3;break}return p(),t.abrupt("return");case 3:if(!f){t.next=5;break}return t.abrupt("return");case 5:if(!(h+s.length>=e)){t.next=7;break}return t.abrupt("return");case 7:return f=!0,h++,t.prev=9,t.next=12,n.next();case 12:r=t.sent,i=r.done,a=r.value,i?(c=!0,h--,p()):y(a),t.next=24;break;case 18:t.prev=18,t.t0=t.catch(9),c=!0,h--,l=t.t0,p();case 24:f=!1,d();case 26:case"end":return t.stop()}}),t,null,[[9,18]])})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=Object(a.a)(o.a.mark((function e(r){var n;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(r);case 3:n=e.sent,s.push(n),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),c=!0,l=e.t0;case 11:h--,p(),d();case 14:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function m(){return(m=Object(a.a)(o.a.mark((function e(){var t,r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==s.length){e.next=5;break}return t=w(),u.push(t),d(),e.abrupt("return",t.promise);case 5:return r=s.shift(),d(),e.abrupt("return",{done:!1,value:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=Object(i.a)({next:function(){return m.apply(this,arguments)}},Symbol.asyncIterator,(function(){return g}));return g}(e,t,r)}function ne(e,t){return ie.apply(this,arguments)}function ie(){return(ie=Object(a.a)(o.a.mark((function e(t,r){var n,i,a,s,u,c,f,h,l,p,d,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=null,s=null,u=null,c=function(e){a=e,s&&s(e)},f=function(){u&&u()},h=function(){t.removeListener("error",c),t.removeListener("drain",f)},t.once("error",c),l=function(){return new Promise((function(e,r){if(a)return r(a);t.once("drain",f),u=e,s=r}))},e.prev=8,p=b(r);case 10:return e.next=12,p.next();case 12:if((d=e.sent).done){e.next=22;break}if(v=d.value,!1!==t.write(v)){e.next=18;break}return e.next=18,l();case 18:if(!a){e.next=20;break}return e.abrupt("break",22);case 20:e.next=10;break;case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(8),n={error:e.t0};case 27:if(e.prev=27,e.prev=28,!d||d.done||!(i=p.return)){e.next=32;break}return e.next=32,i.call(p);case 32:if(e.prev=32,!n){e.next=35;break}throw n.error;case 35:return e.finish(32);case 36:return e.finish(27);case 37:if(h(),!a){e.next=40;break}throw a;case 40:case"end":return e.stop()}}),e,null,[[8,24,27,37],[28,,32,36]])})))).apply(this,arguments)}function ae(e,t){return void 0===t?function(t){return ne(e,t)}:ne(e,t)}void 0===Symbol.asyncIterator&&(Symbol.asyncIterator=Symbol.for("asyncIterator"))}.call(this,r(37))},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(18),u=r(78),c=r(100),f=r(1958),h=r(2357),l=r(1953);e.exports=function(e){var t=l.logger(e.peerId,"rpc"),r=h(e);function p(e,t){return d.apply(this,arguments)}function d(){return(d=i(n.mark((function i(a,s){var o;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=r(s.type),n.prev=1,n.next=4,e._add(a);case 4:n.next=9;break;case 6:n.prev=6,n.t0=n.catch(1),t.error("Failed to update the kbucket store",n.t0);case 9:if(o){n.next=12;break}return t.error("no handler found for message type: ".concat(s.type)),n.abrupt("return");case 12:return n.abrupt("return",o(a,s));case 13:case"end":return n.stop()}}),i,null,[[1,6]])})))).apply(this,arguments)}return(function(){var r=i(n.mark((function r(i){var h,l,d,v;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h=i.stream,l=i.connection,d=l.remotePeer,r.prev=2,r.next=5,e._add(d);case 5:r.next=10;break;case 7:r.prev=7,r.t0=r.catch(2),t.error(r.t0);case 10:return v=d.toB58String(),t("from: %s",v),r.next=14,u(h.source,c.decode(),(function(e){return s(n.mark((function t(){var r,i,s,u,c,h,l,v,y;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=!0,i=!1,t.prev=2,u=o(e);case 4:return t.next=6,a(u.next());case 6:return c=t.sent,r=c.done,t.next=10,a(c.value);case 10:if(h=t.sent,r){t.next=23;break}return l=h,v=f.deserialize(l.slice()),t.next=16,a(p(d,v));case 16:if(!(y=t.sent)){t.next=20;break}return t.next=20,y.serialize();case 20:r=!0,t.next=4;break;case 23:t.next=29;break;case 25:t.prev=25,t.t0=t.catch(2),i=!0,s=t.t0;case 29:if(t.prev=29,t.prev=30,r||null==u.return){t.next=34;break}return t.next=34,a(u.return());case 34:if(t.prev=34,!i){t.next=37;break}throw s;case 37:return t.finish(34);case 38:return t.finish(29);case 39:case"end":return t.stop()}}),t,null,[[2,25,29,39],[30,,34,38]])})))()}),c.encode(),h.sink);case 14:case"end":return r.stop()}}),r,null,[[2,7]])})));return function(e){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";e.exports='// can\'t use, because protocol-buffers doesn\'t support imports\n// so we have to duplicate for now :(\n// import "record.proto";\n\nmessage Record {\n  // adjusted for javascript\n  optional bytes key = 1;\n  optional bytes value = 2;\n  optional bytes author = 3;\n  optional bytes signature = 4;\n  optional string timeReceived = 5;\n}\n\nmessage Message {\n  enum MessageType {\n    PUT_VALUE = 0;\n    GET_VALUE = 1;\n    ADD_PROVIDER = 2;\n    GET_PROVIDERS = 3;\n    FIND_NODE = 4;\n    PING = 5;\n  }\n\n  enum ConnectionType {\n    // sender does not have a connection to peer, and no extra information (default)\n    NOT_CONNECTED = 0;\n\n    // sender has a live connection to peer\n    CONNECTED = 1;\n\n    // sender recently connected to peer\n    CAN_CONNECT = 2;\n\n    // sender recently tried to connect to peer repeatedly but failed to connect\n    // ("try" here is loose, but this should signal "made strong effort, failed")\n    CANNOT_CONNECT = 3;\n  }\n\n  message Peer {\n    // ID of a given peer.\n    optional bytes id = 1;\n\n    // multiaddrs for a given peer\n    repeated bytes addrs = 2;\n\n    // used to signal the sender\'s connection capabilities to the peer\n    optional ConnectionType connection = 3;\n  }\n\n  // defines what type of message it is.\n  optional MessageType type = 1;\n\n  // defines what coral cluster level this query/response belongs to.\n  // in case we want to implement coral\'s cluster rings in the future.\n  optional int32 clusterLevelRaw = 10;\n\n  // Used to specify the key associated with this message.\n  // PUT_VALUE, GET_VALUE, ADD_PROVIDER, GET_PROVIDERS\n  // adjusted for javascript\n  optional bytes key = 2;\n\n  // Used to return a value\n  // PUT_VALUE, GET_VALUE\n  // adjusted Record to bytes for js\n  optional bytes record = 3;\n\n  // Used to return peers closer to a key in a query\n  // GET_VALUE, GET_PROVIDERS, FIND_NODE\n  repeated Peer closerPeers = 8;\n\n  // Used to return Providers\n  // GET_VALUE, ADD_PROVIDER, GET_PROVIDERS\n  repeated Peer providerPeers = 9;\n}'},function(e,t,r){"use strict";var n=r(50),i=r(1958).TYPES;e.exports=function(e){var t,a=(n(t={},i.GET_VALUE,r(2358)(e)),n(t,i.PUT_VALUE,r(2359)(e)),n(t,i.FIND_NODE,r(2360)(e)),n(t,i.ADD_PROVIDER,r(2361)(e)),n(t,i.GET_PROVIDERS,r(2362)(e)),n(t,i.PING,r(2363)(e)),t);return function(e){return a[e]}}},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(191).Record,o=r(15),u=r(1958),c=r(1953);e.exports=function(e){var t=c.logger(e.peerId,"rpc:get-value");return(function(){var r=a(n.mark((function r(a,f){var h,l,p,d,v,y,b,m,g;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(h=f.key,t("key: %b",h),h&&0!==h.length){r.next=4;break}throw o(new Error("Invalid key"),"ERR_INVALID_KEY");case 4:if(l=new u(u.TYPES.GET_VALUE,h,f.clusterLevel),!c.isPublicKeyKey(h)){r.next=13;break}if(t("is public key"),p=c.fromPublicKeyKey(h),e._isSelf(p)?d=e.peerId:(v=e.peerStore.get(p),d=v&&v.id),!d||!d.pubKey){r.next=13;break}return t("returning found public key"),l.record=new s(h,d.pubKey.bytes),r.abrupt("return",l);case 13:return r.next=15,Promise.all([e._checkLocalDatastore(h),e._betterPeersToQuery(f,a)]);case 15:return y=r.sent,b=i(y,2),m=b[0],g=b[1],m&&(t("got record"),l.record=m),g.length>0&&(t("got closer %s",g.length),l.closerPeers=g),r.abrupt("return",l);case 22:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1953),s=r(15);e.exports=function(e){var t=a.logger(e.peerId,"rpc:put-value");return(function(){var r=i(n.mark((function r(i,o){var u,c,f,h;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=o.key,t("key: %b",u),c=o.record){r.next=7;break}throw f="Empty record from: ".concat(i.toB58String()),t.error(f),s(new Error(f),"ERR_EMPTY_RECORD");case 7:return r.next=9,e._verifyRecordLocally(c);case 9:return c.timeReceived=new Date,h=a.bufferToKey(c.key),r.next=13,e.datastore.put(h,c.serialize());case 13:return r.abrupt("return",o);case 14:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(1958),o=r(1953);e.exports=function(e){var t=o.logger(e.peerId,"rpc:find-node");return(function(){var r=i(n.mark((function r(i,o){var u,c;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t("start"),!o.key.equals(e.peerId.id)){r.next=5;break}u=[{id:e.peerId}],r.next=8;break;case 5:return r.next=7,e._betterPeersToQuery(o,i);case 7:u=r.sent;case 8:return c=new s(o.type,a.alloc(0),o.clusterLevel),u.length>0?c.closerPeers=u:t("handle FindNode %s: could not find anything",i.toB58String()),r.abrupt("return",c);case 11:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(32),s=r(15),o=r(1953);e.exports=function(e){var t=o.logger(e.peerId,"rpc:add-provider");return(function(){var r=i(n.mark((function r(i,o){var u,c;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t("start"),o.key&&0!==o.key.length){r.next=3;break}throw s(new Error("Missing key"),"ERR_MISSING_KEY");case 3:r.prev=3,u=new a(o.key),r.next=11;break;case 7:throw r.prev=7,r.t0=r.catch(3),c="Invalid CID: ".concat(r.t0.message),s(new Error(c),"ERR_INVALID_CID");case 11:return o.providerPeers.forEach((function(r){if(r.id.isEqual(i)){if(!(r.multiaddrs.length<1))return t("received provider %s for %s (addrs %s)",i.toB58String(),u.toBaseEncodedString(),r.multiaddrs.map((function(e){return e.toString()}))),e._isSelf(r.id)?void 0:(e.peerStore.addressBook.add(r.id,r.multiaddrs),e.providers.addProvider(u,r.id));t("no valid addresses for provider %s. Ignore",i.toB58String())}else t("invalid provider peer %s from %s",r.id.toB58String(),i.toB58String())})),r.abrupt("return",e.providers.addProvider(u,i));case 13:case"end":return r.stop()}}),r,null,[[3,7]])})));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(32),o=r(15),u=r(1958),c=r(1953);e.exports=function(e){var t=c.logger(e.peerId,"rpc:get-providers");return(function(){var r=a(n.mark((function r(a,f){var h,l,p,d,v,y,b,m,g,k;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.prev=0,h=new s(f.key),r.next=7;break;case 4:throw r.prev=4,r.t0=r.catch(0),o(new Error("Invalid CID: ".concat(r.t0.message)),"ERR_INVALID_CID");case 7:return t("%s",h.toBaseEncodedString()),l=c.bufferToKey(h.buffer),r.next=11,Promise.all([e.datastore.has(l),e.providers.getProviders(h),e._betterPeersToQuery(f,a)]);case 11:return p=r.sent,d=i(p,3),v=d[0],y=d[1],b=d[2],m=y.map((function(e){return{id:e}})),g=b.map((function(e){return{id:e.id}})),v&&m.push({id:e.peerId}),k=new u(f.type,f.key,f.clusterLevel),m.length>0&&(k.providerPeers=m),g.length>0&&(k.closerPeers=g),t("got %s providers %s closerPeers",m.length,g.length),r.abrupt("return",k);case 24:case"end":return r.stop()}}),r,null,[[0,4]])})));return function(e,t){return r.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1953);e.exports=function(e){var t=n.logger(e.peerId,"rpc:ping");return function(e,r){return t("from %s",e.toB58String()),r}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(15),s=r(170),o=r(191),u=r(1965),c=r(2037),f=r(1953),h=o.Record;e.exports=function(e){var t=function(){var t=i(n.mark((function t(r,i){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.datastore.put(f.bufferToKey(r),i));case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),r=function(){var t=i(n.mark((function t(r){var i,a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._log("getLocal %b",r),t.next=3,e.datastore.get(f.bufferToKey(r));case 3:return i=t.sent,e._log("found %b in local datastore",r),a=h.deserialize(i),t.next=8,e._verifyRecordLocally(a);case 8:return t.abrupt("return",a);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var t=i(n.mark((function t(r,a,s){var o;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.createPutRecord(r,s);case 2:return o=t.sent,t.abrupt("return",Promise.all(a.map(function(){var t=i(n.mark((function t(i){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!i.val.equals(s)){t.next=2;break}return t.abrupt("return");case 2:if(!e._isSelf(i.from)){t.next=12;break}return t.prev=3,t.next=6,e._putLocal(r,o);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(3),e._log.error("Failed error correcting self",t.t0);case 11:return t.abrupt("return");case 12:return t.prev=12,t.next=15,e._putValueToPeer(r,o,i.from);case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(12),e._log.error("Failed error correcting entry",t.t1);case 20:case"end":return t.stop()}}),t,null,[[3,8],[12,17]])})));return function(e){return t.apply(this,arguments)}}())));case 4:case"end":return t.stop()}}),t)})));return function(e,r,n){return t.apply(this,arguments)}}();return{_putLocal:function(e,r){return i(n.mark((function i(){return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t(e,r));case 1:case"end":return n.stop()}}),i)})))()},put:function(r,s){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n.mark((function u(){var c,h,l,p,d;return n.wrap((function(u){for(;;)switch(u.prev=u.next){case 0:return e._log("PutValue %b",r),u.next=3,f.createPutRecord(r,s);case 3:return c=u.sent,u.next=6,t(r,c);case 6:return h=0,l=0,u.next=10,f.mapParallel(e.getClosestPeers(r,{shallow:!0}),function(){var t=i(n.mark((function t(i){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,h+=1,t.next=4,e._putValueToPeer(r,c,i);case 4:l+=1,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),e._log.error("Failed to put to peer (%b): %s",i.id,t.t0);case 10:case"end":return t.stop()}}),t,null,[[0,7]])})));return function(e){return t.apply(this,arguments)}}());case 10:if(!((p=o.minPeers||h)>l)){u.next=15;break}throw d=a(new Error("Failed to put value to enough peers: ".concat(l,"/").concat(p)),"ERR_NOT_ENOUGH_PUT_PEERS"),e._log.error(d),d;case 15:case"end":return u.stop()}}),u)})))()},get:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(n.mark((function i(){var s,c,f,h;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.timeout=r.timeout||u.minute,e._log("_get %b",t),n.next=4,e.getMany(t,u.GET_MANY_RECORD_COUNT,r);case 4:s=n.sent,c=s.map((function(e){return e.val})),f=0,n.prev=7,f=o.selection.bestRecord(e.selectors,t,c),n.next=15;break;case 11:if(n.prev=11,n.t0=n.catch(7),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"===n.t0.code){n.next=15;break}throw n.t0;case 15:if(h=c[f],e._log("GetValue %b %s",t,h),h){n.next=19;break}throw a(new Error("best value was not found"),"ERR_NOT_FOUND");case 19:return n.next=21,l(t,s,h);case 21:return n.abrupt("return",h);case 22:case"end":return n.stop()}}),i,null,[[7,11]])})))()},getMany:function(t,o){var h=this,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i(n.mark((function p(){var d,v,y,b,m,g,k,w;return n.wrap((function(p){for(;;)switch(p.prev=p.next){case 0:return l.timeout=l.timeout||u.minute,e._log("getMany %b (%s)",t,o),d=[],p.prev=3,p.next=6,r(t);case 6:v=p.sent,p.next=13;break;case 9:if(p.prev=9,p.t0=p.catch(3),0!==o){p.next=13;break}throw p.t0;case 13:if(v&&d.push({val:v.value,from:e.peerId}),!(d.length>=o)){p.next=16;break}return p.abrupt("return",d);case 16:return y=[],p.next=19,f.convertBuffer(t);case 19:if(b=p.sent,m=e.routingTable.closestPeers(b,h.kBucketSize),e._log("peers in rt: %d",m.length),0!==m.length){p.next=28;break}if(g="Failed to lookup key! No peers from routing table!",e._log.error(g),0!==d.length){p.next=27;break}throw a(new Error(g),"ERR_NO_PEERS_IN_ROUTING_TABLE");case 27:return p.abrupt("return",d);case 28:return k=new c(e,t,(function(r,a){var s=f.pathSize(o-d.length,a),u=[];return y.push(u),function(){var r=i(n.mark((function r(i){var a,o,c,f,h;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e._getValueOrPeers(i,t);case 3:f=r.sent,a=f.record,o=f.peers,r.next=13;break;case 8:if(r.prev=8,r.t0=r.catch(0),"ERR_INVALID_RECORD"===r.t0.code){r.next=12;break}throw r.t0;case 12:c=r.t0;case 13:return h={closerPeers:o},(a&&a.value||c)&&u.push({val:a&&a.value,from:i}),u.length>=s&&(h.pathComplete=!0),r.abrupt("return",h);case 17:case"end":return r.stop()}}),r,null,[[0,8]])})));return function(e){return r.apply(this,arguments)}}()})),p.prev=29,p.next=32,s(k.run(m),l.timeout);case 32:p.next=37;break;case 34:p.prev=34,p.t1=p.catch(29),w=p.t1;case 37:if(k.stop(),d=[].concat.apply(d,y).slice(0,o),!w||0!==d.length){p.next=41;break}throw w;case 41:return p.abrupt("return",d);case 42:case"end":return p.stop()}}),p,null,[[3,9],[29,34]])})))()}}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(28),u=r(27),c=r(29),f=r(2366),h=r(41),l=r(2367),p=r(2369),d=r(1953),v=function(e){function t(e){var r;return a(this,t),(r=o(this,u(t).call(this))).query=e,r.running=!1,r.workers=[],r.peersSeen=new Set,r.errors=[],r.peersQueried=null,r}return c(t,e),s(t,[{key:"stop",value:function(){if(this.running){this.running=!1;var e=!0,t=!1,r=void 0;try{for(var n,i=this.workers[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.stop()}}catch(a){t=!0,r=a}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}}},{key:"execute",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,o,u,c;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],i=Math.min(this.query.dht.disjointPaths,t.length),a=0;a<i;a++)r.push(new l(this,this.query.makePath(a,i)));return t.forEach((function(e,t){r[t%i].addInitialPeer(e)})),e.next=6,this.executePaths(r);case 6:for(s={finalSet:new Set(this.peersQueried.peers),paths:[]},o=0,u=r;o<u.length;o++)(c=u[o]).res&&(c.res.pathComplete||c.res.queryComplete)&&(c.res.success=!0,s.paths.push(c.res));return e.abrupt("return",s);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"executePaths",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.running=!0,this.emit("start"),e.prev=2,e.next=5,Promise.all(t.map((function(e){return e.execute()})));case 5:return e.prev=5,this.stop(),this.emit("complete"),e.finish(5);case 9:if(this.errors.length!==this.peersSeen.size){e.next=11;break}throw this.errors[0];case 11:case"end":return e.stop()}}),e,this,[[2,,5,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"workerQueue",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this.startWorker(t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"startWorker",value:function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new p(this.query.dht,this,t,this.query._log),this.workers.push(r),e.next=4,r.execute();case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"init",value:function(){var e=i(n.mark((function e(){var t=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.peersQueried){e.next=2;break}return e.abrupt("return");case 2:if(!this.peersQueriedPromise){e.next=6;break}return e.next=5,this.peersQueriedPromise;case 5:return e.abrupt("return");case 6:return this.peersQueriedPromise=i(n.mark((function e(){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.convertBuffer(t.query.key);case 2:r=e.sent,t.peersQueried=new f(r,t.query.dht.kBucketSize);case 4:case"end":return e.stop()}}),e)})))(),e.next=9,this.peersQueriedPromise;case 9:delete this.peersQueriedPromise;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"continueQuerying",value:function(){var e=i(n.mark((function e(t){var r;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.peersQueried.length<this.peersQueried.capacity)){e.next=2;break}return e.abrupt("return",!0);case 2:return r=t.queue.workersList().map((function(e){return e.data})),e.next=5,this.peersQueried.anyCloser(r);case 5:if(!e.sent){e.next=8;break}return e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(h);e.exports=v},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(336),u=r(1953),c=r(2090),f=function(){function e(t,r){a(this,e),this.originDhtKey=t,this.capacity=r,this.peerDistances=[]}return s(e,[{key:"add",value:function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.peerDistances.find((function(e){return e.peerId.id.equals(t.id)}))){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,u.convertPeerId(t);case 4:r=e.sent,i={peerId:t,distance:o(this.originDhtKey,r)},this.peerDistances.push(i),this.peerDistances.sort((function(e,t){return o.compare(e.distance,t.distance)})),this.peerDistances=this.peerDistances.slice(0,this.capacity);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"anyCloser",value:function(){var e=i(n.mark((function e(t){var r,i,a,s,f,h,l,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.length){e.next=2;break}return e.abrupt("return",!1);case 2:if(this.length){e.next=4;break}return e.abrupt("return",!0);case 4:return e.next=6,c(t,(function(e){return u.convertPeerId(e)}));case 6:r=e.sent,i=this.peerDistances[this.peerDistances.length-1].distance,a=!0,s=!1,f=void 0,e.prev=11,h=r[Symbol.iterator]();case 13:if(a=(l=h.next()).done){e.next=21;break}if(p=l.value,d=o(this.originDhtKey,p),!(o.compare(d,i)<0)){e.next=18;break}return e.abrupt("return",!0);case 18:a=!0,e.next=13;break;case 21:e.next=27;break;case 23:e.prev=23,e.t0=e.catch(11),s=!0,f=e.t0;case 27:e.prev=27,e.prev=28,a||null==h.return||h.return();case 30:if(e.prev=30,!s){e.next=33;break}throw f;case 33:return e.finish(30);case 34:return e.finish(27);case 35:return e.abrupt("return",!1);case 36:case"end":return e.stop()}}),e,this,[[11,23,27,35],[28,,30,34]])})));return function(t){return e.apply(this,arguments)}}()},{key:"length",get:function(){return this.peerDistances.length}},{key:"peers",get:function(){return this.peerDistances.map((function(e){return e.peerId}))}}]),e}();e.exports=f},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(2368),u=r(1953),c=function(){function e(t,r){if(a(this,e),this.run=t,this.queryFunc=u.withTimeout(r,3e4),!this.queryFunc)throw new Error("Path requires a `queryFn` to be specified");if("function"!==typeof this.queryFunc)throw new Error("Path expected `queryFn` to be a function. Got "+typeof this.queryFunc);this.initialPeers=[],this.peersToQuery=null}return s(e,[{key:"addInitialPeer",value:function(e){this.initialPeers.push(e)}},{key:"execute",value:function(){var e=i(n.mark((function e(){var t,r=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.fromKey(this.run.query.key);case 2:return t=e.sent,this.peersToQuery=t,e.next=6,Promise.all(this.initialPeers.map((function(e){return r.addPeerToQuery(e)})));case 6:return e.next=8,this.run.workerQueue(this);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addPeerToQuery",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.run.query.dht._isSelf(t)){e.next=2;break}return e.abrupt("return");case 2:if(!this.run.peersSeen.has(t.toB58String())){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.peersToQuery.enqueue(t);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(822),u=r(336),c=r(19),f=r(1953),h=c("libp2p:dht:peer-queue"),l=function(){function e(t){a(this,e),h("create: %b",t),this.from=t,this.heap=new o(f.xorCompare)}return s(e,null,[{key:"fromPeerId",value:function(){var t=i(n.mark((function t(r){var i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.convertPeerId(r);case 2:return i=t.sent,t.abrupt("return",new e(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},{key:"fromKey",value:function(){var t=i(n.mark((function t(r){var i;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,f.convertBuffer(r);case 2:return i=t.sent,t.abrupt("return",new e(i));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),s(e,[{key:"enqueue",value:function(){var e=i(n.mark((function e(t){var r,i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h("enqueue %s",t.toB58String()),e.next=3,f.convertPeerId(t);case 3:r=e.sent,i={id:t,distance:u(this.from,r)},this.heap.push(i);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"dequeue",value:function(){var e=this.heap.pop();return h("dequeue %s",e.id.toB58String()),e.id}},{key:"length",get:function(){return this.heap.size()}}]),e}();e.exports=l},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(823),u=r(824),c=function(){function e(t,r,n,i){a(this,e),this.dht=t,this.run=r,this.path=n,this.log=i,this.concurrency=this.dht.concurrency,this.queue=this.setupQueue(),this.execution=null}return s(e,[{key:"setupQueue",value:function(){var e=this,t=o((function(t,r){u(e.processNext(t))(r)}),this.concurrency);return t.error=function(t){e.log.error("queue",t),e.stop(t)},t.drain=function(){e.log("queue:drain"),e.stop()},t.unsaturated=function(){e.running&&e.fill()},t.buffer=0,t}},{key:"stop",value:function(e){this.running&&(this.running=!1,this.queue.kill(),this.log("worker:stop, %d workers still running",this.run.workers.filter((function(e){return e.running})).length),e?this.execution.reject(e):this.execution.resolve())}},{key:"execute",value:function(){var e=i(n.mark((function e(){var t,r=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.running=!0,this.execution={},t=new Promise((function(e,t){return Object.assign(r.execution,{resolve:e,reject:t})})),this.fill(),e.next=6,t;case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){for(;this.queue.running()+this.queue.length()<this.concurrency&&this.path.peersToQuery.length>0;)this.queue.push(this.path.peersToQuery.dequeue())}},{key:"processNext",value:function(){var e=i(n.mark((function e(t){var r,i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.running){e.next=2;break}return e.abrupt("return");case 2:if(!this.run.peersSeen.has(t.toB58String())){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,this.run.continueQuerying(this);case 7:r=e.sent,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(4),i=e.t0;case 13:if(this.running){e.next=15;break}return e.abrupt("return");case 15:if(!i){e.next=17;break}throw i;case 17:if(r){e.next=20;break}return this.stop(),e.abrupt("return");case 20:if(!this.run.peersSeen.has(t.toB58String())){e.next=22;break}return e.abrupt("return");case 22:return this.run.peersSeen.add(t.toB58String()),this.log("queue:work"),e.prev=24,e.next=27,this.execQuery(t);case 27:a=e.sent,e.next=33;break;case 30:e.prev=30,e.t1=e.catch(24),s=e.t1;case 33:if(this.running){e.next=35;break}return e.abrupt("return");case 35:if(this.log("queue:work:done",s,a),!s){e.next=38;break}throw s;case 38:if(!a||!a.queryComplete){e.next=42;break}return this.log("query:complete"),this.run.stop(),e.abrupt("return");case 42:a&&a.pathComplete&&this.stop();case 43:case"end":return e.stop()}}),e,this,[[4,10],[24,30]])})));return function(t){return e.apply(this,arguments)}}()},{key:"execQuery",value:function(){var e=i(n.mark((function e(t){var r,a,s=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.path.queryFunc(t);case 3:r=e.sent,e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),a=e.t0;case 9:if(this.running){e.next=11;break}return e.abrupt("return");case 11:if(!a){e.next=14;break}return this.run.errors.push(a),e.abrupt("return");case 14:return e.next=16,this.run.peersQueried.add(t);case 16:if(!r.pathComplete&&!r.queryComplete){e.next=19;break}return this.path.res=r,e.abrupt("return",{pathComplete:r.pathComplete,queryComplete:r.queryComplete});case 19:if(!(r.closerPeers&&r.closerPeers.length>0)){e.next=22;break}return e.next=22,Promise.all(r.closerPeers.map(function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.dht._isSelf(t.id)){e.next=2;break}return e.abrupt("return");case 2:return s.dht._peerDiscovered(t.id,t.multiaddrs),e.next=5,s.path.addPeerToQuery(t.id);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 22:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(15),u=r(170),c=r(1965),f=r(2371),h=r(1958),l=r(2037),p=r(1953);e.exports=function(e){var t=function(){var t=i(n.mark((function t(r,i){var a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new h(h.TYPES.GET_PROVIDERS,i.buffer,0),t.abrupt("return",e.network.sendRequest(r,a));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}();return{provide:function(t){return i(n.mark((function r(){var a,s,u;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e._log("provide: %s",t.toBaseEncodedString()),a=[],r.next=4,e.providers.addProvider(t,e.peerId);case 4:return s=e.libp2p?e.libp2p.multiaddrs:[],(u=new h(h.TYPES.ADD_PROVIDER,t.buffer,0)).providerPeers=[{id:e.peerId,multiaddrs:s}],r.next=9,p.mapParallel(e.getClosestPeers(t.buffer),function(){var r=i(n.mark((function r(i){return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e._log("putProvider %s to %s",t.toBaseEncodedString(),i.toB58String()),r.prev=1,r.next=4,e.network.sendMessage(i,u);case 4:r.next=9;break;case 6:r.prev=6,r.t0=r.catch(1),a.push(r.t0);case 9:case"end":return r.stop()}}),r,null,[[1,6]])})));return function(e){return r.apply(this,arguments)}}());case 9:if(!a.length){r.next=11;break}throw o(new Error("Failed to provide to ".concat(a.length," of ").concat(e.kBucketSize," peers"),"ERR_SOME_PROVIDES_FAILED"),{errors:a});case 11:case"end":return r.stop()}}),r)})))()},findProviders:function(r){var h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s(n.mark((function s(){var d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C,B,R;return n.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return d=h.timeout||c.minute,v=h.maxNumProviders||c.K,e._log("findProviders %s",r.toBaseEncodedString()),y=new f(v),s.next=6,a(e.providers.getProviders(r));case 6:if(s.sent.forEach((function(t){var r=e.peerStore.get(t)||{};y.push({id:r.id||t,multiaddrs:(r.addresses||[]).map((function(e){return e.multiaddr}))})})),!(y.length>=v)){s.next=36;break}b=!0,m=!1,g=void 0,s.prev=12,k=y.toArray()[Symbol.iterator]();case 14:if(b=(w=k.next()).done){s.next=21;break}return x=w.value,s.next=18,x;case 18:b=!0,s.next=14;break;case 21:s.next=27;break;case 23:s.prev=23,s.t0=s.catch(12),m=!0,g=s.t0;case 27:s.prev=27,s.prev=28,b||null==k.return||k.return();case 30:if(s.prev=30,!m){s.next=33;break}throw g;case 33:return s.finish(30);case 34:return s.finish(27);case 35:return s.abrupt("return");case 36:return S=[],E=new l(e,r.buffer,(function(a,s){var o=p.pathSize(v-y.length,s),u=new f(o);return S.push(u),function(){var a=i(n.mark((function i(a){var s,c;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t(a,r);case 2:if(s=n.sent,c=s.providerPeers,e._log("(%s) found %s provider entries",e.peerId.toB58String(),c.length),c.forEach((function(e){u.push({id:e.id})})),!(u.length>=o)){n.next=8;break}return n.abrupt("return",{pathComplete:!0});case 8:return n.abrupt("return",{closerPeers:s.closerPeers});case 9:case"end":return n.stop()}}),i)})));return function(e){return a.apply(this,arguments)}}()})),_=e.routingTable.closestPeers(r.buffer,e.kBucketSize),s.prev=39,s.next=42,a(u(E.run(_),d));case 42:s.next=48;break;case 44:if(s.prev=44,s.t1=s.catch(39),s.t1.name===u.TimeoutError.name){s.next=48;break}throw s.t1;case 48:return s.prev=48,E.stop(),s.finish(48);case 51:if(S.forEach((function(e){e.toArray().forEach((function(e){y.push(e)}))})),0!==y.length){s.next=54;break}throw o(new Error("no providers found"),"ERR_NOT_FOUND");case 54:I=!0,A=!1,T=void 0,s.prev=57,C=y.toArray()[Symbol.iterator]();case 59:if(I=(B=C.next()).done){s.next=66;break}return R=B.value,s.next=63,R;case 63:I=!0,s.next=59;break;case 66:s.next=72;break;case 68:s.prev=68,s.t2=s.catch(57),A=!0,T=s.t2;case 72:s.prev=72,s.prev=73,I||null==C.return||C.return();case 75:if(s.prev=75,!A){s.next=78;break}throw T;case 78:return s.finish(75);case 79:return s.finish(72);case 80:case"end":return s.stop()}}),s,null,[[12,23,27,35],[28,,30,34],[39,44,48,51],[57,68,72,80],[73,,75,79]])})))()}}}},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(127),u=r(29),c=function(e){function t(e){var r;return n(this,t),(r=a(this,s(t).call(this))).limit=e,r}return u(t,e),i(t,[{key:"push",value:function(e){return this.length<this.limit&&o(s(t.prototype),"push",this).call(this,e)}}]),t}(r(2372));e.exports=c},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(){n(this,e),this.list=[]}return i(e,[{key:"push",value:function(e){return!this.has(e.id)&&(this.list.push(e),!0)}},{key:"has",value:function(e){var t=this.list.find((function(t){return t.id.isEqual(e)}));return Boolean(t)}},{key:"toArray",value:function(){return this.list.slice()}},{key:"pop",value:function(){return this.list.pop()}},{key:"length",get:function(){return this.list.length}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(25),s=r(26),o=r(15),u=r(170),c=r(55),f=r(104),h=r(1965),l=r(1958),p=r(2037),d=r(1953);e.exports=function(e){var t=function(){var t=i(n.mark((function t(r){var i,a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._log("findPeerLocal %s",r.toB58String()),t.next=3,e.routingTable.find(r);case 3:if(i=t.sent,!(a=i&&e.peerStore.get(i))){t.next=7;break}return t.abrupt("return",{id:a.id,multiaddrs:a.addresses.map((function(e){return e.multiaddr}))});case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=function(){var t=i(n.mark((function t(r,i){var a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new l(l.TYPES.GET_VALUE,i,0),t.abrupt("return",e.network.sendRequest(r,a));case 2:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),v=function(){var t=i(n.mark((function t(r,i){var a;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e._log("closerPeersSingle %b from %s",r,i.toB58String()),t.next=3,e.peerRouting._findPeerSingle(i,new c(r));case 3:return a=t.sent,t.abrupt("return",a.closerPeers.filter((function(t){return!e._isSelf(t.id)})).map((function(t){return e.peerStore.addressBook.add(t.id,t.multiaddrs),t})));case 5:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),y=function(){var e=i(n.mark((function e(t){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=d.keyForPublicKey(t),e.next=3,r(t,i);case 3:if((a=e.sent).record&&a.record.value){e.next=6;break}throw o("Node not responding with its public key: ".concat(t.toB58String()),"ERR_INVALID_RECORD");case 6:if((s=c.createFromPubKey(a.record.value)).isEqual(t)){e.next=9;break}throw o("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");case 9:return e.abrupt("return",s.pubKey);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return{_findPeerSingle:function(t,r){return i(n.mark((function i(){var a;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return e._log("findPeerSingle %s",t.toB58String()),a=new l(l.TYPES.FIND_NODE,r.id,0),n.abrupt("return",e.network.sendRequest(t,a));case 3:case"end":return n.stop()}}),i)})))()},findPeer:function(r){var a=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(n.mark((function c(){var f,l,v,y,b,m,g,k,w;return n.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:return s.timeout=s.timeout||h.minute,e._log("findPeer %s",r.toB58String()),c.next=4,t(r);case 4:if(null==(f=c.sent)){c.next=8;break}return e._log("found local"),c.abrupt("return",f);case 8:return c.next=10,d.convertPeerId(r);case 10:if(l=c.sent,0!==(v=e.routingTable.closestPeers(l,e.kBucketSize)).length){c.next=14;break}throw o(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED");case 14:if(!v.find((function(e){return e.isEqual(r)}))){c.next=20;break}if(!(y=e.peerStore.get(r))){c.next=20;break}return e._log("found in peerStore"),c.abrupt("return",{id:y.id,multiaddrs:y.addresses.map((function(e){return e.multiaddr}))});case 20:return b=new p(e,r.id,(function(){return function(){var e=i(n.mark((function e(t){var i,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a._findPeerSingle(t,r);case 2:if(i=e.sent,!(s=i.closerPeers.find((function(e){return e.id.isEqual(r)})))){e.next=6;break}return e.abrupt("return",{peer:s,queryComplete:!0});case 6:return e.abrupt("return",{closerPeers:i.closerPeers});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),c.prev=21,c.next=24,u(b.run(v),s.timeout);case 24:g=c.sent,c.next=30;break;case 27:c.prev=27,c.t0=c.catch(21),m=c.t0;case 30:if(b.stop(),!m){c.next=33;break}throw m;case 33:if(k=!1,g.paths.forEach((function(t){t.success&&(k=!0,e.peerStore.addressBook.add(t.peer.id,t.peer.multiaddrs))})),e._log("findPeer %s: %s",r.toB58String(),k),k){c.next=38;break}throw o(new Error("No peer found"),"ERR_NOT_FOUND");case 38:return w=e.peerStore.get(r),c.abrupt("return",{id:w.id,multiaddrs:w.addresses.map((function(e){return e.multiaddr}))});case 40:case"end":return c.stop()}}),c,null,[[21,27]])})))()},getClosestPeers:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shallow:!1};return s(n.mark((function s(){var o,u,c,f,h,l,y,b,m,g,k;return n.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e._log("getClosestPeers to %b",t),s.next=3,a(d.convertBuffer(t));case 3:return o=s.sent,u=e.routingTable.closestPeers(o,e.kBucketSize),c=new p(e,t,(function(){return function(){var e=i(n.mark((function e(i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(t,i);case 2:return a=e.sent,e.abrupt("return",{closerPeers:a,pathComplete:!!r.shallow||void 0});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()})),s.next=8,a(c.run(u));case 8:if((f=s.sent)&&f.finalSet){s.next=11;break}return s.abrupt("return",[]);case 11:return s.next=13,a(d.sortClosestPeers(Array.from(f.finalSet),o));case 13:h=s.sent,l=!0,y=!1,b=void 0,s.prev=17,m=h.slice(0,e.kBucketSize)[Symbol.iterator]();case 19:if(l=(g=m.next()).done){s.next=26;break}return k=g.value,s.next=23,k;case 23:l=!0,s.next=19;break;case 26:s.next=32;break;case 28:s.prev=28,s.t0=s.catch(17),y=!0,b=s.t0;case 32:s.prev=32,s.prev=33,l||null==m.return||m.return();case 35:if(s.prev=35,!y){s.next=38;break}throw b;case 38:return s.finish(35);case 39:return s.finish(32);case 40:case"end":return s.stop()}}),s,null,[[17,28,32,40],[33,,35,39]])})))()},getPublicKey:function(t){return i(n.mark((function r(){var i,a,s,o,u;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e._log("getPublicKey %s",t.toB58String()),!(i=e.peerStore.get(t))||!i.id.pubKey){r.next=5;break}return e._log("getPublicKey: found local copy"),r.abrupt("return",i.id.pubKey);case 5:return r.prev=5,r.next=8,y(t);case 8:a=r.sent,r.next=18;break;case 11:return r.prev=11,r.t0=r.catch(5),s=d.keyForPublicKey(t),r.next=16,e.get(s);case 16:o=r.sent,a=f.keys.unmarshalPublicKey(o);case 18:return i.id=new c(t.id,null,a),u=i.addresses.map((function(e){return e.multiaddr})),e.peerStore.addressBook.add(i.id,u),e.peerStore.keyBook.set(i.id,a),r.abrupt("return",a);case 23:case"end":return r.stop()}}),r,null,[[5,11]])})))()}}}},function(e,t,r){"use strict";var n=r(68),i=r(1),a=r(48),s=r(2),o=r(5),u=r(7),c=r(18),f=r(331),h=r(47),l=r(55),p=r(57).Key,d=r(151).default,v=r(3).Buffer,y=r(1965),b=r(1953),m=function(){function e(t,r,n){o(this,e),this.datastore=t,this._log=b.logger(r,"providers"),this.cleanupInterval=y.PROVIDERS_CLEANUP_INTERVAL,this.provideValidity=y.PROVIDERS_VALIDITY,this.lruCacheSize=n||y.PROVIDERS_LRU_CACHE_SIZE,this.providers=f(this.lruCacheSize),this.syncQueue=new d({concurrency:1})}return u(e,[{key:"start",value:function(){var e=this;this._cleaner=setInterval((function(){return e._cleanup()}),this.cleanupInterval)}},{key:"stop",value:function(){clearInterval(this._cleaner),this._cleaner=null}},{key:"_cleanup",value:function(){var e=this;return this.syncQueue.add(s(i.mark((function t(){var r,n,s,o,u,f,h,l,p,d,v,b,m,k,w,S,E,I,A,T,C,B,R,N,P,M,D,O,L,K,U,q,z,j,V,F,H;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e._log("start cleanup"),r=Date.now(),n=0,s=0,o=new Map,u=e.datastore.batch(),f=e.datastore.query({prefix:y.PROVIDERS_KEY_PREFIX}),h=!0,l=!1,t.prev=9,d=c(f);case 11:return t.next=13,d.next();case 13:return v=t.sent,h=v.done,t.next=17,v.value;case 17:if(b=t.sent,h){t.next=24;break}m=b;try{k=x(m.key),w=k.cid,S=k.peerId,E=_(m.value),I=Date.now(),T=(A=I-E)>e.provideValidity,e._log("comparing: %d - %d = %d > %d %s",I,E,A,e.provideValidity,T?"(expired)":""),T&&(s++,u.delete(m.key),(C=o.get(w)||new Set).add(S),o.set(w,C)),n++}catch(i){e._log.error(i.message)}case 21:h=!0,t.next=11;break;case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(9),l=!0,p=t.t0;case 30:if(t.prev=30,t.prev=31,h||null==d.return){t.next=35;break}return t.next=35,d.return();case 35:if(t.prev=35,!l){t.next=38;break}throw p;case 38:return t.finish(35);case 39:return t.finish(30);case 40:if(e._log("deleting %d / %d entries",s,n),!o.size){t.next=44;break}return t.next=44,u.commit();case 44:B=!0,R=!1,N=void 0,t.prev=47,P=o[Symbol.iterator]();case 49:if(B=(M=P.next()).done){t.next=77;break}if(D=a(M.value,2),O=D[0],L=D[1],K=g(O),!(U=e.providers.get(K))){t.next=74;break}for(q=!0,z=!1,j=void 0,t.prev=57,V=L[Symbol.iterator]();!(q=(F=V.next()).done);q=!0)H=F.value,U.delete(H);t.next=65;break;case 61:t.prev=61,t.t1=t.catch(57),z=!0,j=t.t1;case 65:t.prev=65,t.prev=66,q||null==V.return||V.return();case 68:if(t.prev=68,!z){t.next=71;break}throw j;case 71:return t.finish(68);case 72:return t.finish(65);case 73:0===U.size?e.providers.remove(K):e.providers.set(K,U);case 74:B=!0,t.next=49;break;case 77:t.next=83;break;case 79:t.prev=79,t.t2=t.catch(47),R=!0,N=t.t2;case 83:t.prev=83,t.prev=84,B||null==P.return||P.return();case 86:if(t.prev=86,!R){t.next=89;break}throw N;case 89:return t.finish(86);case 90:return t.finish(83);case 91:e._log("Cleanup successful (%dms)",Date.now()-r);case 92:case"end":return t.stop()}}),t,null,[[9,26,30,40],[31,,35,39],[47,79,83,91],[57,61,65,73],[66,,68,72],[84,,86,90]])}))))}},{key:"_getProvidersMap",value:function(){var e=s(i.mark((function e(t){var r,n;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=g(t),n=this.providers.get(r)){e.next=7;break}return e.next=5,S(this.datastore,t);case 5:n=e.sent,this.providers.set(r,n);case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addProvider",value:function(){var e=s(i.mark((function e(t,r){var n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncQueue.add(s(i.mark((function e(){var a,s,o;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n._log("addProvider %s",t.toBaseEncodedString()),e.next=3,n._getProvidersMap(t);case 3:return a=e.sent,n._log("loaded %s provs",a.size),s=Date.now(),a.set(b.encodeBase32(r.id),s),o=g(t),n.providers.set(o,a),e.abrupt("return",k(n.datastore,t,r,s));case 10:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getProviders",value:function(){var e=s(i.mark((function e(t){var r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.syncQueue.add(s(i.mark((function e(){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r._log("getProviders %s",t.toBaseEncodedString()),e.next=3,r._getProvidersMap(t);case 3:return a=e.sent,e.abrupt("return",n(a.keys()).map((function(e){return new l(b.decodeBase32(e))})));case 5:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function g(e){return e="string"===typeof e?e:b.encodeBase32(e.buffer),y.PROVIDERS_KEY_PREFIX+e}function k(e,t,r,n){return w.apply(this,arguments)}function w(){return(w=s(i.mark((function e(t,r,n,a){var s,o,u;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[g(r),"/",b.encodeBase32(n.id)].join(""),o=new p(s),u=v.from(h.encode(a)),e.abrupt("return",t.put(o,u));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){var t=e.toString().split("/");if(4!==t.length)throw new Error("incorrectly formatted provider entry key in datastore: "+e);return{cid:t[2],peerId:t[3]}}function S(e,t){return E.apply(this,arguments)}function E(){return(E=s(i.mark((function e(t,r){var n,a,s,o,u,f,h,l,p,d,v;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new Map,a=t.query({prefix:g(r)}),s=!0,o=!1,e.prev=4,f=c(a);case 6:return e.next=8,f.next();case 8:return h=e.sent,s=h.done,e.next=12,h.value;case 12:if(l=e.sent,s){e.next=20;break}d=x((p=l).key),v=d.peerId,n.set(v,_(p.value));case 17:s=!0,e.next=6;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(4),o=!0,u=e.t0;case 26:if(e.prev=26,e.prev=27,s||null==f.return){e.next=31;break}return e.next=31,f.return();case 31:if(e.prev=31,!o){e.next=34;break}throw u;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",n);case 37:case"end":return e.stop()}}),e,null,[[4,22,26,36],[27,,31,35]])})))).apply(this,arguments)}function _(e){return h.decode(e)}e.exports=m},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(46),s=r(5),o=r(7),u=r(104),c=r(88),f=r(55),h=r(152),l=r(15),p=r(2376),d=r(1965),v=r(1953).logger,y=function(){function e(t,r){if(s(this,e),!t)throw new Error("Random Walk needs an instance of the Kademlia DHT");this._kadDHT=t,this._options=a({},d.defaultRandomWalk,{},r),this.log=v(t.peerId,"random-walk"),this._timeoutId=void 0}return o(e,[{key:"start",value:function(){var e=this;!this._timeoutId&&this._options.enabled&&(this._timeoutId=setTimeout((function(){e._runPeriodically()}),this._options.delay))}},{key:"stop",value:function(){this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=void 0),this._controller&&this._controller.abort()}},{key:"_runPeriodically",value:function(){var e=i(n.mark((function e(){var t=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timeoutId){e.next=13;break}return e.prev=1,e.next=4,this._walk(this._options.queriesPerPeriod,this._options.timeout);case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),this._kadDHT._log.error("random-walk:error",e.t0);case 9:return e.next=11,new Promise((function(e){t._timeoutId=setTimeout(e,t._options.interval)}));case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,6]])})));return function(){return e.apply(this,arguments)}}()},{key:"_walk",value:function(){var e=i(n.mark((function e(t,r){var a=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("start"),this._controller=new h,e.prev=2,e.next=5,p(t,function(){var e=i(n.mark((function e(t){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.log("running query %d",t),e.prev=1,e.next=4,a._randomPeerId();case 4:if(i=e.sent,a._controller){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,a._query(i,{timeout:r,signal:a._controller.signal});case 9:e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(1),!e.t0||"ETIMEDOUT"===e.t0.code){e.next=16;break}throw a.log.error("query %d finished with error",t,e.t0),e.t0;case 16:a.log("finished query %d",t);case 17:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}());case 5:return e.prev=5,this._controller=null,this.log("finished queries"),e.finish(5);case 9:case"end":return e.stop()}}),e,this,[[2,,5,9]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_query",value:function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.log("query:%s",t.toB58String()),e.prev=1,e.next=4,this._kadDHT.findPeer(t,r);case 4:i=e.sent,e.next=12;break;case 7:if(e.prev=7,e.t0=e.catch(1),!e.t0||"ERR_NOT_FOUND"!==e.t0.code){e.next=11;break}return e.abrupt("return");case 11:throw e.t0;case 12:throw this.log("query:found",i),l("random-walk: ACTUALLY FOUND PEER: ".concat(i,", ").concat(t.toB58String()),"ERR_FOUND_RANDOM_PEER");case 14:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_randomPeerId",value:function(){var e=i(n.mark((function e(){var t;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(u.randomBytes(16),"sha2-256");case 2:return t=e.sent,e.abrupt("return",new f(t));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}();e.exports=y},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2377),s=function(){var e=i(n.mark((function e(t,r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a(new Array(t).fill(),(function(e,t){return r(t)}),i));case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();e.exports=s,e.exports.default=s},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(264);e.exports=function(){var e=i(n.mark((function e(t,r){var s,o,u,c,f,h=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=h.length>2&&void 0!==h[2]?h[2]:{},o=s.concurrency,u=void 0===o?1/0:o,c=s.stopOnError,f=void 0===c||c,e.abrupt("return",new Promise((function(e,s){if("function"!==typeof r)throw new TypeError("Mapper function is required");if(!Number.isSafeInteger(u)&&u!==1/0||!(u>=1))throw new TypeError("Expected `concurrency` to be an integer from 1 and up or `Infinity`, got `".concat(u,"` (").concat(typeof u,")"));for(var o=[],c=[],h=t[Symbol.iterator](),l=!1,p=!1,d=0,v=0,y=function t(){if(!l){var u=h.next(),y=v;if(v++,u.done)return p=!0,void(0===d&&(f||0===c.length?e(o):s(new a(c))));d++,i(n.mark((function e(){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.value;case 3:return i=e.sent,e.next=6,r(i,y);case 6:o[y]=e.sent,d--,t(),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),f?(l=!0,s(e.t0)):(c.push(e.t0),d--,t());case 14:case"end":return e.stop()}}),e,null,[[0,11]])})))()}},b=0;b<u&&(y(),!p);b++);})));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(){n(this,e),this.queries=new Set,this.running=!1}return i(e,[{key:"queryStarted",value:function(e){this.queries.add(e)}},{key:"queryCompleted",value:function(e){this.queries.delete(e)}},{key:"start",value:function(){this.running=!0}},{key:"stop",value:function(){this.running=!1;var e=!0,t=!1,r=void 0;try{for(var n,i=this.queries[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value.stop()}}catch(a){t=!0,r=a}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}this.queries.clear()}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(55),c=r(72),f=r(169),h=r(41).EventEmitter,l=r(19),p=l("libp2p:bootstrap");p.error=l("libp2p:bootstrap:error");var d=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(n(this,t),!r.list||!r.list.length)throw new Error("Bootstrap requires a list of peer addresses");return(e=a(this,s(t).call(this)))._list=r.list,e._interval=r.interval||1e4,e._timer=null,e}return o(t,e),i(t,[{key:"start",value:function(){var e=this;this._timer||(this._timer=setInterval((function(){return e._discoverBootstrapPeers()}),this._interval),this._discoverBootstrapPeers())}},{key:"_discoverBootstrapPeers",value:function(){var e=this;this._timer&&this._list.forEach((function(t){if(!f.P2P.matches(t))return p.error("Invalid multiaddr");var r=c(t),n=u.createFromB58String(r.getPeerId());try{e.emit("peer",{id:n,multiaddrs:[r]})}catch(i){p.error("Invalid bootstrap peer id",i)}}))}},{key:"stop",value:function(){clearInterval(this._timer),this._timer=null}}]),t}(h);(e.exports=d).tag="bootstrap"},function(e,t,r){"use strict";var n=r(1),i=r(25),a=r(26),s=r(18),o=r(126),u=r(15),c=r(1948),f=c.normalizeCidPath,h=c.mapFile,l=c.withTimeoutOption;e.exports=function(e){var t=e.ipld,r=e.preload;return l(function(){var e=a(n.mark((function e(a,c){var l,p,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=c||{},l=f(a),p=c.recursive,d=l.split("/"),!1!==c.preload&&r(d[0]),e.next=7,i(o(a,t,c));case 7:if((v=e.sent).unixfs){e.next=10;break}throw u(new Error("dag node was not a UnixFS node"),"ERR_NOT_UNIXFS");case 10:if("file"!==v.unixfs.type){e.next=12;break}return e.abrupt("return",h(v,c));case 12:if(!v.unixfs.type.includes("dir")){e.next=88;break}if(!p){e.next=51;break}y=!0,b=!1,e.prev=16,g=s(o.recursive(v.cid,t,c));case 18:return e.next=20,i(g.next());case 20:return k=e.sent,y=k.done,e.next=24,i(k.value);case 24:if(w=e.sent,y){e.next=34;break}if(x=w,v.cid.toBaseEncodedString()!==x.cid.toBaseEncodedString()){e.next=29;break}return e.abrupt("continue",31);case 29:return e.next=31,h(x,c);case 31:y=!0,e.next=18;break;case 34:e.next=40;break;case 36:e.prev=36,e.t0=e.catch(16),b=!0,m=e.t0;case 40:if(e.prev=40,e.prev=41,y||null==g.return){e.next=45;break}return e.next=45,i(g.return());case 45:if(e.prev=45,!b){e.next=48;break}throw m;case 48:return e.finish(45);case 49:return e.finish(40);case 50:return e.abrupt("return");case 51:S=!0,E=!1,e.prev=53,I=s(v.content());case 55:return e.next=57,i(I.next());case 57:return A=e.sent,S=A.done,e.next=61,i(A.value);case 61:if(T=e.sent,S){e.next=71;break}return(C=h(C=T,c)).depth--,e.next=68,C;case 68:S=!0,e.next=55;break;case 71:e.next=77;break;case 73:e.prev=73,e.t1=e.catch(53),E=!0,_=e.t1;case 77:if(e.prev=77,e.prev=78,S||null==I.return){e.next=82;break}return e.next=82,i(I.return());case 82:if(e.prev=82,!E){e.next=85;break}throw _;case 85:return e.finish(82);case 86:return e.finish(77);case 87:return e.abrupt("return");case 88:throw u(new Error("Unknown UnixFS type ".concat(v.unixfs.type)),"ERR_UNKNOWN_UNIXFS_TYPE");case 89:case"end":return e.stop()}}),e,null,[[16,36,40,50],[41,,45,49],[53,73,77,87],[78,,82,86]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19),s=r(2003).default,o=r(1981),u=r(15),c=a("ipfs:name:publish");c.error=a("ipfs:name:publish:error");var f=r(1948),h=f.OFFLINE_ERROR,l=f.normalizePath,p=f.withTimeoutOption,d=r(2382).resolvePath;e.exports=function(e){var t=e.ipns,r=e.dag,a=e.peerId,f=e.isOnline,v=e.keychain,y=e.options,b=function(){var e=i(n.mark((function e(t){var r,i,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("self"!==t){e.next=2;break}return e.abrupt("return",a.privKey);case 2:return e.prev=2,r=y.pass,e.next=6,v.exportKey(t,r);case 6:return i=e.sent,e.next=9,o.keys.import(i,r);case 9:return s=e.sent,e.abrupt("return",s);case 13:throw e.prev=13,e.t0=e.catch(2),c.error(e.t0),u(e.t0,"ERR_CANNOT_GET_KEY");case 17:case"end":return e.stop()}}),e,null,[[2,13]])})));return function(t){return e.apply(this,arguments)}}();return p(function(){var e=i(n.mark((function e(i,a){var o,p,v,y,m;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=!(!1===(a=a||{}).resolve),p=a.lifetime||"24h",v=a.key||"self",f()){e.next=6;break}throw u(new Error(h),"OFFLINE_ERROR");case 6:e.prev=6,i=l(i),e.next=14;break;case 10:throw e.prev=10,e.t0=e.catch(6),c.error(e.t0),e.t0;case 14:e.prev=14,y=(y=s(p)).toFixed(6),e.next=23;break;case 19:throw e.prev=19,e.t1=e.catch(14),c.error(e.t1),e.t1;case 23:return e.next=25,Promise.all([b(v),o?d({ipns:t,dag:r},i):Promise.resolve()]);case 25:return m=e.sent,e.abrupt("return",t.publish(m[0],i,y));case 27:case"end":return e.stop()}}),e,null,[[6,10],[14,19]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(149);t.resolvePath=function(e,t){var r=e.ipns,i=e.dag;return n.ipnsPath(t)?r.resolve(t):i.get(t.substring("/ipfs/".length))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2038).getPubsubRouting,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipns,r=e.options;return s(function(){var e=i(n.mark((function e(i,s){var o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a(t,r),e.abrupt("return",o.cancel(i,s));case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2038).getPubsubRouting,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipns,r=e.options;return s(function(){var e=i(n.mark((function e(i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",{enabled:Boolean(a(t,r))});case 4:return e.prev=4,e.t0=e.catch(0),e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e,null,[[0,4]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2038).getPubsubRouting,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipns,r=e.options;return s(function(){var e=i(n.mark((function e(i){var s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=a(t,r),e.abrupt("return",s.getSubscriptions(i));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(340),i=r(1),a=r(2),s=(r(25),r(26)),o=r(19),u=r(15),c=r(103),f=r(32),h=r(826),l=o("ipfs:name:resolve");l.error=o("ipfs:name:resolve:error");var p=r(1948),d=p.OFFLINE_ERROR,v=p.withTimeoutOption,y=function(){var e=a(i.mark((function e(t,r){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(t=e.sent,!r.length){e.next=5;break}return e.abrupt("return",t+"/"+r.join("/"));case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();e.exports=function(e){var t=e.dns,r=e.ipns,a=e.peerId,o=e.isOnline,p=e.options;return v(function(){var e=s(i.mark((function e(s,v){var b,m,g,k,w,x;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=c({nocache:!1,recursive:!0},v||{}),!(b=p.offline)||!v.nocache){e.next=4;break}throw u(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");case 4:s||(s=a.toB58String()),s.startsWith("/ipns/")||(s="/ipns/".concat(s)),m=s.slice(1).split("/"),g=n(m),k=g[0],w=g[1],x=g.slice(2),e.prev=7,new f(w),e.next=19;break;case 11:if(e.prev=11,e.t0=e.catch(7),!h(w)){e.next=17;break}return e.next=16,y(t(w,v),x);case 16:return e.abrupt("return");case 17:throw l.error(e.t0),u(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME");case 19:if(o()||b){e.next=21;break}throw u(new Error(d),"OFFLINE_ERROR");case 21:return e.next=23,y(r.resolve("/".concat(k,"/").concat(w),v),x);case 23:case"end":return e.stop()}}),e,null,[[7,11]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,s=e.preload,o=r(1966)({ipld:t,preload:s});return a(function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(t,r);case 2:return i=e.sent,e.abrupt("return",i.Data);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61).DAGLink,s=r(32),o=r(1948).withTimeoutOption;function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];for(var r in e){var n=e[r];if("/"===r&&1===Object.keys(e).length)try{t.push(new a("",0,new s(n)));continue}catch(i){}s.isCID(n)?t.push(new a("",0,n)):(Array.isArray(n)&&u(n,t),n&&"object"===typeof n&&u(n,t))}return t}e.exports=function(e){var t=e.dag;return o(function(){var e=i(n.mark((function e(r,i){var a,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=i||{},a=new s(r),e.next=4,t.get(a,i);case 4:if(o=e.sent,"raw"!==a.codec){e.next=7;break}return e.abrupt("return",[]);case 7:if("dag-pb"!==a.codec){e.next=9;break}return e.abrupt("return",o.value.Links);case 9:if("dag-cbor"!==a.codec){e.next=11;break}return e.abrupt("return",u(o));case 11:throw new Error("Cannot resolve links from codec ".concat(a.codec));case 12:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61).DAGNode,s=r(49),o=r(90),u=r(1948).withTimeoutOption,c=r(3).Buffer;e.exports=function(e){var t=e.ipld,r=e.preload;return u(function(){var e=i(n.mark((function e(){var i,u,f,h,l=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=l.length>0&&void 0!==l[0]?l[0]:{}).template){e.next=9;break}if("unixfs-dir"!==i.template){e.next=6;break}u=new o("directory").marshal(),e.next=7;break;case 6:throw new Error("unknown template");case 7:e.next=10;break;case 9:u=c.alloc(0);case 10:return f=new a(u),e.next=13,t.put(f,s.DAG_PB,{cidVersion:0,hashAlg:s.SHA2_256,signal:i.signal});case 13:return h=e.sent,!1!==i.preload&&r(h),e.abrupt("return",h);case 16:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,s=e.gcLock,o=e.preload,u=r(1966)({ipld:t,preload:o}),c=r(1979)({ipld:t,gcLock:s,preload:o});return a(function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t,i);case 2:return(a=e.sent).addLink(r),e.abrupt("return",c(a,i));case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61).DAGNode,s=r(1948).withTimeoutOption,o=r(3).Buffer;e.exports=function(e){var t=e.ipld,u=e.gcLock,c=e.preload,f=r(1966)({ipld:t,preload:c}),h=r(1979)({ipld:t,gcLock:u,preload:c});return s(function(){var e=i(n.mark((function e(t,r,i){var s,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,i);case 2:return s=e.sent,u=o.concat([s.Data,r]),e.abrupt("return",h(new a(u,s.Links),i));case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,s=e.gcLock,o=e.preload,u=r(1966)({ipld:t,preload:o}),c=r(1979)({ipld:t,gcLock:s,preload:o});return a(function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t,i);case 2:return(a=e.sent).rmLink(r.Name||r.name),e.abrupt("return",c(a,i));case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61).DAGNode,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,o=e.gcLock,u=e.preload,c=r(1966)({ipld:t,preload:u}),f=r(1979)({ipld:t,gcLock:o,preload:u});return s(function(){var e=i(n.mark((function e(t,r,i){var s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t,i);case 2:return s=e.sent,e.abrupt("return",f(new a(r,s.Links),i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(61),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,o=e.preload,u=r(1966)({ipld:t,preload:o});return s(function(){var e=i(n.mark((function e(t,r){var i,s,o,c,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=r||{},e.next=3,u(t,r);case 3:return i=e.sent,s=a.util.serialize(i),e.next=7,a.util.cid(s,{cidVersion:0});case 7:return o=e.sent,c=s.length,f=i.Links.reduce((function(e,t){return e+t.Tsize}),0),e.abrupt("return",{Hash:o.toBaseEncodedString(),NumLinks:i.Links.length,BlockSize:c,LinksSize:c-i.Data.length,DataSize:i.Data.length,CumulativeSize:c+f});case 11:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948),s=a.resolvePath,o=a.withTimeoutOption;e.exports=function(e){var t=e.pinManager,r=e.gcLock,a=e.dag;return o(function(){var e=i(n.mark((function e(o,u){var c,f,h,l;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=!1!==(u=u||{}).recursive,e.next=4,s(a,o,{signal:u.signal});case 4:if(f=e.sent,h=function(){var e=i(n.mark((function e(){var r,i,s,o,h,l,p,d,v;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=!0,s=!1,o=void 0,e.prev=4,h=f[Symbol.iterator]();case 6:if(i=(l=h.next()).done){e.next=27;break}if(p=l.value,d=p.toBaseEncodedString(),!c){e.next=18;break}if(!t.recursivePins.has(d)){e.next=13;break}return r.push(p),e.abrupt("continue",24);case 13:return e.next=15,t.fetchCompleteDag(d,{preload:u.preload,signal:u.signal});case 15:r.push(p),e.next=24;break;case 18:if(!t.recursivePins.has(d)){e.next=20;break}throw new Error("".concat(d," already pinned recursively"));case 20:if(t.directPins.has(d)){e.next=23;break}return e.next=23,a.get(p,{preload:u.preload});case 23:r.push(p);case 24:i=!0,e.next=6;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(4),s=!0,o=e.t0;case 33:e.prev=33,e.prev=34,i||null==h.return||h.return();case 36:if(e.prev=36,!s){e.next=39;break}throw o;case 39:return e.finish(36);case 40:return e.finish(33);case 41:return v=c?t.recursivePins:t.directPins,r.forEach((function(e){return v.add(e.toString())})),e.next=45,t.flushPins();case 45:return e.abrupt("return",r.map((function(e){return{cid:e}})));case 46:case"end":return e.stop()}}),e,null,[[4,29,33,41],[34,,36,40]])})));return function(){return e.apply(this,arguments)}}(),Boolean(u.lock)){e.next=9;break}return e.abrupt("return",h());case 9:return e.next=11,r.readLock();case 11:return l=e.sent,e.prev=12,e.next=15,h();case 15:return e.prev=15,l(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[12,,15,18]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(26),s=r(25),o=r(18),u=r(96),c=r(1993).parallelMap,f=r(32),h=r(1948).resolvePath,l=r(1986),p=l.PinTypes,d=r(1948).withTimeoutOption;e.exports=function(e){var t=e.pinManager,r=e.dag;return d(function(){var e=a(n.mark((function e(){var a,d,v,y,b,m,g=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=g.length>0&&void 0!==g[0]?g[0]:{},d=p.all,!a.type){e.next=8;break}if(d=a.type,"string"===typeof a.type&&(d=a.type.toLowerCase()),!(v=l.checkPinType(d))){e.next=8;break}throw v;case 8:if(!a.paths){e.next=15;break}return a.paths=Array.isArray(a.paths)?a.paths:[a.paths],e.next=12,s(h(r,a.paths));case 12:return y=e.sent,e.delegateYield(u(o(c(8,function(){var e=i(n.mark((function e(r){var i,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.isPinnedWithType(r,d);case 2:if(i=e.sent,s=i.reason,i.pinned){e.next=7;break}throw new Error("path '".concat(a.paths[y.indexOf(r)],"' is not pinned"));case 7:if(s!==p.direct&&s!==p.recursive){e.next=9;break}return e.abrupt("return",{cid:r,type:s});case 9:return e.abrupt("return",{cid:r,type:"".concat(p.indirect," through ").concat(s)});case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),y)),s),"t0",14);case 14:return e.abrupt("return");case 15:if(b=[],d!==p.direct&&d!==p.all||(b=b.concat(Array.from(t.directPins).map((function(e){return{type:p.direct,cid:new f(e)}})))),d!==p.recursive&&d!==p.all||(b=b.concat(Array.from(t.recursivePins).map((function(e){return{type:p.recursive,cid:new f(e)}})))),d!==p.indirect&&d!==p.all){e.next=23;break}return e.next=21,s(t.getIndirectKeys(a));case 21:m=e.sent,b=b.filter((function(e){var r=e.cid;return!m.includes(r.toString())||!t.directPins.has(r.toString())})).concat(m.map((function(e){return{type:p.indirect,cid:new f(e)}})));case 23:return e.delegateYield(u(o(b),s),"t1",24);case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(15),s=r(150),o=r(1993),u=o.parallelMap,c=o.collect,f=r(78),h=r(1948),l=h.resolvePath,p=h.withTimeoutOption,d=r(1986).PinTypes;e.exports=function(e){var t=e.pinManager,r=e.gcLock,o=e.dag;return p(function(){var e=i(n.mark((function e(h,p){var v,y,b,m;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v=!1!==(p=p||{}).recursive,!p.cidBase||s.names[p.cidBase]){e.next=4;break}throw a(new Error("invalid multibase"),"ERR_INVALID_MULTIBASE");case 4:return e.next=6,l(o,h);case 6:return y=e.sent,e.next=9,r.readLock();case 9:return b=e.sent,e.prev=10,e.next=13,f(y,u(8,function(){var e=i(n.mark((function e(r){var i,a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.isPinnedWithType(r,d.all);case 2:if(i=e.sent,a=i.pinned,s=i.reason,a){e.next=7;break}throw new Error("".concat(r," is not pinned"));case 7:if(s===d.recursive||s===d.direct){e.next=9;break}throw new Error("".concat(r," is pinned indirectly under ").concat(s));case 9:if(s!==d.recursive||v){e.next=11;break}throw new Error("".concat(r," is pinned recursively"));case 11:return e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),c);case 13:return(m=e.sent).forEach((function(e){v&&t.recursivePins.has(e.toString())?t.recursivePins.delete(e.toString()):t.directPins.delete(e.toString())})),e.next=17,t.flushPins();case 17:return e.abrupt("return",m.map((function(e){return{cid:e}})));case 18:return e.prev=18,b(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[10,,18,21]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(46),a=r(25),s=r(26),o=r(55),u={success:!0,time:0,text:""},c=r(1948).withTimeoutOption;e.exports=function(e){var t=e.libp2p;return c(function(){var e=s(n.mark((function e(r,s){var c,f,h,l,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=s||{}).count=s.count||10,o.isPeerId(r)||(r=o.createFromCID(r)),c=t.peerStore.get(r)){e.next=10;break}return e.next=7,i({},u,{text:"Looking up peer ".concat(r)});case 7:return e.next=9,a(t.peerRouting.findPeer(r));case 9:c=e.sent;case 10:return e.next=12,i({},u,{text:"PING ".concat(c.id.toB58String())});case 12:f=0,h=0,l=0;case 15:if(!(l<s.count)){e.next=33;break}return e.prev=16,e.next=19,a(t.ping(c.id));case 19:return p=e.sent,h+=p,f++,e.next=24,i({},u,{time:p});case 24:e.next=30;break;case 26:return e.prev=26,e.t0=e.catch(16),e.next=30,i({},u,{success:!1,text:e.t0.toString()});case 30:l++,e.next=15;break;case 33:if(!f){e.next=37;break}return d=h/f,e.next=37,i({},u,{text:"Average latency: ".concat(d,"ms")});case 37:case"end":return e.stop()}}),e,null,[[16,26]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption,s=r(15);e.exports=function(e){var t=e.libp2p;return{subscribe:a((function(){var e;return(e=t.pubsub).subscribe.apply(e,arguments)})),unsubscribe:a((function(){var e;return(e=t.pubsub).unsubscribe.apply(e,arguments)})),publish:a(function(){var e=i(n.mark((function e(r,i,a){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=2;break}throw s(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");case 2:return e.next=4,t.pubsub.publish(r,i);case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()),ls:a((function(){var e;return(e=t.pubsub).getTopics.apply(e,arguments)})),peers:a((function(){var e;return(e=t.pubsub).getSubscribers.apply(e,arguments)}))}}},function(e,t,r){"use strict";var n=r(48),i=r(2),a=r(1),s=r(26),o=r(25),u=r(18),c=r(96),f=r(149),h=r(32),l=r(61).DAGNode,p=r(1948).normalizeCidPath,d=r(57).Errors.notFoundError().code,v=r(1948).withTimeoutOption,y={default:"<dst>",edges:"<src> -> <dst>"};function b(e,t,r){var n=p(t),i=n.split("/")[0];if(!f.cid(i))throw new Error("Error resolving path '".concat(n,"': '").concat(i,"' is not a valid CID"));return!1!==r.preload&&e(i),"/ipfs/"+n}function m(e,t,r,n){return g.apply(this,arguments)}function g(){return(g=s(a.mark((function e(t,r,n,i){var s,c,f,h,l,p,d,v,y,b;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o(t(n));case 2:s=e.sent,c=s.split("/"),f=c[2],h=!0,l=!1,e.prev=7,d=u(w(r,f,i.maxDepth,i.unique));case 9:return e.next=11,o(d.next());case 11:return v=e.sent,h=v.done,e.next=15,o(v.value);case 15:if(y=e.sent,h){e.next=27;break}if((b=y).parent){e.next=20;break}return e.abrupt("continue",24);case 20:if(!b.isDuplicate){e.next=22;break}return e.abrupt("continue",24);case 22:return e.next=24,{ref:k(b.parent.cid,b.node.cid,b.node.name,i.format)};case 24:h=!0,e.next=9;break;case 27:e.next=33;break;case 29:e.prev=29,e.t0=e.catch(7),l=!0,p=e.t0;case 33:if(e.prev=33,e.prev=34,h||null==d.return){e.next=38;break}return e.next=38,o(d.return());case 38:if(e.prev=38,!l){e.next=41;break}throw p;case 41:return e.finish(38);case 42:return e.finish(33);case 43:case"end":return e.stop()}}),e,null,[[7,29,33,43],[34,,38,42]])})))).apply(this,arguments)}function k(e,t,r,n){var i=n.replace(/<src>/g,e.toString());return i=(i=i.replace(/<dst>/g,t.toString())).replace(/<linkname>/g,r)}function w(e,t,r,n){return x.apply(this,arguments)}function x(){return(x=s(a.mark((function e(t,r,n,i){var f,h,l;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=function(){return(l=s(a.mark((function e(r,s){var l,p,v,y,b,m,g;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((l=s+1)>n)){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,p=!0,v=!1,y=void 0,e.prev=7,e.next=10,o(S(t,r.cid));case 10:e.t0=Symbol.iterator,b=e.sent[e.t0]();case 12:if(p=(m=b.next()).done){e.next=21;break}return g=m.value,e.next=16,{parent:r,node:g,isDuplicate:i&&f.has(g.cid.toString())};case 16:return i&&f.add(g.cid.toString()),e.delegateYield(c(u(h(g,l)),o),"t1",18);case 18:p=!0,e.next=12;break;case 21:e.next=27;break;case 23:e.prev=23,e.t2=e.catch(7),v=!0,y=e.t2;case 27:e.prev=27,e.prev=28,p||null==b.return||b.return();case 30:if(e.prev=30,!v){e.next=33;break}throw y;case 33:return e.finish(30);case 34:return e.finish(27);case 35:e.next=41;break;case 37:throw e.prev=37,e.t3=e.catch(3),e.t3.code===d&&(e.t3.message="Could not find object with CID: ".concat(r.cid)),e.t3;case 41:case"end":return e.stop()}}),e,null,[[3,37],[7,23,27,35],[28,,30,34]])})))).apply(this,arguments)},h=function(e,t){return l.apply(this,arguments)},f=new Set,e.delegateYield(c(u(h({cid:r},0)),o),"t0",4);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t){return E.apply(this,arguments)}function E(){return(E=i(a.mark((function e(t,r){var n;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get(new h(r));case 2:if(n=e.sent,!l.isDAGNode(n)){e.next=5;break}return e.abrupt("return",n.Links.map((function(e){var t=e.Name,r=e.Hash;return{name:t,cid:new h(r)}})));case 5:return e.abrupt("return",_(n));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=[],i=0,a=Object.entries(e);i<a.length;i++){var s=n(a[i],2),o=s[0],u=s[1];h.isCID(u)?r.push({name:t+o,cid:u}):"object"===typeof u&&(r=r.concat(_(u,t+o+"/")))}return r}e.exports=function(e){var t=e.ipld,r=e.resolve,n=e.preload;return v(function(){var e=s(a.mark((function e(i,s){var f,h,l,p,d,v,g,k;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(s=s||{}).maxDepth){e.next=3;break}return e.abrupt("return");case 3:if(!s.edges||!s.format||s.format===y.default){e.next=5;break}throw new Error("Cannot set edges to true and also specify format");case 5:s.format=s.edges?y.edges:s.format||y.default,"number"!==typeof s.maxDepth&&(s.maxDepth=s.recursive?1/0:1),f=Array.isArray(i)?i:[i],h=f.map((function(e){return b(n,e,s)})),l=!0,p=!1,d=void 0,e.prev=12,v=h[Symbol.iterator]();case 14:if(l=(g=v.next()).done){e.next=20;break}return k=g.value,e.delegateYield(c(u(m(r,t,k,s)),o),"t0",17);case 17:l=!0,e.next=14;break;case 20:e.next=26;break;case 22:e.prev=22,e.t1=e.catch(12),p=!0,d=e.t1;case 26:e.prev=26,e.prev=27,l||null==v.return||v.return();case 29:if(e.prev=29,!p){e.next=32;break}throw d;case 32:return e.finish(29);case 33:return e.finish(26);case 34:case"end":return e.stop()}}),e,null,[[12,22,26,34],[27,,29,33]])})));return function(t,r){return e.apply(this,arguments)}}())},e.exports.Format=y},function(e,t,r){"use strict";var n=r(1),i=r(25),a=r(26),s=r(18),o=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return o(function(){var e=a(n.mark((function e(){var r,a,o,u,c,f,h,l,p=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=p.length>0&&void 0!==p[0]?p[0]:{},a=!0,o=!1,e.prev=3,c=s(t.blocks.query({keysOnly:!0,signal:r.signal}));case 5:return e.next=7,i(c.next());case 7:return f=e.sent,a=f.done,e.next=11,i(f.value);case 11:if(h=e.sent,a){e.next=19;break}return l=h,e.next=16,{ref:l.toString()};case 16:a=!0,e.next=5;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),o=!0,u=e.t0;case 25:if(e.prev=25,e.prev=26,a||null==c.return){e.next=30;break}return e.next=30,i(c.return());case 30:if(e.prev=30,!o){e.next=33;break}throw u;case 33:return e.finish(30);case 34:return e.finish(25);case 35:case"end":return e.stop()}}),e,null,[[3,21,25,35],[26,,30,34]])})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(2),i=r(1),a=r(26),s=r(25),o=r(18),u=r(96),c=r(32),f=r(19)("ipfs:repo:gc"),h=r(1948),l=h.MFS_ROOT_KEY,p=h.withTimeoutOption,d=r(57).Errors.notFoundError().code,v=r(1993),y=v.parallelMerge,b=v.transform,m=v.map,g=r(150);function k(e){return w.apply(this,arguments)}function w(){return(w=n(i.mark((function e(t){var r,n,h,p,v,b,k,w,x,S,E,_,I,A,T;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.pin,n=t.pinManager,h=t.refs,p=t.repo,v=m((function(e){return e.cid}),r.ls()),b=a(i.mark((function e(){var t;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s(n.getInternalBlocks());case 2:return t=e.sent,e.delegateYield(u(o(t),s),"t0",4);case 4:case"end":return e.stop()}}),e)})))(),k=a(i.mark((function e(){var t,r,n,a,u,v,y,b,m;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,s(p.root.get(l));case 3:t=e.sent,e.next=12;break;case 6:if(e.prev=6,e.t0=e.catch(0),e.t0.code!==d){e.next=11;break}return f("No blocks in MFS"),e.abrupt("return");case 11:throw e.t0;case 12:return r=new c(t),e.next=15,r;case 15:n=!0,a=!1,e.prev=17,v=o(h(r,{recursive:!0}));case 19:return e.next=21,s(v.next());case 21:return y=e.sent,n=y.done,e.next=25,s(y.value);case 25:if(b=e.sent,n){e.next=33;break}return m=b.ref,e.next=30,new c(m);case 30:n=!0,e.next=19;break;case 33:e.next=39;break;case 35:e.prev=35,e.t1=e.catch(17),a=!0,u=e.t1;case 39:if(e.prev=39,e.prev=40,n||null==v.return){e.next=44;break}return e.next=44,s(v.return());case 44:if(e.prev=44,!a){e.next=47;break}throw u;case 47:return e.finish(44);case 48:return e.finish(39);case 49:case"end":return e.stop()}}),e,null,[[0,6],[17,35,39,49],[40,,44,48]])})))(),w=new Set,x=!0,S=!1,e.prev=7,_=o(y(v,b,k));case 9:return e.next=11,_.next();case 11:return I=e.sent,x=I.done,e.next=15,I.value;case 15:if(A=e.sent,x){e.next=22;break}T=A,w.add(g.encode("base32",T.multihash).toString());case 19:x=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(7),S=!0,E=e.t0;case 28:if(e.prev=28,e.prev=29,x||null==_.return){e.next=33;break}return e.next=33,_.return();case 33:if(e.prev=33,!S){e.next=36;break}throw E;case 36:return e.finish(33);case 37:return e.finish(28);case 38:return e.abrupt("return",w);case 39:case"end":return e.stop()}}),e,null,[[7,24,28,38],[29,,33,37]])})))).apply(this,arguments)}function x(e,t,r){return S.apply(this,arguments)}function S(){return(S=a(i.mark((function e(t,r,a){var u,c,h,l,p,d,v,y,m,k,w;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=t.repo,t.refs,c=0,h=0,l=function(){var e=n(i.mark((function e(t){var n,a,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c++,e.prev=1,n=g.encode("base32",t.multihash).toString(),!r.has(n)){e.next=5;break}return e.abrupt("return",null);case 5:return a={cid:t},e.prev=6,e.next=9,u.blocks.delete(t);case 9:h++,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),a.err=new Error("Could not delete block with CID ".concat(t,": ").concat(e.t0.message));case 15:return e.abrupt("return",a);case 18:return e.prev=18,e.t1=e.catch(1),s="Could delete block with CID ".concat(t),f(s,e.t1),e.abrupt("return",{err:new Error(s+": ".concat(e.t1.message))});case 23:case"end":return e.stop()}}),e,null,[[1,18],[6,12]])})));return function(t){return e.apply(this,arguments)}}(),p=!0,d=!1,e.prev=6,y=o(b(256,l,a));case 8:return e.next=10,s(y.next());case 10:return m=e.sent,p=m.done,e.next=14,s(m.value);case 14:if(k=e.sent,p){e.next=23;break}if(!(w=k)){e.next=20;break}return e.next=20,w;case 20:p=!0,e.next=8;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(6),d=!0,v=e.t0;case 29:if(e.prev=29,e.prev=30,p||null==y.return){e.next=34;break}return e.next=34,s(y.return());case 34:if(e.prev=34,!d){e.next=37;break}throw v;case 37:return e.finish(34);case 38:return e.finish(29);case 39:f("Marked set has ".concat(r.size," unique blocks. Blockstore has ").concat(c," blocks. ")+"Deleted ".concat(h," blocks."));case 40:case"end":return e.stop()}}),e,null,[[6,25,29,39],[30,,34,38]])})))).apply(this,arguments)}e.exports=function(e){var t=e.gcLock,r=e.pin,n=e.pinManager,c=e.refs,h=e.repo;return p(function(){var e=a(i.mark((function e(){var a,l,p,d,v=arguments;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v.length>0&&void 0!==v[0]?v[0]:{},a=Date.now(),f("Creating set of marked blocks"),e.next=5,s(t.writeLock());case 5:return l=e.sent,e.prev=6,e.next=9,s(k({pin:r,pinManager:n,refs:c,repo:h}));case 9:return p=e.sent,d=h.blocks.query({keysOnly:!0}),e.delegateYield(u(o(x({repo:h,refs:c},p,d)),s),"t0",12);case 12:f("Complete (".concat(Date.now()-a,"ms)"));case 13:return e.prev=13,l(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[6,,13,16]])})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return a(function(){var e=i(n.mark((function e(r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.stat(r);case 2:return i=e.sent,e.abrupt("return",{numObjects:i.numObjects,repoSize:i.repoSize,repoPath:i.repoPath,version:i.version.toString(),storageMax:i.storageMax});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2012).repoVersion,s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return s(function(){var e=i(n.mark((function e(r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._checkInitialized(r);case 3:e.next=11;break;case 5:if(e.prev=5,e.t0=e.catch(0),![/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some((function(t){return t.test(e.t0.message)}))){e.next=10;break}return e.abrupt("return",a);case 10:throw e.t0;case 11:return e.abrupt("return",t.version.get(r));case 12:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(340),a=r(2),s=r(18),o=r(149),u=r(32),c=r(2005).cidToString,f=r(1948).withTimeoutOption;e.exports=function(e){var t=e.ipld,r=e.name;return f(function(){var e=a(n.mark((function e(a,f){var h,l,p,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C,B,R;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=f||{},o.path(a)){e.next=3;break}throw new Error("invalid argument "+a);case 3:if(!o.ipnsPath(a)){e.next=39;break}if(r){e.next=6;break}throw new Error("failed to resolve IPNS path: name API unavailable");case 6:h=!0,l=!1,e.prev=8,d=s(r.resolve(a,f));case 10:return e.next=12,d.next();case 12:return v=e.sent,h=v.done,e.next=16,v.value;case 16:if(y=e.sent,h){e.next=23;break}a=y;case 20:h=!0,e.next=10;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(8),l=!0,p=e.t0;case 29:if(e.prev=29,e.prev=30,h||null==d.return){e.next=34;break}return e.next=34,d.return();case 34:if(e.prev=34,!l){e.next=37;break}throw p;case 37:return e.finish(34);case 38:return e.finish(29);case 39:if(b=a.split("/"),m=i(b),g=m[2],k=m.slice(3),w=new u(g),0!==k.length){e.next=43;break}return e.abrupt("return","/ipfs/".concat(c(w,{base:f.cidBase})));case 43:a=k.join("/"),x=t.resolve(w,a),S=w,E=a,_=!0,I=!1,e.prev=49,T=s(x);case 51:return e.next=53,T.next();case 53:return C=e.sent,_=C.done,e.next=57,C.value;case 57:if(B=e.sent,_){e.next=64;break}R=B,u.isCID(R.value)&&(S=R.value,E=R.remainderPath);case 61:_=!0,e.next=51;break;case 64:e.next=70;break;case 66:e.prev=66,e.t1=e.catch(49),I=!0,A=e.t1;case 70:if(e.prev=70,e.prev=71,_||null==T.return){e.next=75;break}return e.next=75,T.return();case 75:if(e.prev=75,!I){e.next=78;break}throw A;case 78:return e.finish(75);case 79:return e.finish(70);case 80:return e.abrupt("return","/ipfs/".concat(c(S,{base:f.cidBase})).concat(E?"/"+E:""));case 81:case"end":return e.stop()}}),e,null,[[8,25,29,39],[30,,34,38],[49,66,70,80],[71,,75,79]])})));return function(t,r){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=(r(25),r(26)),s=r(19)("ipfs:components:start"),o=r(2407),u=r(72),c=r(332),f=r(2092),h=r(15),l=r(2056),p=r(2427),d=r(1974),v=d.AlreadyInitializedError,y=d.NotEnabledError,b=r(1984),m=r(2428),g=r(1948).withTimeoutOption;function k(e){var t=e.apiManager,r=e.bitswap,s=e.block,o=e.blockService,u=e.config,f=e.constructorOptions,h=e.dag,l=e.files,p=e.gcLock,d=e.initOptions,m=e.ipld,g=e.ipns,k=e.keychain,w=e.libp2p,x=e.mfsPreload,S=e.peerId,E=e.pin,_=e.pinManager,I=e.preload,A=e.print,T=e.repo,C={data:b.object.data({ipld:m,preload:I}),get:b.object.get({ipld:m,preload:I}),links:b.object.links({dag:h}),new:b.object.new({ipld:m,preload:I}),patch:{addLink:b.object.patch.addLink({ipld:m,gcLock:p,preload:I}),appendData:b.object.patch.appendData({ipld:m,gcLock:p,preload:I}),rmLink:b.object.patch.rmLink({ipld:m,gcLock:p,preload:I}),setData:b.object.patch.setData({ipld:m,gcLock:p,preload:I})},put:b.object.put({ipld:m,gcLock:p,preload:I}),stat:b.object.stat({ipld:m,preload:I})},B=b.addAll({block:s,preload:I,pin:E,gcLock:p,options:f}),R=b.isOnline({libp2p:w}),N=function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new y("dht not enabled");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=a(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new y("dht not enabled");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),M=c(w,"_config.dht.enabled",!1)?b.dht({libp2p:w,repo:T}):{get:N,put:N,findProvs:P,findPeer:N,provide:P,query:P},D=b.dns(),O={pubsub:{cancel:b.name.pubsub.cancel({ipns:g,options:f}),state:b.name.pubsub.state({ipns:g,options:f}),subs:b.name.pubsub.subs({ipns:g,options:f})},publish:b.name.publish({ipns:g,dag:h,peerId:S,isOnline:R,keychain:k,options:f}),resolve:b.name.resolve({dns:D,ipns:g,peerId:S,isOnline:R,options:f})},L=b.resolve({name:O,ipld:m}),K=b.refs({ipld:m,resolve:L,preload:I});K.local=b.refs.local({repo:T});var U=function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new y("pubsub not enabled");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),q=c(f,"config.Pubsub.Enabled",c(u,"Pubsub.Enabled",!0))?b.pubsub({libp2p:w}):{subscribe:U,unsubscribe:U,publish:U,ls:U,peers:U};return{add:b.add({addAll:B}),addAll:B,bitswap:{stat:b.bitswap.stat({bitswap:r}),unwant:b.bitswap.unwant({bitswap:r}),wantlist:b.bitswap.wantlist({bitswap:r}),wantlistForPeer:b.bitswap.wantlistForPeer({bitswap:r})},block:s,bootstrap:{add:b.bootstrap.add({repo:T}),clear:b.bootstrap.clear({repo:T}),list:b.bootstrap.list({repo:T}),reset:b.bootstrap.reset({repo:T}),rm:b.bootstrap.rm({repo:T})},cat:b.cat({ipld:m,preload:I}),config:b.config({repo:T}),dag:h,dht:M,dns:D,files:l,get:b.get({ipld:m,preload:I}),id:b.id({peerId:S,libp2p:w}),init:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new v;case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isOnline:R,key:{export:b.key.export({keychain:k}),gen:b.key.gen({keychain:k}),import:b.key.import({keychain:k}),info:b.key.info({keychain:k}),list:b.key.list({keychain:k}),rename:b.key.rename({keychain:k}),rm:b.key.rm({keychain:k})},libp2p:w,ls:b.ls({ipld:m,preload:I}),name:O,object:C,pin:E,ping:b.ping({libp2p:w}),pubsub:q,refs:K,repo:{gc:b.repo.gc({gcLock:p,pin:E,pinManager:_,refs:K,repo:T}),stat:b.repo.stat({repo:T}),version:b.repo.version({repo:T})},resolve:L,start:function(){return t.api},stats:{bitswap:b.bitswap.stat({bitswap:r}),bw:w.metrics?b.stats.bw({libp2p:w}):i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new y("libp2p metrics not enabled");case 1:case"end":return e.stop()}}),e)}))),repo:b.repo.stat({repo:T})},stop:b.stop({apiManager:t,bitswap:r,options:f,blockService:o,gcLock:p,initOptions:d,ipld:m,ipns:g,keychain:k,libp2p:w,mfsPreload:x,peerId:S,preload:I,print:A,repo:T}),swarm:{addrs:b.swarm.addrs({libp2p:w}),connect:b.swarm.connect({libp2p:w}),disconnect:b.swarm.disconnect({libp2p:w}),localAddrs:b.swarm.localAddrs({multiaddrs:w.multiaddrs}),peers:b.swarm.peers({libp2p:w})},version:b.version({repo:T})}}e.exports=function(e){var t=e.apiManager,r=e.options,a=e.blockService,c=e.gcLock,d=e.initOptions,v=e.ipld,y=e.keychain,w=e.peerId,x=e.pinManager,S=e.preload,E=e.print,_=e.repo;return g(function(){var e=i(n.mark((function e(){var i,g,I,A,T,C,B,R,N,P,M,D,O,L,K;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=f()).promise.catch((function(e){return s(e)})),g=t.update({start:function(){return i.promise}}),I=g.cancel,e.prev=3,!_.closed){e.next=7;break}return e.next=7,_.open();case 7:return e.next=9,_.config.getAll();case 9:if(A=e.sent,T=[],A.Addresses&&A.Addresses.Swarm&&A.Addresses.Swarm.forEach((function(e){var t=u(e);if(t.protoCodes().includes(479))throw h(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");var r=t.getPeerId();r&&r!==w.toB58String()&&(t=t.encapsulate("/p2p/".concat(w.toB58String()))),T.push(t)})),C=b.libp2p({options:r,repo:_,peerId:w,multiaddrs:T,config:A}),e.t0=C.keychain,!e.t0){e.next=17;break}return e.next=17,C.loadKeychain();case 17:return e.next=19,C.start();case 19:return C.transportManager.getAddrs().forEach((function(e){return E("Swarm listening on ".concat(e,"/p2p/").concat(w.toB58String()))})),B=p({libp2p:C,repo:_,peerId:w,options:r}),R=new l(B,_.datastore,w,y,{pass:d.pass}),N=new o(C,_.blocks,{statsEnabled:!0}),e.next=25,N.start();case 25:return a.setExchange(N),P={get:b.dag.get({ipld:v,preload:S}),resolve:b.dag.resolve({ipld:v,preload:S}),tree:b.dag.tree({ipld:v,preload:S})},M={add:b.pin.add({pinManager:x,gcLock:c,dag:P}),ls:b.pin.ls({pinManager:x,dag:P}),rm:b.pin.rm({pinManager:x,gcLock:c,dag:P})},P.put=b.dag.put({ipld:v,pin:M,gcLock:c,preload:S}),D={get:b.block.get({blockService:a,preload:S}),put:b.block.put({blockService:a,pin:M,gcLock:c,preload:S}),rm:b.block.rm({blockService:a,gcLock:c,pinManager:x}),stat:b.block.stat({blockService:a,preload:S})},O=b.files({ipld:v,block:D,blockService:a,repo:_,preload:S,options:r}),L=m({files:O,preload:S,options:r.preload}),e.next=34,Promise.all([R.republisher.start(),S.start(),L.start()]);case 34:K=k({apiManager:t,bitswap:N,block:D,blockService:a,config:A,constructorOptions:r,dag:P,files:O,gcLock:c,initOptions:d,ipld:v,ipns:R,keychain:y,libp2p:C,mfsPreload:L,peerId:w,pin:M,pinManager:x,preload:S,print:E,repo:_}),t.update(K,(function(){})),e.next=43;break;case 38:throw e.prev=38,e.t1=e.catch(3),I(),i.reject(e.t1),e.t1;case 43:return i.resolve(t.api),e.abrupt("return",t.api);case 45:case"end":return e.stop()}}),e,null,[[3,38]])})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(25),u=r(26),c=r(18),f=r(2408),h=r(2418),l=r(2419),p=r(2424),d=r(1961).logger,v=r(2425),y=r(152),b=r(226),m={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},g=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],k=function(){function e(t,r,n){a(this,e),this._libp2p=t,this._log=d(this.peerId),this._options=Object.assign({},m,n),this._stats=new v(g,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new h(t,this,{},this._stats),this.blockstore=r,this.engine=new l(this.peerId,r,this.network,this._stats),this.wm=new f(this.peerId,this.network,this._stats),this.notifications=new p(this.peerId)}return s(e,[{key:"_receiveMessage",value:function(){var e=i(n.mark((function e(t,r){var a,s,o=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.engine.messageReceived(t,r);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),this._log("failed to receive message",r);case 8:if(0!==r.blocks.size){e.next=10;break}return e.abrupt("return");case 10:return a=Array.from(r.blocks.values()),s=a.filter((function(e){return o.wm.wantlist.contains(e.cid)})).map((function(e){return e.cid})),this.wm.cancelWants(s),e.next=15,Promise.all(a.map(function(){var e=i(n.mark((function e(r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=s.includes(r.cid),e.next=3,o._handleReceivedBlock(t,r,i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_handleReceivedBlock",value:function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._log("received block"),e.next=3,this.blockstore.has(r.cid);case 3:if(a=e.sent,this._updateReceiveCounters(t.toB58String(),r,a),i){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.put(r);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_updateReceiveCounters",value:function(e,t,r){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",t.data.length),r&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",t.data.length))}},{key:"_receiveError",value:function(e){this._log.error("ReceiveError: %s",e.message)}},{key:"_onPeerConnected",value:function(e){this.wm.connected(e)}},{key:"_onPeerDisconnected",value:function(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}},{key:"enableStats",value:function(){this._stats.enable()}},{key:"disableStats",value:function(){this._stats.disable()}},{key:"wantlistForPeer",value:function(e){return this.engine.wantlistForPeer(e)}},{key:"ledgerForPeer",value:function(e){return this.engine.ledgerForPeer(e)}},{key:"get",value:function(){var e=i(n.mark((function e(t){var r,a,s,o,u,c,f,h=this,l=arguments;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>1&&void 0!==l[1]?l[1]:{},a=function(e,t){return h.wm.wantBlocks([e],t),h.notifications.wantBlock(e,t)},s=!1,o=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h.blockstore.get(t,r);case 3:return i=e.sent,e.abrupt("return",i);case 7:if(e.prev=7,e.t0=e.catch(0),"ERR_NOT_FOUND"===e.t0.code){e.next=11;break}throw e.t0;case 11:return s||(s=!0,h.network.findAndConnect(t).catch((function(e){return h._log.error(e)}))),e.abrupt("return",a(t,r));case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,r){return e.apply(this,arguments)}}(),u=new y,c=b([r.signal,u.signal]),e.next=8,Promise.race([this.notifications.wantBlock(t,{signal:c}),o(t,{signal:c})]);case 8:return f=e.sent,u.abort(),e.abrupt("return",f);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMany",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return u(n.mark((function i(){var a,s,u,f,h,l,p;return n.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=!0,s=!1,n.prev=2,f=c(e);case 4:return n.next=6,o(f.next());case 6:return h=n.sent,a=h.done,n.next=10,o(h.value);case 10:if(l=n.sent,a){n.next=18;break}return p=l,n.next=15,t.get(p,r);case 15:a=!0,n.next=4;break;case 18:n.next=24;break;case 20:n.prev=20,n.t0=n.catch(2),s=!0,u=n.t0;case 24:if(n.prev=24,n.prev=25,a||null==f.return){n.next=29;break}return n.next=29,o(f.return());case 29:if(n.prev=29,!s){n.next=32;break}throw u;case 32:return n.finish(29);case 33:return n.finish(24);case 34:case"end":return n.stop()}}),i,null,[[2,20,24,34],[25,,29,33]])})))()}},{key:"unwant",value:function(e){var t=this;Array.isArray(e)||(e=[e]),this.wm.unwantBlocks(e),e.forEach((function(e){return t.notifications.unwantBlock(e)}))}},{key:"cancelWants",value:function(e){Array.isArray(e)||(e=[e]),this.wm.cancelWants(e)}},{key:"put",value:function(){var e=i(n.mark((function e(t){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.blockstore.put(t);case 2:this._sendHaveBlockNotifications(t);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"putMany",value:function(e){var t=this;return u(n.mark((function r(){var i,a,s,u,f,h,l;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:i=!0,a=!1,r.prev=2,u=c(t.blockstore.putMany(e));case 4:return r.next=6,o(u.next());case 6:return f=r.sent,i=f.done,r.next=10,o(f.value);case 10:if(h=r.sent,i){r.next=19;break}return l=h,t._sendHaveBlockNotifications(l),r.next=16,l;case 16:i=!0,r.next=4;break;case 19:r.next=25;break;case 21:r.prev=21,r.t0=r.catch(2),a=!0,s=r.t0;case 25:if(r.prev=25,r.prev=26,i||null==u.return){r.next=30;break}return r.next=30,o(u.return());case 30:if(r.prev=30,!a){r.next=33;break}throw s;case 33:return r.finish(30);case 34:return r.finish(25);case 35:case"end":return r.stop()}}),r,null,[[2,21,25,35],[26,,30,34]])})))()}},{key:"_sendHaveBlockNotifications",value:function(e){var t=this;this.notifications.hasBlock(e),this.engine.receivedBlocks([e]),this.network.provide(e.cid).catch((function(e){t._log.error("Failed to provide: %s",e.message)}))}},{key:"getWantlist",value:function(){return this.wm.wantlist.entries()}},{key:"peers",value:function(){return this.engine.peers()}},{key:"stat",value:function(){return this._stats}},{key:"start",value:function(){this.wm.start(),this.network.start(),this.engine.start()}},{key:"stop",value:function(){this._stats.stop(),this.wm.stop(),this.network.stop(),this.engine.stop()}},{key:"peerId",get:function(){return this._libp2p.peerId}}]),e}();e.exports=k},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(1980),s=r(1991),o=r(1992),u=r(2417),c=r(1961).logger;e.exports=function(){function e(t,r,i){n(this,e),this.peers=new Map,this.wantlist=new s(i),this.network=r,this._stats=i,this._peerId=t,this._log=c(t,"want")}return i(e,[{key:"_addEntries",value:function(e,t,r){var n=this,i=e.map((function(e,r){return new a.Entry(e,o.kMaxPriority-r,a.WantType.Block,t)}));i.forEach((function(e){e.cancel?r?n.wantlist.removeForce(e.cid):n.wantlist.remove(e.cid):(n._log("adding to wl"),n.wantlist.add(e.cid,e.priority))}));var s=!0,u=!1,c=void 0;try{for(var f,h=this.peers.values()[Symbol.iterator]();!(s=(f=h.next()).done);s=!0){f.value.addEntries(i)}}catch(l){u=!0,c=l}finally{try{s||null==h.return||h.return()}finally{if(u)throw c}}}},{key:"_startPeerHandler",value:function(e){var t=this.peers.get(e.toB58String());if(!t){t=new u(this._peerId,e,this.network);var r=new a(!0),n=!0,i=!1,s=void 0;try{for(var o,c=this.wantlist.entries()[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var f=o.value;r.addEntry(f[1].cid,f[1].priority)}}catch(h){i=!0,s=h}finally{try{n||null==c.return||c.return()}finally{if(i)throw s}}return t.addMessage(r),this.peers.set(e.toB58String(),t),t}t.refcnt++}},{key:"_stopPeerHandler",value:function(e){var t=this.peers.get(e.toB58String());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toB58String()))}},{key:"wantBlocks",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._addEntries(e,!1),r&&r.signal&&r.signal.addEventListener("abort",(function(){t.cancelWants(e)}))}},{key:"unwantBlocks",value:function(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}},{key:"cancelWants",value:function(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}},{key:"connectedPeers",value:function(){return Array.from(this.peers.keys())}},{key:"connected",value:function(e){this._startPeerHandler(e)}},{key:"disconnected",value:function(e){this._stopPeerHandler(e)}},{key:"start",value:function(){}},{key:"stop",value:function(){var e=this;this.peers.forEach((function(t){return e.disconnected(t.peerId)})),clearInterval(this.timer)}}]),e}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(15),o=r(128),u=r(2410);function c(e,t,r){return f.apply(this,arguments)}function f(){return(f=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.digest(t,r,i);case 2:return a=e.sent,e.abrupt("return",o.encode(a,r,i));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}c.Buffer=a,c.multihash=o,c.digest=function(){var e=i(n.mark((function e(t,r,i){var a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.createHash(r),e.next=3,a(t);case 3:return s=e.sent,e.abrupt("return",i?s.slice(0,i):s);case 5:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),c.createHash=function(e){if(!e)throw s(new Error("hash algorithm must be specified"),"ERR_HASH_ALGORITHM_NOT_SPECIFIED");if(e=o.coerceCode(e),!c.functions[e])throw s(new Error("multihash function '".concat(e,"' not yet supported")),"ERR_HASH_ALGORITHM_NOT_SUPPORTED");return c.functions[e]},c.functions={0:u.identity,17:u.sha1,18:u.sha2256,19:u.sha2512,20:u.sha3512,21:u.sha3384,22:u.sha3256,23:u.sha3224,24:u.shake128,25:u.shake256,26:u.keccak224,27:u.keccak256,28:u.keccak384,29:u.keccak512,34:u.murmur3128,35:u.murmur332,86:u.dblSha2256},u.addBlake(c.functions),c.validate=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c(t,o.decode(r).name);case 2:return i=e.sent,e.abrupt("return",0===a.compare(r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(171),o=r(337),u=r(2411).factory,c=r(2412).fromNumberTo32BitBuf,f=function(e){return function(){var t=i(n.mark((function t(r){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="sha3-224"===t.t0?3:"sha3-256"===t.t0?4:"sha3-384"===t.t0?5:"sha3-512"===t.t0?6:"shake-128"===t.t0?7:"shake-256"===t.t0?8:"keccak-224"===t.t0?9:"keccak-256"===t.t0?10:"keccak-384"===t.t0?11:"keccak-512"===t.t0?12:"murmur3-128"===t.t0?13:"murmur3-32"===t.t0?14:15;break;case 3:return t.abrupt("return",a.from(s.sha3_224.arrayBuffer(r)));case 4:return t.abrupt("return",a.from(s.sha3_256.arrayBuffer(r)));case 5:return t.abrupt("return",a.from(s.sha3_384.arrayBuffer(r)));case 6:return t.abrupt("return",a.from(s.sha3_512.arrayBuffer(r)));case 7:return t.abrupt("return",a.from(s.shake128.create(128).update(r).arrayBuffer()));case 8:return t.abrupt("return",a.from(s.shake256.create(256).update(r).arrayBuffer()));case 9:return t.abrupt("return",a.from(s.keccak224.arrayBuffer(r)));case 10:return t.abrupt("return",a.from(s.keccak256.arrayBuffer(r)));case 11:return t.abrupt("return",a.from(s.keccak384.arrayBuffer(r)));case 12:return t.abrupt("return",a.from(s.keccak512.arrayBuffer(r)));case 13:return t.abrupt("return",a.from(o.x64.hash128(r),"hex"));case 14:return t.abrupt("return",c(o.x86.hash32(r)));case 15:throw new TypeError("".concat(e," is not a supported algorithm"));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()};e.exports={identity:function(e){return a.from(e)},sha1:u("sha1"),sha2256:u("sha2-256"),sha2512:u("sha2-512"),dblSha2256:u("dbl-sha2-256"),sha3224:f("sha3-224"),sha3256:f("sha3-256"),sha3384:f("sha3-384"),sha3512:f("sha3-512"),shake128:f("shake-128"),shake256:f("shake-256"),keccak224:f("keccak-224"),keccak256:f("keccak-256"),keccak384:f("keccak-384"),keccak512:f("keccak-512"),murmur3128:f("murmur3-128"),murmur332:f("murmur3-32"),addBlake:r(2413)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(128),o=self.crypto||self.msCrypto,u=function(){var e=i(n.mark((function e(t,r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof self&&(self.crypto||self.msCrypto)){e.next=2;break}throw new Error("Please use a browser with webcrypto support and ensure the code has been delivered securely via HTTPS/TLS and run within a Secure Context");case 2:e.t0=r,e.next="sha1"===e.t0?5:"sha2-256"===e.t0?10:"sha2-512"===e.t0?15:"dbl-sha2-256"===e.t0?20:28;break;case 5:return e.t1=a,e.next=8,o.subtle.digest({name:"SHA-1"},t);case 8:return e.t2=e.sent,e.abrupt("return",e.t1.from.call(e.t1,e.t2));case 10:return e.t3=a,e.next=13,o.subtle.digest({name:"SHA-256"},t);case 13:return e.t4=e.sent,e.abrupt("return",e.t3.from.call(e.t3,e.t4));case 15:return e.t5=a,e.next=18,o.subtle.digest({name:"SHA-512"},t);case 18:return e.t6=e.sent,e.abrupt("return",e.t5.from.call(e.t5,e.t6));case 20:return e.next=22,o.subtle.digest({name:"SHA-256"},t);case 22:return i=e.sent,e.t7=a,e.next=26,o.subtle.digest({name:"SHA-256"},i);case 26:return e.t8=e.sent,e.abrupt("return",e.t7.from.call(e.t7,e.t8));case 28:throw new Error("".concat(r," is not a supported algorithm"));case 29:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();e.exports={factory:function(e){return function(){var t=i(n.mark((function t(r){return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",u(r,e));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},digest:u,multihashing:function(){var e=i(n.mark((function e(t,r,i){var a;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t,r,i);case 2:return a=e.sent,e.abrupt("return",s.encode(a,r,i));case 4:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}},function(e,t,r){"use strict";var n=r(3).Buffer;e.exports={fromNumberTo32BitBuf:function(e){for(var t=new Array(4),r=0;r<4;r++)t[r]=255&e,e>>=8;return n.from(t)}}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(3).Buffer,s=r(228),o={init:s.blake2bInit,update:s.blake2bUpdate,digest:s.blake2bFinal},u={init:s.blake2sInit,update:s.blake2sUpdate,digest:s.blake2sFinal},c=function(e,t){return function(){var r=i(n.mark((function r(i){var s;return n.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=t.init(e,null),t.update(s,i),r.abrupt("return",a.from(t.digest(s)));case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}()};e.exports=function(e){for(var t=0;t<64;t++)e[45569+t]=c(t+1,o);for(var r=0;r<32;r++)e[45633+r]=c(r+1,u)}},function(e,t,r){"use strict";var n=r(73);e.exports=n("\n  message Message {\n    message Wantlist {\n      enum WantType {\n        Block = 0;\n        Have = 1;\n      }\n\n      message Entry {\n        // changed from string to bytes, it makes a difference in JavaScript\n        optional bytes block = 1;      // the block cid (cidV0 in bitswap 1.0.0, cidV1 in bitswap 1.1.0)\n        optional int32 priority = 2;    // the priority (normalized). default to 1\n        optional bool cancel = 3;       // whether this revokes an entry\n        WantType wantType = 4;         // Note: defaults to enum 0, ie Block\n        bool sendDontHave = 5;        // Note: defaults to false\n      }\n\n      repeated Entry entries = 1;       // a list of wantlist entries\n      optional bool full = 2;           // whether this is the full wantlist. default to false\n    }\n\n    message Block {\n      optional bytes prefix = 1;        // CID prefix (cid version, multicodec and multihash prefix (type + length)\n      optional bytes data = 2;\n    }\n\n    enum BlockPresenceType {\n      Have = 0;\n      DontHave = 1;\n    }\n    message BlockPresence {\n      bytes cid = 1;\n      BlockPresenceType type = 2;\n    }\n\n    optional Wantlist wantlist = 1;\n    repeated bytes blocks = 2;          // used to send Blocks in bitswap 1.0.0\n    repeated Block payload = 3;         // used to send Blocks in bitswap 1.1.0\n    repeated BlockPresence blockPresences = 4;\n    int32 pendingBytes = 5;\n  }\n")},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(1991).Entry;e.exports=function(){function e(t,r,i,s,o){n(this,e),this.entry=new a(t,r,i),this.cancel=Boolean(s),this.sendDontHave=Boolean(o)}return i(e,[{key:"equals",value:function(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}},{key:"cid",get:function(){return this.entry.cid},set:function(e){this.entry.cid=e}},{key:"priority",get:function(){return this.entry.priority},set:function(e){this.entry.priority=e}},{key:"wantType",get:function(){return this.entry.wantType},set:function(e){this.entry.wantType=e}},{key:Symbol.toStringTag,get:function(){var e=this.cid.toString("base58btc");return"BitswapMessageEntry ".concat(e," <cancel: ").concat(this.cancel,", priority: ").concat(this.priority,">")}}]),e}()},function(e,t,r){"use strict";var n=r(5),i=r(7),a=function(){function e(t,r,i){n(this,e),this._refCounter=1,this.cid=t,this.priority=r||1,this.wantType=i}return i(e,[{key:"inc",value:function(){this._refCounter+=1}},{key:"dec",value:function(){this._refCounter=Math.max(0,this._refCounter-1)}},{key:"hasRefs",value:function(){return this._refCounter>0}},{key:"equals",value:function(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}},{key:Symbol.toStringTag,get:function(){var e=this.cid.toString("base58btc");return"WantlistEntry <key: ".concat(e,", priority: ").concat(this.priority,", refs: ").concat(this._refCounter,">")}}]),e}();e.exports=a},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(828),u=r(1980),c=r(1961).logger,f=r(1992).wantlistSendDebounceMs;e.exports=function(){function e(t,r,n){a(this,e),this.peerId=r,this.network=n,this.refcnt=1,this._entries=[],this._log=c(t,"msgqueue",r.toB58String().slice(0,8)),this.sendEntries=o(this._sendEntries.bind(this),f)}return s(e,[{key:"addMessage",value:function(e){e.empty||this.send(e)}},{key:"addEntries",value:function(e){this._entries=this._entries.concat(e),this.sendEntries()}},{key:"_sendEntries",value:function(){if(this._entries.length){var e=new u(!1);this._entries.forEach((function(t){t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)})),this._entries=[],this.addMessage(e)}}},{key:"send",value:function(){var e=i(n.mark((function e(t){var r=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.network.connectTo(this.peerId);case 3:e.next=9;break;case 5:return e.prev=5,e.t0=e.catch(0),this._log.error("cant connect to peer %s: %s",this.peerId.toB58String(),e.t0.message),e.abrupt("return");case 9:this._log("sending message to peer %s",this.peerId.toB58String()),this.network.sendMessage(this.peerId,t).catch((function(e){r._log.error("send error: %s",e.message)}));case 11:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(5),s=r(7),o=r(18),u=r(100),c=r(78),f=r(2015),h=r(1980),l=r(1992),p=r(1961).logger,d=function(){function e(t,r,n,i){a(this,e),this._log=p(t.peerId,"network"),n=n||{},this.libp2p=t,this.bitswap=r,this.protocols=["/ipfs/bitswap/1.0.0"],n.b100Only||(this.protocols.unshift("/ipfs/bitswap/1.1.0"),this.protocols.unshift("/ipfs/bitswap/1.2.0")),this._stats=i,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this)}return s(e,[{key:"start",value:function(){this._running=!0,this.libp2p.handle(this.protocols,this._onConnection);var e=new f({multicodecs:this.protocols,handlers:{onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect}});this._registrarId=this.libp2p.registrar.register(e);var t=!0,r=!1,n=void 0;try{for(var i,a=this.libp2p.peerStore.peers.values()[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value,o=this.libp2p.connectionManager.get(s.id);o&&this._onPeerConnect(o.remotePeer)}}catch(u){r=!0,n=u}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"stop",value:function(){this._running=!1,this.libp2p.unhandle(this.protocols),this.libp2p.registrar.unregister(this._registrarId)}},{key:"_onConnection",value:function(){var e=i(n.mark((function e(t){var r,a,s,f=this;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.protocol,a=t.stream,s=t.connection,this._running){e.next=3;break}return e.abrupt("return");case 3:return this._log("incoming new bitswap %s connection from %s",r,s.remotePeer.toB58String()),e.prev=4,e.next=7,c(a,u.decode(),function(){var e=i(n.mark((function e(t){var r,i,a,u,c,l,p,d;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!0,i=!1,e.prev=2,u=o(t);case 4:return e.next=6,u.next();case 6:return c=e.sent,r=c.done,e.next=10,c.value;case 10:if(l=e.sent,r){e.next=28;break}return p=l,e.prev=13,e.next=16,h.deserialize(p.slice());case 16:return d=e.sent,e.next=19,f.bitswap._receiveMessage(s.remotePeer,d);case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(13),f.bitswap._receiveError(e.t0),e.abrupt("break",28);case 25:r=!0,e.next=4;break;case 28:e.next=34;break;case 30:e.prev=30,e.t1=e.catch(2),i=!0,a=e.t1;case 34:if(e.prev=34,e.prev=35,r||null==u.return){e.next=39;break}return e.next=39,u.return();case 39:if(e.prev=39,!i){e.next=42;break}throw a;case 42:return e.finish(39);case 43:return e.finish(34);case 44:case"end":return e.stop()}}),e,null,[[2,30,34,44],[13,21],[35,,39,43]])})));return function(t){return e.apply(this,arguments)}}());case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(4),this._log(e.t0);case 12:case"end":return e.stop()}}),e,this,[[4,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_onPeerConnect",value:function(e){this.bitswap._onPeerConnected(e)}},{key:"_onPeerDisconnect",value:function(e){this.bitswap._onPeerDisconnected(e)}},{key:"findProviders",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.libp2p.contentRouting.findProviders(e,{maxTimeout:l.providerRequestTimeout,maxNumProviders:t,signal:r.signal})}},{key:"findAndConnect",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,u,c,f,h,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=!0,s=!1,e.prev=3,c=o(this.findProviders(t,l.maxProvidersPerRequest,r));case 5:return e.next=7,c.next();case 7:return f=e.sent,a=f.done,e.next=11,f.value;case 11:if(h=e.sent,a){e.next=19;break}p=h,this._log("connecting to providers",p.id.toB58String()),i.push(this.connectTo(p,r));case 16:a=!0,e.next=5;break;case 19:e.next=25;break;case 21:e.prev=21,e.t0=e.catch(3),s=!0,u=e.t0;case 25:if(e.prev=25,e.prev=26,a||null==c.return){e.next=30;break}return e.next=30,c.return();case 30:if(e.prev=30,!s){e.next=33;break}throw u;case 33:return e.finish(30);case 34:return e.finish(25);case 35:return e.next=37,Promise.all(i);case 37:case"end":return e.stop()}}),e,this,[[3,21,25,35],[26,,30,34]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"provide",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.libp2p.contentRouting.provide(t,r);case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=i(n.mark((function e(t,r){var i,a,s,o,u;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._running){e.next=2;break}throw new Error("network isn't running");case 2:return i=t.toB58String(),this._log("sendMessage to %s",i,r),e.next=6,this._dialPeer(t);case 6:a=e.sent,s=a.stream,o=a.protocol,e.t0=o,e.next="/ipfs/bitswap/1.0.0"===e.t0?12:"/ipfs/bitswap/1.1.0"===e.t0?14:"/ipfs/bitswap/1.2.0"===e.t0?14:16;break;case 12:return u=r.serializeToBitswap100(),e.abrupt("break",17);case 14:return u=r.serializeToBitswap110(),e.abrupt("break",17);case 16:throw new Error("Unknown protocol: "+o);case 17:v(s,u,this._log),this._updateSentStats(t,r.blocks);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"connectTo",value:function(){var e=i(n.mark((function e(t,r){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._running){e.next=2;break}throw new Error("network isn't running");case 2:return e.abrupt("return",this.libp2p.dial(t,r));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_dialPeer",value:function(e){return this.libp2p.dialProtocol(e,["/ipfs/bitswap/1.2.0","/ipfs/bitswap/1.1.0","/ipfs/bitswap/1.0.0"])}},{key:"_updateSentStats",value:function(e,t){var r=this,n=e.toB58String();this._stats&&(t.forEach((function(e){return r._stats.push(n,"dataSent",e.data.length)})),this._stats.push(n,"blocksSent",t.size))}}]),e}();function v(e,t,r){return y.apply(this,arguments)}function y(){return(y=i(n.mark((function e(t,r,i){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,c([r],u.encode(),t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}e.exports=d},function(e,t,r){"use strict";var n=r(68),i=r(1),a=r(48),s=r(2),o=r(46),u=r(5),c=r(7),f=r(32),h=r(1980),l=h.WantType,p=r(1991),d=r(2420),v=r(2421),y=r(2423),b=r(1961).logger,m=function(){function e(t,r,n,i,a){u(this,e),this._log=b(t,"engine"),this.blockstore=r,this.network=n,this._stats=i,this._opts=this._processOpts(a),this.ledgerMap=new Map,this._running=!1,this._requestQueue=new v(y)}return c(e,[{key:"_processOpts",value:function(e){return o({maxSizeReplaceHasWithBlock:1024,targetMessageSize:16384},e)}},{key:"_scheduleProcessTasks",value:function(){var e=this;setTimeout((function(){e._processTasks()}))}},{key:"_processTasks",value:function(){var e=s(i.mark((function e(){var t,r,n,s,o,u,c,l,p,d,v,y,b,m,g,k,w,x,S,E,_,I,A,T,C,B,R,N,P,M,D;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._running){e.next=2;break}return e.abrupt("return");case 2:if(t=this._requestQueue.popTasks(this._opts.targetMessageSize),r=t.peerId,n=t.tasks,s=t.pendingSize,0!==n.length){e.next=5;break}return e.abrupt("return");case 5:for((o=new h(!1)).setPendingBytes(s),u=[],c=new Map,l=!0,p=!1,d=void 0,e.prev=12,v=n[Symbol.iterator]();!(l=(y=v.next()).done);l=!0)b=y.value,m=new f(b.topic),b.data.haveBlock?b.data.isWantBlock?(u.push(m),c.set(b.topic,b.data)):o.addHave(m):o.addDontHave(m);e.next=20;break;case 16:e.prev=16,e.t0=e.catch(12),p=!0,d=e.t0;case 20:e.prev=20,e.prev=21,l||null==v.return||v.return();case 23:if(e.prev=23,!p){e.next=26;break}throw d;case 26:return e.finish(23);case 27:return e.finish(20);case 28:return e.next=30,this._getBlocks(u);case 30:for(g=e.sent,k=!0,w=!1,x=void 0,e.prev=34,S=c[Symbol.iterator]();!(k=(E=S.next()).done);k=!0)_=a(E.value,2),I=_[0],A=_[1],(T=g.get(I))?o.addBlock(T):A.sendDontHave&&(C=new f(I),o.addDontHave(C));e.next=42;break;case 38:e.prev=38,e.t1=e.catch(34),w=!0,x=e.t1;case 42:e.prev=42,e.prev=43,k||null==S.return||S.return();case 45:if(e.prev=45,!w){e.next=48;break}throw x;case 48:return e.finish(45);case 49:return e.finish(42);case 50:if(!o.empty){e.next=54;break}return this._requestQueue.tasksDone(r,n),this._scheduleProcessTasks(),e.abrupt("return");case 54:return e.prev=54,e.next=57,this.network.sendMessage(r,o);case 57:for(B=!0,R=!1,N=void 0,e.prev=60,P=g.values()[Symbol.iterator]();!(B=(M=P.next()).done);B=!0)D=M.value,this.messageSent(r,D);e.next=68;break;case 64:e.prev=64,e.t2=e.catch(60),R=!0,N=e.t2;case 68:e.prev=68,e.prev=69,B||null==P.return||P.return();case 71:if(e.prev=71,!R){e.next=74;break}throw N;case 74:return e.finish(71);case 75:return e.finish(68);case 76:e.next=81;break;case 78:e.prev=78,e.t3=e.catch(54),this._log.error(e.t3);case 81:this._requestQueue.tasksDone(r,n),this._scheduleProcessTasks();case 83:case"end":return e.stop()}}),e,this,[[12,16,20,28],[21,,23,27],[34,38,42,50],[43,,45,49],[54,78],[60,64,68,76],[69,,71,75]])})));return function(){return e.apply(this,arguments)}}()},{key:"wantlistForPeer",value:function(e){var t=e.toB58String();return this.ledgerMap.has(t)?this.ledgerMap.get(t).wantlist.sortedEntries():new Map}},{key:"ledgerForPeer",value:function(e){var t=e.toB58String(),r=this.ledgerMap.get(t);return r?{peer:r.partner.toPrint(),value:r.debtRatio(),sent:r.accounting.bytesSent,recv:r.accounting.bytesRecv,exchanged:r.exchangeCount}:null}},{key:"peers",value:function(){return Array.from(this.ledgerMap.values()).map((function(e){return e.partner}))}},{key:"receivedBlocks",value:function(e){var t=this;e.length&&(this.ledgerMap.forEach((function(r){e.forEach((function(e){var n=r.wantlistContains(e.cid);if(n){var i=e.data.length,a=t._sendAsBlock(n.wantType,i),s=i;a||(s=h.blockPresenceSize(n.cid)),t._requestQueue.pushTasks(r.partner,[{topic:n.cid.toString(),priority:n.priority,size:s,data:{blockSize:i,isWantBlock:a,haveBlock:!0,sendDontHave:!1}}])}}))})),this._scheduleProcessTasks())}},{key:"messageReceived",value:function(){var e=s(i.mark((function e(t,r){var n,a,s;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._findOrCreate(t),!r.empty){e.next=3;break}return e.abrupt("return");case 3:if(r.full&&(n.wantlist=new p),this._updateBlockAccounting(r.blocks,n),0!==r.wantlist.size){e.next=8;break}return this._scheduleProcessTasks(),e.abrupt("return");case 8:return a=[],s=[],r.wantlist.forEach((function(e){e.cancel?(n.cancelWant(e.cid),a.push(e.cid)):(n.wants(e.cid,e.priority,e.wantType),s.push(e))})),this._cancelWants(t,a),e.next=14,this._addWants(t,s);case 14:this._scheduleProcessTasks();case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_cancelWants",value:function(e,t){var r=!0,n=!1,i=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;this._requestQueue.remove(o.toString(),e)}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}}},{key:"_addWants",value:function(){var e=s(i.mark((function e(t,r){var n,a,s,o,u,c,f,p,d,v,y,b;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getBlockSizes(r.map((function(e){return e.cid})));case 2:for(n=e.sent,a=[],s=!0,o=!1,u=void 0,e.prev=7,c=r[Symbol.iterator]();!(s=(f=c.next()).done);s=!0)p=f.value,d=p.cid.toString(),null==(v=n.get(d))?p.sendDontHave&&a.push({topic:d,priority:p.priority,size:h.blockPresenceSize(p.cid),data:{isWantBlock:p.wantType===l.Block,blockSize:0,haveBlock:!1,sendDontHave:p.sendDontHave}}):(y=this._sendAsBlock(p.wantType,v),b=v,y||(b=h.blockPresenceSize(p.cid)),a.push({topic:d,priority:p.priority,size:b,data:{isWantBlock:y,blockSize:v,haveBlock:!0,sendDontHave:p.sendDontHave}})),this._requestQueue.pushTasks(t,a);e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),o=!0,u=e.t0;case 15:e.prev=15,e.prev=16,s||null==c.return||c.return();case 18:if(e.prev=18,!o){e.next=21;break}throw u;case 21:return e.finish(18);case 22:return e.finish(15);case 23:case"end":return e.stop()}}),e,this,[[7,11,15,23],[16,,18,22]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_sendAsBlock",value:function(e,t){return e===l.Block||t<=this._opts.maxSizeReplaceHasWithBlock}},{key:"_getBlockSizes",value:function(){var e=s(i.mark((function e(t){var r;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getBlocks(t);case 2:return r=e.sent,e.abrupt("return",new Map(n(r).map((function(e){var t=a(e,2);return[t[0],t[1].data.length]}))));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getBlocks",value:function(){var e=s(i.mark((function e(t){var r,n=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Map,e.next=3,Promise.all(t.map(function(){var e=s(i.mark((function e(t){var a;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.blockstore.get(t);case 3:a=e.sent,r.set(t.toString(),a),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),"ERR_NOT_FOUND"!==e.t0.code&&n._log.error("failed to query blockstore for %s: %s",t,e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateBlockAccounting",value:function(e,t){var r=this;e.forEach((function(e){r._log("got block (%s bytes)",e.data.length),t.receivedBytes(e.data.length)}))}},{key:"messageSent",value:function(e,t){var r=this._findOrCreate(e);r.sentBytes(t?t.data.length:0),t&&t.cid&&r.wantlist.remove(t.cid)}},{key:"numBytesSentTo",value:function(e){return this._findOrCreate(e).accounting.bytesSent}},{key:"numBytesReceivedFrom",value:function(e){return this._findOrCreate(e).accounting.bytesRecv}},{key:"peerDisconnected",value:function(e){}},{key:"_findOrCreate",value:function(e){var t=e.toB58String();if(this.ledgerMap.has(t))return this.ledgerMap.get(t);var r=new d(e);return this.ledgerMap.set(t,r),this._stats&&this._stats.push(t,"peerCount",1),r}},{key:"start",value:function(){this._running=!0}},{key:"stop",value:function(){this._running=!1}}]),e}();e.exports=m},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(1991),s=function(){function e(t){n(this,e),this.partner=t,this.wantlist=new a,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}return i(e,[{key:"sentBytes",value:function(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}},{key:"receivedBytes",value:function(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}},{key:"wants",value:function(e,t,r){this.wantlist.add(e,t,r)}},{key:"cancelWant",value:function(e){this.wantlist.remove(e)}},{key:"wantlistContains",value:function(e){return this.wantlist.contains(e)}},{key:"debtRatio",value:function(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}]),e}();e.exports=s},function(e,t,r){"use strict";var n=r(68),i=r(48),a=r(5),s=r(7),o=r(2422),u={hasNewInfo:function(){return!1},merge:function(){}},c=function(){function e(t){a(this,e),this._taskMerger=t||u,this._byPeer=new o([],f.compare,!0)}return s(e,[{key:"pushTasks",value:function(e,t){var r=this._byPeer.get(e.toB58String());r||(r=new f(e,this._taskMerger)),r.pushTasks(t),this._byPeer.set(e.toB58String(),r)}},{key:"popTasks",value:function(e){if(0===this._byPeer.size)return{tasks:[],pendingSize:0};var t=this._head(),r=t.popTasks(e),n=r.tasks,i=r.pendingSize;if(0===n.length)return{tasks:n,pendingSize:i};var a=t.peerId;return t.isIdle()?this._byPeer.delete(a.toB58String()):this._byPeer.update(0),{peerId:a,tasks:n,pendingSize:i}}},{key:"_head",value:function(){var e=!0,t=!1,r=void 0;try{for(var n,a=this._byPeer[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){return i(n.value,2)[1]}}catch(s){t=!0,r=s}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},{key:"remove",value:function(e,t){var r=this._byPeer.get(t.toB58String());r&&r.remove(e)}},{key:"tasksDone",value:function(e,t){var r=this._byPeer.get(e.toB58String());if(r){var n=this._byPeer.indexOf(e.toB58String()),i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value;r.taskDone(c)}}catch(f){a=!0,s=f}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}this._byPeer.update(n)}}}]),e}(),f=function(){function e(t,r){a(this,e),this.peerId=t,this._taskMerger=r,this._activeTotalSize=0,this._pending=new h,this._active=new Set}return s(e,[{key:"pushTasks",value:function(e){var t=!0,r=!1,n=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var s=i.value;this._pushTask(s)}}catch(o){r=!0,n=o}finally{try{t||null==a.return||a.return()}finally{if(r)throw n}}}},{key:"_pushTask",value:function(e){if(this._taskHasMoreInfoThanActiveTasks(e)){var t=this._pending.get(e.topic);if(t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}}},{key:"_taskHasMoreInfoThanActiveTasks",value:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var a,s=this._active[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;o.topic===e.topic&&t.push(o)}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}return 0===t.length||this._taskMerger.hasNewInfo(e,t)}},{key:"popTasks",value:function(e){for(var t=0,r=[],n=this._pending.tasks(),i=0;i<n.length&&t<e;i++){var a=n[i];r.push(a),t+=a.size,this._pending.delete(a.topic),this._activeTotalSize+=a.size,this._active.add(a)}return{tasks:r,pendingSize:this._pending.totalSize}}},{key:"taskDone",value:function(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}},{key:"remove",value:function(e){this._pending.delete(e)}},{key:"isIdle",value:function(){return 0===this._pending.length&&0===this._active.length}}],[{key:"compare",value:function(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}]),e}(),h=function(){function e(){a(this,e),this._tasks=new o([],this._compare)}return s(e,[{key:"get",value:function(e){return(this._tasks.get(e)||{}).task}},{key:"add",value:function(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}},{key:"delete",value:function(e){this._tasks.delete(e)}},{key:"tasks",value:function(){return n(this._tasks.values()).map((function(e){return e.task}))}},{key:"updatePriority",value:function(e,t){var r=this._tasks.get(e);if(r){var n=this._tasks.indexOf(e);r.task.priority=t,this._tasks.update(n)}}},{key:"_compare",value:function(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}},{key:"length",get:function(){return this._tasks.size}},{key:"totalSize",get:function(){return n(this._tasks.values()).reduce((function(e,t){return e+t.task.size}),0)}}]),e}();e.exports=c},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(5),s=r(7),o=r(28),u=r(27),c=r(127),f=r(29),h=function(e){function t(e,r){var n;a(this,t),(n=o(this,u(t).call(this)))._cmp=r||n._defaultSort,n._keys=[];var s=!0,c=!1,f=void 0;try{for(var h,l=(e||[])[Symbol.iterator]();!(s=(h=l.next()).done);s=!0){var p=i(h.value,2),d=p[0],v=p[1];n.set(d,v)}}catch(y){c=!0,f=y}finally{try{s||null==l.return||l.return()}finally{if(c)throw f}}return n}return f(t,e),s(t,[{key:"update",value:function(e){if(!(e<0||e>=this._keys.length)){var t=this._keys[e];this._keys.splice(e,1);var r=this._find(t);this._keys.splice(r,0,t)}}},{key:"set",value:function(e,r){if(this.has(e)){var n=this.indexOf(e);this._keys.splice(n,1)}c(u(t.prototype),"set",this).call(this,e,r);var i=this._find(e);this._keys.splice(i,0,e)}},{key:"clear",value:function(){c(u(t.prototype),"clear",this).call(this),this._keys=[]}},{key:"delete",value:function(e){if(this.has(e)){var r=this.indexOf(e);this._keys.splice(r,1),c(u(t.prototype),"delete",this).call(this,e)}}},{key:"indexOf",value:function(e){if(!this.has(e))return-1;var t=this._find(e);if(this._keys[t]===e)return t;for(var r=1;r<this._keys.length;r++){if(this._keys[t+r]===e)return t+r;if(this._keys[t-r]===e)return t-r}return-1}},{key:"_find",value:function(e){for(var t=0,r=this._keys.length;t<r;){var n=t+r>>>1,i=this._kCmp(this._keys[n],e);if(i<0)t=n+1;else{if(!(i>0))return n;r=n}}return t}},{key:"keys",value:n.mark((function e(){var t,r,i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,i=void 0,e.prev=3,a=this._keys[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=12;break}return o=s.value,e.next=9,o;case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))},{key:"values",value:n.mark((function e(){var t,r,i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,i=void 0,e.prev=3,a=this._keys[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=12;break}return o=s.value,e.next=9,this.get(o);case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))},{key:"entries",value:n.mark((function e(){var t,r,i,a,s,o;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!0,r=!1,i=void 0,e.prev=3,a=this._keys[Symbol.iterator]();case 5:if(t=(s=a.next()).done){e.next=12;break}return o=s.value,e.next=9,[o,this.get(o)];case 9:t=!0,e.next=5;break;case 12:e.next=18;break;case 14:e.prev=14,e.t0=e.catch(3),r=!0,i=e.t0;case 18:e.prev=18,e.prev=19,t||null==a.return||a.return();case 21:if(e.prev=21,!r){e.next=24;break}throw i;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[3,14,18,26],[19,,21,25]])}))},{key:Symbol.iterator,value:n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this.entries(),"t0",1);case 1:case"end":return e.stop()}}),e,this)}))},{key:"forEach",value:function(e,t){if(e){var r=!0,n=!1,i=void 0;try{for(var a,s=this._keys[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var o=a.value;e.apply(t,[[o,this.get(o)]])}}catch(u){n=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(n)throw i}}}}},{key:"_defaultSort",value:function(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}},{key:"_kCmp",value:function(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}]),t}(r(110)(Map));e.exports=h},function(e,t,r){"use strict";var n={hasNewInfo:function(e,t){var r=!1,n=!1,i=!0,a=!1,s=void 0;try{for(var o,u=t[Symbol.iterator]();!(i=(o=u.next()).done);i=!0){var c=o.value;c.data.haveBlock&&(r=!0),c.data.isWantBlock&&(n=!0)}}catch(f){a=!0,s=f}finally{try{i||null==u.return||u.return()}finally{if(a)throw s}}return!(n||!e.data.isWantBlock)||!(r||!e.data.haveBlock)},merge:function(e,t){var r=e.data,n=t.data;!n.haveBlock&&r.haveBlock&&(n.haveBlock=r.haveBlock,n.blockSize=r.blockSize),!n.isWantBlock&&r.isWantBlock&&(n.isWantBlock=!0,n.haveBlock&&!r.haveBlock||(n.haveBlock=r.haveBlock,t.size=e.size)),n.isWantBlock&&n.haveBlock&&(t.size=n.blockSize)}};e.exports=n},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(41).EventEmitter,c=r(227),f=r(1992),h=r(1961).logger,l=function(e){return e.multihash.toString("base64")},p=function(e){return"unwant:".concat(l(e))},d=function(e){return"block:".concat(l(e))},v=function(e){function t(e){var r;return n(this,t),(r=a(this,s(t).call(this))).setMaxListeners(f.maxListeners),r._log=h(e,"notif"),r}return o(t,e),i(t,[{key:"hasBlock",value:function(e){var t=d(e.cid);this._log(t),this.emit(t,e)}},{key:"wantBlock",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)throw new Error("Not a valid cid");var n=d(e),i=p(e);return this._log("wantBlock:".concat(e)),new Promise((function(a,s){var o=function(){t.removeListener(n,u),s(new Error("Block for ".concat(e," unwanted")))},u=function(r){if(t.removeListener(i,o),!e.multihash.equals(r.cid.multihash))return s(new Error("Incorrect block received for ".concat(e)));e.version===r.cid.version&&e.codec===r.cid.codec||(r=new c(r.data,e)),a(r)};t.once(i,o),t.once(n,u),r&&r.signal&&r.signal.addEventListener("abort",(function(){t.removeListener(n,u),t.removeListener(i,o),s(new Error("Want for ".concat(e," aborted")))}))}))}},{key:"unwantBlock",value:function(e){var t=p(e);this._log(t),this.emit(t)}}]),t}(u);e.exports=v},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(29),u=r(41),c=r(2426),f={movingAverageIntervals:[6e4,3e5,9e5]},h=function(e){function t(e,r){var i;n(this,t),i=a(this,s(t).call(this));var o=Object.assign({},f,r);if("number"!==typeof o.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!==typeof o.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");return i._initialCounters=e,i._options=o,i._enabled=i._options.enabled,i._global=new c(e,o),i._global.on("update",(function(e){return i.emit("update",e)})),i._peers=new Map,i}return o(t,e),i(t,[{key:"enable",value:function(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}},{key:"disable",value:function(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}},{key:"stop",value:function(){this._enabled=!1,this._global.stop();var e=!0,t=!1,r=void 0;try{for(var n,i=this._peers[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){n.value[1].stop()}}catch(a){t=!0,r=a}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}}},{key:"forPeer",value:function(e){return e.toB58String&&(e=e.toB58String()),this._peers.get(e)}},{key:"push",value:function(e,t,r){if(this._enabled&&(this._global.push(t,r),e)){var n=this._peers.get(e);n||(n=new c(this._initialCounters,this._options),this._peers.set(e,n)),n.push(t,r)}}},{key:"disconnected",value:function(e){var t=e.toB58String(),r=this._peers.get(t);r&&(r.stop(),this._peers.delete(t))}},{key:"snapshot",get:function(){return this._global.snapshot}},{key:"movingAverages",get:function(){return this._global.movingAverages}}]),t}(u);e.exports=h},function(e,t,r){"use strict";var n=r(5),i=r(7),a=r(28),s=r(27),o=r(87),u=r(29),c=r(41),f=r(139),h=r(470),l=function(e){function t(e,r){var i;return n(this,t),(i=a(this,s(t).call(this)))._options=r,i._queue=[],i._stats={},i._frequencyLastTime=Date.now(),i._frequencyAccumulators={},i._movingAverages={},i._update=i._update.bind(o(i)),e.forEach((function(e){i._stats[e]=f(0),i._movingAverages[e]={},i._options.movingAverageIntervals.forEach((function(t){(i._movingAverages[e][t]=h(t)).push(i._frequencyLastTime,0)}))})),i._enabled=i._options.enabled,i}return u(t,e),i(t,[{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._disabled=!0}},{key:"stop",value:function(){this._timeout&&clearTimeout(this._timeout)}},{key:"push",value:function(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}},{key:"_resetComputeTimeout",value:function(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}},{key:"_nextTimeout",value:function(){var e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}},{key:"_update",value:function(){if(this._timeout=null,this._queue.length){for(var e;this._queue.length;){var t=e=this._queue.shift();this._applyOp(t)}this._updateFrequency(e[2]),this.emit("update",this._stats)}}},{key:"_updateFrequency",value:function(e){var t=this,r=e-this._frequencyLastTime;Object.keys(this._stats).forEach((function(n){t._updateFrequencyFor(n,r,e)})),this._frequencyLastTime=e}},{key:"_updateFrequencyFor",value:function(e,t,r){var n=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;var i=n/t*1e3,a=this._movingAverages[e];a||(a=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((function(e){var t=a[e];t||(t=a[e]=h(e)),t.push(r,i)}))}},{key:"_applyOp",value:function(e){var t,r=e[0],n=e[1];if("number"!==typeof n)throw new Error("invalid increment number:",n);t=Object.prototype.hasOwnProperty.call(this._stats,r)?this._stats[r]:this._stats[r]=f(0),this._stats[r]=t.plus(n),this._frequencyAccumulators[r]||(this._frequencyAccumulators[r]=0),this._frequencyAccumulators[r]+=n}},{key:"snapshot",get:function(){return Object.assign({},this._stats)}},{key:"movingAverages",get:function(){return Object.assign({},this._movingAverages)}}]),t}(c);e.exports=l},function(e,t,r){"use strict";var n=r(462).TieredDatastore,i=r(332),a=r(2091),s=r(2057);e.exports=function(e){var t,r=e.libp2p,o=e.repo,u=e.peerId,c=e.options,f=[];if(i(c,"EXPERIMENTAL.ipnsPubsub",!1)){var h=r.pubsub,l=o.datastore;t=new a(h,l,u),f.push(t)}if(i(c,"offline")||!i(c,"libp2p.config.dht.enabled",!1)){var p=new s(o);f.push(p)}else f.push(r._dht);return new n(f)}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(19),s=r(2005).cidToString,o=a("ipfs:mfs-preload");o.error=a("ipfs:mfs-preload:error"),e.exports=function(e){var t,r,a=e.preload,u=e.files,c=e.options;if((c=c||{}).interval=c.interval||3e4,!c.enabled){o("MFS preload disabled");var f=function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{start:f,stop:f}}var h=function(){var e=i(n.mark((function e(){var i,f;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.stat("/");case 3:if(i=e.sent,f=s(i.cid,{base:"base32"}),t===f){e.next=10;break}return o("preloading updated MFS root ".concat(t," -> ").concat(i.cid)),e.next=9,a(i.cid);case 9:t=f;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),o.error("failed to preload MFS root",e.t0);case 15:return e.prev=15,r=setTimeout(h,c.interval),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return{start:function(){return i(n.mark((function e(){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.stat("/");case 2:i=e.sent,t=s(i.cid,{base:"base32"}),o("monitoring MFS root ".concat(i.cid)),r=setTimeout(h,c.interval);case 6:case"end":return e.stop()}}),e)})))()},stop:function(){clearTimeout(r)}}}},function(e,t,r){"use strict";var n=r(1),i=r(25),a=r(26),s=r(139),o=r(2003).default,u=r(15),c=r(1948).withTimeoutOption;function f(e,t){var r;if(!(r=t.peer?e.metrics.forPeer(t.peer):t.proto?e.metrics.forProtocol(t.proto):e.metrics.global))return{totalIn:new s(0),totalOut:new s(0),rateIn:new s(0),rateOut:new s(0)};var n=r,i=n.movingAverages,a=n.snapshot;return{totalIn:a.dataReceived,totalOut:a.dataSent,rateIn:new s(i.dataReceived[6e4].movingAverage()/60),rateOut:new s(i.dataSent[6e4].movingAverage()/60)}}e.exports=function(e){var t=e.libp2p;return c(function(){var e=a(n.mark((function e(r){var a,s;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=r||{}).poll){e.next=5;break}return e.next=4,f(t,r);case 4:return e.abrupt("return");case 5:if(a=r.interval||1e3,e.prev=6,(a="string"===typeof a?o(a):a)&&!(a<0)){e.next=10;break}throw new Error("invalid poll interval");case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(6),u(e.t0,"ERR_INVALID_POLL_INTERVAL");case 15:e.prev=15;case 16:return e.next=19,f(t,r);case 19:return e.next=21,i(new Promise((function(e){s=setTimeout(e,a)})));case 21:e.next=16;break;case 23:return e.prev=23,clearTimeout(s),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[6,12],[15,,23,26]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2092),s=r(1974),o=s.NotStartedError,u=s.AlreadyInitializedError,c=r(1984),f=r(1948).withTimeoutOption;function h(e){var t=e.apiManager,r=e.constructorOptions,a=e.blockService,s=e.gcLock,f=e.initOptions,h=e.ipld,l=e.keychain,p=e.peerId,d=e.pinManager,v=e.preload,y=e.print,b=e.repo,m={get:c.dag.get({ipld:h,preload:v}),resolve:c.dag.resolve({ipld:h,preload:v}),tree:c.dag.tree({ipld:h,preload:v})},g={data:c.object.data({ipld:h,preload:v}),get:c.object.get({ipld:h,preload:v}),links:c.object.links({dag:m}),new:c.object.new({ipld:h,preload:v}),patch:{addLink:c.object.patch.addLink({ipld:h,gcLock:s,preload:v}),appendData:c.object.patch.appendData({ipld:h,gcLock:s,preload:v}),rmLink:c.object.patch.rmLink({ipld:h,gcLock:s,preload:v}),setData:c.object.patch.setData({ipld:h,gcLock:s,preload:v})},put:c.object.put({ipld:h,gcLock:s,preload:v}),stat:c.object.stat({ipld:h,preload:v})},k={add:c.pin.add({pinManager:d,gcLock:s,dag:m}),ls:c.pin.ls({pinManager:d,dag:m}),rm:c.pin.rm({pinManager:d,gcLock:s,dag:m})};m.put=c.dag.put({ipld:h,pin:k,gcLock:s,preload:v});var w={get:c.block.get({blockService:a,preload:v}),put:c.block.put({blockService:a,pin:k,gcLock:s,preload:v}),rm:c.block.rm({blockService:a,gcLock:s,pinManager:d}),stat:c.block.stat({blockService:a,preload:v})},x=c.addAll({block:w,preload:v,pin:k,gcLock:s,options:r}),S=c.resolve({ipld:h}),E=c.refs({ipld:h,resolve:S,preload:v});E.local=c.refs.local({repo:b});var _=function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new o;case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return{add:c.add({addAll:x}),addAll:x,bitswap:{stat:_,unwant:_,wantlist:_,wantlistForPeer:_},block:w,bootstrap:{add:c.bootstrap.add({repo:b}),clear:c.bootstrap.clear({repo:b}),list:c.bootstrap.list({repo:b}),reset:c.bootstrap.reset({repo:b}),rm:c.bootstrap.rm({repo:b})},cat:c.cat({ipld:h,preload:v}),config:c.config({repo:b}),dag:m,dns:c.dns(),files:c.files({ipld:h,block:w,blockService:a,repo:b,preload:v,options:r}),get:c.get({ipld:h,preload:v}),id:c.id({peerId:p}),init:function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new u;case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),isOnline:c.isOnline({}),key:{export:c.key.export({keychain:l}),gen:c.key.gen({keychain:l}),import:c.key.import({keychain:l}),info:c.key.info({keychain:l}),list:c.key.list({keychain:l}),rename:c.key.rename({keychain:l}),rm:c.key.rm({keychain:l})},ls:c.ls({ipld:h,preload:v}),object:g,pin:k,refs:E,repo:{gc:c.repo.gc({gcLock:s,pin:k,pinManager:d,refs:E,repo:b}),stat:c.repo.stat({repo:b}),version:c.repo.version({repo:b})},resolve:S,start:c.start({apiManager:t,options:r,blockService:a,gcLock:s,initOptions:f,ipld:h,keychain:l,peerId:p,pinManager:d,preload:v,print:y,repo:b}),stats:{bitswap:_,bw:_,repo:c.repo.stat({repo:b})},stop:function(){},swarm:{addrs:_,connect:_,disconnect:_,localAddrs:c.swarm.localAddrs({multiaddrs:[]}),peers:_},version:c.version({repo:b})}}e.exports=function(e){var t=e.apiManager,r=e.options,s=e.bitswap,u=e.blockService,c=e.gcLock,l=e.initOptions,p=e.ipld,d=e.ipns,v=e.keychain,y=e.libp2p,b=e.mfsPreload,m=e.peerId,g=e.pinManager,k=e.preload,w=e.print,x=e.repo;return f(function(){var e=i(n.mark((function e(){var i,f,S,E;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a(),f=t.update({stop:function(){return i.promise}}),S=f.cancel,e.prev=2,u.unsetExchange(),s.stop(),k.stop(),e.next=8,Promise.all([d.republisher.stop(),b.stop(),y.stop(),x.close()]);case 8:E=h({apiManager:t,constructorOptions:r,blockService:u,gcLock:c,initOptions:l,ipld:p,keychain:v,peerId:m,pinManager:g,preload:k,print:w,repo:x}),t.update(E,(function(){throw new o})),e.next=17;break;case 12:throw e.prev=12,e.t0=e.catch(2),S(),i.reject(e.t0),e.t0;case 17:i.resolve();case 18:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.libp2p;return s(function(){var e=a(n.mark((function e(r){var a,s,o,u,c,f,h,l,p;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=[],s=!0,o=!1,u=void 0,e.prev=4,c=t.peerStore.peers.entries(r)[Symbol.iterator]();!(s=(f=c.next()).done);s=!0)h=i(f.value,2),l=h[0],p=h[1],a.push({id:l,addrs:p.addresses.map((function(e){return e.multiaddr}))});e.next=12;break;case 8:e.prev=8,e.t0=e.catch(4),o=!0,u=e.t0;case 12:e.prev=12,e.prev=13,s||null==c.return||c.return();case 15:if(e.prev=15,!o){e.next=18;break}throw u;case 18:return e.finish(15);case 19:return e.finish(12);case 20:return e.abrupt("return",a);case 21:case"end":return e.stop()}}),e,null,[[4,8,12,20],[13,,15,19]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.libp2p;return n((function(e,r){return t.dial(e,r)}))}},function(e,t,r){"use strict";var n=r(1948).withTimeoutOption;e.exports=function(e){var t=e.libp2p;return n((function(e,r){return t.hangUp(e,r)}))}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(1948).withTimeoutOption;e.exports=function(e){var t=e.multiaddrs;return a(function(){var e=i(n.mark((function e(){return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(48),a=r(2),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.libp2p;return s(function(){var e=a(n.mark((function e(r){var a,s,o,u,c,f,h,l,p,d,v,y,b,m,g,k,w;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(r=r||{}).v||r.verbose,s=[],o=!0,u=!1,c=void 0,e.prev=6,f=t.connections[Symbol.iterator]();case 8:if(o=(h=f.next()).done){e.next=32;break}for(l=i(h.value,2),p=l[0],d=l[1],v=!0,y=!1,b=void 0,e.prev=13,m=d[Symbol.iterator]();!(v=(g=m.next()).done);v=!0)k=g.value,w={addr:k.remoteAddr,peer:p},(a||r.direction)&&(w.direction=k.stat.direction),a&&(w.muxer=k.stat.multiplexer,w.latency="n/a"),s.push(w);e.next=21;break;case 17:e.prev=17,e.t0=e.catch(13),y=!0,b=e.t0;case 21:e.prev=21,e.prev=22,v||null==m.return||m.return();case 24:if(e.prev=24,!y){e.next=27;break}throw b;case 27:return e.finish(24);case 28:return e.finish(21);case 29:o=!0,e.next=8;break;case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(6),u=!0,c=e.t1;case 38:e.prev=38,e.prev=39,o||null==f.return||f.return();case 41:if(e.prev=41,!u){e.next=44;break}throw c;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.abrupt("return",s);case 47:case"end":return e.stop()}}),e,null,[[6,34,38,46],[13,17,21,29],[22,,24,28],[39,,41,45]])})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(2052),s=r(1948).withTimeoutOption;e.exports=function(e){var t=e.repo;return s(function(){var e=i(n.mark((function e(r){var i;return n.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.version.get(r);case 2:return i=e.sent,e.abrupt("return",{version:a.version,repo:i,commit:a.gitHead||"","interface-ipfs-core":a.devDependencies["interface-ipfs-core"],"ipfs-http-client":a.dependencies["ipfs-http-client"]});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},function(e,t,r){"use strict";var n=r(46),i=r(5),a=r(7);e.exports=function(){function e(){var t=this;i(this,e),this._api={},this._onUndef=function(){},this.api=new Proxy(this._api,{get:function(e,r){if("then"!==r)return void 0===t._api[r]?t._onUndef(r):t._api[r]}})}return a(e,[{key:"update",value:function(e,t){var r=this,i=n({},this._api),a=this._onUndef;return Object.keys(this._api).forEach((function(e){delete r._api[e]})),Object.assign(this._api,e),t&&(this._onUndef=t),{cancel:function(){return r.update(i,a)},api:this.api}}}]),e}()},,function(e,t,r){"use strict";r.r(t);var n=r(83),i=r(1),a=r.n(i),s=r(23),o=r(12),u=r(13),c=r(2036),f=r.n(c),h=r(3),l=r(481),p=r.n(l),d=r(819),v=r.n(d),y=r(334),b=r.n(y),m=r(78),g=r.n(m),k=r(100),w=r(20),x=r(17),S=r(21),E=r(2330),_=r.n(E),I=r(2087),A=r.n(I),T=r(55),C=r.n(T),B=r(104),R=r(2332).pb.NoiseHandshakePayload;function N(){var e=f.a.privateKeyGenerate();return{publicKey:f.a.publicKeyCreate(e),privateKey:e}}function P(e,t,r){return M.apply(this,arguments)}function M(){return(M=Object(s.a)(a.a.mark((function e(t,r,n){var i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L(t,V(r));case 2:return i=e.sent,s=n||h.Buffer.alloc(0),e.next=6,D(t.marshalPubKey(),i,s);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,r){return O.apply(this,arguments)}function O(){return(O=Object(s.a)(a.a.mark((function e(t,r,n){var i;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=R.create({identityKey:t,identitySig:r,data:n||null}),e.abrupt("return",h.Buffer.from(R.encode(i).finish()));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,t){return K.apply(this,arguments)}function K(){return(K=Object(s.a)(a.a.mark((function e(t,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.privKey.sign(r));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return q.apply(this,arguments)}function q(){return(q=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.createFromPubKey(h.Buffer.from(t.identityKey));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return j.apply(this,arguments)}function j(){return(j=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",R.toObject(R.decode(h.Buffer.from(t))));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return h.Buffer.concat([h.Buffer.from("noise-libp2p-static-key:"),e])}function F(e,t){return H.apply(this,arguments)}function H(){return(H=Object(s.a)(a.a.mark((function e(t,r){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,C.a.createFromPubKey(r);case 2:return n=e.sent,e.abrupt("return",n.id.equals(t));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function G(e,t,r){return Y.apply(this,arguments)}function Y(){return(Y=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.Buffer.from(r.identityKey),e.next=3,F(n.id,i);case 3:if(e.sent){e.next=5;break}throw new Error("Peer ID doesn't match libp2p public key.");case 5:if(s=V(t),o=B.keys.unmarshalPublicKey(i),r.identitySig&&o.verify(s,h.Buffer.from(r.identitySig))){e.next=9;break}throw new Error("Static key doesn't match to peer that signed payload!");case 9:return e.abrupt("return",C.a.createFromPubKey(i));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e,t){var r=h.Buffer.alloc(0),n=_.a.extract(A.a,t,e),i=_.a.expand(A.a,n,r,96);return[i.slice(0,32),i.slice(32,64),i.slice(64,96)]}function J(e){return f.a.publicKeyVerify(e.slice(0,32))}var Q,X=r(98),Z=r(2348),$=r.n(Z),ee=r(19),te=r.n(ee),re=Object({NODE_ENV:"production",PUBLIC_URL:"/Web3Drive",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).DUMP_SESSION_KEYS,ne=te()("libp2p:noise");function ie(e){Q("LOCAL_STATIC_PUBLIC_KEY ".concat(e.publicKey.toString("hex"))),Q("LOCAL_STATIC_PRIVATE_KEY ".concat(e.privateKey.toString("hex")))}function ae(e){e?(Q("LOCAL_PUBLIC_EPHEMERAL_KEY ".concat(e.publicKey.toString("hex"))),Q("LOCAL_PRIVATE_EPHEMERAL_KEY ".concat(e.privateKey.toString("hex")))):Q("Missing local ephemeral keys.")}function se(e){Q("REMOTE_STATIC_PUBLIC_KEY ".concat(e.toString("hex")))}function oe(e){Q("REMOTE_EPHEMERAL_PUBLIC_KEY ".concat(e.toString("hex")))}function ue(e){e.cs1&&e.cs2?(Q("CIPHER_STATE_1 ".concat(e.cs1.n," ").concat(e.cs1.k.toString("hex"))),Q("CIPHER_STATE_2 ".concat(e.cs2.n," ").concat(e.cs2.k.toString("hex")))):Q("Missing cipher state.")}Q=re?ne:function(){};var ce=function(){function e(){Object(o.a)(this,e)}return Object(u.a)(e,[{key:"encryptWithAd",value:function(e,t,r){var n=this.encrypt(e.k,e.n,t,r);return this.setNonce(e,this.incrementNonce(e.n)),n}},{key:"decryptWithAd",value:function(e,t,r){var n=this.decrypt(e.k,e.n,t,r),i=n.plaintext,a=n.valid;return this.setNonce(e,this.incrementNonce(e.n)),{plaintext:i,valid:a}}},{key:"hasKey",value:function(e){return!this.isEmptyKey(e.k)}},{key:"setNonce",value:function(e,t){e.n=t}},{key:"createEmptyKey",value:function(){return h.Buffer.alloc(32)}},{key:"isEmptyKey",value:function(e){return this.createEmptyKey().equals(e)}},{key:"incrementNonce",value:function(e){return e+1}},{key:"nonceToBytes",value:function(e){var t=h.Buffer.alloc(12);return t.writeUInt32LE(e,4),t}},{key:"encrypt",value:function(e,t,r,n){var i=this.nonceToBytes(t),a=new $.a;return n=h.Buffer.from(n),a.init(e,i),a.aad(r),a.encrypt(n),h.Buffer.concat([n,a.final()])}},{key:"encryptAndHash",value:function(e,t){var r;return r=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,r),r}},{key:"decrypt",value:function(e,t,r,n){var i=this.nonceToBytes(t),a=new $.a,s=(n=h.Buffer.from(n)).slice(n.length-16);return n=n.slice(0,n.length-16),a.init(e,i),a.aad(r),a.decrypt(n),{plaintext:n,valid:a.verify(s)}}},{key:"decryptAndHash",value:function(e,t){var r,n=!0;if(this.hasKey(e.cs)){var i=this.decryptWithAd(e.cs,e.h,t);r=i.plaintext,n=i.valid}else r=t;return this.mixHash(e,t),{plaintext:r,valid:n}}},{key:"dh",value:function(e,t){try{var r=f.a.derive(t,e),n=h.Buffer.alloc(32);return r.copy(n),n}catch(i){return ne(i.message),h.Buffer.alloc(32)}}},{key:"mixHash",value:function(e,t){e.h=this.getHash(e.h,t)}},{key:"getHash",value:function(e,t){return A.a.digest(h.Buffer.from([].concat(Object(X.a)(e),Object(X.a)(t))))}},{key:"mixKey",value:function(e,t){var r=W(e.ck,t),i=Object(n.a)(r,2),a=i[0],s=i[1];e.cs=this.initializeKey(s),e.ck=a}},{key:"initializeKey",value:function(e){return{k:e,n:0}}},{key:"initializeSymmetric",value:function(e){var t=h.Buffer.from(e,"utf-8"),r=this.hashProtocolName(t),n=r,i=this.createEmptyKey();return{cs:this.initializeKey(i),ck:n,h:r}}},{key:"hashProtocolName",value:function(e){if(e.length<=32){var t=h.Buffer.alloc(32);return e.copy(t),t}return this.getHash(e,h.Buffer.alloc(0))}},{key:"split",value:function(e){var t=W(e.ck,h.Buffer.alloc(0)),r=Object(n.a)(t,2),i=r[0],a=r[1];return{cs1:this.initializeKey(i),cs2:this.initializeKey(a)}}},{key:"writeMessageRegular",value:function(e,t){var r=this.encryptWithAd(e,h.Buffer.alloc(0),t);return{ne:this.createEmptyKey(),ns:h.Buffer.alloc(0),ciphertext:r}}},{key:"readMessageRegular",value:function(e,t){return this.decryptWithAd(e,h.Buffer.alloc(0),t.ciphertext)}}]),e}(),fe=function(e){function t(){return Object(o.a)(this,t),Object(w.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(u.a)(t,[{key:"initializeInitiator",value:function(e,t,r,n){var i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),{ss:i,s:t,rs:r,psk:n,re:h.Buffer.alloc(32)}}},{key:"initializeResponder",value:function(e,t,r,n){var i=this.initializeSymmetric("Noise_XX_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),{ss:i,s:t,rs:r,psk:n,re:h.Buffer.alloc(32)}}},{key:"writeMessageA",value:function(e,t,r){var n=h.Buffer.alloc(0);e.e=r||N();var i=e.e.publicKey;return this.mixHash(e.ss,i),{ne:i,ns:n,ciphertext:this.encryptAndHash(e.ss,t)}}},{key:"writeMessageB",value:function(e,t){e.e=N();var r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));var n=h.Buffer.from(e.s.publicKey),i=this.encryptAndHash(e.ss,n);return this.mixKey(e.ss,this.dh(e.s.privateKey,e.re)),{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}},{key:"writeMessageC",value:function(e,t){var r=h.Buffer.from(e.s.publicKey),n=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));var i=this.encryptAndHash(e.ss,t),a={ne:this.createEmptyKey(),ns:n,ciphertext:i},s=this.split(e.ss),o=s.cs1,u=s.cs2;return{h:e.ss.h,messageBuffer:a,cs1:o,cs2:u}}},{key:"readMessageA",value:function(e,t){return J(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}},{key:"readMessageB",value:function(e,t){if(J(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));var r=this.decryptAndHash(e.ss,t.ns),n=r.plaintext,i=r.valid;i&&32===n.length&&J(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));var a=this.decryptAndHash(e.ss,t.ciphertext),s=a.plaintext,o=a.valid;return{plaintext:s,valid:i&&o}}},{key:"readMessageC",value:function(e,t){var r=this.decryptAndHash(e.ss,t.ns),n=r.plaintext,i=r.valid;if(i&&32===n.length&&J(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));var a=this.decryptAndHash(e.ss,t.ciphertext),s=a.plaintext,o=a.valid,u=this.split(e.ss),c=u.cs1,f=u.cs2;return{h:e.ss.h,plaintext:s,valid:i&&o,cs1:c,cs2:f}}},{key:"initSession",value:function(e,t,r){var n=this.createEmptyKey(),i=h.Buffer.alloc(32);return{hs:e?this.initializeInitiator(t,r,i,n):this.initializeResponder(t,r,i,n),i:e,mc:0}}},{key:"sendMessage",value:function(e,t,r){var n;if(0===e.mc)n=this.writeMessageA(e.hs,t,r);else if(1===e.mc)n=this.writeMessageB(e.hs,t);else if(2===e.mc){var i=this.writeMessageC(e.hs,t),a=i.h,s=i.messageBuffer,o=i.cs1,u=i.cs2;n=s,e.h=a,e.cs1=o,e.cs2=u}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");n=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");n=this.writeMessageRegular(e.cs2,t)}}return e.mc++,n}},{key:"recvMessage",value:function(e,t){var r=h.Buffer.alloc(0),n=!1;if(0===e.mc){var i=this.readMessageA(e.hs,t);r=i.plaintext,n=i.valid}else if(1===e.mc){var a=this.readMessageB(e.hs,t);r=a.plaintext,n=a.valid}else if(2===e.mc){var s=this.readMessageC(e.hs,t),o=s.h,u=s.plaintext,c=s.valid,f=s.cs1,l=s.cs2;r=u,n=c,e.h=o,e.cs1=f,e.cs2=l}return e.mc++,{plaintext:r,valid:n}}}]),t}(ce),he=function(e,t,r){return(t=t||h.Buffer.allocUnsafe(2)).writeUInt16BE(e,r),t};he.bytes=2;var le=function(e){if(e.length<2)throw RangeError("Could not decode int16BE");return e.readUInt16BE(0)};function pe(e){return h.Buffer.concat([e.ne,e.ciphertext])}function de(e){return h.Buffer.concat([e.ne,e.ns,e.ciphertext])}function ve(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.slice(0,32),ciphertext:e.slice(32,e.length),ns:h.Buffer.alloc(0)}}function ye(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.slice(0,32),ns:e.slice(32,80),ciphertext:e.slice(80,e.length)}}function be(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:h.Buffer.alloc(0),ns:e.slice(0,48),ciphertext:e.slice(48,e.length)}}function me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}le.bytes=2;var ge=function(){function e(t,r,n,i,a,s,u){Object(o.a)(this,e),me(this,"isInitiator",void 0),me(this,"session",void 0),me(this,"remotePeer",void 0),me(this,"remoteEarlyData",void 0),me(this,"payload",void 0),me(this,"connection",void 0),me(this,"xx",void 0),me(this,"staticKeypair",void 0),me(this,"prologue",void 0),this.isInitiator=t,this.payload=r,this.prologue=n,this.staticKeypair=i,this.connection=a,s&&(this.remotePeer=s),this.xx=u||new fe,this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair),this.remoteEarlyData=h.Buffer.alloc(0)}return Object(u.a)(e,[{key:"propose",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ie(this.session.hs.s),!this.isInitiator){e.next=9;break}ne("Stage 0 - Initiator starting to send first message."),t=this.xx.sendMessage(this.session,h.Buffer.alloc(0)),this.connection.writeLP(pe(t)),ne("Stage 0 - Initiator finished sending first message."),ae(this.session.hs.e),e.next=20;break;case 9:return ne("Stage 0 - Responder waiting to receive first message..."),e.t0=ve,e.next=13,this.connection.readLP();case 13:if(e.t1=e.sent.slice(),r=(0,e.t0)(e.t1),n=this.xx.recvMessage(this.session,r),n.valid){e.next=18;break}throw new Error("xx handshake stage 0 validation fail");case 18:ne("Stage 0 - Responder received first message."),oe(this.session.hs.re);case 20:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exchange",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitiator){e.next=36;break}return ne("Stage 1 - Initiator waiting to receive first message from responder..."),e.t0=ye,e.next=5,this.connection.readLP();case 5:if(e.t1=e.sent.slice(),t=(0,e.t0)(e.t1),r=this.xx.recvMessage(this.session,t),n=r.plaintext,r.valid){e.next=10;break}throw new Error("xx handshake stage 1 validation fail");case 10:return ne("Stage 1 - Initiator received the message."),oe(this.session.hs.re),se(this.session.hs.rs),ne("Initiator going to check remote's signature..."),e.prev=14,e.next=17,z(n);case 17:if(i=e.sent,e.t2=this.remotePeer,e.t2){e.next=23;break}return e.next=22,U(i);case 22:e.t2=e.sent;case 23:return this.remotePeer=e.t2,e.next=26,G(t.ns,i,this.remotePeer);case 26:this.remotePeer=e.sent,this.setRemoteEarlyData(i.data),e.next=33;break;case 30:throw e.prev=30,e.t3=e.catch(14),new Error("Error occurred while verifying signed payload: ".concat(e.t3.message));case 33:ne("All good with the signature!"),e.next=41;break;case 36:ne("Stage 1 - Responder sending out first message with signed payload and static key."),s=this.xx.sendMessage(this.session,this.payload),this.connection.writeLP(de(s)),ne("Stage 1 - Responder sent the second handshake message with signed payload."),ae(this.session.hs.e);case 41:case"end":return e.stop()}}),e,this,[[14,30]])})));return function(){return e.apply(this,arguments)}}()},{key:"finish",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitiator){e.next=7;break}ne("Stage 2 - Initiator sending third handshake message."),t=this.xx.sendMessage(this.session,this.payload),this.connection.writeLP((a=t,h.Buffer.concat([a.ns,a.ciphertext]))),ne("Stage 2 - Initiator sent message with signed payload."),e.next=35;break;case 7:return ne("Stage 2 - Responder waiting for third handshake message..."),e.t0=be,e.next=11,this.connection.readLP();case 11:if(e.t1=e.sent.slice(),r=(0,e.t0)(e.t1),n=this.xx.recvMessage(this.session,r),i=n.plaintext,n.valid){e.next=16;break}throw new Error("xx handshake stage 2 validation fail");case 16:return ne("Stage 2 - Responder received the message, finished handshake."),e.prev=17,e.next=20,z(i);case 20:if(s=e.sent,e.t2=this.remotePeer,e.t2){e.next=26;break}return e.next=25,U(s);case 25:e.t2=e.sent;case 26:return this.remotePeer=e.t2,e.next=29,G(this.session.hs.rs,s,this.remotePeer);case 29:this.setRemoteEarlyData(s.data),e.next=35;break;case 32:throw e.prev=32,e.t3=e.catch(17),new Error("Error occurred while verifying signed payload: ".concat(e.t3.message));case 35:ue(this.session);case 36:case"end":return e.stop()}var a}),e,this,[[17,32]])})));return function(){return e.apply(this,arguments)}}()},{key:"encrypt",value:function(e,t){var r=this.getCS(t);return this.xx.encryptWithAd(r,h.Buffer.alloc(0),e)}},{key:"decrypt",value:function(e,t){var r=this.getCS(t,!1);return this.xx.decryptWithAd(r,h.Buffer.alloc(0),e)}},{key:"getRemoteStaticKey",value:function(){return this.session.hs.rs}},{key:"getCS",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.cs1||!e.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}},{key:"setRemoteEarlyData",value:function(e){e&&(this.remoteEarlyData=h.Buffer.from(e.buffer,e.byteOffset,e.length))}}]),e}(),ke=function(e){function t(){return Object(o.a)(this,t),Object(w.a)(this,Object(x.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(u.a)(t,[{key:"initSession",value:function(e,t,r,n){var i=this.createEmptyKey();return{hs:e?this.initializeInitiator(t,r,n,i):this.initializeResponder(t,r,n,i),i:e,mc:0}}},{key:"sendMessage",value:function(e,t){var r;if(0===e.mc)r=this.writeMessageA(e.hs,t);else if(1===e.mc){var n=this.writeMessageB(e.hs,t),i=n.messageBuffer,a=n.h,s=n.cs1,o=n.cs2;r=i,e.h=a,e.cs1=s,e.cs2=o}else{if(!(e.mc>1))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}},{key:"recvMessage",value:function(e,t){var r=h.Buffer.alloc(0),n=!1;if(0===e.mc){var i=this.readMessageA(e.hs,t);r=i.plaintext,n=i.valid}if(1===e.mc){var a=this.readMessageB(e.hs,t),s=a.plaintext,o=a.valid,u=a.h,c=a.cs1,f=a.cs2;r=s,n=o,e.h=u,e.cs1=c,e.cs2=f}return e.mc++,{plaintext:r,valid:n}}},{key:"writeMessageA",value:function(e,t){e.e=N();var r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));var n=h.Buffer.from(e.s.publicKey),i=this.encryptAndHash(e.ss,n);return this.mixKey(e.ss,this.dh(e.s.privateKey,e.rs)),{ne:r,ns:i,ciphertext:this.encryptAndHash(e.ss,t)}}},{key:"writeMessageB",value:function(e,t){e.e=N();var r=e.e.publicKey;this.mixHash(e.ss,r),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re)),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));var n=this.encryptAndHash(e.ss,t),i={ne:r,ns:this.createEmptyKey(),ciphertext:n},a=this.split(e.ss);return{messageBuffer:i,cs1:a.cs1,cs2:a.cs2,h:e.ss.h}}},{key:"readMessageA",value:function(e,t){J(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));var r=this.decryptAndHash(e.ss,t.ns),n=r.plaintext,i=r.valid;i&&32===n.length&&J(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.s.privateKey,e.rs));var a=this.decryptAndHash(e.ss,t.ciphertext),s=a.plaintext,o=a.valid;return{plaintext:s,valid:i&&o}}},{key:"readMessageB",value:function(e,t){if(J(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state should contain ephemeral key by now.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re)),this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));var r=this.decryptAndHash(e.ss,t.ciphertext),n=r.plaintext,i=r.valid,a=this.split(e.ss),s=a.cs1,o=a.cs2;return{h:e.ss.h,valid:i,plaintext:n,cs1:s,cs2:o}}},{key:"initializeInitiator",value:function(e,t,r,n){var i=this.initializeSymmetric("Noise_IK_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),this.mixHash(i,r),{ss:i,s:t,rs:r,re:h.Buffer.alloc(32),psk:n}}},{key:"initializeResponder",value:function(e,t,r,n){var i=this.initializeSymmetric("Noise_IK_25519_ChaChaPoly_SHA256");return this.mixHash(i,e),this.mixHash(i,t.publicKey),{ss:i,s:t,rs:r,re:h.Buffer.alloc(32),psk:n}}}]),t}(ce),we=r(36),xe=r(476);function Se(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Ee(e,t,r){return(Ee=Se()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Object(xe.a)(i,r.prototype),i}).apply(null,arguments)}function _e(e){var t="function"===typeof Map?new Map:void 0;return(_e=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return Ee(e,arguments,Object(x.a)(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Object(xe.a)(n,e)})(e)}var Ie=function(e){function t(e,r){var n,i,a,s;return Object(o.a)(this,t),n=Object(w.a)(this,Object(x.a)(t).call(this,r)),i=Object(we.a)(n),s=void 0,(a="initialMsg")in i?Object.defineProperty(i,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[a]=s,n.initialMsg=e,n.name="FailedIKhandshake",n}return Object(S.a)(t,e),t}(_e(Error));function Ae(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Te=function(){function e(t,r,n,i,a,s,u,c){Object(o.a)(this,e),Ae(this,"isInitiator",void 0),Ae(this,"session",void 0),Ae(this,"remotePeer",void 0),Ae(this,"remoteEarlyData",void 0),Ae(this,"payload",void 0),Ae(this,"prologue",void 0),Ae(this,"staticKeypair",void 0),Ae(this,"connection",void 0),Ae(this,"ik",void 0),this.isInitiator=t,this.payload=h.Buffer.from(r),this.prologue=n,this.staticKeypair=i,this.connection=a,u&&(this.remotePeer=u),this.ik=c||new ke,this.session=this.ik.initSession(this.isInitiator,this.prologue,this.staticKeypair,s),this.remoteEarlyData=h.Buffer.alloc(0)}return Object(u.a)(e,[{key:"stage0",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n,i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ie(this.session.hs.s),se(this.session.hs.rs),!this.isInitiator){e.next=10;break}ne("IK Stage 0 - Initiator sending message..."),t=this.ik.sendMessage(this.session,this.payload),this.connection.writeLP(de(t)),ne("IK Stage 0 - Initiator sent message."),ae(this.session.hs.e),e.next=40;break;case 10:return ne("IK Stage 0 - Responder receiving message..."),e.next=13,this.connection.readLP();case 13:if(r=e.sent,e.prev=14,n=ye(r.slice()),i=this.ik.recvMessage(this.session,n),s=i.plaintext,i.valid){e.next=19;break}throw new Error("ik handshake stage 0 decryption validation fail");case 19:return ne("IK Stage 0 - Responder got message, going to verify payload."),e.next=22,z(s);case 22:if(o=e.sent,e.t0=this.remotePeer,e.t0){e.next=28;break}return e.next=27,U(o);case 27:e.t0=e.sent;case 28:return this.remotePeer=e.t0,e.next=31,G(this.session.hs.rs,o,this.remotePeer);case 31:this.setRemoteEarlyData(o.data),ne("IK Stage 0 - Responder successfully verified payload!"),oe(this.session.hs.re),e.next=40;break;case 36:throw e.prev=36,e.t1=e.catch(14),ne("Responder breaking up with IK handshake in stage 0."),new Ie(r,"Error occurred while verifying initiator's signed payload: ".concat(e.t1.message));case 40:case"end":return e.stop()}}),e,this,[[14,36]])})));return function(){return e.apply(this,arguments)}}()},{key:"stage1",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r,n,i,s,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitiator){e.next=33;break}return ne("IK Stage 1 - Initiator receiving message..."),e.next=4,this.connection.readLP();case 4:if(t=e.sent.slice(),r=ve(h.Buffer.from(t)),n=this.ik.recvMessage(this.session,r),i=n.plaintext,s=n.valid,ne("IK Stage 1 - Initiator got message, going to verify payload."),e.prev=8,s){e.next=11;break}throw new Error("ik stage 1 decryption validation fail");case 11:return e.next=13,z(i);case 13:if(o=e.sent,e.t0=this.remotePeer,e.t0){e.next=19;break}return e.next=18,U(o);case 18:e.t0=e.sent;case 19:return this.remotePeer=e.t0,e.next=22,G(r.ns.slice(0,32),o,this.remotePeer);case 22:this.setRemoteEarlyData(o.data),ne("IK Stage 1 - Initiator successfully verified payload!"),oe(this.session.hs.re),e.next=31;break;case 27:throw e.prev=27,e.t1=e.catch(8),ne("Initiator breaking up with IK handshake in stage 1."),new Ie(t,"Error occurred while verifying responder's signed payload: ".concat(e.t1.message));case 31:e.next=38;break;case 33:ne("IK Stage 1 - Responder sending message..."),u=this.ik.sendMessage(this.session,this.payload),this.connection.writeLP(pe(u)),ne("IK Stage 1 - Responder sent message..."),ae(this.session.hs.e);case 38:ue(this.session);case 39:case"end":return e.stop()}}),e,this,[[8,27]])})));return function(){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(e,t){var r=this.getCS(t,!1);return this.ik.decryptWithAd(r,h.Buffer.alloc(0),e)}},{key:"encrypt",value:function(e,t){var r=this.getCS(t);return this.ik.encryptWithAd(r,h.Buffer.alloc(0),e)}},{key:"getLocalEphemeralKeys",value:function(){if(!this.session.hs.e)throw new Error("Ephemeral keys do not exist.");return this.session.hs.e}},{key:"getCS",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e.cs1||!e.cs2)throw new Error("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}},{key:"setRemoteEarlyData",value:function(e){e&&(this.remoteEarlyData=h.Buffer.from(e.buffer,e.byteOffset,e.length))}}]),e}(),Ce=r(134);function Be(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Re=function(e){function t(e,r,n,i,a,s,u,c,f){var h;return Object(o.a)(this,t),h=Object(w.a)(this,Object(x.a)(t).call(this,e,r,n,i,a,u,f)),Be(Object(we.a)(h),"ephemeralKeys",void 0),Be(Object(we.a)(h),"initialMsg",void 0),c&&(h.ephemeralKeys=c),h.initialMsg=s,h}return Object(S.a)(t,e),Object(u.a)(t,[{key:"propose",value:function(){var e=Object(s.a)(a.a.mark((function e(){var t,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitiator){e.next=6;break}this.xx.sendMessage(this.session,h.Buffer.alloc(0),this.ephemeralKeys),ne("XX Fallback Stage 0 - Initialized state as the first message was sent by initiator."),ae(this.session.hs.e),e.next=13;break;case 6:if(ne("XX Fallback Stage 0 - Responder decoding initial msg from IK."),t=ve(this.initialMsg),r=this.xx.recvMessage(this.session,{ne:t.ne,ns:h.Buffer.alloc(0),ciphertext:h.Buffer.alloc(0)}),r.valid){e.next=11;break}throw new Error("xx fallback stage 0 decryption validation fail");case 11:ne("XX Fallback Stage 0 - Responder used received message from IK."),oe(this.session.hs.re);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"exchange",value:function(){var e=Object(s.a)(a.a.mark((function e(){var r,n,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isInitiator){e.next=30;break}if(r=ye(this.initialMsg),n=this.xx.recvMessage(this.session,r),i=n.plaintext,n.valid){e.next=5;break}throw new Error("xx fallback stage 1 decryption validation fail");case 5:return ne("XX Fallback Stage 1 - Initiator used received message from IK."),oe(this.session.hs.re),se(this.session.hs.rs),ne("Initiator going to check remote's signature..."),e.prev=9,e.next=12,z(i);case 12:if(s=e.sent,e.t0=this.remotePeer,e.t0){e.next=18;break}return e.next=17,U(s);case 17:e.t0=e.sent;case 18:return this.remotePeer=e.t0,e.next=21,G(this.session.hs.rs,s,this.remotePeer);case 21:this.setRemoteEarlyData(s.data),e.next=27;break;case 24:throw e.prev=24,e.t1=e.catch(9),new Error("Error occurred while verifying signed payload from responder: ".concat(e.t1.message));case 27:ne("All good with the signature!"),e.next=34;break;case 30:return ne("XX Fallback Stage 1 - Responder start"),e.next=33,Object(Ce.a)(Object(x.a)(t.prototype),"exchange",this).call(this);case 33:ne("XX Fallback Stage 1 - Responder end");case 34:case"end":return e.stop()}}),e,this,[[9,24]])})));return function(){return e.apply(this,arguments)}}()}]),t}(ge);function Ne(e){return new De(e)}function Pe(e){return function(){return new Me(e.apply(this,arguments))}}function Me(e){var t,r;function n(t,r){try{var a=e[t](r),s=a.value,o=s instanceof De;Promise.resolve(o?s.wrapped:s).then((function(e){o?n("return"===t?"return":"next",e):i(a.done?"return":"normal",e)}),(function(e){n("throw",e)}))}catch(u){i("throw",u)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise((function(a,s){var o={key:e,arg:i,resolve:a,reject:s,next:null};r?r=r.next=o:(t=r=o,n(e,i))}))},"function"!==typeof e.return&&(this.return=void 0)}function De(e){this.wrapped=e}function Oe(e){var t;if("undefined"!==typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}function Le(e){return function(){var t=Pe(a.a.mark((function t(r){var n,i,s,o,u,c,f,l,p,d,v;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,i=!1,t.prev=2,o=Oe(r);case 4:return t.next=6,Ne(o.next());case 6:return u=t.sent,n=u.done,t.next=10,Ne(u.value);case 10:if(c=t.sent,n){t.next=27;break}f=c,l=h.Buffer.from(f.buffer,f.byteOffset,f.length),p=0;case 15:if(!(p<l.length)){t.next=24;break}return(d=p+65519)>l.length&&(d=l.length),v=e.encrypt(l.slice(p,d),e.session),t.next=21,v;case 21:p+=65519,t.next=15;break;case 24:n=!0,t.next=4;break;case 27:t.next=33;break;case 29:t.prev=29,t.t0=t.catch(2),i=!0,s=t.t0;case 33:if(t.prev=33,t.prev=34,n||null==o.return){t.next=38;break}return t.next=38,Ne(o.return());case 38:if(t.prev=38,!i){t.next=41;break}throw s;case 41:return t.finish(38);case 42:return t.finish(33);case 43:case"end":return t.stop()}}),t,null,[[2,29,33,43],[34,,38,42]])})));return function(e){return t.apply(this,arguments)}}()}function Ke(e){return function(){var t=Pe(a.a.mark((function t(r){var n,i,s,o,u,c,f,l,p,d,v,y,b;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,i=!1,t.prev=2,o=Oe(r);case 4:return t.next=6,Ne(o.next());case 6:return u=t.sent,n=u.done,t.next=10,Ne(u.value);case 10:if(c=t.sent,n){t.next=34;break}f=c,l=h.Buffer.from(f.buffer,f.byteOffset,f.length),p=0;case 15:if(!(p<l.length)){t.next=31;break}return(d=p+65535)>l.length&&(d=l.length),v=l.slice(p,d),t.next=21,Ne(e.decrypt(v,e.session));case 21:if(y=t.sent,b=y.plaintext,y.valid){t.next=26;break}throw new Error("Failed to validate decrypted chunk");case 26:return t.next=28,b;case 28:p+=65535,t.next=15;break;case 31:n=!0,t.next=4;break;case 34:t.next=40;break;case 36:t.prev=36,t.t0=t.catch(2),i=!0,s=t.t0;case 40:if(t.prev=40,t.prev=41,n||null==o.return){t.next=45;break}return t.next=45,Ne(o.return());case 45:if(t.prev=45,!i){t.next=48;break}throw s;case 48:return t.finish(45);case 49:return t.finish(40);case 50:case"end":return t.stop()}}),t,null,[[2,36,40,50],[41,,45,49]])})));return function(e){return t.apply(this,arguments)}}()}"function"===typeof Symbol&&Symbol.asyncIterator&&(Me.prototype[Symbol.asyncIterator]=function(){return this}),Me.prototype.next=function(e){return this._invoke("next",e)},Me.prototype.throw=function(e){return this._invoke("throw",e)},Me.prototype.return=function(e){return this._invoke("return",e)};var Ue=new(function(){function e(){var t,r,n;Object(o.a)(this,e),t=this,r="storage",n=new Map,r in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n}return Object(u.a)(e,[{key:"store",value:function(e,t){this.storage.set(e.id,t)}},{key:"load",value:function(e){return e&&this.storage.get(e.id)||null}},{key:"resetStorage",value:function(){this.storage.clear()}}]),e}());function qe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ze=function(){function e(t,r){if(Object(o.a)(this,e),qe(this,"protocol","/noise"),qe(this,"prologue",h.Buffer.alloc(0)),qe(this,"staticKeys",void 0),qe(this,"earlyData",void 0),qe(this,"useNoisePipes",void 0),this.earlyData=r||h.Buffer.alloc(0),this.useNoisePipes=!1,t){var n=f.a.publicKeyCreate(t);this.staticKeys={privateKey:t,publicKey:n}}else this.staticKeys=N()}return Object(u.a)(e,[{key:"secureOutbound",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p()(r,{lengthEncoder:he,lengthDecoder:le,maxDataLength:65535}),e.next=3,this.performHandshake({connection:i,isInitiator:!0,localPeer:t,remotePeer:n});case 3:return s=e.sent,e.next=6,this.createSecureConnection(i,s);case 6:return o=e.sent,e.abrupt("return",{conn:o,remoteEarlyData:s.remoteEarlyData,remotePeer:s.remotePeer});case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"secureInbound",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n){var i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=p()(r,{lengthEncoder:he,lengthDecoder:le,maxDataLength:65535}),e.next=3,this.performHandshake({connection:i,isInitiator:!1,localPeer:t,remotePeer:n});case 3:return s=e.sent,e.next=6,this.createSecureConnection(i,s);case 6:return o=e.sent,e.abrupt("return",{conn:o,remoteEarlyData:s.remoteEarlyData,remotePeer:s.remotePeer});case 8:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"performHandshake",value:function(){var e=Object(s.a)(a.a.mark((function e(t){var r,n,i,s,o,u,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t.localPeer,this.staticKeys.publicKey,this.earlyData);case 2:if(r=e.sent,n=this.useNoisePipes,t.isInitiator&&null===Ue.load(t.remotePeer)&&(n=!1),!n){e.next=22;break}return i=t.remotePeer,s=t.connection,o=t.isInitiator,u=new Te(o,r,this.prologue,this.staticKeys,s,Ue.load(t.remotePeer)||h.Buffer.alloc(32),i),e.prev=8,e.next=11,this.performIKHandshake(u);case 11:return e.abrupt("return",e.sent);case 14:return e.prev=14,e.t0=e.catch(8),t.isInitiator&&(c=u.getLocalEphemeralKeys()),e.next=19,this.performXXFallbackHandshake(t,r,e.t0.initialMsg,c);case 19:return e.abrupt("return",e.sent);case 20:e.next=25;break;case 22:return e.next=24,this.performXXHandshake(t,r);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e,this,[[8,14]])})));return function(t){return e.apply(this,arguments)}}()},{key:"performXXFallbackHandshake",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r,n,i){var s,o,u,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.isInitiator,o=t.remotePeer,u=t.connection,c=new Re(s,r,this.prologue,this.staticKeys,u,n,o,i),e.prev=2,e.next=5,c.propose();case 5:return e.next=7,c.exchange();case 7:return e.next=9,c.finish();case 9:e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(2),ne(e.t0),new Error("Error occurred during XX Fallback handshake: ".concat(e.t0.message));case 15:return e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"performXXHandshake",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var n,i,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.isInitiator,i=t.remotePeer,s=t.connection,o=new ge(n,r,this.prologue,this.staticKeys,s,i),e.prev=2,e.next=5,o.propose();case 5:return e.next=7,o.exchange();case 7:return e.next=9,o.finish();case 9:this.useNoisePipes&&o.remotePeer&&Ue.store(o.remotePeer,o.getRemoteStaticKey()),e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(2),new Error("Error occurred during XX handshake: ".concat(e.t0.message));case 15:return e.abrupt("return",o);case 16:case"end":return e.stop()}}),e,this,[[2,12]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"performIKHandshake",value:function(){var e=Object(s.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.stage0();case 2:return e.next=4,t.stage1();case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createSecureConnection",value:function(){var e=Object(s.a)(a.a.mark((function e(t,r){var i,s,o,u,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=v()(),s=Object(n.a)(i,2),o=s[0],u=s[1],c=t.unwrap(),g()(o,b.a,Le(r),Object(k.encode)({lengthEncoder:he}),c,Object(k.decode)({lengthDecoder:le}),b.a,Ke(r),o),e.abrupt("return",u);case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),e}();r.d(t,"NOISE",(function(){return je})),r.d(t,"Noise",(function(){return ze}));var je=new ze},function(e,t,r){"use strict";var n=r(6),i=r(14),a=r(59),s=r(0),o=r.n(s),u=(r(11),r(16)),c=r(35),f=r(43),h=o.a.forwardRef((function(e,t){var r=e.classes,a=e.className,s=e.component,c=void 0===s?"div":s,h=e.disableGutters,l=void 0!==h&&h,p=e.fixed,d=void 0!==p&&p,v=e.maxWidth,y=void 0===v?"lg":v,b=Object(i.a)(e,["classes","className","component","disableGutters","fixed","maxWidth"]);return o.a.createElement(c,Object(n.a)({className:Object(u.a)(r.root,a,d&&r.fixed,l&&r.disableGutters,!1!==y&&r["maxWidth".concat(Object(f.a)(String(y)))]),ref:t},b))}));t.a=Object(c.a)((function(e){return{root:Object(a.a)({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",paddingLeft:e.spacing(2),paddingRight:e.spacing(2)},e.breakpoints.up("sm"),{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}),disableGutters:{paddingLeft:0,paddingRight:0},fixed:Object.keys(e.breakpoints.values).reduce((function(t,r){var n=e.breakpoints.values[r];return 0!==n&&(t[e.breakpoints.up(r)]={maxWidth:n}),t}),{}),maxWidthXs:Object(a.a)({},e.breakpoints.up("xs"),{maxWidth:Math.max(e.breakpoints.values.xs,444)}),maxWidthSm:Object(a.a)({},e.breakpoints.up("sm"),{maxWidth:e.breakpoints.values.sm}),maxWidthMd:Object(a.a)({},e.breakpoints.up("md"),{maxWidth:e.breakpoints.values.md}),maxWidthLg:Object(a.a)({},e.breakpoints.up("lg"),{maxWidth:e.breakpoints.values.lg}),maxWidthXl:Object(a.a)({},e.breakpoints.up("xl"),{maxWidth:e.breakpoints.values.xl})}}),{name:"MuiContainer"})(h)}])]);
//# sourceMappingURL=3.551495b5.chunk.js.map